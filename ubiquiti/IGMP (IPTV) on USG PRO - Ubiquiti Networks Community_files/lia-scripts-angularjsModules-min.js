;(function(angular){'use strict';var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};angular.module('li.services.utils.lodash-utils',[]).factory('$liLodashUtils',['$window',function($window){;(function(){function n(n,r,t){if(r!==r){n:{for(r=n.length,t+=-1;++t<r;){var e=n[t];if(e!==e){n=t;break n;}}n=-1;}return n;}for(t-=1,e=n.length;++t<e;){if(n[t]===r)return t;}return-1;}function r(n){return null==n?"":n+"";}function t(n){return hr[n];}function e(n){return vr[n];}function u(n){return!!n&&(typeof n==='undefined'?'undefined':_typeof(n))=="object";}function o(n){return gr[n];}function i(){}function a(n){var r=n?n.length:0;for(this.data={hash:Mr(null),set:new Fr()};r--;){this.push(n[r]);}}function c(n,r){var t=n.data;return(typeof r=="string"||hn(r)?t.set.has(r):t.hash[r])?0:-1;}function f(n,r){var t=-1,e=n.length;for(r||(r=Array(e));++t<e;){r[t]=n[t];}return r;}function l(n,r){for(var t=-1,e=n.length;++t<e&&false!==r(n[t],t,n);){}return n;}function s(n,r){for(var t=-1,e=n.length,u=-1,o=[];++t<e;){var i=n[t];r(i,t,n)&&(o[++u]=i);}return o;}function p(n,r){for(var t=-1,e=n.length,u=Array(e);++t<e;){u[t]=r(n[t],t,n);}return u;}function h(n,r){for(var t=-1,e=n.length;++t<e;){if(r(n[t],t,n))return true;}return false;}function v(n,r){var t;if(null==r)t=n;else{t=at(r);var e=n;e||(e={});for(var u=-1,o=t.length;++u<o;){var i=t[u];e[i]=r[i];}t=e;}return t;}function g(n,r,t){var e=typeof n==='undefined'?'undefined':_typeof(n);return"function"==e?r===Sn?n:P(n,r,t):null==n?On:"object"==e?I(n):r===Sn?In(n):S(n,r);}function y(n,r,t,e,u,o,i){var a;if(t&&(a=u?t(n,e,u):t(n)),a!==Sn)return a;if(!hn(n))return n;if(e=ot(n)){if(a=Z(n),!r)return f(n,a);}else{var c=_r.call(n),s=c==Fn;if(c!=qn&&c!=_n&&(!s||u))return pr[c]?Y(n,c,r):u?n:{};if(wr(n))return u?n:{};if(a=V(s?{}:n),!r)return v(a,n);}for(o||(o=[]),i||(i=[]),u=o.length;u--;){if(o[u]==n)return i[u];}return o.push(n),i.push(a),(e?l:A)(n,function(e,u){a[u]=y(e,r,t,u,n,o,i);}),a;}function b(n,r,t,e){var u=e,o=u;return Xr(n,function(n,i,a){i=+r(n,i,a),(t(i,u)||i===e&&i===o)&&(u=i,o=n);}),o;}function d(n,r){var t=[];return Xr(n,function(n,e,u){r(n,e,u)&&t.push(n);}),t;}function x(n,r,t){var e;return t(n,function(n,t,u){return r(n,t,u)?(e=t,false):void 0;}),e;}function m(n,r,t,e){e||(e=[]);for(var o=-1,i=n.length;++o<i;){var a=n[o];if(u(a)&&z(a)&&(t||ot(a)||ln(a))){if(r)m(a,r,t,e);else for(var c=e,f=-1,l=a.length,s=c.length;++f<l;){c[s+f]=a[f];}}else t||(e[e.length]=a);}return e;}function A(n,r){return nt(n,r,at);}function j(n,r,t){if(null!=n){n=X(n),t!==Sn&&t in n&&(r=[t]),t=0;for(var e=r.length;null!=n&&t<e;){n=X(n)[r[t++]];}return t&&t==e?n:Sn;}}function w(n,r,t,e,o,i){if(n===r)n=true;else if(null==n||null==r||!hn(n)&&!u(r))n=n!==n&&r!==r;else n:{var a=w,c=ot(n),f=ot(r),l=Un,s=Un;c||(l=_r.call(n),l==_n?l=qn:l!=qn&&(c=yn(n))),f||(s=_r.call(r),s==_n?s=qn:s!=qn&&yn(r));var p=l==qn&&!wr(n),f=s==qn&&!wr(r),s=l==s;if(!s||c||p){if(!e&&(l=p&&kr.call(n,"__wrapped__"),f=f&&kr.call(r,"__wrapped__"),l||f)){n=a(l?n.value():n,f?r.value():r,t,e,o,i);break n;}if(s){for(o||(o=[]),i||(i=[]),l=o.length;l--;){if(o[l]==n){n=i[l]==r;break n;}}o.push(n),i.push(r),n=(c?q:R)(n,r,a,t,e,o,i),o.pop(),i.pop();}else n=false;}else n=M(n,r,l);}return n;}function O(n,r){var t=r.length,e=t;if(null==n)return!e;for(n=X(n);t--;){var u=r[t];if(u[2]?u[1]!==n[u[0]]:!(u[0]in n))return false;}for(;++t<e;){var u=r[t],o=u[0],i=n[o],a=u[1];if(u[2]){if(i===Sn&&!(o in n))return false;}else if(u=Sn,u===Sn?!w(a,i,void 0,true):!u)return false;}return true;}function E(n,r){var t=-1,e=z(n)?Array(n.length):[];return Xr(n,function(n,u,o){e[++t]=r(n,u,o);}),e;}function I(n){var r=D(n);if(1==r.length&&r[0][2]){var t=r[0][0],e=r[0][1];return function(n){return null==n?false:(n=X(n),n[t]===e&&(e!==Sn||t in n));};}return function(n){return O(n,r);};}function S(n,r){var t=ot(n),e=H(n)&&r===r&&!hn(r),u=n+"";return n=nn(n),function(o){if(null==o)return false;var i=u;if(o=X(o),!(!t&&e||i in o)){if(o=1==n.length?o:j(o,U(n)),null==o)return false;i=tn(n),o=X(o);}return o[i]===r?r!==Sn||i in o:w(r,o[i],Sn,true);};}function T(n){return function(r){return null==r?Sn:X(r)[n];};}function k(n){var r=n+"";return n=nn(n),function(t){return j(t,n,r);};}function _(n,r,t,e,u){return u(n,function(n,u,o){t=e?(e=false,n):r(t,n,u,o);}),t;}function U(n){var r=0,t=-1,e=-1,u=n.length,r=null==r?0:+r||0;for(0>r&&(r=-r>u?0:u+r),t=t===Sn||t>u?u:+t||0,0>t&&(t+=u),u=r>t?0:t-r>>>0,r>>>=0,t=Array(u);++e<u;){t[e]=n[e+r];}return t;}function C(n,r){var t=n.length;for(n.sort(r);t--;){n[t]=n[t].c;}return n;}function N(n,r,t){var e=W(),u=-1;return r=p(r,function(n){return e(n);}),n=E(n,function(n){return{a:p(r,function(r){return r(n);}),b:++u,c:n};}),C(n,function(n,r){var e;n:{e=-1;for(var u=n.a,o=r.a,i=u.length,a=t.length;++e<i;){var c;r:{c=u[e];var f=o[e];if(c!==f){var l=null===c,s=c===Sn,p=c===c,h=null===f,v=f===Sn,g=f===f;if(c>f&&!h||!p||l&&!v&&g||s&&g){c=1;break r;}if(c<f&&!l||!g||h&&!s&&p||v&&p){c=-1;break r;}}c=0;}if(c){if(e>=a){e=c;break n;}e=t[e],e=c*("asc"===e||true===e?1:-1);break n;}}e=n.b-r.b;}return e;});}function P(n,r,t){if(typeof n!="function")return On;if(r===Sn)return n;switch(t){case 1:return function(t){return n.call(r,t);};case 3:return function(t,e,u){return n.call(r,t,e,u);};case 4:return function(t,e,u,o){return n.call(r,t,e,u,o);};case 5:return function(t,e,u,o,i){return n.call(r,t,e,u,o,i);};}return function(){return n.apply(r,arguments);};}function F(n){var r=new Nr(n.byteLength);return new qr(r).set(new qr(n)),r;}function $(n,r){return function(t,e,u){if(u&&K(t,e,u)&&(e=Sn),e=W(e,u,3),1==e.length){ot(t)||(t=null==t?[]:z(t)?i.support.unindexedChars&&gn(t)?t.split(""):hn(t)?t:Object(t):mn(t)),u=t;for(var o=e,a=-1,c=u.length,f=r,l=f;++a<c;){var s=u[a],p=+o(s);n(p,f)&&(f=p,l=s);}if(u=l,!t.length||u!==r)return u;}return b(t,e,n,r);};}function q(n,r,t,e,u,o,i){var a=-1,c=n.length,f=r.length;if(c!=f&&(!u||f<=c))return false;for(;++a<c;){var l=n[a],f=r[a],s=e?e(u?f:l,u?l:f,a):Sn;if(s!==Sn){if(s)continue;return false;}if(u){if(!h(r,function(n){return l===n||t(l,n,e,u,o,i);}))return false;}else if(l!==f&&!t(l,f,e,u,o,i))return false;}return true;}function M(n,r,t){switch(t){case Cn:case Nn:return+n==+r;case Pn:return n.name==r.name&&n.message==r.message;case $n:return n!=+n?r!=+r:n==+r;case Mn:case Rn:return n==r+"";}return false;}function R(n,r,t,e,u,o,i){var a=at(n),c=a.length,f=at(r).length;if(c!=f&&!u)return false;for(f=c;f--;){var l=a[f];if(!(u?l in r:kr.call(r,l)))return false;}for(var s=u;++f<c;){var l=a[f],p=n[l],h=r[l],v=e?e(u?h:p,u?p:h,l):Sn;if(v===Sn?!t(p,h,e,u,o,i):!v)return false;s||(s="constructor"==l);}return s||(t=n.constructor,e=r.constructor,!(t!=e&&"constructor"in n&&"constructor"in r)||typeof t=="function"&&t instanceof t&&typeof e=="function"&&e instanceof e)?true:false;}function W(n,r,t){var e=i.callback||wn,e=e===wn?g:e;return t?e(n,r,t):e;}function B(){var r=i.indexOf||rn;return r=r===rn?n:r;}function D(n){n=xn(n);for(var r=n.length;r--;){var t=n[r][1];n[r][2]=t===t&&!hn(t);}return n;}function L(n,r){var t=null==n?Sn:n[r];return vn(t)?t:Sn;}function Z(n){var r=n.length,t=new n.constructor(r);return r&&"string"==typeof n[0]&&kr.call(n,"index")&&(t.index=n.index,t.input=n.input),t;}function V(n){return n=n.constructor,typeof n=="function"&&n instanceof n||(n=Object),new n();}function Y(n,r,t){var e=n.constructor;switch(r){case Wn:return F(n);case Cn:case Nn:return new e(+n);case Bn:case Dn:case Ln:case Zn:case Vn:case Yn:case zn:case Gn:case Kn:return e instanceof e&&(e=Hr[r]),r=n.buffer,new e(t?F(r):r,n.byteOffset,n.length);case $n:case Rn:return new e(n);case Mn:var u=new e(n.source,or.exec(n));u.lastIndex=n.lastIndex;}return u;}function z(n){return null!=n&&J(rt(n));}function G(n,r){return n=typeof n=="number"||ar.test(n)?+n:-1,r=null==r?Kr:r,-1<n&&0==n%1&&n<r;}
function K(n,r,t){if(!hn(t))return false;var e=typeof r==='undefined'?'undefined':_typeof(r);return("number"==e?z(t)&&G(r,t.length):"string"==e&&r in t)?(r=t[r],n===n?n===r:r!==r):false;}function H(n,r){var t=typeof n==='undefined'?'undefined':_typeof(n);return"string"==t&&rr.test(n)||"number"==t?true:ot(n)?false:!nr.test(n)||null!=r&&n in X(r);}function J(n){return typeof n=="number"&&-1<n&&0==n%1&&n<=Kr;}function Q(n){for(var r=dn(n),t=r.length,e=t&&n.length,u=!!e&&J(e)&&(ot(n)||ln(n)||gn(n)),o=-1,i=[];++o<t;){var a=r[o];(u&&G(a,e)||kr.call(n,a))&&i.push(a);}return i;}function X(n){if(i.support.unindexedChars&&gn(n)){for(var r=-1,t=n.length,e=Object(n);++r<t;){e[r]=n.charAt(r);}return e;}return hn(n)?n:Object(n);}function nn(n){if(ot(n))return n;var t=[];return r(n).replace(tr,function(n,r,e,u){t.push(e?u.replace(ur,"$1"):r||n);}),t;}function rn(r,t,e){var u=r?r.length:0;if(!u)return-1;if(typeof e=="number")e=0>e?Dr(u+e,0):e;else if(e){e=0;var o=r?r.length:e;if(typeof t!="number"||t!==t||o>Gr){o=On,e=o(t);for(var i=0,a=r?r.length:0,c=e!==e,f=null===e,l=e===Sn;i<a;){var s=Rr((i+a)/2),p=o(r[s]),h=p!==Sn,v=p===p;(c?v:f?v&&h&&null!=p:l?v&&h:null==p?0:p<e)?i=s+1:a=s;}e=Lr(a,zr);}else{for(;e<o;){var i=e+o>>>1,a=r[i];a<t&&null!==a?e=i+1:o=i;}e=o;}return e<u&&(t===t?t===r[e]:r[e]!==r[e])?e:-1;}return n(r,t,e||0);}function tn(n){var r=n?n.length:0;return r?n[r-1]:Sn;}function en(r,t,e,u){if(!r||!r.length)return[];null!=t&&typeof t!="boolean"&&(u=e,e=K(r,t,u)?Sn:t,t=false);var o=W();if((null!=e||o!==g)&&(e=o(e,u,3)),t&&B()===n){t=e;var i;e=-1,u=r.length;for(var o=-1,f=[];++e<u;){var l=r[e],s=t?t(l,e,r):l;e&&i===s||(i=s,f[++o]=l);}r=f;}else{i=e,t=-1,e=B(),u=r.length,l=(f=(o=e===n)&&u>=Tn)&&Mr&&Fr?new a(void 0):null,s=[],l?(e=c,o=false):(f=false,l=i?[]:s);n:for(;++t<u;){var p=r[t],h=i?i(p,t,r):p;if(o&&p===p){for(var v=l.length;v--;){if(l[v]===h)continue n;}i&&l.push(h),s.push(p);}else 0>e(l,h,0)&&((i||f)&&l.push(h),s.push(p));}r=s;}return r;}function un(n,r,t){var e=ot(n)?s:d;return r=W(r,t,3),e(n,r);}function on(n,r,t){var e=ot(n)?p:E;return r=W(r,t,3),e(n,r);}function an(n,r,t){function e(r,t){t&&clearTimeout(t),c=p=h=Sn,r&&(v=ut(),f=n.apply(s,a),p||c||(a=s=Sn));}function u(){var n=r-(ut()-l);0>=n||n>r?e(h,c):p=setTimeout(u,n);}function o(){e(y,p);}function i(){if(a=arguments,l=ut(),s=this,h=y&&(p||!b),false===g)var t=b&&!p;else{c||b||(v=l);var e=g-(l-v),i=0>=e||e>g;i?(c&&(c=clearTimeout(c)),v=l,f=n.apply(s,a)):c||(c=setTimeout(o,e));}return i&&p?p=clearTimeout(p):p||r===g||(p=setTimeout(u,r)),t&&(i=true,f=n.apply(s,a)),!i||p||c||(a=s=Sn),f;}var a,c,f,l,s,p,h,v=0,g=false,y=true;if(typeof n!="function")throw new TypeError(kn);if(r=0>r?0:+r||0,true===t)var b=true,y=false;else hn(t)&&(b=!!t.leading,g="maxWait"in t&&Dr(+t.maxWait||0,r),y="trailing"in t?!!t.trailing:y);return i.cancel=function(){p&&clearTimeout(p),c&&clearTimeout(c),v=0,c=p=h=Sn;},i;}function cn(n,r){if(typeof n!="function")throw new TypeError(kn);return r=Dr(r===Sn?n.length-1:+r||0,0),function(){for(var t=arguments,e=-1,u=Dr(t.length-r,0),o=Array(u);++e<u;){o[e]=t[r+e];}switch(r){case 0:return n.call(this,o);case 1:return n.call(this,t[0],o);case 2:return n.call(this,t[0],t[1],o);}for(u=Array(r+1),e=-1;++e<r;){u[e]=t[e];}return u[r]=o,n.apply(this,u);};}function fn(n,r){return n>r;}function ln(n){return u(n)&&z(n)&&kr.call(n,"callee")&&!Pr.call(n,"callee");}function sn(n,r,t,e){return e=(t=typeof t=="function"?P(t,e,3):Sn)?t(n,r):Sn,e===Sn?w(n,r,t):!!e;}function pn(n){return hn(n)&&_r.call(n)==Fn;}function hn(n){var r=typeof n==='undefined'?'undefined':_typeof(n);return!!n&&("object"==r||"function"==r);}function vn(n){return null==n?false:pn(n)?Cr.test(Tr.call(n)):u(n)&&(wr(n)?Cr:ir).test(n);}function gn(n){return typeof n=="string"||u(n)&&_r.call(n)==Rn;}function yn(n){return u(n)&&J(n.length)&&!!sr[_r.call(n)];}function bn(n,r){return n<r;}function dn(n){if(null==n)return[];hn(n)||(n=Object(n));for(var r=n.length,t=i.support,r=r&&J(r)&&(ot(n)||ln(n)||gn(n))&&r||0,e=n.constructor,u=-1,e=pn(e)&&e.prototype||Ir,o=e===n,a=Array(r),c=0<r,f=t.enumErrorProps&&(n===Er||n instanceof Error),l=t.enumPrototypes&&pn(n);++u<r;){a[u]=u+"";}for(var s in n){l&&"prototype"==s||f&&("message"==s||"name"==s)||c&&G(s,r)||"constructor"==s&&(o||!kr.call(n,s))||a.push(s);}if(t.nonEnumShadows&&n!==Ir)for(r=n===Sr?Rn:n===Er?Pn:_r.call(n),t=Jr[r]||Jr[qn],r==qn&&(e=Ir),r=lr.length;r--;){s=lr[r],u=t[s],o&&u||(u?!kr.call(n,s):n[s]===e[s])||a.push(s);}return a;}function xn(n){n=X(n);for(var r=-1,t=at(n),e=t.length,u=Array(e);++r<e;){var o=t[r];u[r]=[o,n[o]];}return u;}function mn(n){for(var r=at(n),t=-1,e=r.length,u=Array(e);++t<e;){u[t]=n[r[t]];}return u;}function An(n){return(n=r(n))&&n.replace(cr,t).replace(er,"");}function jn(n,t,e){return e&&K(n,t,e)&&(t=Sn),n=r(n),n.match(t||fr)||[];}function wn(n,r,t){return t&&K(n,r,t)&&(r=Sn),u(n)?En(n):g(n,r);}function On(n){return n;}function En(n){return I(y(n,true));}function In(n){return H(n)?T(n):k(n);}var Sn,Tn=200,kn="Expected a function",_n="[object Arguments]",Un="[object Array]",Cn="[object Boolean]",Nn="[object Date]",Pn="[object Error]",Fn="[object Function]",$n="[object Number]",qn="[object Object]",Mn="[object RegExp]",Rn="[object String]",Wn="[object ArrayBuffer]",Bn="[object Float32Array]",Dn="[object Float64Array]",Ln="[object Int8Array]",Zn="[object Int16Array]",Vn="[object Int32Array]",Yn="[object Uint8Array]",zn="[object Uint8ClampedArray]",Gn="[object Uint16Array]",Kn="[object Uint32Array]",Hn=/&(?:amp|lt|gt|quot|#39|#96);/g,Jn=/[&<>"'`]/g,Qn=RegExp(Hn.source),Xn=RegExp(Jn.source),nr=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,rr=/^\w*$/,tr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,er=/[\u0300-\u036f\ufe20-\ufe23]/g,ur=/\\(\\)?/g,or=/\w*$/,ir=/^\[object .+?Constructor\]$/,ar=/^\d+$/,cr=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,fr=RegExp("[A-Z\\xc0-\\xd6\\xd8-\\xde]+(?=[A-Z\\xc0-\\xd6\\xd8-\\xde][a-z\\xdf-\\xf6\\xf8-\\xff]+)|[A-Z\\xc0-\\xd6\\xd8-\\xde]?[a-z\\xdf-\\xf6\\xf8-\\xff]+|[A-Z\\xc0-\\xd6\\xd8-\\xde]+|[0-9]+","g"),lr="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),sr={};sr[Bn]=sr[Dn]=sr[Ln]=sr[Zn]=sr[Vn]=sr[Yn]=sr[zn]=sr[Gn]=sr[Kn]=true,sr[_n]=sr[Un]=sr[Wn]=sr[Cn]=sr[Nn]=sr[Pn]=sr[Fn]=sr["[object Map]"]=sr[$n]=sr[qn]=sr[Mn]=sr["[object Set]"]=sr[Rn]=sr["[object WeakMap]"]=false;var pr={};pr[_n]=pr[Un]=pr[Wn]=pr[Cn]=pr[Nn]=pr[Bn]=pr[Dn]=pr[Ln]=pr[Zn]=pr[Vn]=pr[$n]=pr[qn]=pr[Mn]=pr[Rn]=pr[Yn]=pr[zn]=pr[Gn]=pr[Kn]=true,pr[Pn]=pr[Fn]=pr["[object Map]"]=pr["[object Set]"]=pr["[object WeakMap]"]=false;var hr={"\xc0":"A","\xc1":"A","\xc2":"A","\xc3":"A","\xc4":"A","\xc5":"A","\xe0":"a","\xe1":"a","\xe2":"a","\xe3":"a","\xe4":"a","\xe5":"a","\xc7":"C","\xe7":"c","\xd0":"D","\xf0":"d","\xc8":"E","\xc9":"E","\xca":"E","\xcb":"E","\xe8":"e","\xe9":"e","\xea":"e","\xeb":"e","\xcc":"I","\xcd":"I","\xce":"I","\xcf":"I","\xec":"i","\xed":"i","\xee":"i","\xef":"i","\xd1":"N","\xf1":"n","\xd2":"O","\xd3":"O","\xd4":"O","\xd5":"O","\xd6":"O","\xd8":"O","\xf2":"o","\xf3":"o","\xf4":"o","\xf5":"o","\xf6":"o","\xf8":"o","\xd9":"U","\xda":"U","\xdb":"U","\xdc":"U","\xf9":"u","\xfa":"u","\xfb":"u","\xfc":"u","\xdd":"Y","\xfd":"y","\xff":"y","\xc6":"Ae","\xe6":"ae","\xde":"Th","\xfe":"th","\xdf":"ss"},vr={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},gr={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},yr={"function":true,object:true},br=yr[typeof exports==='undefined'?'undefined':_typeof(exports)]&&exports&&!exports.nodeType&&exports,dr=yr[typeof module==='undefined'?'undefined':_typeof(module)]&&module&&!module.nodeType&&module,xr=yr[typeof self==='undefined'?'undefined':_typeof(self)]&&self&&self.Object&&self,mr=yr[typeof window==='undefined'?'undefined':_typeof(window)]&&window&&window.Object&&window,Ar=dr&&dr.exports===br&&br,jr=br&&dr&&(typeof global==='undefined'?'undefined':_typeof(global))=="object"&&global&&global.Object&&global||mr!==(this&&this.window)&&mr||xr||this,wr=function(){try{Object({toString:0}+"");}catch(n){return function(){return false;};}return function(n){return typeof n.toString!="function"&&typeof(n+"")=="string";};}(),Or=Array.prototype,Er=Error.prototype,Ir=Object.prototype,Sr=String.prototype,Tr=Function.prototype.toString,kr=Ir.hasOwnProperty,_r=Ir.toString,Ur=jr._,Cr=RegExp("^"+Tr.call(kr).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Nr=jr.ArrayBuffer,Pr=Ir.propertyIsEnumerable,Fr=L(jr,"Set"),$r=Or.splice,qr=jr.Uint8Array,Mr=L(Object,"create"),Rr=Math.floor,Wr=L(Array,"isArray"),Br=L(Object,"keys"),Dr=Math.max,Lr=Math.min,Zr=L(Date,"now"),Vr=Number.NEGATIVE_INFINITY,Yr=Number.POSITIVE_INFINITY,zr=4294967294,Gr=2147483647,Kr=9007199254740991,Hr={};Hr[Bn]=jr.Float32Array,Hr[Dn]=jr.Float64Array,Hr[Ln]=jr.Int8Array,Hr[Zn]=jr.Int16Array,Hr[Vn]=jr.Int32Array,Hr[Yn]=qr,Hr[zn]=jr.Uint8ClampedArray,Hr[Gn]=jr.Uint16Array,Hr[Kn]=jr.Uint32Array;var Jr={};Jr[Un]=Jr[Nn]=Jr[$n]={constructor:true,toLocaleString:true,toString:true,valueOf:true},Jr[Cn]=Jr[Rn]={constructor:true,toString:true,valueOf:true},Jr[Pn]=Jr[Fn]=Jr[Mn]={constructor:true,toString:true},Jr[qn]={constructor:true},l(lr,function(n){for(var r in Jr){if(kr.call(Jr,r)){var t=Jr[r];t[n]=kr.call(t,n);}}});var Qr=i.support={};!function(n){function r(){this.x=n;}var t={0:n,length:n},e=[];r.prototype={valueOf:n,y:n};for(var u in new r()){e.push(u);}Qr.enumErrorProps=Pr.call(Er,"message")||Pr.call(Er,"name"),Qr.enumPrototypes=Pr.call(r,"prototype"),Qr.nonEnumShadows=!/valueOf/.test(e),Qr.spliceObjects=($r.call(t,0,1),!t[0]),Qr.unindexedChars="xx"!="x"[0]+Object("x")[0];}(1,0);var Xr=function(n,r){return function(t,e){var u=t?rt(t):0;if(!J(u))return n(t,e);for(var o=r?u:-1,i=X(t);(r?o--:++o<u)&&false!==e(i[o],o,i);){}return t;};}(A),nt=function(n){return function(r,t,e){var u=X(r);e=e(r);for(var o=e.length,i=n?o:-1;n?i--:++i<o;){var a=e[i];if(false===t(u[a],a,u))break;}return r;};}(),rt=T("length"),tt=cn(function(r,t){var e;if(u(r)&&z(r)){e=m(t,false,true);var o=r?r.length:0,i=[];if(o){var f=-1,l=B(),s=l===n,p=s&&e.length>=Tn&&Mr&&Fr?new a(e):null,h=e.length;p&&(l=c,s=false,e=p);n:for(;++f<o;){if(p=r[f],s&&p===p){for(var v=h;v--;){if(e[v]===p)continue n;}i.push(p);}else 0>l(e,p,0)&&i.push(p);}}e=i;}else e=[];return e;}),et=function(n,r){return function(t,e,u,o){var i=3>arguments.length;return typeof e=="function"&&o===Sn&&ot(t)?n(t,e,u,i):_(t,W(e,o,4),u,i,r);};}(function(n,r,t,e){var u=-1,o=n.length;for(e&&o&&(t=n[++u]);++u<o;){t=r(t,n[u],u,n);}return t;},Xr),ut=Zr||function(){return new Date().getTime();},ot=Wr||function(n){return u(n)&&J(n.length)&&_r.call(n)==Un;},it=function(n){return function(r,t,e){return t=W(t,e,3),x(r,t,n);};}(A),at=Br?function(n){var r=null==n?Sn:n.constructor;return typeof r=="function"&&r.prototype===n||(typeof n=="function"?i.support.enumPrototypes:z(n))?Q(n):hn(n)?Br(n):[];}:Q,ct=function(n){return function(r){var t=-1;r=jn(An(r));for(var e=r.length,u="";++t<e;){u=n(u,r[t],t);}return u;};}(function(n,r,t){return n+(t?"-":"")+r.toLowerCase();}),ft=$(fn,Vr),lt=$(bn,Yr);a.prototype.push=function(n){var r=this.data;typeof n=="string"||hn(n)?r.set.add(n):r.hash[n]=true;},i.callback=wn,i.debounce=an,i.difference=tt,i.filter=un,i.flatten=function(n,r,t){var e=n?n.length:0;return t&&K(n,r,t)&&(r=false),e?m(n,r):[];},i.keys=at,i.keysIn=dn,i.map=on,i.matches=En,i.pairs=xn,i.pluck=function(n,r){return on(n,In(r));},i.property=In,i.restParam=cn,i.set=function(n,r,t){if(null==n)return n;var e=r+"";r=null!=n[e]||H(r,n)?[e]:nn(r);for(var e=-1,u=r.length,o=u-1,i=n;null!=i&&++e<u;){var a=r[e];hn(i)&&(e==o?i[a]=t:null==i[a]&&(i[a]=G(r[e+1])?[]:{})),i=i[a];}return n;},i.sortByOrder=function(n,r,t,e){return null==n?[]:(e&&K(r,t,e)&&(t=Sn),ot(r)||(r=null==r?[]:[r]),ot(t)||(t=null==t?[]:[t]),N(n,r,t));},i.throttle=function(n,r,t){var e=true,u=true;if(typeof n!="function")throw new TypeError(kn);return false===t?e=false:hn(t)&&(e="leading"in t?!!t.leading:e,u="trailing"in t?!!t.trailing:u),an(n,r,{leading:e,maxWait:+r,trailing:u});},i.toArray=function(n){var r=n?rt(n):0;return J(r)?r?i.support.unindexedChars&&gn(n)?n.split(""):f(n):[]:mn(n);},i.uniq=en,i.values=mn,i.collect=on,i.iteratee=wn,i.select=un,i.unique=en,i.deburr=An,i.escape=function(n){return(n=r(n))&&Xn.test(n)?n.replace(Jn,e):n;},i.findKey=it,i.get=function(n,r,t){return n=null==n?Sn:j(n,nn(r),r+""),n===Sn?t:n;},i.gt=fn,i.has=function(n,r){if(null==n)return false;var t=kr.call(n,r);if(!t&&!H(r)){if(r=nn(r),n=1==r.length?n:j(n,U(r)),null==n)return false;r=tn(r),t=kr.call(n,r);}return t||J(n.length)&&G(r,n.length)&&(ot(n)||ln(n)||gn(n));},i.identity=On,i.indexOf=rn,i.isArguments=ln,i.isArray=ot,i.isEmpty=function(n){return null==n?true:z(n)&&(ot(n)||gn(n)||ln(n)||u(n)&&pn(n.splice))?!n.length:!at(n).length;},i.isEqual=sn,i.isFunction=pn,i.isNative=vn,i.isObject=hn,i.isString=gn,i.isTypedArray=yn,i.kebabCase=ct,i.last=tn,i.lt=bn,i.max=ft,i.min=lt,i.noConflict=function(){return jr._=Ur,this;},i.now=ut,i.reduce=et,i.unescape=function(n){return(n=r(n))&&Qn.test(n)?n.replace(Hn,o):n;},i.words=jn,i.eq=sn,i.foldl=et,i.inject=et,i.VERSION="3.10.1",typeof define=="function"&&_typeof(define.amd)=="object"&&define.amd?(jr._=i,define(function(){return i;})):br&&dr?Ar?(dr.exports=i)._=i:br._=i:jr._=i;}).call(this);var localLodash=$window._.noConflict();return{debounce:localLodash.debounce,throttle:localLodash.throttle,noConflict:localLodash.noConflict,escape:localLodash.escape,unescape:localLodash.unescape,get:localLodash.get,set:localLodash.set,has:localLodash.has,isEmpty:localLodash.isEmpty,map:localLodash.map,findKey:localLodash.findKey,uniq:localLodash.uniq,sortByOrder:localLodash.sortByOrder,reduce:localLodash.reduce,flatten:localLodash.flatten,toArray:localLodash.toArray,keys:localLodash.keys,kebabCase:localLodash.kebabCase,isEqual:localLodash.isEqual,difference:localLodash.difference,pluck:localLodash.pluck,filter:localLodash.filter,values:localLodash.values,min:localLodash.min,max:localLodash.max};}]);})(window.LITHIUM&&LITHIUM.angular||angular);
;(function(angular){'use strict';angular.module('li.services.community.context-manager',['li.services.utils.lodash-utils']).factory('$liContextManager',['$liLodashUtils','$window',function($liLodashUtils,$window){var context=$liLodashUtils.get($window,'LITHIUM.CommunityJsonObject',{});function transformKey(key){if(key==='nodeType'){return'type';}
return key.replace(/([A-Z])/g,function($1){return'_'+$1.toLowerCase();});}
function deepTransform(obj){if(obj===undefined){return{};}else if(!angular.isObject(obj)){return obj;}else if(angular.isDate(obj)){return new Date(obj);}else if(angular.isArray(obj)){return obj.map(function(item){return deepTransform(item);});}else{var _obj={};for(var key in obj){var _key=transformKey(key);_obj[_key]=deepTransform(obj[key]);if(_key==='type'){_obj[_key]=_obj[_key].toLowerCase();}}
return _obj;}}
return{community:function community(){return deepTransform(context.Community);},server:function server(){return deepTransform(context.Server);},config:function config(){return deepTransform(context.Config);},validation:function validation(){return deepTransform(context.Validation);},coreNode:function coreNode(){return deepTransform(context.CoreNode);},page:function page(){return deepTransform(context.Page);},currentUser:function currentUser(){var _user=deepTransform(context.User);delete _user.settings;return _user;},currentUserSettings:function currentUserSettings(){return deepTransform(context.User&&context.User.settings);},currentUserPolicies:function currentUserPolicies(){return deepTransform(context.User&&context.User.policies);},topLevelNode:function topLevelNode(){return deepTransform(context.TopLevelNode);},nodeContainer:function nodeContainer(){return deepTransform(context.NodeContainer);}};}]);})(window.LITHIUM&&LITHIUM.angular||angular);

(function(window,angular,undefined){'use strict';var ngRouteModule=angular.module('ngRoute',['ng']).provider('$route',$RouteProvider),$routeMinErr=angular.$$minErr('ngRoute');function $RouteProvider(){function inherit(parent,extra){return angular.extend(Object.create(parent),extra);}
var routes={};this.when=function(path,route){var routeCopy=angular.copy(route);if(angular.isUndefined(routeCopy.reloadOnSearch)){routeCopy.reloadOnSearch=true;}
if(angular.isUndefined(routeCopy.caseInsensitiveMatch)){routeCopy.caseInsensitiveMatch=this.caseInsensitiveMatch;}
routes[path]=angular.extend(routeCopy,path&&pathRegExp(path,routeCopy));if(path){var redirectPath=(path[path.length-1]=='/')?path.substr(0,path.length-1):path+'/';routes[redirectPath]=angular.extend({redirectTo:path},pathRegExp(redirectPath,routeCopy));}
return this;};this.caseInsensitiveMatch=false;function pathRegExp(path,opts){var insensitive=opts.caseInsensitiveMatch,ret={originalPath:path,regexp:path},keys=ret.keys=[];path=path.replace(/([().])/g,'\\$1').replace(/(\/)?:(\w+)([\?\*])?/g,function(_,slash,key,option){var optional=option==='?'?option:null;var star=option==='*'?option:null;keys.push({name:key,optional:!!optional});slash=slash||'';return''
+(optional?'':slash)
+'(?:'
+(optional?slash:'')
+(star&&'(.+?)'||'([^/]+)')
+(optional||'')
+')'
+(optional||'');}).replace(/([\/$\*])/g,'\\$1');ret.regexp=new RegExp('^'+path+'$',insensitive?'i':'');return ret;}
this.otherwise=function(params){if(typeof params==='string'){params={redirectTo:params};}
this.when(null,params);return this;};this.$get=['$rootScope','$location','$routeParams','$q','$injector','$templateRequest','$sce',function($rootScope,$location,$routeParams,$q,$injector,$templateRequest,$sce){var forceReload=false,preparedRoute,preparedRouteIsUpdateOnly,$route={routes:routes,reload:function(){forceReload=true;$rootScope.$evalAsync(function(){prepareRoute();commitRoute();});},updateParams:function(newParams){if(this.current&&this.current.$$route){newParams=angular.extend({},this.current.params,newParams);$location.path(interpolate(this.current.$$route.originalPath,newParams));$location.search(newParams);}else{throw $routeMinErr('norout','Tried updating route when with no current route');}}};$rootScope.$on('$locationChangeStart',prepareRoute);$rootScope.$on('$locationChangeSuccess',commitRoute);return $route;function switchRouteMatcher(on,route){var keys=route.keys,params={};if(!route.regexp)return null;var m=route.regexp.exec(on);if(!m)return null;for(var i=1,len=m.length;i<len;++i){var key=keys[i-1];var val=m[i];if(key&&val){params[key.name]=val;}}
return params;}
function prepareRoute($locationEvent){var lastRoute=$route.current;preparedRoute=parseRoute();preparedRouteIsUpdateOnly=preparedRoute&&lastRoute&&preparedRoute.$$route===lastRoute.$$route&&angular.equals(preparedRoute.pathParams,lastRoute.pathParams)&&!preparedRoute.reloadOnSearch&&!forceReload;if(!preparedRouteIsUpdateOnly&&(lastRoute||preparedRoute)){if($rootScope.$broadcast('$routeChangeStart',preparedRoute,lastRoute).defaultPrevented){if($locationEvent){$locationEvent.preventDefault();}}}}
function commitRoute(){var lastRoute=$route.current;var nextRoute=preparedRoute;if(preparedRouteIsUpdateOnly){lastRoute.params=nextRoute.params;angular.copy(lastRoute.params,$routeParams);$rootScope.$broadcast('$routeUpdate',lastRoute);}else if(nextRoute||lastRoute){forceReload=false;$route.current=nextRoute;if(nextRoute){if(nextRoute.redirectTo){if(angular.isString(nextRoute.redirectTo)){$location.path(interpolate(nextRoute.redirectTo,nextRoute.params)).search(nextRoute.params).replace();}else{$location.url(nextRoute.redirectTo(nextRoute.pathParams,$location.path(),$location.search())).replace();}}}
$q.when(nextRoute).then(function(){if(nextRoute){var locals=angular.extend({},nextRoute.resolve),template,templateUrl;angular.forEach(locals,function(value,key){locals[key]=angular.isString(value)?$injector.get(value):$injector.invoke(value,null,null,key);});if(angular.isDefined(template=nextRoute.template)){if(angular.isFunction(template)){template=template(nextRoute.params);}}else if(angular.isDefined(templateUrl=nextRoute.templateUrl)){if(angular.isFunction(templateUrl)){templateUrl=templateUrl(nextRoute.params);}
if(angular.isDefined(templateUrl)){nextRoute.loadedTemplateUrl=$sce.valueOf(templateUrl);template=$templateRequest(templateUrl);}}
if(angular.isDefined(template)){locals['$template']=template;}
return $q.all(locals);}}).then(function(locals){if(nextRoute==$route.current){if(nextRoute){nextRoute.locals=locals;angular.copy(nextRoute.params,$routeParams);}
$rootScope.$broadcast('$routeChangeSuccess',nextRoute,lastRoute);}},function(error){if(nextRoute==$route.current){$rootScope.$broadcast('$routeChangeError',nextRoute,lastRoute,error);}});}}
function parseRoute(){var params,match;angular.forEach(routes,function(route,path){if(!match&&(params=switchRouteMatcher($location.path(),route))){match=inherit(route,{params:angular.extend({},$location.search(),params),pathParams:params});match.$$route=route;}});return match||routes[null]&&inherit(routes[null],{params:{},pathParams:{}});}
function interpolate(string,params){var result=[];angular.forEach((string||'').split(':'),function(segment,i){if(i===0){result.push(segment);}else{var segmentMatch=segment.match(/(\w+)(?:[?*])?(.*)/);var key=segmentMatch[1];result.push(params[key]);result.push(segmentMatch[2]||'');delete params[key];}});return result.join('');}}];}
ngRouteModule.provider('$routeParams',$RouteParamsProvider);function $RouteParamsProvider(){this.$get=function(){return{};};}
ngRouteModule.directive('ngView',ngViewFactory);ngRouteModule.directive('ngView',ngViewFillContentFactory);ngViewFactory.$inject=['$route','$anchorScroll','$animate'];function ngViewFactory($route,$anchorScroll,$animate){return{restrict:'ECA',terminal:true,priority:400,transclude:'element',link:function(scope,$element,attr,ctrl,$transclude){var currentScope,currentElement,previousLeaveAnimation,autoScrollExp=attr.autoscroll,onloadExp=attr.onload||'';scope.$on('$routeChangeSuccess',update);update();function cleanupLastView(){if(previousLeaveAnimation){$animate.cancel(previousLeaveAnimation);previousLeaveAnimation=null;}
if(currentScope){currentScope.$destroy();currentScope=null;}
if(currentElement){previousLeaveAnimation=$animate.leave(currentElement);previousLeaveAnimation.then(function(){previousLeaveAnimation=null;});currentElement=null;}}
function update(){var locals=$route.current&&$route.current.locals,template=locals&&locals.$template;if(angular.isDefined(template)){var newScope=scope.$new();var current=$route.current;var clone=$transclude(newScope,function(clone){$animate.enter(clone,null,currentElement||$element).then(function onNgViewEnter(){if(angular.isDefined(autoScrollExp)&&(!autoScrollExp||scope.$eval(autoScrollExp))){$anchorScroll();}});cleanupLastView();});currentElement=clone;currentScope=current.scope=newScope;currentScope.$emit('$viewContentLoaded');currentScope.$eval(onloadExp);}else{cleanupLastView();}}}};}
ngViewFillContentFactory.$inject=['$compile','$controller','$route'];function ngViewFillContentFactory($compile,$controller,$route){return{restrict:'ECA',priority:-400,link:function(scope,$element){var current=$route.current,locals=current.locals;$element.html(locals.$template);var link=$compile($element.contents());if(current.controller){locals.$scope=scope;var controller=$controller(current.controller,locals);if(current.controllerAs){scope[current.controllerAs]=controller;}
$element.data('$ngControllerController',controller);$element.children().data('$ngControllerController',controller);}
link(scope);}};}})(window,window.angular);
;(function(angular){'use strict';angular.module('li.services.utils.url-manager',['li.services.community.context-manager','ngRoute']).constant('$liUrlManagerConfig',{ImageServerPage:{path:{required:['image-id'],optional:['image-size','crop-image','image-dimensions']},tpl:'{{tapestryContext}}/image/serverpage'},GalleryPage:{path:{optional:['user-id','tab']},tpl:'{{tapestryContext}}/media/gallerypage'},KudosMessagePage:{path:{optional:['image-id','message-uid','tab']},tpl:'{{tapestryContext}}/kudos/messagepage'},NotificationFeedPage:{tpl:'{{tapestryContext}}/notificationfeed/page'},PrivateNotesPage:{tpl:'{{tapestryContext}}/notes/privatenotespage'},RatingDetailPage:{path:{required:['message-uid','rating-system']},tpl:'{{tapestryContext}}/ratings/ratingdetailpage'},RecentPostsPage:{path:{optional:['post-type','user-id']},tpl:'{{tapestryContext}}/forums/recentpostspage'},MyProfilePage:{path:{optional:['tab']},tpl:'{{tapestryContext}}/user/myprofilepage'},ProfilePlusPage:{tpl:'{{tapestryContext}}/integratedprofile/profilepluspage'},Params:{LABEL_NAME:'label-name',TAB:'tab',SORT_STRING:'sort-string'},SearchPage:{path:{required:['tab']},query:{optional:['filter','location','q','include_ideas','f']},tpl:'{{tapestryContext}}/forums/searchpage'},RegistrationPage:{tpl:'{{tapestryContext}}/user/userregistrationpage'},VerifyEmailPage:{tpl:'{{tapestryContext}}/user/myprofilepage/tab/personal-profile:email'}}).factory('$liUrlManager',['$location','$window','$liUrlManagerConfig','$log','$interpolate','$liContextManager',function($location,$window,$liUrlManagerConfig,$log,$interpolate,$liContextManager){return{forceRedirect:function forceRedirect(url,$routeParams,params){var query=[];for(var key in params){if($routeParams[key]){if($routeParams[key]!==params[key]){url=url.replace(key+'='+$routeParams[key],key+'='+encodeURIComponent(params[key]));}}else{query.push(key+'='+encodeURIComponent(params[key]));}}
if(query.length>0){if(url.indexOf('?')>0){url=url+'&'+query.join('&');}else{url=url+'?'+query.join('&');}}
$window.location=url;},getHostName:function getHostName(url){var link=document.createElement('a');link.setAttribute('href',url);return link.hostname;},getPath:function getPath(url){var link=document.createElement('a');link.setAttribute('href',url);return link.pathname;},buildUrl:function buildUrl(key,params){var def=$liUrlManagerConfig[key];var pathItems=[];var queryItems=[];var hasError=false;function add(items,keys,params,required){if(keys){for(var i=0;i<keys.length;i++){var key=keys[i];if(required&&!params.hasOwnProperty(key)){hasError=true;$log.error('Required value [%s] was not specified',key,params);}else if(params.hasOwnProperty(key)){items.push({key:key,value:params[key]});}}}}
if(def&&def.tpl){var url;var path;var query;var queryPairs;var fragment;params=params||{};params.tapestryContext=$liContextManager.server().tapestry_prefix;if(def.path){add(pathItems,def.path.required,params,true);add(pathItems,def.path.optional,params,false);}
if(def.query){add(queryItems,def.query.required,params,true);add(queryItems,def.query.optional,params,false);}
fragment=params.fragment?'#'+params.fragment:'';if(hasError){return null;}
url=$interpolate($liUrlManagerConfig[key].tpl)(params);path=url.split('?')[0]||'';query=url.split('?')[1]||'';queryPairs=query?query.split('&'):[];angular.forEach(pathItems,function(pathItem){path+='/'+pathItem.key+'/'+pathItem.value;});angular.forEach(queryItems,function(queryItem){queryPairs.push(queryItem.key+'='+$window.encodeURIComponent(queryItem.value));});query=queryPairs.length>0?'?'+queryPairs.join('&'):'';return path+query+fragment;}else{$log.error('No URL exists for %s',key);}
return null;},adjustUrl:function adjustUrl(url){var path=url.split('?')[0]||url;var query=url.split('?')[1]||'';var queryPairs=query?query.split('&'):[];var fragment='';var urlAdjuster={addPathParam:function addPathParam(pathKey,pathValue){this.removePathParam(pathKey);path+='/'+pathKey+'/'+pathValue;return urlAdjuster;},removePathParam:function removePathParam(pathKey){var prefixPath;var postfixPath;var pathValueEndIndex;var pathItems=path.split('/'+pathKey+'/');if(pathItems.length===1){return urlAdjuster;}
if(pathItems.length!==2){throw'Either the url has more than one path key that was specified or the path key specified is not '+'present. url: '+url+'pathkey: '+pathKey;}
prefixPath=pathItems[0];pathValueEndIndex=pathItems[1].indexOf('/');if(pathValueEndIndex===-1){pathValueEndIndex=pathItems[1].indexOf('?');}
if(pathValueEndIndex===-1){path=prefixPath;}else{postfixPath=pathItems[1].substr(pathValueEndIndex+1);path=prefixPath+'/'+postfixPath;}
return urlAdjuster;},addQueryParam:function addQueryParam(key,value){this.removeQueryParam(key);queryPairs.push(key+'='+$window.encodeURIComponent(value));return urlAdjuster;},removeQueryParam:function removeQueryParam(key){queryPairs=queryPairs.filter(function(value){return value.indexOf(key)!==0;});return urlAdjuster;},compileQueryParams:function compileQueryParams(params){var compiledPairs=[];angular.forEach(queryPairs,function(val){var parts=val.split('=');if(parts.length===2){var queryVal=$window.decodeURIComponent(parts[1]);var compiled=$interpolate(queryVal)(params);compiledPairs.push(parts[0]+'='+$window.encodeURIComponent(compiled));}});queryPairs=compiledPairs;return urlAdjuster;},addFragment:function addFragment(val){fragment=val?'#'+val:'';return urlAdjuster;},build:function build(){query=queryPairs.length>0?'?'+queryPairs.join('&'):'';return path+query+fragment;}};return urlAdjuster;},getPathParameter:function getPathParameter(param,url){var path=url?this.getPath(url):$window.location.pathname;var pathParts=path.split('/');var idx=pathParts.indexOf(param);if(idx>-1&&pathParts.length-1>idx){return decodeURI(pathParts[idx+1]);}else{return null;}},validUrl:function validUrl(url){var urlExp=new RegExp('(http|https)://[\\w-]+(\\.[\\w-]+)+([\\w-.,@?^=%&:/~+#-]*[\\w@?^=%&;/~+#-])?');return url.match(urlExp)!==null;},getImageExtension:function getImageExtension(url){var pathIndex,extensionIndex,protocolIndex;if(url.indexOf('http://')!==-1){protocolIndex=url.indexOf('http://');url=url.substring(protocolIndex+8);}else if(url.indexOf('https://')!==-1){protocolIndex=url.indexOf('http://');url=url.substring(protocolIndex+9);}
pathIndex=url.lastIndexOf('/');extensionIndex=url.lastIndexOf('.');if(pathIndex===-1||pathIndex>extensionIndex){return'';}else{return url.substring(extensionIndex+1);}},getImageFileName:function getImageFileName(url){if(this.validUrl(url)&&this.getImageExtension(url)){var pathIndex=url.lastIndexOf('/');var extensionIndex=url.lastIndexOf('.');return url.substring(pathIndex+1,extensionIndex);}else{return'';}},goto:function goto(url){$window.location.href=url;},getCurrentUrl:function getCurrentUrl(){return $location.absUrl();}};}]);})(window.LITHIUM&&LITHIUM.angular||angular);

(function(window,angular,undefined){'use strict';var $resourceMinErr=angular.$$minErr('$resource');var MEMBER_NAME_REGEX=/^(\.[a-zA-Z_$@][0-9a-zA-Z_$@]*)+$/;function isValidDottedPath(path){return(path!=null&&path!==''&&path!=='hasOwnProperty'&&MEMBER_NAME_REGEX.test('.'+path));}
function lookupDottedPath(obj,path){if(!isValidDottedPath(path)){throw $resourceMinErr('badmember','Dotted member path "@{0}" is invalid.',path);}
var keys=path.split('.');for(var i=0,ii=keys.length;i<ii&&angular.isDefined(obj);i++){var key=keys[i];obj=(obj!==null)?obj[key]:undefined;}
return obj;}
function shallowClearAndCopy(src,dst){dst=dst||{};angular.forEach(dst,function(value,key){delete dst[key];});for(var key in src){if(src.hasOwnProperty(key)&&!(key.charAt(0)==='$'&&key.charAt(1)==='$')){dst[key]=src[key];}}
return dst;}
angular.module('ngResource',['ng']).provider('$resource',function(){var PROTOCOL_AND_DOMAIN_REGEX=/^https?:\/\/[^\/]*/;var provider=this;this.defaults={stripTrailingSlashes:true,actions:{'get':{method:'GET'},'save':{method:'POST'},'query':{method:'GET',isArray:true},'remove':{method:'DELETE'},'delete':{method:'DELETE'}}};this.$get=['$http','$q',function($http,$q){var noop=angular.noop,forEach=angular.forEach,extend=angular.extend,copy=angular.copy,isFunction=angular.isFunction;function encodeUriSegment(val){return encodeUriQuery(val,true).replace(/%26/gi,'&').replace(/%3D/gi,'=').replace(/%2B/gi,'+');}
function encodeUriQuery(val,pctEncodeSpaces){return encodeURIComponent(val).replace(/%40/gi,'@').replace(/%3A/gi,':').replace(/%24/g,'$').replace(/%2C/gi,',').replace(/%20/g,(pctEncodeSpaces?'%20':'+'));}
function Route(template,defaults){this.template=template;this.defaults=extend({},provider.defaults,defaults);this.urlParams={};}
Route.prototype={setUrlParams:function(config,params,actionUrl){var self=this,url=actionUrl||self.template,val,encodedVal,protocolAndDomain='';var urlParams=self.urlParams={};forEach(url.split(/\W/),function(param){if(param==='hasOwnProperty'){throw $resourceMinErr('badname',"hasOwnProperty is not a valid parameter name.");}
if(!(new RegExp("^\\d+$").test(param))&&param&&(new RegExp("(^|[^\\\\]):"+param+"(\\W|$)").test(url))){urlParams[param]=true;}});url=url.replace(/\\:/g,':');url=url.replace(PROTOCOL_AND_DOMAIN_REGEX,function(match){protocolAndDomain=match;return'';});params=params||{};forEach(self.urlParams,function(_,urlParam){val=params.hasOwnProperty(urlParam)?params[urlParam]:self.defaults[urlParam];if(angular.isDefined(val)&&val!==null){encodedVal=encodeUriSegment(val);url=url.replace(new RegExp(":"+urlParam+"(\\W|$)","g"),function(match,p1){return encodedVal+p1;});}else{url=url.replace(new RegExp("(\/?):"+urlParam+"(\\W|$)","g"),function(match,leadingSlashes,tail){if(tail.charAt(0)=='/'){return tail;}else{return leadingSlashes+tail;}});}});if(self.defaults.stripTrailingSlashes){url=url.replace(/\/+$/,'')||'/';}
url=url.replace(/\/\.(?=\w+($|\?))/,'.');config.url=protocolAndDomain+url.replace(/\/\\\./,'/.');forEach(params,function(value,key){if(!self.urlParams[key]){config.params=config.params||{};config.params[key]=value;}});}};function resourceFactory(url,paramDefaults,actions,options){var route=new Route(url,options);actions=extend({},provider.defaults.actions,actions);function extractParams(data,actionParams){var ids={};actionParams=extend({},paramDefaults,actionParams);forEach(actionParams,function(value,key){if(isFunction(value)){value=value();}
ids[key]=value&&value.charAt&&value.charAt(0)=='@'?lookupDottedPath(data,value.substr(1)):value;});return ids;}
function defaultResponseInterceptor(response){return response.resource;}
function Resource(value){shallowClearAndCopy(value||{},this);}
Resource.prototype.toJSON=function(){var data=extend({},this);delete data.$promise;delete data.$resolved;return data;};forEach(actions,function(action,name){var hasBody=/^(POST|PUT|PATCH)$/i.test(action.method);Resource[name]=function(a1,a2,a3,a4){var params={},data,success,error;switch(arguments.length){case 4:error=a4;success=a3;case 3:case 2:if(isFunction(a2)){if(isFunction(a1)){success=a1;error=a2;break;}
success=a2;error=a3;}else{params=a1;data=a2;success=a3;break;}
case 1:if(isFunction(a1))success=a1;else if(hasBody)data=a1;else params=a1;break;case 0:break;default:throw $resourceMinErr('badargs',"Expected up to 4 arguments [params, data, success, error], got {0} arguments",arguments.length);}
var isInstanceCall=this instanceof Resource;var value=isInstanceCall?data:(action.isArray?[]:new Resource(data));var httpConfig={};var responseInterceptor=action.interceptor&&action.interceptor.response||defaultResponseInterceptor;var responseErrorInterceptor=action.interceptor&&action.interceptor.responseError||undefined;forEach(action,function(value,key){switch(key){default:httpConfig[key]=copy(value);break;case'params':case'isArray':case'interceptor':break;case'timeout':httpConfig[key]=value;break;}});if(hasBody)httpConfig.data=data;route.setUrlParams(httpConfig,extend({},extractParams(data,action.params||{}),params),action.url);var promise=$http(httpConfig).then(function(response){var data=response.data,promise=value.$promise;if(data){if(angular.isArray(data)!==(!!action.isArray)){throw $resourceMinErr('badcfg','Error in resource configuration for action `{0}`. Expected response to '+'contain an {1} but got an {2} (Request: {3} {4})',name,action.isArray?'array':'object',angular.isArray(data)?'array':'object',httpConfig.method,httpConfig.url);}
if(action.isArray){value.length=0;forEach(data,function(item){if(typeof item==="object"){value.push(new Resource(item));}else{value.push(item);}});}else{shallowClearAndCopy(data,value);value.$promise=promise;}}
value.$resolved=true;response.resource=value;return response;},function(response){value.$resolved=true;(error||noop)(response);return $q.reject(response);});promise=promise.then(function(response){var value=responseInterceptor(response);(success||noop)(value,response.headers);return value;},responseErrorInterceptor);if(!isInstanceCall){value.$promise=promise;value.$resolved=false;return value;}
return promise;};Resource.prototype['$'+name]=function(params,success,error){if(isFunction(params)){error=success;success=params;params={};}
var result=Resource[name].call(this,params,this,success,error);return result.$promise||result;};});Resource.bind=function(additionalParamDefaults){return resourceFactory(url,extend({},paramDefaults,additionalParamDefaults),actions);};return Resource;}
return resourceFactory;}];});})(window,window.angular);
;(function(angular){'use strict';angular.module('li.services.rest.rest-manager',['li.services.community.context-manager','ngResource']).config(['$sceDelegateProvider',function($sceDelegateProvider){$sceDelegateProvider.resourceUrlWhitelist(['**']);}]).factory('$liRestManagerRetryInterceptor',['$q','$injector','$log','$timeout',function($q,$injector,$log,$timeout){return{responseError:function responseError(rejection){$log.error('$http error',rejection);if(rejection.status>=500&&rejection.config.retry<5){rejection.config.retry++;$log.debug('Retry $http call attempt ['+rejection.config.retry+']',rejection);$timeout(function(){return $injector.get('$http')(rejection.config);},500);}else{return $q.reject(rejection);}}};}]).config(['$httpProvider',function($httpProvider){$httpProvider.interceptors.push('$liRestManagerRetryInterceptor');}]).constant('$liRestManagerConfig',{status:{NOT_FOUND:404,FORBIDDEN:403}}).factory('$liRestManager',['$http','$resource','$q','$liContextManager',function($http,$resource,$q,$liContextManager){$http.defaults.headers.common['Application-Identifier']=$liContextManager.server().device_mode;$http.defaults.headers.common['Application-Version']='2.0.0';$http.defaults.headers.get=!$http.defaults.headers.get?{}:$http.defaults.headers.get;$http.defaults.headers.get['If-Modified-Since']=new Date(0).toUTCString();function request(apiUrl,params,data,method,cache,retry){var queryParams={};angular.forEach(params,function(val,key){if(apiUrl.indexOf(':'+key)!==-1){apiUrl=apiUrl.replace(':'+key,val);}else{queryParams[key]=val;}});return $http({url:getFullyQualifiedUrl(apiUrl),params:queryParams,data:data||null,method:method||'get',cache:cache,retry:retry!==undefined?retry:0,headers:{'Content-Type':'application/json'}}).then(function(response){if(response&&response.data){return response.data;}
return $q.reject(response);});}
function getFullyQualifiedUrl(apiUrl){return $liContextManager.server().community_prefix+'/api/2.0'+apiUrl;}
return{request:request,getFullyQualifiedUrl:getFullyQualifiedUrl};}]);})(window.LITHIUM&&LITHIUM.angular||angular);
;(function(angular){'use strict';angular.module('li.services.rest.liql',['li.services.rest.rest-manager']).factory('$liql',['$log','$liRestManager','$window',function($log,$liRestManager,$window){function liqlBuilder(){var chain;var selectParam;var fromParam;var whereParam;var orderByParam;var limitParam;var offsetParam;var expandParam;function select(param){selectParam=angular.isArray(param)?param:[param];return chain;}
function from(param){fromParam=param;return chain;}
function where(param){whereParam=whereBuilder(chain,param,[]);return whereParam;}
function orderBy(param){orderByParam=orderByBuilder(chain,param,[]);return orderByParam;}
function limit(param){limitParam=param;return chain;}
function offset(param){offsetParam=param;return chain;}
function expand(param){if(param){expandParam=angular.isArray(param)?param:[param];}
return chain;}
function build(forCount){if(selectParam===undefined||fromParam===undefined){throw new Error('$liql requires both a SELECT and FROM to be specified.'+'SELECT: ['+selectParam+'] FROM: ['+fromParam+']');}
var selectVal=forCount?'count(*)':selectParam.join(', ');var statement='SELECT '+selectVal+' FROM '+fromParam;if(whereParam!==undefined&&whereParam.build().length>0){statement+=' WHERE '+whereParam.build();}
if(orderByParam!==undefined&&!forCount){var orderByBuilt=orderByParam.build();if(orderByBuilt.length>0){statement+=' ORDER BY '+orderByParam.build();}}
if(angular.isNumber(limitParam)&&!$window.isNaN(limitParam)&&!forCount){statement+=' LIMIT '+limitParam;}
if(angular.isNumber(offsetParam)&&!$window.isNaN(offsetParam)&&!forCount){statement+=' OFFSET '+offsetParam;}
$log.debug(statement);return statement;}
function count(useCache){return exec(useCache,true).unwrap();}
function exec(useCache,forCount){var params={q:build(forCount)};if(expandParam){params.expands=expandParam.join(',');}
if(useCache===undefined){useCache=true;}
var liqlResponse=$liRestManager.request('/search',params,{},'get',useCache);return liqlPromise(liqlResponse);}
function liqlPromise(res){res.unwrap=function(){return res.then(function(response){if(response.data){if(response.data.items){return response.data.items;}else if(angular.isNumber(response.data.count)){return response.data.count;}
return response.data;}
return response;});};res.first=function(){return res.then(function(response){return response.data&&response.data.items[0]||null;});};return res;}
chain={select:select,from:from,where:where,orderBy:orderBy,limit:limit,offset:offset,expand:expand,build:build,exec:exec,count:count};return chain;}
function whereBuilder(liqlBuilder,key,clauses,connector){var operandParam;var whereChain;var whereClauses=clauses;var operands={eq:'=',neq:'!=',gt:'>',lt:'<',gte:'>=',lte:'<=',in:'IN',matches:'MATCHES'};function op(param){operandParam=param;return whereChain;}
function value(param){whereClauses.push({connector:connector,key:key,operand:operandParam,value:param});liqlBuilder.where=and;liqlBuilder.and=and;liqlBuilder.or=or;return liqlBuilder;}
function and(param){return whereBuilder(liqlBuilder,param,whereClauses,'AND');}
function or(param){return whereBuilder(liqlBuilder,param,whereClauses,'OR');}
function logicalOperand(operand,valueParam){operandParam=operand;return value(valueParam);}
function build(){var statement='';angular.forEach(whereClauses,function(whereClause){var val;if(angular.isString(whereClause.value)&&whereClause.operand==='IN'){val='('+wrapWithQuotes(whereClause.value)+')';}else if(angular.isString(whereClause.value)){val=wrapWithQuotes(whereClause.value);}else if(angular.isArray(whereClause.value)){val='(';angular.forEach(whereClause.value,function(clause,i){val+=wrapWithQuotes(clause);if(i!==whereClause.value.length-1){val+=', ';}});val+=')';}else{val=whereClause.value;}
if(whereClause.key!==undefined&&whereClause.key!==null&&val!==undefined&&val!==null){var connectorStr=statement.length>0&&whereClause.connector?' '+whereClause.connector+' ':'';statement+=connectorStr+whereClause.key+' '+whereClause.operand+' '+val;}});return statement;}
whereChain={op:op,value:value,build:build};angular.forEach(operands,function(actual,key){whereChain[key]=function(value){return logicalOperand(actual,value);};});return whereChain;}
function orderByBuilder(liqlBuilder,keyParam,orderBysParam){var orderBys=orderBysParam;var key=keyParam;function add(key,dir){orderBys.push({key:key,dir:dir});liqlBuilder.orderBy=function(key){return orderByBuilder(liqlBuilder,key,orderBys);};return liqlBuilder;}
function asc(){return add(key,'ASC');}
function desc(){return add(key,'DESC');}
function dir(orderDir){return add(key,orderDir);}
function build(){var toJoin=[];angular.forEach(orderBys,function(orderBy){if(orderBy.key&&orderBy.dir){toJoin.push(orderBy.key+' '+orderBy.dir);}});return toJoin.join(', ');}
var orderByChain={asc:asc,desc:desc,dir:dir,build:build};return orderByChain;}
function wrapWithQuotes(input){return'"'+input.replace(/\\/g,'\\\\').replace(/"/g,'\\"')+'"';}
liqlBuilder.exactPhrase=wrapWithQuotes;return liqlBuilder;}]);})(window.LITHIUM&&LITHIUM.angular||angular);

if(window.XMLHttpRequest&&!(window.FileAPI&&FileAPI.shouldLoad)){window.XMLHttpRequest.prototype.setRequestHeader=(function(orig){return function(header,value){if(header==='__setXHR_'){var val=value(this);if(val instanceof Function){val(this);}}else{orig.apply(this,arguments);}};})(window.XMLHttpRequest.prototype.setRequestHeader);}
var ngFileUpload=angular.module('ngFileUpload',[]);ngFileUpload.version='12.0.4';ngFileUpload.service('UploadBase',['$http','$q','$timeout',function($http,$q,$timeout){var upload=this;upload.promisesCount=0;this.isResumeSupported=function(){return window.Blob&&window.Blob.prototype.slice;};var resumeSupported=this.isResumeSupported();function sendHttp(config){config.method=config.method||'POST';config.headers=config.headers||{};var deferred=config._deferred=config._deferred||$q.defer();var promise=deferred.promise;function notifyProgress(e){if(deferred.notify){deferred.notify(e);}
if(promise.progressFunc){$timeout(function(){promise.progressFunc(e);});}}
function getNotifyEvent(n){if(config._start!=null&&resumeSupported){return{loaded:n.loaded+config._start,total:(config._file&&config._file.size)||n.total,type:n.type,config:config,lengthComputable:true,target:n.target};}else{return n;}}
if(!config.disableProgress){config.headers.__setXHR_=function(){return function(xhr){if(!xhr||!xhr.upload||!xhr.upload.addEventListener)return;config.__XHR=xhr;if(config.xhrFn)config.xhrFn(xhr);xhr.upload.addEventListener('progress',function(e){e.config=config;notifyProgress(getNotifyEvent(e));},false);xhr.upload.addEventListener('load',function(e){if(e.lengthComputable){e.config=config;notifyProgress(getNotifyEvent(e));}},false);};};}
function uploadWithAngular(){$http(config).then(function(r){if(resumeSupported&&config._chunkSize&&!config._finished&&config._file){notifyProgress({loaded:config._end,total:config._file&&config._file.size,config:config,type:'progress'});upload.upload(config,true);}else{if(config._finished)delete config._finished;deferred.resolve(r);}},function(e){deferred.reject(e);},function(n){deferred.notify(n);});}
if(!resumeSupported){uploadWithAngular();}else if(config._chunkSize&&config._end&&!config._finished){config._start=config._end;config._end+=config._chunkSize;uploadWithAngular();}else if(config.resumeSizeUrl){$http.get(config.resumeSizeUrl).then(function(resp){if(config.resumeSizeResponseReader){config._start=config.resumeSizeResponseReader(resp.data);}else{config._start=parseInt((resp.data.size==null?resp.data:resp.data.size).toString());}
if(config._chunkSize){config._end=config._start+config._chunkSize;}
uploadWithAngular();},function(e){throw e;});}else if(config.resumeSize){config.resumeSize().then(function(size){config._start=size;uploadWithAngular();},function(e){throw e;});}else{if(config._chunkSize){config._start=0;config._end=config._start+config._chunkSize;}
uploadWithAngular();}
promise.success=function(fn){promise.then(function(response){fn(response.data,response.status,response.headers,config);});return promise;};promise.error=function(fn){promise.then(null,function(response){fn(response.data,response.status,response.headers,config);});return promise;};promise.progress=function(fn){promise.progressFunc=fn;promise.then(null,null,function(n){fn(n);});return promise;};promise.abort=promise.pause=function(){if(config.__XHR){$timeout(function(){config.__XHR.abort();});}
return promise;};promise.xhr=function(fn){config.xhrFn=(function(origXhrFn){return function(){if(origXhrFn)origXhrFn.apply(promise,arguments);fn.apply(promise,arguments);};})(config.xhrFn);return promise;};upload.promisesCount++;promise['finally'](function(){upload.promisesCount--;});return promise;}
this.isUploadInProgress=function(){return upload.promisesCount>0;};this.rename=function(file,name){file.ngfName=name;return file;};this.jsonBlob=function(val){if(val!=null&&!angular.isString(val)){val=JSON.stringify(val);}
var blob=new window.Blob([val],{type:'application/json'});blob._ngfBlob=true;return blob;};this.json=function(val){return angular.toJson(val);};function copy(obj){var clone={};for(var key in obj){if(obj.hasOwnProperty(key)){clone[key]=obj[key];}}
return clone;}
this.isFile=function(file){return file!=null&&(file instanceof window.Blob||(file.flashId&&file.name&&file.size));};this.upload=function(config,internal){function toResumeFile(file,formData){if(file._ngfBlob)return file;config._file=config._file||file;if(config._start!=null&&resumeSupported){if(config._end&&config._end>=file.size){config._finished=true;config._end=file.size;}
var slice=file.slice(config._start,config._end||file.size);slice.name=file.name;slice.ngfName=file.ngfName;if(config._chunkSize){formData.append('_chunkSize',config._chunkSize);formData.append('_currentChunkSize',config._end-config._start);formData.append('_chunkNumber',Math.floor(config._start/config._chunkSize));formData.append('_totalSize',config._file.size);}
return slice;}
return file;}
function addFieldToFormData(formData,val,key){if(val!==undefined){if(angular.isDate(val)){val=val.toISOString();}
if(angular.isString(val)){formData.append(key,val);}else if(upload.isFile(val)){var file=toResumeFile(val,formData);var split=key.split(',');if(split[1]){file.ngfName=split[1].replace(/^\s+|\s+$/g,'');key=split[0];}
config._fileKey=config._fileKey||key;formData.append(key,file,file.ngfName||file.name);}else{if(angular.isObject(val)){if(val.$$ngfCircularDetection)throw'ngFileUpload: Circular reference in config.data. Make sure specified data for Upload.upload() has no circular reference: '+key;val.$$ngfCircularDetection=true;try{for(var k in val){if(val.hasOwnProperty(k)&&k!=='$$ngfCircularDetection'){var objectKey=config.objectKey==null?'[i]':config.objectKey;if(val.length&&parseInt(k)>-1){objectKey=config.arrayKey==null?objectKey:config.arrayKey;}
addFieldToFormData(formData,val[k],key+objectKey.replace(/[ik]/g,k));}}}finally{delete val.$$ngfCircularDetection;}}else{formData.append(key,val);}}}}
function digestConfig(){config._chunkSize=upload.translateScalars(config.resumeChunkSize);config._chunkSize=config._chunkSize?parseInt(config._chunkSize.toString()):null;config.headers=config.headers||{};config.headers['Content-Type']=undefined;config.transformRequest=config.transformRequest?(angular.isArray(config.transformRequest)?config.transformRequest:[config.transformRequest]):[];config.transformRequest.push(function(data){var formData=new window.FormData(),key;data=data||config.fields||{};if(config.file){data.file=config.file;}
for(key in data){if(data.hasOwnProperty(key)){var val=data[key];if(config.formDataAppender){config.formDataAppender(formData,key,val);}else{addFieldToFormData(formData,val,key);}}}
return formData;});}
if(!internal)config=copy(config);if(!config._isDigested){config._isDigested=true;digestConfig();}
return sendHttp(config);};this.http=function(config){config=copy(config);config.transformRequest=config.transformRequest||function(data){if((window.ArrayBuffer&&data instanceof window.ArrayBuffer)||data instanceof window.Blob){return data;}
return $http.defaults.transformRequest[0].apply(this,arguments);};config._chunkSize=upload.translateScalars(config.resumeChunkSize);config._chunkSize=config._chunkSize?parseInt(config._chunkSize.toString()):null;return sendHttp(config);};this.translateScalars=function(str){if(angular.isString(str)){if(str.search(/kb/i)===str.length-2){return parseFloat(str.substring(0,str.length-2)*1024);}else if(str.search(/mb/i)===str.length-2){return parseFloat(str.substring(0,str.length-2)*1048576);}else if(str.search(/gb/i)===str.length-2){return parseFloat(str.substring(0,str.length-2)*1073741824);}else if(str.search(/b/i)===str.length-1){return parseFloat(str.substring(0,str.length-1));}else if(str.search(/s/i)===str.length-1){return parseFloat(str.substring(0,str.length-1));}else if(str.search(/m/i)===str.length-1){return parseFloat(str.substring(0,str.length-1)*60);}else if(str.search(/h/i)===str.length-1){return parseFloat(str.substring(0,str.length-1)*3600);}}
return str;};this.urlToBlob=function(url){var defer=$q.defer();$http({url:url,method:'get',responseType:'arraybuffer'}).then(function(resp){var arrayBufferView=new Uint8Array(resp.data);var type=resp.headers('content-type')||'image/WebP';var blob=new window.Blob([arrayBufferView],{type:type});defer.resolve(blob);},function(e){defer.reject(e);});return defer.promise;};this.setDefaults=function(defaults){this.defaults=defaults||{};};this.defaults={};this.version=ngFileUpload.version;}]);ngFileUpload.service('Upload',['$parse','$timeout','$compile','$q','UploadExif',function($parse,$timeout,$compile,$q,UploadExif){var upload=UploadExif;upload.getAttrWithDefaults=function(attr,name){if(attr[name]!=null)return attr[name];var def=upload.defaults[name];return(def==null?def:(angular.isString(def)?def:JSON.stringify(def)));};upload.attrGetter=function(name,attr,scope,params){var attrVal=this.getAttrWithDefaults(attr,name);if(scope){try{if(params){return $parse(attrVal)(scope,params);}else{return $parse(attrVal)(scope);}}catch(e){if(name.search(/min|max|pattern/i)){return attrVal;}else{throw e;}}}else{return attrVal;}};upload.shouldUpdateOn=function(type,attr,scope){var modelOptions=upload.attrGetter('ngModelOptions',attr,scope);if(modelOptions&&modelOptions.updateOn){return modelOptions.updateOn.split(' ').indexOf(type)>-1;}
return true;};upload.emptyPromise=function(){var d=$q.defer();var args=arguments;$timeout(function(){d.resolve.apply(d,args);});return d.promise;};upload.rejectPromise=function(){var d=$q.defer();var args=arguments;$timeout(function(){d.reject.apply(d,args);});return d.promise;};upload.happyPromise=function(promise,data){var d=$q.defer();promise.then(function(result){d.resolve(result);},function(error){$timeout(function(){throw error;});d.resolve(data);});return d.promise;};function applyExifRotations(files,attr,scope){var promises=[upload.emptyPromise()];angular.forEach(files,function(f,i){if(f.type.indexOf('image/jpeg')===0&&upload.attrGetter('ngfFixOrientation',attr,scope,{$file:f})){promises.push(upload.happyPromise(upload.applyExifRotation(f),f).then(function(fixedFile){files.splice(i,1,fixedFile);}));}});return $q.all(promises);}
function resize(files,attr,scope){var resizeVal=upload.attrGetter('ngfResize',attr,scope);if(!resizeVal||!upload.isResizeSupported()||!files.length)return upload.emptyPromise();if(resizeVal instanceof Function){var defer=$q.defer();resizeVal(files).then(function(p){resizeWithParams(p,files,attr,scope).then(function(r){defer.resolve(r);},function(e){defer.reject(e);});},function(e){defer.reject(e);});}else{return resizeWithParams(resizeVal,files,attr,scope);}}
function resizeWithParams(param,files,attr,scope){var promises=[upload.emptyPromise()];function handleFile(f,i){if(f.type.indexOf('image')===0){if(param.pattern&&!upload.validatePattern(f,param.pattern))return;var promise=upload.resize(f,param.width,param.height,param.quality,param.type,param.ratio,param.centerCrop,function(width,height){return upload.attrGetter('ngfResizeIf',attr,scope,{$width:width,$height:height,$file:f});},param.restoreExif!==false);promises.push(promise);promise.then(function(resizedFile){files.splice(i,1,resizedFile);},function(e){f.$error='resize';f.$errorParam=(e?(e.message?e.message:e)+': ':'')+(f&&f.name);});}}
for(var i=0;i<files.length;i++){handleFile(files[i],i);}
return $q.all(promises);}
upload.updateModel=function(ngModel,attr,scope,fileChange,files,evt,noDelay){function update(files,invalidFiles,newFiles,dupFiles,isSingleModel){attr.$$ngfPrevValidFiles=files;attr.$$ngfPrevInvalidFiles=invalidFiles;var file=files&&files.length?files[0]:null;var invalidFile=invalidFiles&&invalidFiles.length?invalidFiles[0]:null;if(ngModel){upload.applyModelValidation(ngModel,files);ngModel.$setViewValue(isSingleModel?file:files);}
if(fileChange){$parse(fileChange)(scope,{$files:files,$file:file,$newFiles:newFiles,$duplicateFiles:dupFiles,$invalidFiles:invalidFiles,$invalidFile:invalidFile,$event:evt});}
var invalidModel=upload.attrGetter('ngfModelInvalid',attr);if(invalidModel){$timeout(function(){$parse(invalidModel).assign(scope,isSingleModel?invalidFile:invalidFiles);});}
$timeout(function(){});}
var allNewFiles,dupFiles=[],prevValidFiles,prevInvalidFiles,invalids=[],valids=[];function removeDuplicates(){function equals(f1,f2){return f1.name===f2.name&&(f1.$ngfOrigSize||f1.size)===(f2.$ngfOrigSize||f2.size)&&f1.type===f2.type;}
function isInPrevFiles(f){var j;for(j=0;j<prevValidFiles.length;j++){if(equals(f,prevValidFiles[j])){return true;}}
for(j=0;j<prevInvalidFiles.length;j++){if(equals(f,prevInvalidFiles[j])){return true;}}
return false;}
if(files){allNewFiles=[];dupFiles=[];for(var i=0;i<files.length;i++){if(isInPrevFiles(files[i])){dupFiles.push(files[i]);}else{allNewFiles.push(files[i]);}}}}
function toArray(v){return angular.isArray(v)?v:[v];}
function separateInvalids(){valids=[];invalids=[];angular.forEach(allNewFiles,function(file){if(file.$error){invalids.push(file);}else{valids.push(file);}});}
function resizeAndUpdate(){function updateModel(){$timeout(function(){update(keep?prevValidFiles.concat(valids):valids,keep?prevInvalidFiles.concat(invalids):invalids,files,dupFiles,isSingleModel);},options&&options.debounce?options.debounce.change||options.debounce:0);}
resize(validateAfterResize?allNewFiles:valids,attr,scope).then(function(){if(validateAfterResize){upload.validate(allNewFiles,prevValidFiles.length,ngModel,attr,scope).then(function(){separateInvalids();updateModel();});}else{updateModel();}},function(e){throw'Could not resize files '+e;});}
prevValidFiles=attr.$$ngfPrevValidFiles||[];prevInvalidFiles=attr.$$ngfPrevInvalidFiles||[];if(ngModel&&ngModel.$modelValue){prevValidFiles=toArray(ngModel.$modelValue);}
var keep=upload.attrGetter('ngfKeep',attr,scope);allNewFiles=(files||[]).slice(0);if(keep==='distinct'||upload.attrGetter('ngfKeepDistinct',attr,scope)===true){removeDuplicates(attr,scope);}
var isSingleModel=!keep&&!upload.attrGetter('ngfMultiple',attr,scope)&&!upload.attrGetter('multiple',attr);if(keep&&!allNewFiles.length)return;upload.attrGetter('ngfBeforeModelChange',attr,scope,{$files:files,$file:files&&files.length?files[0]:null,$newFiles:allNewFiles,$duplicateFiles:dupFiles,$event:evt});var validateAfterResize=upload.attrGetter('ngfValidateAfterResize',attr,scope);var options=upload.attrGetter('ngModelOptions',attr,scope);upload.validate(allNewFiles,prevValidFiles.length,ngModel,attr,scope).then(function(){if(noDelay){update(allNewFiles,[],files,dupFiles,isSingleModel);}else{if((!options||!options.allowInvalid)&&!validateAfterResize){separateInvalids();}else{valids=allNewFiles;}
if(upload.attrGetter('ngfFixOrientation',attr,scope)&&upload.isExifSupported()){applyExifRotations(valids,attr,scope).then(function(){resizeAndUpdate();});}else{resizeAndUpdate();}}});};return upload;}]);ngFileUpload.directive('ngfSelect',['$parse','$timeout','$compile','Upload',function($parse,$timeout,$compile,Upload){var generatedElems=[];function isDelayedClickSupported(ua){var m=ua.match(/Android[^\d]*(\d+)\.(\d+)/);if(m&&m.length>2){var v=Upload.defaults.androidFixMinorVersion||4;return parseInt(m[1])<4||(parseInt(m[1])===v&&parseInt(m[2])<v);}
return ua.indexOf('Chrome')===-1&&/.*Windows.*Safari.*/.test(ua);}
function linkFileSelect(scope,elem,attr,ngModel,$parse,$timeout,$compile,upload){var attrGetter=function(name,scope){return upload.attrGetter(name,attr,scope);};function isInputTypeFile(){return elem[0].tagName.toLowerCase()==='input'&&attr.type&&attr.type.toLowerCase()==='file';}
function fileChangeAttr(){return attrGetter('ngfChange')||attrGetter('ngfSelect');}
function changeFn(evt){if(upload.shouldUpdateOn('change',attr,scope)){var fileList=evt.__files_||(evt.target&&evt.target.files),files=[];for(var i=0;i<fileList.length;i++){files.push(fileList[i]);}
upload.updateModel(ngModel,attr,scope,fileChangeAttr(),files.length?files:null,evt);}}
upload.registerModelChangeValidator(ngModel,attr,scope);var unwatches=[];unwatches.push(scope.$watch(attrGetter('ngfMultiple'),function(){fileElem.attr('multiple',attrGetter('ngfMultiple',scope));}));unwatches.push(scope.$watch(attrGetter('ngfCapture'),function(){fileElem.attr('capture',attrGetter('ngfCapture',scope));}));unwatches.push(scope.$watch(attrGetter('ngfAccept'),function(){fileElem.attr('accept',attrGetter('ngfAccept',scope));}));attr.$observe('accept',function(){fileElem.attr('accept',attrGetter('accept'));});unwatches.push(function(){if(attr.$$observers)delete attr.$$observers.accept;});function bindAttrToFileInput(fileElem){if(elem!==fileElem){for(var i=0;i<elem[0].attributes.length;i++){var attribute=elem[0].attributes[i];if(attribute.name!=='type'&&attribute.name!=='class'&&attribute.name!=='style'){if(attribute.value==null||attribute.value===''){if(attribute.name==='required')attribute.value='required';if(attribute.name==='multiple')attribute.value='multiple';}
fileElem.attr(attribute.name,attribute.name==='id'?'ngf-'+attribute.value:attribute.value);}}}}
function createFileInput(){if(isInputTypeFile()){return elem;}
var fileElem=angular.element('<input type="file">');bindAttrToFileInput(fileElem);var label=angular.element('<label>upload</label>');label.css('visibility','hidden').css('position','absolute').css('overflow','hidden').css('width','0px').css('height','0px').css('border','none').css('margin','0px').css('padding','0px').attr('tabindex','-1');generatedElems.push({el:elem,ref:label});document.body.appendChild(label.append(fileElem)[0]);return fileElem;}
var initialTouchStartY=0;function clickHandler(evt){if(elem.attr('disabled'))return false;if(attrGetter('ngfSelectDisabled',scope))return;var r=handleTouch(evt);if(r!=null)return r;resetModel(evt);try{if(!isInputTypeFile()&&!document.body.contains(fileElem[0])){generatedElems.push({el:elem,ref:fileElem.parent()});document.body.appendChild(fileElem.parent()[0]);fileElem.bind('change',changeFn);}}catch(e){}
if(isDelayedClickSupported(navigator.userAgent)){setTimeout(function(){fileElem[0].click();},0);}else{fileElem[0].click();}
return false;}
function handleTouch(evt){var touches=evt.changedTouches||(evt.originalEvent&&evt.originalEvent.changedTouches);if(evt.type==='touchstart'){initialTouchStartY=touches?touches[0].clientY:0;return true;}else{evt.stopPropagation();evt.preventDefault();if(evt.type==='touchend'){var currentLocation=touches?touches[0].clientY:0;if(Math.abs(currentLocation-initialTouchStartY)>20)return false;}}}
var fileElem=elem;function resetModel(evt){if(upload.shouldUpdateOn('click',attr,scope)&&fileElem.val()){fileElem.val(null);upload.updateModel(ngModel,attr,scope,fileChangeAttr(),null,evt,true);}}
if(!isInputTypeFile()){fileElem=createFileInput();}
fileElem.bind('change',changeFn);if(!isInputTypeFile()){elem.bind('click touchstart touchend',clickHandler);}else{elem.bind('click',resetModel);}
function ie10SameFileSelectFix(evt){if(fileElem&&!fileElem.attr('__ngf_ie10_Fix_')){if(!fileElem[0].parentNode){fileElem=null;return;}
evt.preventDefault();evt.stopPropagation();fileElem.unbind('click');var clone=fileElem.clone();fileElem.replaceWith(clone);fileElem=clone;fileElem.attr('__ngf_ie10_Fix_','true');fileElem.bind('change',changeFn);fileElem.bind('click',ie10SameFileSelectFix);fileElem[0].click();return false;}else{fileElem.removeAttr('__ngf_ie10_Fix_');}}
if(navigator.appVersion.indexOf('MSIE 10')!==-1){fileElem.bind('click',ie10SameFileSelectFix);}
if(ngModel)ngModel.$formatters.push(function(val){if(val==null||val.length===0){if(fileElem.val()){fileElem.val(null);}}
return val;});scope.$on('$destroy',function(){if(!isInputTypeFile())fileElem.parent().remove();angular.forEach(unwatches,function(unwatch){unwatch();});});$timeout(function(){for(var i=0;i<generatedElems.length;i++){var g=generatedElems[i];if(!document.body.contains(g.el[0])){generatedElems.splice(i,1);g.ref.remove();}}});if(window.FileAPI&&window.FileAPI.ngfFixIE){window.FileAPI.ngfFixIE(elem,fileElem,changeFn);}}
return{restrict:'AEC',require:'?ngModel',link:function(scope,elem,attr,ngModel){linkFileSelect(scope,elem,attr,ngModel,$parse,$timeout,$compile,Upload);}};}]);(function(){ngFileUpload.service('UploadDataUrl',['UploadBase','$timeout','$q',function(UploadBase,$timeout,$q){var upload=UploadBase;upload.base64DataUrl=function(file){if(angular.isArray(file)){var d=$q.defer(),count=0;angular.forEach(file,function(f){upload.dataUrl(f,true)['finally'](function(){count++;if(count===file.length){var urls=[];angular.forEach(file,function(ff){urls.push(ff.$ngfDataUrl);});d.resolve(urls,file);}});});return d.promise;}else{return upload.dataUrl(file,true);}};upload.dataUrl=function(file,disallowObjectUrl){if(!file)return upload.emptyPromise(file,file);if((disallowObjectUrl&&file.$ngfDataUrl!=null)||(!disallowObjectUrl&&file.$ngfBlobUrl!=null)){return upload.emptyPromise(disallowObjectUrl?file.$ngfDataUrl:file.$ngfBlobUrl,file);}
var p=disallowObjectUrl?file.$$ngfDataUrlPromise:file.$$ngfBlobUrlPromise;if(p)return p;var deferred=$q.defer();$timeout(function(){if(window.FileReader&&file&&(!window.FileAPI||navigator.userAgent.indexOf('MSIE 8')===-1||file.size<20000)&&(!window.FileAPI||navigator.userAgent.indexOf('MSIE 9')===-1||file.size<4000000)){var URL=window.URL||window.webkitURL;if(URL&&URL.createObjectURL&&!disallowObjectUrl){var url;try{url=URL.createObjectURL(file);}catch(e){$timeout(function(){file.$ngfBlobUrl='';deferred.reject();});return;}
$timeout(function(){file.$ngfBlobUrl=url;if(url){deferred.resolve(url,file);upload.blobUrls=upload.blobUrls||[];upload.blobUrlsTotalSize=upload.blobUrlsTotalSize||0;upload.blobUrls.push({url:url,size:file.size});upload.blobUrlsTotalSize+=file.size||0;var maxMemory=upload.defaults.blobUrlsMaxMemory||268435456;var maxLength=upload.defaults.blobUrlsMaxQueueSize||200;while((upload.blobUrlsTotalSize>maxMemory||upload.blobUrls.length>maxLength)&&upload.blobUrls.length>1){var obj=upload.blobUrls.splice(0,1)[0];URL.revokeObjectURL(obj.url);upload.blobUrlsTotalSize-=obj.size;}}});}else{var fileReader=new FileReader();fileReader.onload=function(e){$timeout(function(){file.$ngfDataUrl=e.target.result;deferred.resolve(e.target.result,file);$timeout(function(){delete file.$ngfDataUrl;},1000);});};fileReader.onerror=function(){$timeout(function(){file.$ngfDataUrl='';deferred.reject();});};fileReader.readAsDataURL(file);}}else{$timeout(function(){file[disallowObjectUrl?'$ngfDataUrl':'$ngfBlobUrl']='';deferred.reject();});}});if(disallowObjectUrl){p=file.$$ngfDataUrlPromise=deferred.promise;}else{p=file.$$ngfBlobUrlPromise=deferred.promise;}
p['finally'](function(){delete file[disallowObjectUrl?'$$ngfDataUrlPromise':'$$ngfBlobUrlPromise'];});return p;};return upload;}]);function getTagType(el){if(el.tagName.toLowerCase()==='img')return'image';if(el.tagName.toLowerCase()==='audio')return'audio';if(el.tagName.toLowerCase()==='video')return'video';return/./;}
function linkFileDirective(Upload,$timeout,scope,elem,attr,directiveName,resizeParams,isBackground){function constructDataUrl(file){var disallowObjectUrl=Upload.attrGetter('ngfNoObjectUrl',attr,scope);Upload.dataUrl(file,disallowObjectUrl)['finally'](function(){$timeout(function(){var src=(disallowObjectUrl?file.$ngfDataUrl:file.$ngfBlobUrl)||file.$ngfDataUrl;if(isBackground){elem.css('background-image','url(\''+(src||'')+'\')');}else{elem.attr('src',src);}
if(src){elem.removeClass('ng-hide');}else{elem.addClass('ng-hide');}});});}
$timeout(function(){var unwatch=scope.$watch(attr[directiveName],function(file){var size=resizeParams;if(directiveName==='ngfThumbnail'){if(!size){size={width:elem[0].clientWidth,height:elem[0].clientHeight};}
if(size.width===0&&window.getComputedStyle){var style=getComputedStyle(elem[0]);size={width:parseInt(style.width.slice(0,-2)),height:parseInt(style.height.slice(0,-2))};}}
if(angular.isString(file)){elem.removeClass('ng-hide');if(isBackground){return elem.css('background-image','url(\''+file+'\')');}else{return elem.attr('src',file);}}
if(file&&file.type&&file.type.search(getTagType(elem[0]))===0&&(!isBackground||file.type.indexOf('image')===0)){if(size&&Upload.isResizeSupported()){Upload.resize(file,size.width,size.height,size.quality).then(function(f){constructDataUrl(f);},function(e){throw e;});}else{constructDataUrl(file);}}else{elem.addClass('ng-hide');}});scope.$on('$destroy',function(){unwatch();});});}
ngFileUpload.directive('ngfSrc',['Upload','$timeout',function(Upload,$timeout){return{restrict:'AE',link:function(scope,elem,attr){linkFileDirective(Upload,$timeout,scope,elem,attr,'ngfSrc',Upload.attrGetter('ngfResize',attr,scope),false);}};}]);ngFileUpload.directive('ngfBackground',['Upload','$timeout',function(Upload,$timeout){return{restrict:'AE',link:function(scope,elem,attr){linkFileDirective(Upload,$timeout,scope,elem,attr,'ngfBackground',Upload.attrGetter('ngfResize',attr,scope),true);}};}]);ngFileUpload.directive('ngfThumbnail',['Upload','$timeout',function(Upload,$timeout){return{restrict:'AE',link:function(scope,elem,attr){var size=Upload.attrGetter('ngfSize',attr,scope);linkFileDirective(Upload,$timeout,scope,elem,attr,'ngfThumbnail',size,Upload.attrGetter('ngfAsBackground',attr,scope));}};}]);ngFileUpload.config(['$compileProvider',function($compileProvider){if($compileProvider.imgSrcSanitizationWhitelist)$compileProvider.imgSrcSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|local|file|data|blob):/);if($compileProvider.aHrefSanitizationWhitelist)$compileProvider.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|local|file|data|blob):/);}]);ngFileUpload.filter('ngfDataUrl',['UploadDataUrl','$sce',function(UploadDataUrl,$sce){return function(file,disallowObjectUrl,trustedUrl){if(angular.isString(file)){return $sce.trustAsResourceUrl(file);}
var src=file&&((disallowObjectUrl?file.$ngfDataUrl:file.$ngfBlobUrl)||file.$ngfDataUrl);if(file&&!src){if(!file.$ngfDataUrlFilterInProgress&&angular.isObject(file)){file.$ngfDataUrlFilterInProgress=true;UploadDataUrl.dataUrl(file,disallowObjectUrl);}
return'';}
if(file)delete file.$ngfDataUrlFilterInProgress;return(file&&src?(trustedUrl?$sce.trustAsResourceUrl(src):src):file)||'';};}]);})();ngFileUpload.service('UploadValidate',['UploadDataUrl','$q','$timeout',function(UploadDataUrl,$q,$timeout){var upload=UploadDataUrl;function globStringToRegex(str){var regexp='',excludes=[];if(str.length>2&&str[0]==='/'&&str[str.length-1]==='/'){regexp=str.substring(1,str.length-1);}else{var split=str.split(',');if(split.length>1){for(var i=0;i<split.length;i++){var r=globStringToRegex(split[i]);if(r.regexp){regexp+='('+r.regexp+')';if(i<split.length-1){regexp+='|';}}else{excludes=excludes.concat(r.excludes);}}}else{if(str.indexOf('!')===0){excludes.push('^((?!'+globStringToRegex(str.substring(1)).regexp+').)*$');}else{if(str.indexOf('.')===0){str='*'+str;}
regexp='^'+str.replace(new RegExp('[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]','g'),'\\$&')+'$';regexp=regexp.replace(/\\\*/g,'.*').replace(/\\\?/g,'.');}}}
return{regexp:regexp,excludes:excludes};}
upload.validatePattern=function(file,val){if(!val){return true;}
var pattern=globStringToRegex(val),valid=true;if(pattern.regexp&&pattern.regexp.length){var regexp=new RegExp(pattern.regexp,'i');valid=(file.type!=null&&regexp.test(file.type))||(file.name!=null&&regexp.test(file.name));}
var len=pattern.excludes.length;while(len--){var exclude=new RegExp(pattern.excludes[len],'i');valid=valid&&(file.type==null||exclude.test(file.type))&&(file.name==null||exclude.test(file.name));}
return valid;};upload.ratioToFloat=function(val){var r=val.toString(),xIndex=r.search(/[x:]/i);if(xIndex>-1){r=parseFloat(r.substring(0,xIndex))/parseFloat(r.substring(xIndex+1));}else{r=parseFloat(r);}
return r;};upload.registerModelChangeValidator=function(ngModel,attr,scope){if(ngModel){ngModel.$formatters.push(function(files){if(ngModel.$dirty){if(files&&!angular.isArray(files)){files=[files];}
upload.validate(files,0,ngModel,attr,scope).then(function(){upload.applyModelValidation(ngModel,files);});}});}};function markModelAsDirty(ngModel,files){if(files!=null&&!ngModel.$dirty){if(ngModel.$setDirty){ngModel.$setDirty();}else{ngModel.$dirty=true;}}}
upload.applyModelValidation=function(ngModel,files){markModelAsDirty(ngModel,files);angular.forEach(ngModel.$ngfValidations,function(validation){ngModel.$setValidity(validation.name,validation.valid);});};upload.getValidationAttr=function(attr,scope,name,validationName,file){var dName='ngf'+name[0].toUpperCase()+name.substr(1);var val=upload.attrGetter(dName,attr,scope,{$file:file});if(val==null){val=upload.attrGetter('ngfValidate',attr,scope,{$file:file});if(val){var split=(validationName||name).split('.');val=val[split[0]];if(split.length>1){val=val&&val[split[1]];}}}
return val;};upload.validate=function(files,prevLength,ngModel,attr,scope){ngModel=ngModel||{};ngModel.$ngfValidations=ngModel.$ngfValidations||[];angular.forEach(ngModel.$ngfValidations,function(v){v.valid=true;});var attrGetter=function(name,params){return upload.attrGetter(name,attr,scope,params);};if(files==null||files.length===0){return upload.emptyPromise(ngModel);}
files=files.length===undefined?[files]:files.slice(0);function validateSync(name,validationName,fn){if(files){var i=files.length,valid=null;while(i--){var file=files[i];if(file){var val=upload.getValidationAttr(attr,scope,name,validationName,file);if(val!=null){if(!fn(file,val,i)){file.$error=name;(file.$errorMessages=(file.$errorMessages||{}))[name]=true;file.$errorParam=val;files.splice(i,1);valid=false;}}}}
if(valid!==null){ngModel.$ngfValidations.push({name:name,valid:valid});}}}
validateSync('maxFiles',null,function(file,val,i){return prevLength+i<val;});validateSync('pattern',null,upload.validatePattern);validateSync('minSize','size.min',function(file,val){return file.size+0.1>=upload.translateScalars(val);});validateSync('maxSize','size.max',function(file,val){return file.size-0.1<=upload.translateScalars(val);});var totalSize=0;validateSync('maxTotalSize',null,function(file,val){totalSize+=file.size;if(totalSize>upload.translateScalars(val)){files.splice(0,files.length);return false;}
return true;});validateSync('validateFn',null,function(file,r){return r===true||r===null||r==='';});if(!files.length){return upload.emptyPromise(ngModel,ngModel.$ngfValidations);}
function validateAsync(name,validationName,type,asyncFn,fn){function resolveResult(defer,file,val){if(val!=null){asyncFn(file,val).then(function(d){if(!fn(d,val)){file.$error=name;(file.$errorMessages=(file.$errorMessages||{}))[name]=true;file.$errorParam=val;defer.reject();}else{defer.resolve();}},function(){if(attrGetter('ngfValidateForce',{$file:file})){file.$error=name;(file.$errorMessages=(file.$errorMessages||{}))[name]=true;file.$errorParam=val;defer.reject();}else{defer.resolve();}});}else{defer.resolve();}}
var promises=[upload.emptyPromise()];if(files){files=files.length===undefined?[files]:files;angular.forEach(files,function(file){var defer=$q.defer();promises.push(defer.promise);if(type&&(file.type==null||file.type.search(type)!==0)){defer.resolve();return;}
if(name==='dimensions'&&upload.attrGetter('ngfDimensions',attr)!=null){upload.imageDimensions(file).then(function(d){resolveResult(defer,file,attrGetter('ngfDimensions',{$file:file,$width:d.width,$height:d.height}));},function(){defer.reject();});}else if(name==='duration'&&upload.attrGetter('ngfDuration',attr)!=null){upload.mediaDuration(file).then(function(d){resolveResult(defer,file,attrGetter('ngfDuration',{$file:file,$duration:d}));},function(){defer.reject();});}else{resolveResult(defer,file,upload.getValidationAttr(attr,scope,name,validationName,file));}});return $q.all(promises).then(function(){ngModel.$ngfValidations.push({name:name,valid:true});},function(){ngModel.$ngfValidations.push({name:name,valid:false});});}}
var deffer=$q.defer();var promises=[];promises.push(upload.happyPromise(validateAsync('maxHeight','height.max',/image/,this.imageDimensions,function(d,val){return d.height<=val;})));promises.push(upload.happyPromise(validateAsync('minHeight','height.min',/image/,this.imageDimensions,function(d,val){return d.height>=val;})));promises.push(upload.happyPromise(validateAsync('maxWidth','width.max',/image/,this.imageDimensions,function(d,val){return d.width<=val;})));promises.push(upload.happyPromise(validateAsync('minWidth','width.min',/image/,this.imageDimensions,function(d,val){return d.width>=val;})));promises.push(upload.happyPromise(validateAsync('dimensions',null,/image/,function(file,val){return upload.emptyPromise(val);},function(r){return r;})));promises.push(upload.happyPromise(validateAsync('ratio',null,/image/,this.imageDimensions,function(d,val){var split=val.toString().split(','),valid=false;for(var i=0;i<split.length;i++){if(Math.abs((d.width/d.height)-upload.ratioToFloat(split[i]))<0.0001){valid=true;}}
return valid;})));promises.push(upload.happyPromise(validateAsync('maxRatio','ratio.max',/image/,this.imageDimensions,function(d,val){return(d.width/d.height)-upload.ratioToFloat(val)<0.0001;})));promises.push(upload.happyPromise(validateAsync('minRatio','ratio.min',/image/,this.imageDimensions,function(d,val){return(d.width/d.height)-upload.ratioToFloat(val)>-0.0001;})));promises.push(upload.happyPromise(validateAsync('maxDuration','duration.max',/audio|video/,this.mediaDuration,function(d,val){return d<=upload.translateScalars(val);})));promises.push(upload.happyPromise(validateAsync('minDuration','duration.min',/audio|video/,this.mediaDuration,function(d,val){return d>=upload.translateScalars(val);})));promises.push(upload.happyPromise(validateAsync('duration',null,/audio|video/,function(file,val){return upload.emptyPromise(val);},function(r){return r;})));promises.push(upload.happyPromise(validateAsync('validateAsyncFn',null,null,function(file,val){return val;},function(r){return r===true||r===null||r==='';})));return $q.all(promises).then(function(){deffer.resolve(ngModel,ngModel.$ngfValidations);});};upload.imageDimensions=function(file){if(file.$ngfWidth&&file.$ngfHeight){var d=$q.defer();$timeout(function(){d.resolve({width:file.$ngfWidth,height:file.$ngfHeight});});return d.promise;}
if(file.$ngfDimensionPromise)return file.$ngfDimensionPromise;var deferred=$q.defer();$timeout(function(){if(file.type.indexOf('image')!==0){deferred.reject('not image');return;}
upload.dataUrl(file).then(function(dataUrl){var img=angular.element('<img>').attr('src',dataUrl).css('visibility','hidden').css('position','fixed').css('max-width','none !important').css('max-height','none !important');function success(){var width=img[0].clientWidth;var height=img[0].clientHeight;img.remove();file.$ngfWidth=width;file.$ngfHeight=height;deferred.resolve({width:width,height:height});}
function error(){img.remove();deferred.reject('load error');}
img.on('load',success);img.on('error',error);var count=0;function checkLoadError(){$timeout(function(){if(img[0].parentNode){if(img[0].clientWidth){success();}else if(count>10){error();}else{checkLoadError();}}},1000);}
checkLoadError();angular.element(document.getElementsByTagName('body')[0]).append(img);},function(){deferred.reject('load error');});});file.$ngfDimensionPromise=deferred.promise;file.$ngfDimensionPromise['finally'](function(){delete file.$ngfDimensionPromise;});return file.$ngfDimensionPromise;};upload.mediaDuration=function(file){if(file.$ngfDuration){var d=$q.defer();$timeout(function(){d.resolve(file.$ngfDuration);});return d.promise;}
if(file.$ngfDurationPromise)return file.$ngfDurationPromise;var deferred=$q.defer();$timeout(function(){if(file.type.indexOf('audio')!==0&&file.type.indexOf('video')!==0){deferred.reject('not media');return;}
upload.dataUrl(file).then(function(dataUrl){var el=angular.element(file.type.indexOf('audio')===0?'<audio>':'<video>').attr('src',dataUrl).css('visibility','none').css('position','fixed');function success(){var duration=el[0].duration;file.$ngfDuration=duration;el.remove();deferred.resolve(duration);}
function error(){el.remove();deferred.reject('load error');}
el.on('loadedmetadata',success);el.on('error',error);var count=0;function checkLoadError(){$timeout(function(){if(el[0].parentNode){if(el[0].duration){success();}else if(count>10){error();}else{checkLoadError();}}},1000);}
checkLoadError();angular.element(document.body).append(el);},function(){deferred.reject('load error');});});file.$ngfDurationPromise=deferred.promise;file.$ngfDurationPromise['finally'](function(){delete file.$ngfDurationPromise;});return file.$ngfDurationPromise;};return upload;}]);ngFileUpload.service('UploadResize',['UploadValidate','$q',function(UploadValidate,$q){var upload=UploadValidate;var calculateAspectRatioFit=function(srcWidth,srcHeight,maxWidth,maxHeight,centerCrop){var ratio=centerCrop?Math.max(maxWidth/srcWidth,maxHeight/srcHeight):Math.min(maxWidth/srcWidth,maxHeight/srcHeight);return{width:srcWidth*ratio,height:srcHeight*ratio,marginX:srcWidth*ratio-maxWidth,marginY:srcHeight*ratio-maxHeight};};var resize=function(imagen,width,height,quality,type,ratio,centerCrop,resizeIf){var deferred=$q.defer();var canvasElement=document.createElement('canvas');var imageElement=document.createElement('img');imageElement.onload=function(){if(resizeIf!=null&&resizeIf(imageElement.width,imageElement.height)===false){deferred.reject('resizeIf');return;}
try{if(ratio){var ratioFloat=upload.ratioToFloat(ratio);var imgRatio=imageElement.width/imageElement.height;if(imgRatio<ratioFloat){width=imageElement.width;height=width/ratioFloat;}else{height=imageElement.height;width=height*ratioFloat;}}
if(!width){width=imageElement.width;}
if(!height){height=imageElement.height;}
var dimensions=calculateAspectRatioFit(imageElement.width,imageElement.height,width,height,centerCrop);canvasElement.width=Math.min(dimensions.width,width);canvasElement.height=Math.min(dimensions.height,height);var context=canvasElement.getContext('2d');context.drawImage(imageElement,Math.min(0,-dimensions.marginX/2),Math.min(0,-dimensions.marginY/2),dimensions.width,dimensions.height);deferred.resolve(canvasElement.toDataURL(type||'image/WebP',quality||0.934));}catch(e){deferred.reject(e);}};imageElement.onerror=function(){deferred.reject();};imageElement.src=imagen;return deferred.promise;};upload.dataUrltoBlob=function(dataurl,name,origSize){var arr=dataurl.split(','),mime=arr[0].match(/:(.*?);/)[1],bstr=atob(arr[1]),n=bstr.length,u8arr=new Uint8Array(n);while(n--){u8arr[n]=bstr.charCodeAt(n);}
var blob=new window.Blob([u8arr],{type:mime});blob.name=name;blob.$ngfOrigSize=origSize;return blob;};upload.isResizeSupported=function(){var elem=document.createElement('canvas');return window.atob&&elem.getContext&&elem.getContext('2d')&&window.Blob;};if(upload.isResizeSupported()){Object.defineProperty(window.Blob.prototype,'name',{get:function(){return this.$ngfName;},set:function(v){this.$ngfName=v;},configurable:true});}
upload.resize=function(file,width,height,quality,type,ratio,centerCrop,resizeIf,restoreExif){if(file.type.indexOf('image')!==0)return upload.emptyPromise(file);var deferred=$q.defer();upload.dataUrl(file,true).then(function(url){resize(url,width,height,quality,type||file.type,ratio,centerCrop,resizeIf).then(function(dataUrl){if(file.type==='image/jpeg'&&restoreExif){try{dataUrl=upload.restoreExif(url,dataUrl);}catch(e){setTimeout(function(){throw e;},1);}}
try{var blob=upload.dataUrltoBlob(dataUrl,file.name,file.size);deferred.resolve(blob);}catch(e){deferred.reject(e);}},function(r){if(r==='resizeIf'){deferred.resolve(file);}
deferred.reject(r);});},function(e){deferred.reject(e);});return deferred.promise;};return upload;}]);(function(){ngFileUpload.directive('ngfDrop',['$parse','$timeout','$location','Upload','$http','$q',function($parse,$timeout,$location,Upload,$http,$q){return{restrict:'AEC',require:'?ngModel',link:function(scope,elem,attr,ngModel){linkDrop(scope,elem,attr,ngModel,$parse,$timeout,$location,Upload,$http,$q);}};}]);ngFileUpload.directive('ngfNoFileDrop',function(){return function(scope,elem){if(dropAvailable())elem.css('display','none');};});ngFileUpload.directive('ngfDropAvailable',['$parse','$timeout','Upload',function($parse,$timeout,Upload){return function(scope,elem,attr){if(dropAvailable()){var model=$parse(Upload.attrGetter('ngfDropAvailable',attr));$timeout(function(){model(scope);if(model.assign){model.assign(scope,true);}});}};}]);function linkDrop(scope,elem,attr,ngModel,$parse,$timeout,$location,upload,$http,$q){var available=dropAvailable();var attrGetter=function(name,scope,params){return upload.attrGetter(name,attr,scope,params);};if(attrGetter('dropAvailable')){$timeout(function(){if(scope[attrGetter('dropAvailable')]){scope[attrGetter('dropAvailable')].value=available;}else{scope[attrGetter('dropAvailable')]=available;}});}
if(!available){if(attrGetter('ngfHideOnDropNotAvailable',scope)===true){elem.css('display','none');}
return;}
function isDisabled(){return elem.attr('disabled')||attrGetter('ngfDropDisabled',scope);}
if(attrGetter('ngfSelect')==null){upload.registerModelChangeValidator(ngModel,attr,scope);}
var leaveTimeout=null;var stopPropagation=$parse(attrGetter('ngfStopPropagation'));var dragOverDelay=1;var actualDragOverClass;elem[0].addEventListener('dragover',function(evt){if(isDisabled()||!upload.shouldUpdateOn('drop',attr,scope))return;evt.preventDefault();if(stopPropagation(scope))evt.stopPropagation();if(navigator.userAgent.indexOf('Chrome')>-1){var b=evt.dataTransfer.effectAllowed;evt.dataTransfer.dropEffect=('move'===b||'linkMove'===b)?'move':'copy';}
$timeout.cancel(leaveTimeout);if(!actualDragOverClass){actualDragOverClass='C';calculateDragOverClass(scope,attr,evt,function(clazz){actualDragOverClass=clazz;elem.addClass(actualDragOverClass);attrGetter('ngfDrag',scope,{$isDragging:true,$class:actualDragOverClass,$event:evt});});}},false);elem[0].addEventListener('dragenter',function(evt){if(isDisabled()||!upload.shouldUpdateOn('drop',attr,scope))return;evt.preventDefault();if(stopPropagation(scope))evt.stopPropagation();},false);elem[0].addEventListener('dragleave',function(evt){if(isDisabled()||!upload.shouldUpdateOn('drop',attr,scope))return;evt.preventDefault();if(stopPropagation(scope))evt.stopPropagation();leaveTimeout=$timeout(function(){if(actualDragOverClass)elem.removeClass(actualDragOverClass);actualDragOverClass=null;attrGetter('ngfDrag',scope,{$isDragging:false,$event:evt});},dragOverDelay||100);},false);elem[0].addEventListener('drop',function(evt){if(isDisabled()||!upload.shouldUpdateOn('drop',attr,scope))return;evt.preventDefault();if(stopPropagation(scope))evt.stopPropagation();if(actualDragOverClass)elem.removeClass(actualDragOverClass);actualDragOverClass=null;var items=evt.dataTransfer.items;var html;try{html=evt.dataTransfer&&evt.dataTransfer.getData&&evt.dataTransfer.getData('text/html');}catch(e){}
extractFiles(items,evt.dataTransfer.files,attrGetter('ngfAllowDir',scope)!==false,attrGetter('multiple')||attrGetter('ngfMultiple',scope)).then(function(files){if(files.length){updateModel(files,evt);}else{extractFilesFromHtml('dropUrl',html).then(function(files){updateModel(files,evt);});}});},false);elem[0].addEventListener('paste',function(evt){if(navigator.userAgent.toLowerCase().indexOf('firefox')>-1&&attrGetter('ngfEnableFirefoxPaste',scope)){evt.preventDefault();}
if(isDisabled()||!upload.shouldUpdateOn('paste',attr,scope))return;var files=[];var clipboard=evt.clipboardData||evt.originalEvent.clipboardData;if(clipboard&&clipboard.items){for(var k=0;k<clipboard.items.length;k++){if(clipboard.items[k].type.indexOf('image')!==-1){files.push(clipboard.items[k].getAsFile());}}}
if(files.length){updateModel(files,evt);}else{extractFilesFromHtml('pasteUrl',clipboard).then(function(files){updateModel(files,evt);});}},false);if(navigator.userAgent.toLowerCase().indexOf('firefox')>-1&&attrGetter('ngfEnableFirefoxPaste',scope)){elem.attr('contenteditable',true);elem.on('keypress',function(e){if(!e.metaKey&&!e.ctrlKey){e.preventDefault();}});}
function updateModel(files,evt){upload.updateModel(ngModel,attr,scope,attrGetter('ngfChange')||attrGetter('ngfDrop'),files,evt);}
function extractFilesFromHtml(updateOn,html){if(!upload.shouldUpdateOn(updateOn,attr,scope)||!html)return upload.rejectPromise([]);var urls=[];html.replace(/<(img src|img [^>]* src) *=\"([^\"]*)\"/gi,function(m,n,src){urls.push(src);});var promises=[],files=[];if(urls.length){angular.forEach(urls,function(url){promises.push(upload.urlToBlob(url).then(function(blob){files.push(blob);}));});var defer=$q.defer();$q.all(promises).then(function(){defer.resolve(files);},function(e){defer.reject(e);});return defer.promise;}
return upload.emptyPromise();}
function calculateDragOverClass(scope,attr,evt,callback){var obj=attrGetter('ngfDragOverClass',scope,{$event:evt}),dClass='dragover';if(angular.isString(obj)){dClass=obj;}else if(obj){if(obj.delay)dragOverDelay=obj.delay;if(obj.accept||obj.reject){var items=evt.dataTransfer.items;if(items==null||!items.length){dClass=obj.accept;}else{var pattern=obj.pattern||attrGetter('ngfPattern',scope,{$event:evt});var len=items.length;while(len--){if(!upload.validatePattern(items[len],pattern)){dClass=obj.reject;break;}else{dClass=obj.accept;}}}}}
callback(dClass);}
function extractFiles(items,fileList,allowDir,multiple){var maxFiles=upload.getValidationAttr(attr,scope,'maxFiles')||Number.MAX_VALUE;var maxTotalSize=upload.getValidationAttr(attr,scope,'maxTotalSize')||Number.MAX_VALUE;var includeDir=attrGetter('ngfIncludeDir',scope);var files=[],totalSize=0;function traverseFileTree(entry,path){var defer=$q.defer();if(entry!=null){if(entry.isDirectory){var promises=[upload.emptyPromise()];if(includeDir){var file={type:'directory'};file.name=file.path=(path||'')+entry.name+entry.name;files.push(file);}
var dirReader=entry.createReader();var entries=[];var readEntries=function(){dirReader.readEntries(function(results){try{if(!results.length){angular.forEach(entries.slice(0),function(e){if(files.length<=maxFiles&&totalSize<=maxTotalSize){promises.push(traverseFileTree(e,(path?path:'')+entry.name+'/'));}});$q.all(promises).then(function(){defer.resolve();},function(e){defer.reject(e);});}else{entries=entries.concat(Array.prototype.slice.call(results||[],0));readEntries();}}catch(e){defer.reject(e);}},function(e){defer.reject(e);});};readEntries();}else{entry.file(function(file){try{file.path=(path?path:'')+file.name;if(includeDir){file=upload.rename(file,file.path);}
files.push(file);totalSize+=file.size;defer.resolve();}catch(e){defer.reject(e);}},function(e){defer.reject(e);});}}
return defer.promise;}
var promises=[upload.emptyPromise()];if(items&&items.length>0&&$location.protocol()!=='file'){for(var i=0;i<items.length;i++){if(items[i].webkitGetAsEntry&&items[i].webkitGetAsEntry()&&items[i].webkitGetAsEntry().isDirectory){var entry=items[i].webkitGetAsEntry();if(entry.isDirectory&&!allowDir){continue;}
if(entry!=null){promises.push(traverseFileTree(entry));}}else{var f=items[i].getAsFile();if(f!=null){files.push(f);totalSize+=f.size;}}
if(files.length>maxFiles||totalSize>maxTotalSize||(!multiple&&files.length>0))break;}}else{if(fileList!=null){for(var j=0;j<fileList.length;j++){var file=fileList.item(j);if(file.type||file.size>0){files.push(file);totalSize+=file.size;}
if(files.length>maxFiles||totalSize>maxTotalSize||(!multiple&&files.length>0))break;}}}
var defer=$q.defer();$q.all(promises).then(function(){if(!multiple&&!includeDir&&files.length){var i=0;while(files[i]&&files[i].type==='directory')i++;defer.resolve([files[i]]);}else{defer.resolve(files);}},function(e){defer.reject(e);});return defer.promise;}}
function dropAvailable(){var div=document.createElement('div');return('draggable'in div)&&('ondrop'in div)&&!/Edge\/12./i.test(navigator.userAgent);}})();ngFileUpload.service('UploadExif',['UploadResize','$q',function(UploadResize,$q){var upload=UploadResize;upload.isExifSupported=function(){return window.FileReader&&new FileReader().readAsArrayBuffer&&upload.isResizeSupported();};function applyTransform(ctx,orientation,width,height){switch(orientation){case 2:return ctx.transform(-1,0,0,1,width,0);case 3:return ctx.transform(-1,0,0,-1,width,height);case 4:return ctx.transform(1,0,0,-1,0,height);case 5:return ctx.transform(0,1,1,0,0,0);case 6:return ctx.transform(0,1,-1,0,height,0);case 7:return ctx.transform(0,-1,-1,0,height,width);case 8:return ctx.transform(0,-1,1,0,0,width);}}
upload.readOrientation=function(file){var defer=$q.defer();var reader=new FileReader();var slicedFile=file.slice?file.slice(0,64*1024):file;reader.readAsArrayBuffer(slicedFile);reader.onerror=function(e){return defer.reject(e);};reader.onload=function(e){var result={orientation:1};var view=new DataView(this.result);if(view.getUint16(0,false)!==0xFFD8)return defer.resolve(result);var length=view.byteLength,offset=2;while(offset<length){var marker=view.getUint16(offset,false);offset+=2;if(marker===0xFFE1){if(view.getUint32(offset+=2,false)!==0x45786966)return defer.resolve(result);var little=view.getUint16(offset+=6,false)===0x4949;offset+=view.getUint32(offset+4,little);var tags=view.getUint16(offset,little);offset+=2;for(var i=0;i<tags;i++)
if(view.getUint16(offset+(i*12),little)===0x0112){var orientation=view.getUint16(offset+(i*12)+8,little);if(orientation>=2&&orientation<=8){view.setUint16(offset+(i*12)+8,1,little);result.fixedArrayBuffer=e.target.result;}
result.orientation=orientation;return defer.resolve(result);}}else if((marker&0xFF00)!==0xFF00)break;else offset+=view.getUint16(offset,false);}
return defer.resolve(result);};return defer.promise;};function arrayBufferToBase64(buffer){var binary='';var bytes=new Uint8Array(buffer);var len=bytes.byteLength;for(var i=0;i<len;i++){binary+=String.fromCharCode(bytes[i]);}
return window.btoa(binary);}
upload.applyExifRotation=function(file){if(file.type.indexOf('image/jpeg')!==0){return upload.emptyPromise(file);}
var deferred=$q.defer();upload.readOrientation(file).then(function(result){if(result.orientation<2||result.orientation>8){return deferred.resolve(file);}
upload.dataUrl(file,true).then(function(url){var canvas=document.createElement('canvas');var img=document.createElement('img');img.onload=function(){try{canvas.width=result.orientation>4?img.height:img.width;canvas.height=result.orientation>4?img.width:img.height;var ctx=canvas.getContext('2d');applyTransform(ctx,result.orientation,img.width,img.height);ctx.drawImage(img,0,0);var dataUrl=canvas.toDataURL(file.type||'image/WebP',0.934);dataUrl=upload.restoreExif(arrayBufferToBase64(result.fixedArrayBuffer),dataUrl);var blob=upload.dataUrltoBlob(dataUrl,file.name);deferred.resolve(blob);}catch(e){return deferred.reject(e);}};img.onerror=function(){deferred.reject();};img.src=url;},function(e){deferred.reject(e);});},function(e){deferred.reject(e);});return deferred.promise;};upload.restoreExif=function(orig,resized){var ExifRestorer={};ExifRestorer.KEY_STR='ABCDEFGHIJKLMNOP'+'QRSTUVWXYZabcdef'+'ghijklmnopqrstuv'+'wxyz0123456789+/'+'=';ExifRestorer.encode64=function(input){var output='',chr1,chr2,chr3='',enc1,enc2,enc3,enc4='',i=0;do{chr1=input[i++];chr2=input[i++];chr3=input[i++];enc1=chr1>>2;enc2=((chr1&3)<<4)|(chr2>>4);enc3=((chr2&15)<<2)|(chr3>>6);enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64;}else if(isNaN(chr3)){enc4=64;}
output=output+
this.KEY_STR.charAt(enc1)+
this.KEY_STR.charAt(enc2)+
this.KEY_STR.charAt(enc3)+
this.KEY_STR.charAt(enc4);chr1=chr2=chr3='';enc1=enc2=enc3=enc4='';}while(i<input.length);return output;};ExifRestorer.restore=function(origFileBase64,resizedFileBase64){if(origFileBase64.match('data:image/jpeg;base64,')){origFileBase64=origFileBase64.replace('data:image/jpeg;base64,','');}
var rawImage=this.decode64(origFileBase64);var segments=this.slice2Segments(rawImage);var image=this.exifManipulation(resizedFileBase64,segments);return'data:image/jpeg;base64,'+this.encode64(image);};ExifRestorer.exifManipulation=function(resizedFileBase64,segments){var exifArray=this.getExifArray(segments),newImageArray=this.insertExif(resizedFileBase64,exifArray);return new Uint8Array(newImageArray);};ExifRestorer.getExifArray=function(segments){var seg;for(var x=0;x<segments.length;x++){seg=segments[x];if(seg[0]===255&seg[1]===225)
{return seg;}}
return[];};ExifRestorer.insertExif=function(resizedFileBase64,exifArray){var imageData=resizedFileBase64.replace('data:image/jpeg;base64,',''),buf=this.decode64(imageData),separatePoint=buf.indexOf(255,3),mae=buf.slice(0,separatePoint),ato=buf.slice(separatePoint),array=mae;array=array.concat(exifArray);array=array.concat(ato);return array;};ExifRestorer.slice2Segments=function(rawImageArray){var head=0,segments=[];while(1){if(rawImageArray[head]===255&rawImageArray[head+1]===218){break;}
if(rawImageArray[head]===255&rawImageArray[head+1]===216){head+=2;}
else{var length=rawImageArray[head+2]*256+rawImageArray[head+3],endPoint=head+length+2,seg=rawImageArray.slice(head,endPoint);segments.push(seg);head=endPoint;}
if(head>rawImageArray.length){break;}}
return segments;};ExifRestorer.decode64=function(input){var chr1,chr2,chr3='',enc1,enc2,enc3,enc4='',i=0,buf=[];var base64test=/[^A-Za-z0-9\+\/\=]/g;if(base64test.exec(input)){console.log('There were invalid base64 characters in the input text.\n'+'Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and "="\n'+'Expect errors in decoding.');}
input=input.replace(/[^A-Za-z0-9\+\/\=]/g,'');do{enc1=this.KEY_STR.indexOf(input.charAt(i++));enc2=this.KEY_STR.indexOf(input.charAt(i++));enc3=this.KEY_STR.indexOf(input.charAt(i++));enc4=this.KEY_STR.indexOf(input.charAt(i++));chr1=(enc1<<2)|(enc2>>4);chr2=((enc2&15)<<4)|(enc3>>2);chr3=((enc3&3)<<6)|enc4;buf.push(chr1);if(enc3!==64){buf.push(chr2);}
if(enc4!==64){buf.push(chr3);}
chr1=chr2=chr3='';enc1=enc2=enc3=enc4='';}while(i<input.length);return buf;};return ExifRestorer.restore(orig,resized);};return upload;}]);

(function(){function patchXHR(fnName,newFn){window.XMLHttpRequest.prototype[fnName]=newFn(window.XMLHttpRequest.prototype[fnName]);}
function redefineProp(xhr,prop,fn){try{Object.defineProperty(xhr,prop,{get:fn});}catch(e){}}
if(!window.FileAPI){window.FileAPI={};}
if(!window.XMLHttpRequest){throw'AJAX is not supported. XMLHttpRequest is not defined.';}
FileAPI.shouldLoad=!window.FormData||FileAPI.forceLoad;if(FileAPI.shouldLoad){var initializeUploadListener=function(xhr){if(!xhr.__listeners){if(!xhr.upload)xhr.upload={};xhr.__listeners=[];var origAddEventListener=xhr.upload.addEventListener;xhr.upload.addEventListener=function(t,fn){xhr.__listeners[t]=fn;if(origAddEventListener)origAddEventListener.apply(this,arguments);};}};patchXHR('open',function(orig){return function(m,url,b){initializeUploadListener(this);this.__url=url;try{orig.apply(this,[m,url,b]);}catch(e){if(e.message.indexOf('Access is denied')>-1){this.__origError=e;orig.apply(this,[m,'_fix_for_ie_crossdomain__',b]);}}};});patchXHR('getResponseHeader',function(orig){return function(h){return this.__fileApiXHR&&this.__fileApiXHR.getResponseHeader?this.__fileApiXHR.getResponseHeader(h):(orig==null?null:orig.apply(this,[h]));};});patchXHR('getAllResponseHeaders',function(orig){return function(){return this.__fileApiXHR&&this.__fileApiXHR.getAllResponseHeaders?this.__fileApiXHR.getAllResponseHeaders():(orig==null?null:orig.apply(this));};});patchXHR('abort',function(orig){return function(){return this.__fileApiXHR&&this.__fileApiXHR.abort?this.__fileApiXHR.abort():(orig==null?null:orig.apply(this));};});patchXHR('setRequestHeader',function(orig){return function(header,value){if(header==='__setXHR_'){initializeUploadListener(this);var val=value(this);if(val instanceof Function){val(this);}}else{this.__requestHeaders=this.__requestHeaders||{};this.__requestHeaders[header]=value;orig.apply(this,arguments);}};});patchXHR('send',function(orig){return function(){var xhr=this;if(arguments[0]&&arguments[0].__isFileAPIShim){var formData=arguments[0];var config={url:xhr.__url,jsonp:false,cache:true,complete:function(err,fileApiXHR){if(err&&angular.isString(err)&&err.indexOf('#2174')!==-1){err=null;}
xhr.__completed=true;if(!err&&xhr.__listeners.load)
xhr.__listeners.load({type:'load',loaded:xhr.__loaded,total:xhr.__total,target:xhr,lengthComputable:true});if(!err&&xhr.__listeners.loadend)
xhr.__listeners.loadend({type:'loadend',loaded:xhr.__loaded,total:xhr.__total,target:xhr,lengthComputable:true});if(err==='abort'&&xhr.__listeners.abort)
xhr.__listeners.abort({type:'abort',loaded:xhr.__loaded,total:xhr.__total,target:xhr,lengthComputable:true});if(fileApiXHR.status!==undefined)redefineProp(xhr,'status',function(){return(fileApiXHR.status===0&&err&&err!=='abort')?500:fileApiXHR.status;});if(fileApiXHR.statusText!==undefined)redefineProp(xhr,'statusText',function(){return fileApiXHR.statusText;});redefineProp(xhr,'readyState',function(){return 4;});if(fileApiXHR.response!==undefined)redefineProp(xhr,'response',function(){return fileApiXHR.response;});var resp=fileApiXHR.responseText||(err&&fileApiXHR.status===0&&err!=='abort'?err:undefined);redefineProp(xhr,'responseText',function(){return resp;});redefineProp(xhr,'response',function(){return resp;});if(err)redefineProp(xhr,'err',function(){return err;});xhr.__fileApiXHR=fileApiXHR;if(xhr.onreadystatechange)xhr.onreadystatechange();if(xhr.onload)xhr.onload();},progress:function(e){e.target=xhr;if(xhr.__listeners.progress)xhr.__listeners.progress(e);xhr.__total=e.total;xhr.__loaded=e.loaded;if(e.total===e.loaded){var _this=this;setTimeout(function(){if(!xhr.__completed){xhr.getAllResponseHeaders=function(){};_this.complete(null,{status:204,statusText:'No Content'});}},FileAPI.noContentTimeout||10000);}},headers:xhr.__requestHeaders};config.data={};config.files={};for(var i=0;i<formData.data.length;i++){var item=formData.data[i];if(item.val!=null&&item.val.name!=null&&item.val.size!=null&&item.val.type!=null){config.files[item.key]=item.val;}else{config.data[item.key]=item.val;}}
setTimeout(function(){if(!FileAPI.hasFlash){throw'Adode Flash Player need to be installed. To check ahead use "FileAPI.hasFlash"';}
xhr.__fileApiXHR=FileAPI.upload(config);},1);}else{if(this.__origError){throw this.__origError;}
orig.apply(xhr,arguments);}};});window.XMLHttpRequest.__isFileAPIShim=true;window.FormData=FormData=function(){return{append:function(key,val,name){if(val.__isFileAPIBlobShim){val=val.data[0];}
this.data.push({key:key,val:val,name:name});},data:[],__isFileAPIShim:true};};window.Blob=Blob=function(b){return{data:b,__isFileAPIBlobShim:true};};}})();(function(){function isInputTypeFile(elem){return elem[0].tagName.toLowerCase()==='input'&&elem.attr('type')&&elem.attr('type').toLowerCase()==='file';}
function hasFlash(){try{var fo=new ActiveXObject('ShockwaveFlash.ShockwaveFlash');if(fo)return true;}catch(e){if(navigator.mimeTypes['application/x-shockwave-flash']!==undefined)return true;}
return false;}
function getOffset(obj){var left=0,top=0;if(window.jQuery){return jQuery(obj).offset();}
if(obj.offsetParent){do{left+=(obj.offsetLeft-obj.scrollLeft);top+=(obj.offsetTop-obj.scrollTop);obj=obj.offsetParent;}while(obj);}
return{left:left,top:top};}
if(FileAPI.shouldLoad){FileAPI.hasFlash=hasFlash();if(FileAPI.forceLoad){FileAPI.html5=false;}
if(!FileAPI.upload){var jsUrl,basePath,script=document.createElement('script'),allScripts=document.getElementsByTagName('script'),i,index,src;if(window.FileAPI.jsUrl){jsUrl=window.FileAPI.jsUrl;}else if(window.FileAPI.jsPath){basePath=window.FileAPI.jsPath;}else{for(i=0;i<allScripts.length;i++){src=allScripts[i].src;index=src.search(/\/ng\-file\-upload[\-a-zA-z0-9\.]*\.js/);if(index>-1){basePath=src.substring(0,index+1);break;}}}
if(FileAPI.staticPath==null)FileAPI.staticPath=basePath;script.setAttribute('src',jsUrl||basePath+'FileAPI.min.js');document.getElementsByTagName('head')[0].appendChild(script);}
FileAPI.ngfFixIE=function(elem,fileElem,changeFn){if(!hasFlash()){throw'Adode Flash Player need to be installed. To check ahead use "FileAPI.hasFlash"';}
var fixInputStyle=function(){var label=fileElem.parent();if(elem.attr('disabled')){if(label)label.removeClass('js-fileapi-wrapper');}else{if(!fileElem.attr('__ngf_flash_')){fileElem.unbind('change');fileElem.unbind('click');fileElem.bind('change',function(evt){fileApiChangeFn.apply(this,[evt]);changeFn.apply(this,[evt]);});fileElem.attr('__ngf_flash_','true');}
label.addClass('js-fileapi-wrapper');if(!isInputTypeFile(elem)){label.css('position','absolute').css('top',getOffset(elem[0]).top+'px').css('left',getOffset(elem[0]).left+'px').css('width',elem[0].offsetWidth+'px').css('height',elem[0].offsetHeight+'px').css('filter','alpha(opacity=0)').css('display',elem.css('display')).css('overflow','hidden').css('z-index','900000').css('visibility','visible');fileElem.css('width',elem[0].offsetWidth+'px').css('height',elem[0].offsetHeight+'px').css('position','absolute').css('top','0px').css('left','0px');}}};elem.bind('mouseenter',fixInputStyle);var fileApiChangeFn=function(evt){var files=FileAPI.getFiles(evt);for(var i=0;i<files.length;i++){if(files[i].size===undefined)files[i].size=0;if(files[i].name===undefined)files[i].name='file';if(files[i].type===undefined)files[i].type='undefined';}
if(!evt.target){evt.target={};}
evt.target.files=files;if(evt.target.files!==files){evt.__files_=files;}
(evt.__files_||evt.target.files).item=function(i){return(evt.__files_||evt.target.files)[i]||null;};};};FileAPI.disableFileInput=function(elem,disable){if(disable){elem.removeClass('js-fileapi-wrapper');}else{elem.addClass('js-fileapi-wrapper');}};}})();if(!window.FileReader){window.FileReader=function(){var _this=this,loadStarted=false;this.listeners={};this.addEventListener=function(type,fn){_this.listeners[type]=_this.listeners[type]||[];_this.listeners[type].push(fn);};this.removeEventListener=function(type,fn){if(_this.listeners[type])_this.listeners[type].splice(_this.listeners[type].indexOf(fn),1);};this.dispatchEvent=function(evt){var list=_this.listeners[evt.type];if(list){for(var i=0;i<list.length;i++){list[i].call(_this,evt);}}};this.onabort=this.onerror=this.onload=this.onloadstart=this.onloadend=this.onprogress=null;var constructEvent=function(type,evt){var e={type:type,target:_this,loaded:evt.loaded,total:evt.total,error:evt.error};if(evt.result!=null)e.target.result=evt.result;return e;};var listener=function(evt){if(!loadStarted){loadStarted=true;if(_this.onloadstart)_this.onloadstart(constructEvent('loadstart',evt));}
var e;if(evt.type==='load'){if(_this.onloadend)_this.onloadend(constructEvent('loadend',evt));e=constructEvent('load',evt);if(_this.onload)_this.onload(e);_this.dispatchEvent(e);}else if(evt.type==='progress'){e=constructEvent('progress',evt);if(_this.onprogress)_this.onprogress(e);_this.dispatchEvent(e);}else{e=constructEvent('error',evt);if(_this.onerror)_this.onerror(e);_this.dispatchEvent(e);}};this.readAsDataURL=function(file){FileAPI.readAsDataURL(file,listener);};this.readAsText=function(file){FileAPI.readAsText(file,listener);};};}

(function(){var debug=false;var root=this;var EXIF=function(obj){if(obj instanceof EXIF)return obj;if(!(this instanceof EXIF))return new EXIF(obj);this.EXIFwrapped=obj;};if(typeof exports!=='undefined'){if(typeof module!=='undefined'&&module.exports){exports=module.exports=EXIF;}
exports.EXIF=EXIF;}else{root.EXIF=EXIF;}
var ExifTags=EXIF.Tags={0x9000:"ExifVersion",0xA000:"FlashpixVersion",0xA001:"ColorSpace",0xA002:"PixelXDimension",0xA003:"PixelYDimension",0x9101:"ComponentsConfiguration",0x9102:"CompressedBitsPerPixel",0x927C:"MakerNote",0x9286:"UserComment",0xA004:"RelatedSoundFile",0x9003:"DateTimeOriginal",0x9004:"DateTimeDigitized",0x9290:"SubsecTime",0x9291:"SubsecTimeOriginal",0x9292:"SubsecTimeDigitized",0x829A:"ExposureTime",0x829D:"FNumber",0x8822:"ExposureProgram",0x8824:"SpectralSensitivity",0x8827:"ISOSpeedRatings",0x8828:"OECF",0x9201:"ShutterSpeedValue",0x9202:"ApertureValue",0x9203:"BrightnessValue",0x9204:"ExposureBias",0x9205:"MaxApertureValue",0x9206:"SubjectDistance",0x9207:"MeteringMode",0x9208:"LightSource",0x9209:"Flash",0x9214:"SubjectArea",0x920A:"FocalLength",0xA20B:"FlashEnergy",0xA20C:"SpatialFrequencyResponse",0xA20E:"FocalPlaneXResolution",0xA20F:"FocalPlaneYResolution",0xA210:"FocalPlaneResolutionUnit",0xA214:"SubjectLocation",0xA215:"ExposureIndex",0xA217:"SensingMethod",0xA300:"FileSource",0xA301:"SceneType",0xA302:"CFAPattern",0xA401:"CustomRendered",0xA402:"ExposureMode",0xA403:"WhiteBalance",0xA404:"DigitalZoomRation",0xA405:"FocalLengthIn35mmFilm",0xA406:"SceneCaptureType",0xA407:"GainControl",0xA408:"Contrast",0xA409:"Saturation",0xA40A:"Sharpness",0xA40B:"DeviceSettingDescription",0xA40C:"SubjectDistanceRange",0xA005:"InteroperabilityIFDPointer",0xA420:"ImageUniqueID"};var TiffTags=EXIF.TiffTags={0x0100:"ImageWidth",0x0101:"ImageHeight",0x8769:"ExifIFDPointer",0x8825:"GPSInfoIFDPointer",0xA005:"InteroperabilityIFDPointer",0x0102:"BitsPerSample",0x0103:"Compression",0x0106:"PhotometricInterpretation",0x0112:"Orientation",0x0115:"SamplesPerPixel",0x011C:"PlanarConfiguration",0x0212:"YCbCrSubSampling",0x0213:"YCbCrPositioning",0x011A:"XResolution",0x011B:"YResolution",0x0128:"ResolutionUnit",0x0111:"StripOffsets",0x0116:"RowsPerStrip",0x0117:"StripByteCounts",0x0201:"JPEGInterchangeFormat",0x0202:"JPEGInterchangeFormatLength",0x012D:"TransferFunction",0x013E:"WhitePoint",0x013F:"PrimaryChromaticities",0x0211:"YCbCrCoefficients",0x0214:"ReferenceBlackWhite",0x0132:"DateTime",0x010E:"ImageDescription",0x010F:"Make",0x0110:"Model",0x0131:"Software",0x013B:"Artist",0x8298:"Copyright"};var GPSTags=EXIF.GPSTags={0x0000:"GPSVersionID",0x0001:"GPSLatitudeRef",0x0002:"GPSLatitude",0x0003:"GPSLongitudeRef",0x0004:"GPSLongitude",0x0005:"GPSAltitudeRef",0x0006:"GPSAltitude",0x0007:"GPSTimeStamp",0x0008:"GPSSatellites",0x0009:"GPSStatus",0x000A:"GPSMeasureMode",0x000B:"GPSDOP",0x000C:"GPSSpeedRef",0x000D:"GPSSpeed",0x000E:"GPSTrackRef",0x000F:"GPSTrack",0x0010:"GPSImgDirectionRef",0x0011:"GPSImgDirection",0x0012:"GPSMapDatum",0x0013:"GPSDestLatitudeRef",0x0014:"GPSDestLatitude",0x0015:"GPSDestLongitudeRef",0x0016:"GPSDestLongitude",0x0017:"GPSDestBearingRef",0x0018:"GPSDestBearing",0x0019:"GPSDestDistanceRef",0x001A:"GPSDestDistance",0x001B:"GPSProcessingMethod",0x001C:"GPSAreaInformation",0x001D:"GPSDateStamp",0x001E:"GPSDifferential"};var StringValues=EXIF.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0x0000:"Flash did not fire",0x0001:"Flash fired",0x0005:"Strobe return light not detected",0x0007:"Strobe return light detected",0x0009:"Flash fired, compulsory flash mode",0x000D:"Flash fired, compulsory flash mode, return light not detected",0x000F:"Flash fired, compulsory flash mode, return light detected",0x0010:"Flash did not fire, compulsory flash mode",0x0018:"Flash did not fire, auto mode",0x0019:"Flash fired, auto mode",0x001D:"Flash fired, auto mode, return light not detected",0x001F:"Flash fired, auto mode, return light detected",0x0020:"No flash function",0x0041:"Flash fired, red-eye reduction mode",0x0045:"Flash fired, red-eye reduction mode, return light not detected",0x0047:"Flash fired, red-eye reduction mode, return light detected",0x0049:"Flash fired, compulsory flash mode, red-eye reduction mode",0x004D:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",0x004F:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",0x0059:"Flash fired, auto mode, red-eye reduction mode",0x005D:"Flash fired, auto mode, return light not detected, red-eye reduction mode",0x005F:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}};function addEvent(element,event,handler){if(element.addEventListener){element.addEventListener(event,handler,false);}else if(element.attachEvent){element.attachEvent("on"+event,handler);}}
function imageHasData(img){return!!(img.exifdata);}
function base64ToArrayBuffer(base64,contentType){contentType=contentType||base64.match(/^data\:([^\;]+)\;base64,/mi)[1]||'';base64=base64.replace(/^data\:([^\;]+)\;base64,/gmi,'');var binary=atob(base64);var len=binary.length;var buffer=new ArrayBuffer(len);var view=new Uint8Array(buffer);for(var i=0;i<len;i++){view[i]=binary.charCodeAt(i);}
return buffer;}
function objectURLToBlob(url,callback){var http=new XMLHttpRequest();http.open("GET",url,true);http.responseType="blob";http.onload=function(e){if(this.status==200||this.status===0){callback(this.response);}};http.send();}
function getImageData(img,callback){function handleBinaryFile(binFile){var data=findEXIFinJPEG(binFile);var iptcdata=findIPTCinJPEG(binFile);img.exifdata=data||{};img.iptcdata=iptcdata||{};if(callback){callback.call(img);}}
if(img.src){if(/^data\:/i.test(img.src)){var arrayBuffer=base64ToArrayBuffer(img.src);handleBinaryFile(arrayBuffer);}else if(/^blob\:/i.test(img.src)){var fileReader=new FileReader();fileReader.onload=function(e){handleBinaryFile(e.target.result);};objectURLToBlob(img.src,function(blob){fileReader.readAsArrayBuffer(blob);});}else{var http=new XMLHttpRequest();http.onload=function(){if(this.status==200||this.status===0){handleBinaryFile(http.response);}else{throw"Could not load image";}
http=null;};http.open("GET",img.src,true);http.responseType="arraybuffer";http.send(null);}}else if(window.FileReader&&(img instanceof window.Blob||img instanceof window.File)){var fileReader=new FileReader();fileReader.onload=function(e){if(debug)console.log("Got file of length "+e.target.result.byteLength);handleBinaryFile(e.target.result);};fileReader.readAsArrayBuffer(img);}}
function findEXIFinJPEG(file){var dataView=new DataView(file);if(debug)console.log("Got file of length "+file.byteLength);if((dataView.getUint8(0)!=0xFF)||(dataView.getUint8(1)!=0xD8)){if(debug)console.log("Not a valid JPEG");return false;}
var offset=2,length=file.byteLength,marker;while(offset<length){if(dataView.getUint8(offset)!=0xFF){if(debug)console.log("Not a valid marker at offset "+offset+", found: "+dataView.getUint8(offset));return false;}
marker=dataView.getUint8(offset+1);if(debug)console.log(marker);if(marker==225){if(debug)console.log("Found 0xFFE1 marker");return readEXIFData(dataView,offset+4,dataView.getUint16(offset+2)-2);}else{offset+=2+dataView.getUint16(offset+2);}}}
function findIPTCinJPEG(file){var dataView=new DataView(file);if(debug)console.log("Got file of length "+file.byteLength);if((dataView.getUint8(0)!=0xFF)||(dataView.getUint8(1)!=0xD8)){if(debug)console.log("Not a valid JPEG");return false;}
var offset=2,length=file.byteLength;var isFieldSegmentStart=function(dataView,offset){return(dataView.getUint8(offset)===0x38&&dataView.getUint8(offset+1)===0x42&&dataView.getUint8(offset+2)===0x49&&dataView.getUint8(offset+3)===0x4D&&dataView.getUint8(offset+4)===0x04&&dataView.getUint8(offset+5)===0x04);};while(offset<length){if(isFieldSegmentStart(dataView,offset)){var nameHeaderLength=dataView.getUint8(offset+7);if(nameHeaderLength%2!==0)nameHeaderLength+=1;if(nameHeaderLength===0){nameHeaderLength=4;}
var startOffset=offset+8+nameHeaderLength;var sectionLength=dataView.getUint16(offset+6+nameHeaderLength);return readIPTCData(file,startOffset,sectionLength);break;}
offset++;}}
var IptcFieldMap={0x78:'caption',0x6E:'credit',0x19:'keywords',0x37:'dateCreated',0x50:'byline',0x55:'bylineTitle',0x7A:'captionWriter',0x69:'headline',0x74:'copyright',0x0F:'category'};function readIPTCData(file,startOffset,sectionLength){var dataView=new DataView(file);var data={};var fieldValue,fieldName,dataSize,segmentType,segmentSize;var segmentStartPos=startOffset;while(segmentStartPos<startOffset+sectionLength){if(dataView.getUint8(segmentStartPos)===0x1C&&dataView.getUint8(segmentStartPos+1)===0x02){segmentType=dataView.getUint8(segmentStartPos+2);if(segmentType in IptcFieldMap){dataSize=dataView.getInt16(segmentStartPos+3);segmentSize=dataSize+5;fieldName=IptcFieldMap[segmentType];fieldValue=getStringFromDB(dataView,segmentStartPos+5,dataSize);if(data.hasOwnProperty(fieldName)){if(data[fieldName]instanceof Array){data[fieldName].push(fieldValue);}
else{data[fieldName]=[data[fieldName],fieldValue];}}
else{data[fieldName]=fieldValue;}}}
segmentStartPos++;}
return data;}
function readTags(file,tiffStart,dirStart,strings,bigEnd){var entries=file.getUint16(dirStart,!bigEnd),tags={},entryOffset,tag,i;for(i=0;i<entries;i++){entryOffset=dirStart+i*12+2;tag=strings[file.getUint16(entryOffset,!bigEnd)];if(!tag&&debug)console.log("Unknown tag: "+file.getUint16(entryOffset,!bigEnd));tags[tag]=readTagValue(file,entryOffset,tiffStart,dirStart,bigEnd);}
return tags;}
function readTagValue(file,entryOffset,tiffStart,dirStart,bigEnd){var type=file.getUint16(entryOffset+2,!bigEnd),numValues=file.getUint32(entryOffset+4,!bigEnd),valueOffset=file.getUint32(entryOffset+8,!bigEnd)+tiffStart,offset,vals,val,n,numerator,denominator;switch(type){case 1:case 7:if(numValues==1){return file.getUint8(entryOffset+8,!bigEnd);}else{offset=numValues>4?valueOffset:(entryOffset+8);vals=[];for(n=0;n<numValues;n++){vals[n]=file.getUint8(offset+n);}
return vals;}
case 2:offset=numValues>4?valueOffset:(entryOffset+8);return getStringFromDB(file,offset,numValues-1);case 3:if(numValues==1){return file.getUint16(entryOffset+8,!bigEnd);}else{offset=numValues>2?valueOffset:(entryOffset+8);vals=[];for(n=0;n<numValues;n++){vals[n]=file.getUint16(offset+2*n,!bigEnd);}
return vals;}
case 4:if(numValues==1){return file.getUint32(entryOffset+8,!bigEnd);}else{vals=[];for(n=0;n<numValues;n++){vals[n]=file.getUint32(valueOffset+4*n,!bigEnd);}
return vals;}
case 5:if(numValues==1){numerator=file.getUint32(valueOffset,!bigEnd);denominator=file.getUint32(valueOffset+4,!bigEnd);val=new Number(numerator/denominator);val.numerator=numerator;val.denominator=denominator;return val;}else{vals=[];for(n=0;n<numValues;n++){numerator=file.getUint32(valueOffset+8*n,!bigEnd);denominator=file.getUint32(valueOffset+4+8*n,!bigEnd);vals[n]=new Number(numerator/denominator);vals[n].numerator=numerator;vals[n].denominator=denominator;}
return vals;}
case 9:if(numValues==1){return file.getInt32(entryOffset+8,!bigEnd);}else{vals=[];for(n=0;n<numValues;n++){vals[n]=file.getInt32(valueOffset+4*n,!bigEnd);}
return vals;}
case 10:if(numValues==1){return file.getInt32(valueOffset,!bigEnd)/file.getInt32(valueOffset+4,!bigEnd);}else{vals=[];for(n=0;n<numValues;n++){vals[n]=file.getInt32(valueOffset+8*n,!bigEnd)/file.getInt32(valueOffset+4+8*n,!bigEnd);}
return vals;}}}
function getStringFromDB(buffer,start,length){var outstr="";for(n=start;n<start+length;n++){outstr+=String.fromCharCode(buffer.getUint8(n));}
return outstr;}
function readEXIFData(file,start){if(getStringFromDB(file,start,4)!="Exif"){if(debug)console.log("Not valid EXIF data! "+getStringFromDB(file,start,4));return false;}
var bigEnd,tags,tag,exifData,gpsData,tiffOffset=start+6;if(file.getUint16(tiffOffset)==0x4949){bigEnd=false;}else if(file.getUint16(tiffOffset)==0x4D4D){bigEnd=true;}else{if(debug)console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)");return false;}
if(file.getUint16(tiffOffset+2,!bigEnd)!=0x002A){if(debug)console.log("Not valid TIFF data! (no 0x002A)");return false;}
var firstIFDOffset=file.getUint32(tiffOffset+4,!bigEnd);if(firstIFDOffset<0x00000008){if(debug)console.log("Not valid TIFF data! (First offset less than 8)",file.getUint32(tiffOffset+4,!bigEnd));return false;}
tags=readTags(file,tiffOffset,tiffOffset+firstIFDOffset,TiffTags,bigEnd);if(tags.ExifIFDPointer){exifData=readTags(file,tiffOffset,tiffOffset+tags.ExifIFDPointer,ExifTags,bigEnd);for(tag in exifData){switch(tag){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":exifData[tag]=StringValues[tag][exifData[tag]];break;case"ExifVersion":case"FlashpixVersion":exifData[tag]=String.fromCharCode(exifData[tag][0],exifData[tag][1],exifData[tag][2],exifData[tag][3]);break;case"ComponentsConfiguration":exifData[tag]=StringValues.Components[exifData[tag][0]]+
StringValues.Components[exifData[tag][1]]+
StringValues.Components[exifData[tag][2]]+
StringValues.Components[exifData[tag][3]];break;}
tags[tag]=exifData[tag];}}
if(tags.GPSInfoIFDPointer){gpsData=readTags(file,tiffOffset,tiffOffset+tags.GPSInfoIFDPointer,GPSTags,bigEnd);for(tag in gpsData){switch(tag){case"GPSVersionID":gpsData[tag]=gpsData[tag][0]+"."+gpsData[tag][1]+"."+gpsData[tag][2]+"."+gpsData[tag][3];break;}
tags[tag]=gpsData[tag];}}
return tags;}
EXIF.getData=function(img,callback){if((img instanceof Image||img instanceof HTMLImageElement)&&!img.complete)return false;if(!imageHasData(img)){getImageData(img,callback);}else{if(callback){callback.call(img);}}
return true;}
EXIF.getTag=function(img,tag){if(!imageHasData(img))return;return img.exifdata[tag];}
EXIF.getAllTags=function(img){if(!imageHasData(img))return{};var a,data=img.exifdata,tags={};for(a in data){if(data.hasOwnProperty(a)){tags[a]=data[a];}}
return tags;}
EXIF.pretty=function(img){if(!imageHasData(img))return"";var a,data=img.exifdata,strPretty="";for(a in data){if(data.hasOwnProperty(a)){if(typeof data[a]=="object"){if(data[a]instanceof Number){strPretty+=a+" : "+data[a]+" ["+data[a].numerator+"/"+data[a].denominator+"]\r\n";}else{strPretty+=a+" : ["+data[a].length+" values]\r\n";}}else{strPretty+=a+" : "+data[a]+"\r\n";}}}
return strPretty;}
EXIF.readFromBinaryFile=function(file){return findEXIFinJPEG(file);}
if(typeof define==='function'&&define.amd){define('exif-js',[],function(){return EXIF;});}}.call(this));

angular.module("ui.bootstrap",["ui.bootstrap.tpls","ui.bootstrap.collapse","ui.bootstrap.accordion","ui.bootstrap.alert","ui.bootstrap.buttons","ui.bootstrap.carousel","ui.bootstrap.dateparser","ui.bootstrap.isClass","ui.bootstrap.position","ui.bootstrap.datepicker","ui.bootstrap.debounce","ui.bootstrap.dropdown","ui.bootstrap.stackedMap","ui.bootstrap.modal","ui.bootstrap.paging","ui.bootstrap.pager","ui.bootstrap.pagination","ui.bootstrap.tooltip","ui.bootstrap.popover","ui.bootstrap.progressbar","ui.bootstrap.rating","ui.bootstrap.tabs","ui.bootstrap.timepicker","ui.bootstrap.typeahead"]);angular.module("ui.bootstrap.tpls",["uib/template/accordion/accordion-group.html","uib/template/accordion/accordion.html","uib/template/alert/alert.html","uib/template/carousel/carousel.html","uib/template/carousel/slide.html","uib/template/datepicker/datepicker.html","uib/template/datepicker/day.html","uib/template/datepicker/month.html","uib/template/datepicker/popup.html","uib/template/datepicker/year.html","uib/template/modal/backdrop.html","uib/template/modal/window.html","uib/template/pager/pager.html","uib/template/pagination/pagination.html","uib/template/tooltip/tooltip-html-popup.html","uib/template/tooltip/tooltip-popup.html","uib/template/tooltip/tooltip-template-popup.html","uib/template/popover/popover-html.html","uib/template/popover/popover-template.html","uib/template/popover/popover.html","uib/template/progressbar/bar.html","uib/template/progressbar/progress.html","uib/template/progressbar/progressbar.html","uib/template/rating/rating.html","uib/template/tabs/tab.html","uib/template/tabs/tabset.html","uib/template/timepicker/timepicker.html","uib/template/typeahead/typeahead-match.html","uib/template/typeahead/typeahead-popup.html"]);angular.module('ui.bootstrap.collapse',[]).directive('uibCollapse',['$animate','$injector',function($animate,$injector){var $animateCss=$injector.has('$animateCss')?$injector.get('$animateCss'):null;return{link:function(scope,element,attrs){if(!scope.$eval(attrs.uibCollapse)){element.addClass('in').addClass('collapse').css({height:'auto'});}
function expand(){element.removeClass('collapse').addClass('collapsing').attr('aria-expanded',true).attr('aria-hidden',false);if($animateCss){$animateCss(element,{addClass:'in',easing:'ease',to:{height:element[0].scrollHeight+'px'}}).start()['finally'](expandDone);}else{$animate.addClass(element,'in',{to:{height:element[0].scrollHeight+'px'}}).then(expandDone);}}
function expandDone(){element.removeClass('collapsing').addClass('collapse').css({height:'auto'});}
function collapse(){if(!element.hasClass('collapse')&&!element.hasClass('in')){return collapseDone();}
element.css({height:element[0].scrollHeight+'px'}).removeClass('collapse').addClass('collapsing').attr('aria-expanded',false).attr('aria-hidden',true);if($animateCss){$animateCss(element,{removeClass:'in',to:{height:'0'}}).start()['finally'](collapseDone);}else{$animate.removeClass(element,'in',{to:{height:'0'}}).then(collapseDone);}}
function collapseDone(){element.css({height:'0'});element.removeClass('collapsing').addClass('collapse');}
scope.$watch(attrs.uibCollapse,function(shouldCollapse){if(shouldCollapse){collapse();}else{expand();}});}};}]);angular.module('ui.bootstrap.accordion',['ui.bootstrap.collapse']).constant('uibAccordionConfig',{closeOthers:true}).controller('UibAccordionController',['$scope','$attrs','uibAccordionConfig',function($scope,$attrs,accordionConfig){this.groups=[];this.closeOthers=function(openGroup){var closeOthers=angular.isDefined($attrs.closeOthers)?$scope.$eval($attrs.closeOthers):accordionConfig.closeOthers;if(closeOthers){angular.forEach(this.groups,function(group){if(group!==openGroup){group.isOpen=false;}});}};this.addGroup=function(groupScope){var that=this;this.groups.push(groupScope);groupScope.$on('$destroy',function(event){that.removeGroup(groupScope);});};this.removeGroup=function(group){var index=this.groups.indexOf(group);if(index!==-1){this.groups.splice(index,1);}};}]).directive('uibAccordion',function(){return{controller:'UibAccordionController',controllerAs:'accordion',transclude:true,templateUrl:function(element,attrs){return attrs.templateUrl||'uib/template/accordion/accordion.html';}};}).directive('uibAccordionGroup',function(){return{require:'^uibAccordion',transclude:true,replace:true,templateUrl:function(element,attrs){return attrs.templateUrl||'uib/template/accordion/accordion-group.html';},scope:{heading:'@',isOpen:'=?',isDisabled:'=?'},controller:function(){this.setHeading=function(element){this.heading=element;};},link:function(scope,element,attrs,accordionCtrl){accordionCtrl.addGroup(scope);scope.openClass=attrs.openClass||'panel-open';scope.panelClass=attrs.panelClass||'panel-default';scope.$watch('isOpen',function(value){element.toggleClass(scope.openClass,!!value);if(value){accordionCtrl.closeOthers(scope);}});scope.toggleOpen=function($event){if(!scope.isDisabled){if(!$event||$event.which===32){scope.isOpen=!scope.isOpen;}}};}};}).directive('uibAccordionHeading',function(){return{transclude:true,template:'',replace:true,require:'^uibAccordionGroup',link:function(scope,element,attrs,accordionGroupCtrl,transclude){accordionGroupCtrl.setHeading(transclude(scope,angular.noop));}};}).directive('uibAccordionTransclude',function(){return{require:'^uibAccordionGroup',link:function(scope,element,attrs,controller){scope.$watch(function(){return controller[attrs.uibAccordionTransclude];},function(heading){if(heading){element.find('span').html('');element.find('span').append(heading);}});}};});angular.module('ui.bootstrap.alert',[]).controller('UibAlertController',['$scope','$attrs','$interpolate','$timeout',function($scope,$attrs,$interpolate,$timeout){$scope.closeable=!!$attrs.close;var dismissOnTimeout=angular.isDefined($attrs.dismissOnTimeout)?$interpolate($attrs.dismissOnTimeout)($scope.$parent):null;if(dismissOnTimeout){$timeout(function(){$scope.close();},parseInt(dismissOnTimeout,10));}}]).directive('uibAlert',function(){return{controller:'UibAlertController',controllerAs:'alert',templateUrl:function(element,attrs){return attrs.templateUrl||'uib/template/alert/alert.html';},transclude:true,replace:true,scope:{type:'@',close:'&'}};});angular.module('ui.bootstrap.buttons',[]).constant('uibButtonConfig',{activeClass:'active',toggleEvent:'click'}).controller('UibButtonsController',['uibButtonConfig',function(buttonConfig){this.activeClass=buttonConfig.activeClass||'active';this.toggleEvent=buttonConfig.toggleEvent||'click';}]).directive('uibBtnRadio',['$parse',function($parse){return{require:['uibBtnRadio','ngModel'],controller:'UibButtonsController',controllerAs:'buttons',link:function(scope,element,attrs,ctrls){var buttonsCtrl=ctrls[0],ngModelCtrl=ctrls[1];var uncheckableExpr=$parse(attrs.uibUncheckable);element.find('input').css({display:'none'});ngModelCtrl.$render=function(){element.toggleClass(buttonsCtrl.activeClass,angular.equals(ngModelCtrl.$modelValue,scope.$eval(attrs.uibBtnRadio)));};element.on(buttonsCtrl.toggleEvent,function(){if(attrs.disabled){return;}
var isActive=element.hasClass(buttonsCtrl.activeClass);if(!isActive||angular.isDefined(attrs.uncheckable)){scope.$apply(function(){ngModelCtrl.$setViewValue(isActive?null:scope.$eval(attrs.uibBtnRadio));ngModelCtrl.$render();});}});if(attrs.uibUncheckable){scope.$watch(uncheckableExpr,function(uncheckable){attrs.$set('uncheckable',uncheckable?'':null);});}}};}]).directive('uibBtnCheckbox',function(){return{require:['uibBtnCheckbox','ngModel'],controller:'UibButtonsController',controllerAs:'button',link:function(scope,element,attrs,ctrls){var buttonsCtrl=ctrls[0],ngModelCtrl=ctrls[1];element.find('input').css({display:'none'});function getTrueValue(){return getCheckboxValue(attrs.btnCheckboxTrue,true);}
function getFalseValue(){return getCheckboxValue(attrs.btnCheckboxFalse,false);}
function getCheckboxValue(attribute,defaultValue){return angular.isDefined(attribute)?scope.$eval(attribute):defaultValue;}
ngModelCtrl.$render=function(){element.toggleClass(buttonsCtrl.activeClass,angular.equals(ngModelCtrl.$modelValue,getTrueValue()));};element.on(buttonsCtrl.toggleEvent,function(){if(attrs.disabled){return;}
scope.$apply(function(){ngModelCtrl.$setViewValue(element.hasClass(buttonsCtrl.activeClass)?getFalseValue():getTrueValue());ngModelCtrl.$render();});});}};});angular.module('ui.bootstrap.carousel',[]).controller('UibCarouselController',['$scope','$element','$interval','$timeout','$animate',function($scope,$element,$interval,$timeout,$animate){var self=this,slides=self.slides=$scope.slides=[],SLIDE_DIRECTION='uib-slideDirection',currentIndex=-1,currentInterval,isPlaying,bufferedTransitions=[];self.currentSlide=null;var destroyed=false;self.addSlide=function(slide,element){slide.$element=element;slides.push(slide);if(slides.length===1||slide.active){if($scope.$currentTransition){$scope.$currentTransition=null;}
self.select(slides[slides.length-1]);if(slides.length===1){$scope.play();}}else{slide.active=false;}};self.getCurrentIndex=function(){if(self.currentSlide&&angular.isDefined(self.currentSlide.index)){return+self.currentSlide.index;}
return currentIndex;};self.next=$scope.next=function(){var newIndex=(self.getCurrentIndex()+1)%slides.length;if(newIndex===0&&$scope.noWrap()){$scope.pause();return;}
return self.select(getSlideByIndex(newIndex),'next');};self.prev=$scope.prev=function(){var newIndex=self.getCurrentIndex()-1<0?slides.length-1:self.getCurrentIndex()-1;if($scope.noWrap()&&newIndex===slides.length-1){$scope.pause();return;}
return self.select(getSlideByIndex(newIndex),'prev');};self.removeSlide=function(slide){if(angular.isDefined(slide.index)){slides.sort(function(a,b){return+a.index>+b.index;});}
var bufferedIndex=bufferedTransitions.indexOf(slide);if(bufferedIndex!==-1){bufferedTransitions.splice(bufferedIndex,1);}
var index=slides.indexOf(slide);slides.splice(index,1);$timeout(function(){if(slides.length>0&&slide.active){if(index>=slides.length){self.select(slides[index-1]);}else{self.select(slides[index]);}}else if(currentIndex>index){currentIndex--;}});if(slides.length===0){self.currentSlide=null;clearBufferedTransitions();}};self.select=$scope.select=function(nextSlide,direction){var nextIndex=$scope.indexOfSlide(nextSlide);if(direction===undefined){direction=nextIndex>self.getCurrentIndex()?'next':'prev';}
if(nextSlide&&nextSlide!==self.currentSlide&&!$scope.$currentTransition){goNext(nextSlide,nextIndex,direction);}else if(nextSlide&&nextSlide!==self.currentSlide&&$scope.$currentTransition){bufferedTransitions.push(nextSlide);nextSlide.active=false;}};$scope.indexOfSlide=function(slide){return angular.isDefined(slide.index)?+slide.index:slides.indexOf(slide);};$scope.isActive=function(slide){return self.currentSlide===slide;};$scope.pause=function(){if(!$scope.noPause){isPlaying=false;resetTimer();}};$scope.play=function(){if(!isPlaying){isPlaying=true;restartTimer();}};$scope.$on('$destroy',function(){destroyed=true;resetTimer();});$scope.$watch('noTransition',function(noTransition){$animate.enabled($element,!noTransition);});$scope.$watch('interval',restartTimer);$scope.$watchCollection('slides',resetTransition);function clearBufferedTransitions(){while(bufferedTransitions.length){bufferedTransitions.shift();}}
function getSlideByIndex(index){if(angular.isUndefined(slides[index].index)){return slides[index];}
for(var i=0,l=slides.length;i<l;++i){if(slides[i].index===index){return slides[i];}}}
function goNext(slide,index,direction){if(destroyed){return;}
angular.extend(slide,{direction:direction,active:true});angular.extend(self.currentSlide||{},{direction:direction,active:false});if($animate.enabled($element)&&!$scope.$currentTransition&&slide.$element&&self.slides.length>1){slide.$element.data(SLIDE_DIRECTION,slide.direction);if(self.currentSlide&&self.currentSlide.$element){self.currentSlide.$element.data(SLIDE_DIRECTION,slide.direction);}
$scope.$currentTransition=true;$animate.on('addClass',slide.$element,function(element,phase){if(phase==='close'){$scope.$currentTransition=null;$animate.off('addClass',element);if(bufferedTransitions.length){var nextSlide=bufferedTransitions.pop();var nextIndex=$scope.indexOfSlide(nextSlide);var nextDirection=nextIndex>self.getCurrentIndex()?'next':'prev';clearBufferedTransitions();goNext(nextSlide,nextIndex,nextDirection);}}});}
self.currentSlide=slide;currentIndex=index;restartTimer();}
function resetTimer(){if(currentInterval){$interval.cancel(currentInterval);currentInterval=null;}}
function resetTransition(slides){if(!slides.length){$scope.$currentTransition=null;clearBufferedTransitions();}}
function restartTimer(){resetTimer();var interval=+$scope.interval;if(!isNaN(interval)&&interval>0){currentInterval=$interval(timerFn,interval);}}
function timerFn(){var interval=+$scope.interval;if(isPlaying&&!isNaN(interval)&&interval>0&&slides.length){$scope.next();}else{$scope.pause();}}}]).directive('uibCarousel',function(){return{transclude:true,replace:true,controller:'UibCarouselController',controllerAs:'carousel',templateUrl:function(element,attrs){return attrs.templateUrl||'uib/template/carousel/carousel.html';},scope:{interval:'=',noTransition:'=',noPause:'=',noWrap:'&'}};}).directive('uibSlide',function(){return{require:'^uibCarousel',transclude:true,replace:true,templateUrl:function(element,attrs){return attrs.templateUrl||'uib/template/carousel/slide.html';},scope:{active:'=?',actual:'=?',index:'=?'},link:function(scope,element,attrs,carouselCtrl){carouselCtrl.addSlide(scope,element);scope.$on('$destroy',function(){carouselCtrl.removeSlide(scope);});scope.$watch('active',function(active){if(active){carouselCtrl.select(scope);}});}};}).animation('.item',['$animateCss',function($animateCss){var SLIDE_DIRECTION='uib-slideDirection';function removeClass(element,className,callback){element.removeClass(className);if(callback){callback();}}
return{beforeAddClass:function(element,className,done){if(className==='active'){var stopped=false;var direction=element.data(SLIDE_DIRECTION);var directionClass=direction==='next'?'left':'right';var removeClassFn=removeClass.bind(this,element,directionClass+' '+direction,done);element.addClass(direction);$animateCss(element,{addClass:directionClass}).start().done(removeClassFn);return function(){stopped=true;};}
done();},beforeRemoveClass:function(element,className,done){if(className==='active'){var stopped=false;var direction=element.data(SLIDE_DIRECTION);var directionClass=direction==='next'?'left':'right';var removeClassFn=removeClass.bind(this,element,directionClass,done);$animateCss(element,{addClass:directionClass}).start().done(removeClassFn);return function(){stopped=true;};}
done();}};}]);angular.module('ui.bootstrap.dateparser',[]).service('uibDateParser',['$log','$locale','orderByFilter',function($log,$locale,orderByFilter){var SPECIAL_CHARACTERS_REGEXP=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g;var localeId;var formatCodeToRegex;this.init=function(){localeId=$locale.id;this.parsers={};formatCodeToRegex=[{key:'yyyy',regex:'\\d{4}',apply:function(value){this.year=+value;}},{key:'yy',regex:'\\d{2}',apply:function(value){this.year=+value+2000;}},{key:'y',regex:'\\d{1,4}',apply:function(value){this.year=+value;}},{key:'M!',regex:'0?[1-9]|1[0-2]',apply:function(value){this.month=value-1;}},{key:'MMMM',regex:$locale.DATETIME_FORMATS.MONTH.join('|'),apply:function(value){this.month=$locale.DATETIME_FORMATS.MONTH.indexOf(value);}},{key:'MMM',regex:$locale.DATETIME_FORMATS.SHORTMONTH.join('|'),apply:function(value){this.month=$locale.DATETIME_FORMATS.SHORTMONTH.indexOf(value);}},{key:'MM',regex:'0[1-9]|1[0-2]',apply:function(value){this.month=value-1;}},{key:'M',regex:'[1-9]|1[0-2]',apply:function(value){this.month=value-1;}},{key:'d!',regex:'[0-2]?[0-9]{1}|3[0-1]{1}',apply:function(value){this.date=+value;}},{key:'dd',regex:'[0-2][0-9]{1}|3[0-1]{1}',apply:function(value){this.date=+value;}},{key:'d',regex:'[1-2]?[0-9]{1}|3[0-1]{1}',apply:function(value){this.date=+value;}},{key:'EEEE',regex:$locale.DATETIME_FORMATS.DAY.join('|')},{key:'EEE',regex:$locale.DATETIME_FORMATS.SHORTDAY.join('|')},{key:'HH',regex:'(?:0|1)[0-9]|2[0-3]',apply:function(value){this.hours=+value;}},{key:'hh',regex:'0[0-9]|1[0-2]',apply:function(value){this.hours=+value;}},{key:'H',regex:'1?[0-9]|2[0-3]',apply:function(value){this.hours=+value;}},{key:'h',regex:'[0-9]|1[0-2]',apply:function(value){this.hours=+value;}},{key:'mm',regex:'[0-5][0-9]',apply:function(value){this.minutes=+value;}},{key:'m',regex:'[0-9]|[1-5][0-9]',apply:function(value){this.minutes=+value;}},{key:'sss',regex:'[0-9][0-9][0-9]',apply:function(value){this.milliseconds=+value;}},{key:'ss',regex:'[0-5][0-9]',apply:function(value){this.seconds=+value;}},{key:'s',regex:'[0-9]|[1-5][0-9]',apply:function(value){this.seconds=+value;}},{key:'a',regex:$locale.DATETIME_FORMATS.AMPMS.join('|'),apply:function(value){if(this.hours===12){this.hours=0;}
if(value==='PM'){this.hours+=12;}}},{key:'Z',regex:'[+-]\\d{4}',apply:function(value){var matches=value.match(/([+-])(\d{2})(\d{2})/),sign=matches[1],hours=matches[2],minutes=matches[3];this.hours+=toInt(sign+hours);this.minutes+=toInt(sign+minutes);}},{key:'ww',regex:'[0-4][0-9]|5[0-3]'},{key:'w',regex:'[0-9]|[1-4][0-9]|5[0-3]'},{key:'GGGG',regex:$locale.DATETIME_FORMATS.ERANAMES.join('|').replace(/\s/g,'\\s')},{key:'GGG',regex:$locale.DATETIME_FORMATS.ERAS.join('|')},{key:'GG',regex:$locale.DATETIME_FORMATS.ERAS.join('|')},{key:'G',regex:$locale.DATETIME_FORMATS.ERAS.join('|')}];};this.init();function createParser(format){var map=[],regex=format.split('');var quoteIndex=format.indexOf('\'');if(quoteIndex>-1){var inLiteral=false;format=format.split('');for(var i=quoteIndex;i<format.length;i++){if(inLiteral){if(format[i]==='\''){if(i+1<format.length&&format[i+1]==='\''){format[i+1]='$';regex[i+1]='';}else{regex[i]='';inLiteral=false;}}
format[i]='$';}else{if(format[i]==='\''){format[i]='$';regex[i]='';inLiteral=true;}}}
format=format.join('');}
angular.forEach(formatCodeToRegex,function(data){var index=format.indexOf(data.key);if(index>-1){format=format.split('');regex[index]='('+data.regex+')';format[index]='$';for(var i=index+1,n=index+data.key.length;i<n;i++){regex[i]='';format[i]='$';}
format=format.join('');map.push({index:index,apply:data.apply,matcher:data.regex});}});return{regex:new RegExp('^'+regex.join('')+'$'),map:orderByFilter(map,'index')};}
this.parse=function(input,format,baseDate){if(!angular.isString(input)||!format){return input;}
format=$locale.DATETIME_FORMATS[format]||format;format=format.replace(SPECIAL_CHARACTERS_REGEXP,'\\$&');if($locale.id!==localeId){this.init();}
if(!this.parsers[format]){this.parsers[format]=createParser(format);}
var parser=this.parsers[format],regex=parser.regex,map=parser.map,results=input.match(regex),tzOffset=false;if(results&&results.length){var fields,dt;if(angular.isDate(baseDate)&&!isNaN(baseDate.getTime())){fields={year:baseDate.getFullYear(),month:baseDate.getMonth(),date:baseDate.getDate(),hours:baseDate.getHours(),minutes:baseDate.getMinutes(),seconds:baseDate.getSeconds(),milliseconds:baseDate.getMilliseconds()};}else{if(baseDate){$log.warn('dateparser:','baseDate is not a valid date');}
fields={year:1900,month:0,date:1,hours:0,minutes:0,seconds:0,milliseconds:0};}
for(var i=1,n=results.length;i<n;i++){var mapper=map[i-1];if(mapper.matcher==='Z'){tzOffset=true;}
if(mapper.apply){mapper.apply.call(fields,results[i]);}}
var datesetter=tzOffset?Date.prototype.setUTCFullYear:Date.prototype.setFullYear;var timesetter=tzOffset?Date.prototype.setUTCHours:Date.prototype.setHours;if(isValid(fields.year,fields.month,fields.date)){if(angular.isDate(baseDate)&&!isNaN(baseDate.getTime())&&!tzOffset){dt=new Date(baseDate);datesetter.call(dt,fields.year,fields.month,fields.date);timesetter.call(dt,fields.hours,fields.minutes,fields.seconds,fields.milliseconds);}else{dt=new Date(0);datesetter.call(dt,fields.year,fields.month,fields.date);timesetter.call(dt,fields.hours||0,fields.minutes||0,fields.seconds||0,fields.milliseconds||0);}}
return dt;}};function isValid(year,month,date){if(date<1){return false;}
if(month===1&&date>28){return date===29&&(year%4===0&&year%100!==0||year%400===0);}
if(month===3||month===5||month===8||month===10){return date<31;}
return true;}
function toInt(str){return parseInt(str,10);}
this.toTimezone=toTimezone;this.fromTimezone=fromTimezone;this.timezoneToOffset=timezoneToOffset;this.addDateMinutes=addDateMinutes;this.convertTimezoneToLocal=convertTimezoneToLocal;function toTimezone(date,timezone){return date&&timezone?convertTimezoneToLocal(date,timezone):date;}
function fromTimezone(date,timezone){return date&&timezone?convertTimezoneToLocal(date,timezone,true):date;}
function timezoneToOffset(timezone,fallback){var requestedTimezoneOffset=Date.parse('Jan 01, 1970 00:00:00 '+timezone)/60000;return isNaN(requestedTimezoneOffset)?fallback:requestedTimezoneOffset;}
function addDateMinutes(date,minutes){date=new Date(date.getTime());date.setMinutes(date.getMinutes()+minutes);return date;}
function convertTimezoneToLocal(date,timezone,reverse){reverse=reverse?-1:1;var timezoneOffset=timezoneToOffset(timezone,date.getTimezoneOffset());return addDateMinutes(date,reverse*(timezoneOffset-date.getTimezoneOffset()));}}]);angular.module('ui.bootstrap.isClass',[]).directive('uibIsClass',['$animate',function($animate){var ON_REGEXP=/^\s*([\s\S]+?)\s+on\s+([\s\S]+?)\s*$/;var IS_REGEXP=/^\s*([\s\S]+?)\s+for\s+([\s\S]+?)\s*$/;var dataPerTracked={};return{restrict:'A',compile:function(tElement,tAttrs){var linkedScopes=[];var instances=[];var expToData={};var lastActivated=null;var onExpMatches=tAttrs.uibIsClass.match(ON_REGEXP);var onExp=onExpMatches[2];var expsStr=onExpMatches[1];var exps=expsStr.split(',');return linkFn;function linkFn(scope,element,attrs){linkedScopes.push(scope);instances.push({scope:scope,element:element});exps.forEach(function(exp,k){addForExp(exp,scope);});scope.$on('$destroy',removeScope);}
function addForExp(exp,scope){var matches=exp.match(IS_REGEXP);var clazz=scope.$eval(matches[1]);var compareWithExp=matches[2];var data=expToData[exp];if(!data){var watchFn=function(compareWithVal){var newActivated=null;instances.some(function(instance){var thisVal=instance.scope.$eval(onExp);if(thisVal===compareWithVal){newActivated=instance;return true;}});if(data.lastActivated!==newActivated){if(data.lastActivated){$animate.removeClass(data.lastActivated.element,clazz);}
if(newActivated){$animate.addClass(newActivated.element,clazz);}
data.lastActivated=newActivated;}};expToData[exp]=data={lastActivated:null,scope:scope,watchFn:watchFn,compareWithExp:compareWithExp,watcher:scope.$watch(compareWithExp,watchFn)};}
data.watchFn(scope.$eval(compareWithExp));}
function removeScope(e){var removedScope=e.targetScope;var index=linkedScopes.indexOf(removedScope);linkedScopes.splice(index,1);instances.splice(index,1);if(linkedScopes.length){var newWatchScope=linkedScopes[0];angular.forEach(expToData,function(data){if(data.scope===removedScope){data.watcher=newWatchScope.$watch(data.compareWithExp,data.watchFn);data.scope=newWatchScope;}});}
else{expToData={};}}}};}]);angular.module('ui.bootstrap.position',[]).factory('$uibPosition',['$document','$window',function($document,$window){var SCROLLBAR_WIDTH;var OVERFLOW_REGEX={normal:/(auto|scroll)/,hidden:/(auto|scroll|hidden)/};var PLACEMENT_REGEX={auto:/\s?auto?\s?/i,primary:/^(top|bottom|left|right)$/,secondary:/^(top|bottom|left|right|center)$/,vertical:/^(top|bottom)$/};return{getRawNode:function(elem){return elem[0]||elem;},parseStyle:function(value){value=parseFloat(value);return isFinite(value)?value:0;},offsetParent:function(elem){elem=this.getRawNode(elem);var offsetParent=elem.offsetParent||$document[0].documentElement;function isStaticPositioned(el){return($window.getComputedStyle(el).position||'static')==='static';}
while(offsetParent&&offsetParent!==$document[0].documentElement&&isStaticPositioned(offsetParent)){offsetParent=offsetParent.offsetParent;}
return offsetParent||$document[0].documentElement;},scrollbarWidth:function(){if(angular.isUndefined(SCROLLBAR_WIDTH)){var scrollElem=angular.element('<div style="position: absolute; top: -9999px; width: 50px; height: 50px; overflow: scroll;"></div>');$document.find('body').append(scrollElem);SCROLLBAR_WIDTH=scrollElem[0].offsetWidth-scrollElem[0].clientWidth;SCROLLBAR_WIDTH=isFinite(SCROLLBAR_WIDTH)?SCROLLBAR_WIDTH:0;scrollElem.remove();}
return SCROLLBAR_WIDTH;},scrollParent:function(elem,includeHidden){elem=this.getRawNode(elem);var overflowRegex=includeHidden?OVERFLOW_REGEX.hidden:OVERFLOW_REGEX.normal;var documentEl=$document[0].documentElement;var elemStyle=$window.getComputedStyle(elem);var excludeStatic=elemStyle.position==='absolute';var scrollParent=elem.parentElement||documentEl;if(scrollParent===documentEl||elemStyle.position==='fixed'){return documentEl;}
while(scrollParent.parentElement&&scrollParent!==documentEl){var spStyle=$window.getComputedStyle(scrollParent);if(excludeStatic&&spStyle.position!=='static'){excludeStatic=false;}
if(!excludeStatic&&overflowRegex.test(spStyle.overflow+spStyle.overflowY+spStyle.overflowX)){break;}
scrollParent=scrollParent.parentElement;}
return scrollParent;},position:function(elem,includeMagins){elem=this.getRawNode(elem);var elemOffset=this.offset(elem);if(includeMagins){var elemStyle=$window.getComputedStyle(elem);elemOffset.top-=this.parseStyle(elemStyle.marginTop);elemOffset.left-=this.parseStyle(elemStyle.marginLeft);}
var parent=this.offsetParent(elem);var parentOffset={top:0,left:0};if(parent!==$document[0].documentElement){parentOffset=this.offset(parent);parentOffset.top+=parent.clientTop-parent.scrollTop;parentOffset.left+=parent.clientLeft-parent.scrollLeft;}
return{width:Math.round(angular.isNumber(elemOffset.width)?elemOffset.width:elem.offsetWidth),height:Math.round(angular.isNumber(elemOffset.height)?elemOffset.height:elem.offsetHeight),top:Math.round(elemOffset.top-parentOffset.top),left:Math.round(elemOffset.left-parentOffset.left)};},offset:function(elem){elem=this.getRawNode(elem);var elemBCR=elem.getBoundingClientRect();return{width:Math.round(angular.isNumber(elemBCR.width)?elemBCR.width:elem.offsetWidth),height:Math.round(angular.isNumber(elemBCR.height)?elemBCR.height:elem.offsetHeight),top:Math.round(elemBCR.top+($window.pageYOffset||$document[0].documentElement.scrollTop)),left:Math.round(elemBCR.left+($window.pageXOffset||$document[0].documentElement.scrollLeft))};},viewportOffset:function(elem,useDocument,includePadding){elem=this.getRawNode(elem);includePadding=includePadding!==false?true:false;var elemBCR=elem.getBoundingClientRect();var offsetBCR={top:0,left:0,bottom:0,right:0};var offsetParent=useDocument?$document[0].documentElement:this.scrollParent(elem);var offsetParentBCR=offsetParent.getBoundingClientRect();offsetBCR.top=offsetParentBCR.top+offsetParent.clientTop;offsetBCR.left=offsetParentBCR.left+offsetParent.clientLeft;if(offsetParent===$document[0].documentElement){offsetBCR.top+=$window.pageYOffset;offsetBCR.left+=$window.pageXOffset;}
offsetBCR.bottom=offsetBCR.top+offsetParent.clientHeight;offsetBCR.right=offsetBCR.left+offsetParent.clientWidth;if(includePadding){var offsetParentStyle=$window.getComputedStyle(offsetParent);offsetBCR.top+=this.parseStyle(offsetParentStyle.paddingTop);offsetBCR.bottom-=this.parseStyle(offsetParentStyle.paddingBottom);offsetBCR.left+=this.parseStyle(offsetParentStyle.paddingLeft);offsetBCR.right-=this.parseStyle(offsetParentStyle.paddingRight);}
return{top:Math.round(elemBCR.top-offsetBCR.top),bottom:Math.round(offsetBCR.bottom-elemBCR.bottom),left:Math.round(elemBCR.left-offsetBCR.left),right:Math.round(offsetBCR.right-elemBCR.right)};},parsePlacement:function(placement){var autoPlace=PLACEMENT_REGEX.auto.test(placement);if(autoPlace){placement=placement.replace(PLACEMENT_REGEX.auto,'');}
placement=placement.split('-');placement[0]=placement[0]||'top';if(!PLACEMENT_REGEX.primary.test(placement[0])){placement[0]='top';}
placement[1]=placement[1]||'center';if(!PLACEMENT_REGEX.secondary.test(placement[1])){placement[1]='center';}
if(autoPlace){placement[2]=true;}else{placement[2]=false;}
return placement;},positionElements:function(hostElem,targetElem,placement,appendToBody){hostElem=this.getRawNode(hostElem);targetElem=this.getRawNode(targetElem);var targetWidth=angular.isDefined(targetElem.offsetWidth)?targetElem.offsetWidth:targetElem.prop('offsetWidth');var targetHeight=angular.isDefined(targetElem.offsetHeight)?targetElem.offsetHeight:targetElem.prop('offsetHeight');placement=this.parsePlacement(placement);var hostElemPos=appendToBody?this.offset(hostElem):this.position(hostElem);var targetElemPos={top:0,left:0,placement:''};if(placement[2]){var viewportOffset=this.viewportOffset(hostElem);var targetElemStyle=$window.getComputedStyle(targetElem);var adjustedSize={width:targetWidth+Math.round(Math.abs(this.parseStyle(targetElemStyle.marginLeft)+this.parseStyle(targetElemStyle.marginRight))),height:targetHeight+Math.round(Math.abs(this.parseStyle(targetElemStyle.marginTop)+this.parseStyle(targetElemStyle.marginBottom)))};placement[0]=placement[0]==='top'&&adjustedSize.height>viewportOffset.top&&adjustedSize.height<=viewportOffset.bottom?'bottom':placement[0]==='bottom'&&adjustedSize.height>viewportOffset.bottom&&adjustedSize.height<=viewportOffset.top?'top':placement[0]==='left'&&adjustedSize.width>viewportOffset.left&&adjustedSize.width<=viewportOffset.right?'right':placement[0]==='right'&&adjustedSize.width>viewportOffset.right&&adjustedSize.width<=viewportOffset.left?'left':placement[0];placement[1]=placement[1]==='top'&&adjustedSize.height-hostElemPos.height>viewportOffset.bottom&&adjustedSize.height-hostElemPos.height<=viewportOffset.top?'bottom':placement[1]==='bottom'&&adjustedSize.height-hostElemPos.height>viewportOffset.top&&adjustedSize.height-hostElemPos.height<=viewportOffset.bottom?'top':placement[1]==='left'&&adjustedSize.width-hostElemPos.width>viewportOffset.right&&adjustedSize.width-hostElemPos.width<=viewportOffset.left?'right':placement[1]==='right'&&adjustedSize.width-hostElemPos.width>viewportOffset.left&&adjustedSize.width-hostElemPos.width<=viewportOffset.right?'left':placement[1];if(placement[1]==='center'){if(PLACEMENT_REGEX.vertical.test(placement[0])){var xOverflow=hostElemPos.width/2-targetWidth/2;if(viewportOffset.left+xOverflow<0&&adjustedSize.width-hostElemPos.width<=viewportOffset.right){placement[1]='left';}else if(viewportOffset.right+xOverflow<0&&adjustedSize.width-hostElemPos.width<=viewportOffset.left){placement[1]='right';}}else{var yOverflow=hostElemPos.height/2-adjustedSize.height/2;if(viewportOffset.top+yOverflow<0&&adjustedSize.height-hostElemPos.height<=viewportOffset.bottom){placement[1]='top';}else if(viewportOffset.bottom+yOverflow<0&&adjustedSize.height-hostElemPos.height<=viewportOffset.top){placement[1]='bottom';}}}}
switch(placement[0]){case'top':targetElemPos.top=hostElemPos.top-targetHeight;break;case'bottom':targetElemPos.top=hostElemPos.top+hostElemPos.height;break;case'left':targetElemPos.left=hostElemPos.left-targetWidth;break;case'right':targetElemPos.left=hostElemPos.left+hostElemPos.width;break;}
switch(placement[1]){case'top':targetElemPos.top=hostElemPos.top;break;case'bottom':targetElemPos.top=hostElemPos.top+hostElemPos.height-targetHeight;break;case'left':targetElemPos.left=hostElemPos.left;break;case'right':targetElemPos.left=hostElemPos.left+hostElemPos.width-targetWidth;break;case'center':if(PLACEMENT_REGEX.vertical.test(placement[0])){targetElemPos.left=hostElemPos.left+hostElemPos.width/2-targetWidth/2;}else{targetElemPos.top=hostElemPos.top+hostElemPos.height/2-targetHeight/2;}
break;}
targetElemPos.top=Math.round(targetElemPos.top);targetElemPos.left=Math.round(targetElemPos.left);targetElemPos.placement=placement[1]==='center'?placement[0]:placement[0]+'-'+placement[1];return targetElemPos;},positionArrow:function(elem,placement){elem=this.getRawNode(elem);var isTooltip=true;var innerElem=elem.querySelector('.tooltip-inner');if(!innerElem){isTooltip=false;innerElem=elem.querySelector('.popover-inner');}
if(!innerElem){return;}
var arrowElem=isTooltip?elem.querySelector('.tooltip-arrow'):elem.querySelector('.arrow');if(!arrowElem){return;}
placement=this.parsePlacement(placement);if(placement[1]==='center'){angular.element(arrowElem).css({top:'',bottom:'',right:'',left:'',margin:''});return;}
var borderProp='border-'+placement[0]+'-width';var borderWidth=$window.getComputedStyle(arrowElem)[borderProp];var borderRadiusProp='border-';if(PLACEMENT_REGEX.vertical.test(placement[0])){borderRadiusProp+=placement[0]+'-'+placement[1];}else{borderRadiusProp+=placement[1]+'-'+placement[0];}
borderRadiusProp+='-radius';var borderRadius=$window.getComputedStyle(isTooltip?innerElem:elem)[borderRadiusProp];var arrowCss={top:'auto',bottom:'auto',left:'auto',right:'auto',margin:0};switch(placement[0]){case'top':arrowCss.bottom=isTooltip?'0':'-'+borderWidth;break;case'bottom':arrowCss.top=isTooltip?'0':'-'+borderWidth;break;case'left':arrowCss.right=isTooltip?'0':'-'+borderWidth;break;case'right':arrowCss.left=isTooltip?'0':'-'+borderWidth;break;}
arrowCss[placement[1]]=borderRadius;angular.element(arrowElem).css(arrowCss);}};}]);angular.module('ui.bootstrap.datepicker',['ui.bootstrap.dateparser','ui.bootstrap.isClass','ui.bootstrap.position']).value('$datepickerSuppressError',false).constant('uibDatepickerConfig',{formatDay:'dd',formatMonth:'MMMM',formatYear:'yyyy',formatDayHeader:'EEE',formatDayTitle:'MMMM yyyy',formatMonthTitle:'yyyy',datepickerMode:'day',minMode:'day',maxMode:'year',showWeeks:true,startingDay:0,yearRows:4,yearColumns:5,minDate:null,maxDate:null,shortcutPropagation:false,ngModelOptions:{}}).controller('UibDatepickerController',['$scope','$attrs','$parse','$interpolate','$log','dateFilter','uibDatepickerConfig','$datepickerSuppressError','uibDateParser',function($scope,$attrs,$parse,$interpolate,$log,dateFilter,datepickerConfig,$datepickerSuppressError,dateParser){var self=this,ngModelCtrl={$setViewValue:angular.noop},ngModelOptions={};this.modes=['day','month','year'];angular.forEach(['formatDay','formatMonth','formatYear','formatDayHeader','formatDayTitle','formatMonthTitle'],function(key){self[key]=angular.isDefined($attrs[key])?$interpolate($attrs[key])($scope.$parent):datepickerConfig[key];});angular.forEach(['showWeeks','startingDay','yearRows','yearColumns','shortcutPropagation'],function(key){self[key]=angular.isDefined($attrs[key])?$scope.$parent.$eval($attrs[key]):datepickerConfig[key];});angular.forEach(['minDate','maxDate'],function(key){if($attrs[key]){$scope.$parent.$watch($attrs[key],function(value){self[key]=value?angular.isDate(value)?dateParser.fromTimezone(new Date(value),ngModelOptions.timezone):new Date(dateFilter(value,'medium')):null;self.refreshView();});}else{self[key]=datepickerConfig[key]?dateParser.fromTimezone(new Date(datepickerConfig[key]),ngModelOptions.timezone):null;}});angular.forEach(['minMode','maxMode'],function(key){if($attrs[key]){$scope.$parent.$watch($attrs[key],function(value){self[key]=$scope[key]=angular.isDefined(value)?value:$attrs[key];if(key==='minMode'&&self.modes.indexOf($scope.datepickerMode)<self.modes.indexOf(self[key])||key==='maxMode'&&self.modes.indexOf($scope.datepickerMode)>self.modes.indexOf(self[key])){$scope.datepickerMode=self[key];}});}else{self[key]=$scope[key]=datepickerConfig[key]||null;}});$scope.datepickerMode=$scope.datepickerMode||datepickerConfig.datepickerMode;$scope.uniqueId='datepicker-'+$scope.$id+'-'+Math.floor(Math.random()*10000);if(angular.isDefined($attrs.initDate)){this.activeDate=dateParser.fromTimezone($scope.$parent.$eval($attrs.initDate),ngModelOptions.timezone)||new Date();$scope.$parent.$watch($attrs.initDate,function(initDate){if(initDate&&(ngModelCtrl.$isEmpty(ngModelCtrl.$modelValue)||ngModelCtrl.$invalid)){self.activeDate=dateParser.fromTimezone(initDate,ngModelOptions.timezone);self.refreshView();}});}else{this.activeDate=new Date();}
$scope.disabled=angular.isDefined($attrs.disabled)||false;if(angular.isDefined($attrs.ngDisabled)){$scope.$parent.$watch($attrs.ngDisabled,function(disabled){$scope.disabled=disabled;self.refreshView();});}
$scope.isActive=function(dateObject){if(self.compare(dateObject.date,self.activeDate)===0){$scope.activeDateId=dateObject.uid;return true;}
return false;};this.init=function(ngModelCtrl_){ngModelCtrl=ngModelCtrl_;ngModelOptions=ngModelCtrl_.$options||datepickerConfig.ngModelOptions;if(ngModelCtrl.$modelValue){this.activeDate=ngModelCtrl.$modelValue;}
ngModelCtrl.$render=function(){self.render();};};this.render=function(){if(ngModelCtrl.$viewValue){var date=new Date(ngModelCtrl.$viewValue),isValid=!isNaN(date);if(isValid){this.activeDate=dateParser.fromTimezone(date,ngModelOptions.timezone);}else if(!$datepickerSuppressError){$log.error('Datepicker directive: "ng-model" value must be a Date object');}}
this.refreshView();};this.refreshView=function(){if(this.element){$scope.selectedDt=null;this._refreshView();if($scope.activeDt){$scope.activeDateId=$scope.activeDt.uid;}
var date=ngModelCtrl.$viewValue?new Date(ngModelCtrl.$viewValue):null;date=dateParser.fromTimezone(date,ngModelOptions.timezone);ngModelCtrl.$setValidity('dateDisabled',!date||this.element&&!this.isDisabled(date));}};this.createDateObject=function(date,format){var model=ngModelCtrl.$viewValue?new Date(ngModelCtrl.$viewValue):null;model=dateParser.fromTimezone(model,ngModelOptions.timezone);var dt={date:date,label:dateFilter(date,format.replace(/d!/,'dd')).replace(/M!/,'MM'),selected:model&&this.compare(date,model)===0,disabled:this.isDisabled(date),current:this.compare(date,new Date())===0,customClass:this.customClass(date)||null};if(model&&this.compare(date,model)===0){$scope.selectedDt=dt;}
if(self.activeDate&&this.compare(dt.date,self.activeDate)===0){$scope.activeDt=dt;}
return dt;};this.isDisabled=function(date){return $scope.disabled||this.minDate&&this.compare(date,this.minDate)<0||this.maxDate&&this.compare(date,this.maxDate)>0||$attrs.dateDisabled&&$scope.dateDisabled({date:date,mode:$scope.datepickerMode});};this.customClass=function(date){return $scope.customClass({date:date,mode:$scope.datepickerMode});};this.split=function(arr,size){var arrays=[];while(arr.length>0){arrays.push(arr.splice(0,size));}
return arrays;};$scope.select=function(date){if($scope.datepickerMode===self.minMode){var dt=ngModelCtrl.$viewValue?dateParser.fromTimezone(new Date(ngModelCtrl.$viewValue),ngModelOptions.timezone):new Date(0,0,0,0,0,0,0);dt.setFullYear(date.getFullYear(),date.getMonth(),date.getDate());dt=dateParser.toTimezone(dt,ngModelOptions.timezone);ngModelCtrl.$setViewValue(dt);ngModelCtrl.$render();}else{self.activeDate=date;$scope.datepickerMode=self.modes[self.modes.indexOf($scope.datepickerMode)-1];}};$scope.move=function(direction){var year=self.activeDate.getFullYear()+direction*(self.step.years||0),month=self.activeDate.getMonth()+direction*(self.step.months||0);self.activeDate.setFullYear(year,month,1);self.refreshView();};$scope.toggleMode=function(direction){direction=direction||1;if($scope.datepickerMode===self.maxMode&&direction===1||$scope.datepickerMode===self.minMode&&direction===-1){return;}
$scope.datepickerMode=self.modes[self.modes.indexOf($scope.datepickerMode)+direction];};$scope.keys={13:'enter',32:'space',33:'pageup',34:'pagedown',35:'end',36:'home',37:'left',38:'up',39:'right',40:'down'};var focusElement=function(){self.element[0].focus();};$scope.$on('uib:datepicker.focus',focusElement);$scope.keydown=function(evt){var key=$scope.keys[evt.which];if(!key||evt.shiftKey||evt.altKey||$scope.disabled){return;}
evt.preventDefault();if(!self.shortcutPropagation){evt.stopPropagation();}
if(key==='enter'||key==='space'){if(self.isDisabled(self.activeDate)){return;}
$scope.select(self.activeDate);}else if(evt.ctrlKey&&(key==='up'||key==='down')){$scope.toggleMode(key==='up'?1:-1);}else{self.handleKeyDown(key,evt);self.refreshView();}};}]).controller('UibDaypickerController',['$scope','$element','dateFilter',function(scope,$element,dateFilter){var DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31];this.step={months:1};this.element=$element;function getDaysInMonth(year,month){return month===1&&year%4===0&&(year%100!==0||year%400===0)?29:DAYS_IN_MONTH[month];}
this.init=function(ctrl){angular.extend(ctrl,this);scope.showWeeks=ctrl.showWeeks;ctrl.refreshView();};this.getDates=function(startDate,n){var dates=new Array(n),current=new Date(startDate),i=0,date;while(i<n){date=new Date(current);dates[i++]=date;current.setDate(current.getDate()+1);}
return dates;};this._refreshView=function(){var year=this.activeDate.getFullYear(),month=this.activeDate.getMonth(),firstDayOfMonth=new Date(this.activeDate);firstDayOfMonth.setFullYear(year,month,1);var difference=this.startingDay-firstDayOfMonth.getDay(),numDisplayedFromPreviousMonth=difference>0?7-difference:-difference,firstDate=new Date(firstDayOfMonth);if(numDisplayedFromPreviousMonth>0){firstDate.setDate(-numDisplayedFromPreviousMonth+1);}
var days=this.getDates(firstDate,42);for(var i=0;i<42;i++){days[i]=angular.extend(this.createDateObject(days[i],this.formatDay),{secondary:days[i].getMonth()!==month,uid:scope.uniqueId+'-'+i});}
scope.labels=new Array(7);for(var j=0;j<7;j++){scope.labels[j]={abbr:dateFilter(days[j].date,this.formatDayHeader),full:dateFilter(days[j].date,'EEEE')};}
scope.title=dateFilter(this.activeDate,this.formatDayTitle);scope.rows=this.split(days,7);if(scope.showWeeks){scope.weekNumbers=[];var thursdayIndex=(4+7-this.startingDay)%7,numWeeks=scope.rows.length;for(var curWeek=0;curWeek<numWeeks;curWeek++){scope.weekNumbers.push(getISO8601WeekNumber(scope.rows[curWeek][thursdayIndex].date));}}};this.compare=function(date1,date2){var _date1=new Date(date1.getFullYear(),date1.getMonth(),date1.getDate());var _date2=new Date(date2.getFullYear(),date2.getMonth(),date2.getDate());_date1.setFullYear(date1.getFullYear());_date2.setFullYear(date2.getFullYear());return _date1-_date2;};function getISO8601WeekNumber(date){var checkDate=new Date(date);checkDate.setDate(checkDate.getDate()+4-(checkDate.getDay()||7));var time=checkDate.getTime();checkDate.setMonth(0);checkDate.setDate(1);return Math.floor(Math.round((time-checkDate)/86400000)/7)+1;}
this.handleKeyDown=function(key,evt){var date=this.activeDate.getDate();if(key==='left'){date=date-1;}else if(key==='up'){date=date-7;}else if(key==='right'){date=date+1;}else if(key==='down'){date=date+7;}else if(key==='pageup'||key==='pagedown'){var month=this.activeDate.getMonth()+(key==='pageup'?-1:1);this.activeDate.setMonth(month,1);date=Math.min(getDaysInMonth(this.activeDate.getFullYear(),this.activeDate.getMonth()),date);}else if(key==='home'){date=1;}else if(key==='end'){date=getDaysInMonth(this.activeDate.getFullYear(),this.activeDate.getMonth());}
this.activeDate.setDate(date);};}]).controller('UibMonthpickerController',['$scope','$element','dateFilter',function(scope,$element,dateFilter){this.step={years:1};this.element=$element;this.init=function(ctrl){angular.extend(ctrl,this);ctrl.refreshView();};this._refreshView=function(){var months=new Array(12),year=this.activeDate.getFullYear(),date;for(var i=0;i<12;i++){date=new Date(this.activeDate);date.setFullYear(year,i,1);months[i]=angular.extend(this.createDateObject(date,this.formatMonth),{uid:scope.uniqueId+'-'+i});}
scope.title=dateFilter(this.activeDate,this.formatMonthTitle);scope.rows=this.split(months,3);};this.compare=function(date1,date2){var _date1=new Date(date1.getFullYear(),date1.getMonth());var _date2=new Date(date2.getFullYear(),date2.getMonth());_date1.setFullYear(date1.getFullYear());_date2.setFullYear(date2.getFullYear());return _date1-_date2;};this.handleKeyDown=function(key,evt){var date=this.activeDate.getMonth();if(key==='left'){date=date-1;}else if(key==='up'){date=date-3;}else if(key==='right'){date=date+1;}else if(key==='down'){date=date+3;}else if(key==='pageup'||key==='pagedown'){var year=this.activeDate.getFullYear()+(key==='pageup'?-1:1);this.activeDate.setFullYear(year);}else if(key==='home'){date=0;}else if(key==='end'){date=11;}
this.activeDate.setMonth(date);};}]).controller('UibYearpickerController',['$scope','$element','dateFilter',function(scope,$element,dateFilter){var columns,range;this.element=$element;function getStartingYear(year){return parseInt((year-1)/range,10)*range+1;}
this.yearpickerInit=function(){columns=this.yearColumns;range=this.yearRows*columns;this.step={years:range};};this._refreshView=function(){var years=new Array(range),date;for(var i=0,start=getStartingYear(this.activeDate.getFullYear());i<range;i++){date=new Date(this.activeDate);date.setFullYear(start+i,0,1);years[i]=angular.extend(this.createDateObject(date,this.formatYear),{uid:scope.uniqueId+'-'+i});}
scope.title=[years[0].label,years[range-1].label].join(' - ');scope.rows=this.split(years,columns);scope.columns=columns;};this.compare=function(date1,date2){return date1.getFullYear()-date2.getFullYear();};this.handleKeyDown=function(key,evt){var date=this.activeDate.getFullYear();if(key==='left'){date=date-1;}else if(key==='up'){date=date-columns;}else if(key==='right'){date=date+1;}else if(key==='down'){date=date+columns;}else if(key==='pageup'||key==='pagedown'){date+=(key==='pageup'?-1:1)*range;}else if(key==='home'){date=getStartingYear(this.activeDate.getFullYear());}else if(key==='end'){date=getStartingYear(this.activeDate.getFullYear())+range-1;}
this.activeDate.setFullYear(date);};}]).directive('uibDatepicker',function(){return{replace:true,templateUrl:function(element,attrs){return attrs.templateUrl||'uib/template/datepicker/datepicker.html';},scope:{datepickerMode:'=?',dateDisabled:'&',customClass:'&',shortcutPropagation:'&?'},require:['uibDatepicker','^ngModel'],controller:'UibDatepickerController',controllerAs:'datepicker',link:function(scope,element,attrs,ctrls){var datepickerCtrl=ctrls[0],ngModelCtrl=ctrls[1];datepickerCtrl.init(ngModelCtrl);}};}).directive('uibDaypicker',function(){return{replace:true,templateUrl:function(element,attrs){return attrs.templateUrl||'uib/template/datepicker/day.html';},require:['^uibDatepicker','uibDaypicker'],controller:'UibDaypickerController',link:function(scope,element,attrs,ctrls){var datepickerCtrl=ctrls[0],daypickerCtrl=ctrls[1];daypickerCtrl.init(datepickerCtrl);}};}).directive('uibMonthpicker',function(){return{replace:true,templateUrl:function(element,attrs){return attrs.templateUrl||'uib/template/datepicker/month.html';},require:['^uibDatepicker','uibMonthpicker'],controller:'UibMonthpickerController',link:function(scope,element,attrs,ctrls){var datepickerCtrl=ctrls[0],monthpickerCtrl=ctrls[1];monthpickerCtrl.init(datepickerCtrl);}};}).directive('uibYearpicker',function(){return{replace:true,templateUrl:function(element,attrs){return attrs.templateUrl||'uib/template/datepicker/year.html';},require:['^uibDatepicker','uibYearpicker'],controller:'UibYearpickerController',link:function(scope,element,attrs,ctrls){var ctrl=ctrls[0];angular.extend(ctrl,ctrls[1]);ctrl.yearpickerInit();ctrl.refreshView();}};}).constant('uibDatepickerPopupConfig',{datepickerPopup:'yyyy-MM-dd',datepickerPopupTemplateUrl:'uib/template/datepicker/popup.html',datepickerTemplateUrl:'uib/template/datepicker/datepicker.html',html5Types:{date:'yyyy-MM-dd','datetime-local':'yyyy-MM-ddTHH:mm:ss.sss','month':'yyyy-MM'},currentText:'Today',clearText:'Clear',closeText:'Done',closeOnDateSelection:true,appendToBody:false,showButtonBar:true,onOpenFocus:true,altInputFormats:[]}).controller('UibDatepickerPopupController',['$scope','$element','$attrs','$compile','$parse','$document','$rootScope','$uibPosition','dateFilter','uibDateParser','uibDatepickerPopupConfig','$timeout','uibDatepickerConfig',function(scope,element,attrs,$compile,$parse,$document,$rootScope,$position,dateFilter,dateParser,datepickerPopupConfig,$timeout,datepickerConfig){var self=this;var cache={},isHtml5DateInput=false;var dateFormat,closeOnDateSelection,appendToBody,onOpenFocus,datepickerPopupTemplateUrl,datepickerTemplateUrl,popupEl,datepickerEl,ngModel,ngModelOptions,$popup,altInputFormats;scope.watchData={};this.init=function(_ngModel_){ngModel=_ngModel_;ngModelOptions=_ngModel_.$options||datepickerConfig.ngModelOptions;closeOnDateSelection=angular.isDefined(attrs.closeOnDateSelection)?scope.$parent.$eval(attrs.closeOnDateSelection):datepickerPopupConfig.closeOnDateSelection;appendToBody=angular.isDefined(attrs.datepickerAppendToBody)?scope.$parent.$eval(attrs.datepickerAppendToBody):datepickerPopupConfig.appendToBody;onOpenFocus=angular.isDefined(attrs.onOpenFocus)?scope.$parent.$eval(attrs.onOpenFocus):datepickerPopupConfig.onOpenFocus;datepickerPopupTemplateUrl=angular.isDefined(attrs.datepickerPopupTemplateUrl)?attrs.datepickerPopupTemplateUrl:datepickerPopupConfig.datepickerPopupTemplateUrl;datepickerTemplateUrl=angular.isDefined(attrs.datepickerTemplateUrl)?attrs.datepickerTemplateUrl:datepickerPopupConfig.datepickerTemplateUrl;altInputFormats=angular.isDefined(attrs.altInputFormats)?scope.$parent.$eval(attrs.altInputFormats):datepickerPopupConfig.altInputFormats;scope.showButtonBar=angular.isDefined(attrs.showButtonBar)?scope.$parent.$eval(attrs.showButtonBar):datepickerPopupConfig.showButtonBar;if(datepickerPopupConfig.html5Types[attrs.type]){dateFormat=datepickerPopupConfig.html5Types[attrs.type];isHtml5DateInput=true;}else{dateFormat=attrs.uibDatepickerPopup||datepickerPopupConfig.datepickerPopup;attrs.$observe('uibDatepickerPopup',function(value,oldValue){var newDateFormat=value||datepickerPopupConfig.datepickerPopup;if(newDateFormat!==dateFormat){dateFormat=newDateFormat;ngModel.$modelValue=null;if(!dateFormat){throw new Error('uibDatepickerPopup must have a date format specified.');}}});}
if(!dateFormat){throw new Error('uibDatepickerPopup must have a date format specified.');}
if(isHtml5DateInput&&attrs.uibDatepickerPopup){throw new Error('HTML5 date input types do not support custom formats.');}
popupEl=angular.element('<div uib-datepicker-popup-wrap><div uib-datepicker></div></div>');scope.ngModelOptions=angular.copy(ngModelOptions);scope.ngModelOptions.timezone=null;popupEl.attr({'ng-model':'date','ng-model-options':'ngModelOptions','ng-change':'dateSelection(date)','template-url':datepickerPopupTemplateUrl});datepickerEl=angular.element(popupEl.children()[0]);datepickerEl.attr('template-url',datepickerTemplateUrl);if(isHtml5DateInput){if(attrs.type==='month'){datepickerEl.attr('datepicker-mode','"month"');datepickerEl.attr('min-mode','month');}}
if(attrs.datepickerOptions){var options=scope.$parent.$eval(attrs.datepickerOptions);if(options&&options.initDate){scope.initDate=dateParser.fromTimezone(options.initDate,ngModelOptions.timezone);datepickerEl.attr('init-date','initDate');delete options.initDate;}
angular.forEach(options,function(value,option){datepickerEl.attr(cameltoDash(option),value);});}
angular.forEach(['minMode','maxMode'],function(key){if(attrs[key]){scope.$parent.$watch(function(){return attrs[key];},function(value){scope.watchData[key]=value;});datepickerEl.attr(cameltoDash(key),'watchData.'+key);}});angular.forEach(['datepickerMode','shortcutPropagation'],function(key){if(attrs[key]){var getAttribute=$parse(attrs[key]);var propConfig={get:function(){return getAttribute(scope.$parent);}};datepickerEl.attr(cameltoDash(key),'watchData.'+key);if(key==='datepickerMode'){var setAttribute=getAttribute.assign;propConfig.set=function(v){setAttribute(scope.$parent,v);};}
Object.defineProperty(scope.watchData,key,propConfig);}});angular.forEach(['minDate','maxDate','initDate'],function(key){if(attrs[key]){var getAttribute=$parse(attrs[key]);scope.$parent.$watch(getAttribute,function(value){if(key==='minDate'||key==='maxDate'){cache[key]=angular.isDate(value)?dateParser.fromTimezone(new Date(value),ngModelOptions.timezone):new Date(dateFilter(value,'medium'));}
scope.watchData[key]=cache[key]||dateParser.fromTimezone(new Date(value),ngModelOptions.timezone);});datepickerEl.attr(cameltoDash(key),'watchData.'+key);}});if(attrs.dateDisabled){datepickerEl.attr('date-disabled','dateDisabled({ date: date, mode: mode })');}
angular.forEach(['formatDay','formatMonth','formatYear','formatDayHeader','formatDayTitle','formatMonthTitle','showWeeks','startingDay','yearRows','yearColumns'],function(key){if(angular.isDefined(attrs[key])){datepickerEl.attr(cameltoDash(key),attrs[key]);}});if(attrs.customClass){datepickerEl.attr('custom-class','customClass({ date: date, mode: mode })');}
if(!isHtml5DateInput){ngModel.$$parserName='date';ngModel.$validators.date=validator;ngModel.$parsers.unshift(parseDate);ngModel.$formatters.push(function(value){if(ngModel.$isEmpty(value)){scope.date=value;return value;}
scope.date=dateParser.fromTimezone(value,ngModelOptions.timezone);dateFormat=dateFormat.replace(/M!/,'MM').replace(/d!/,'dd');return dateFilter(scope.date,dateFormat);});}else{ngModel.$formatters.push(function(value){scope.date=dateParser.fromTimezone(value,ngModelOptions.timezone);return value;});}
ngModel.$viewChangeListeners.push(function(){scope.date=parseDateString(ngModel.$viewValue);});element.bind('keydown',inputKeydownBind);$popup=$compile(popupEl)(scope);popupEl.remove();if(appendToBody){$document.find('body').append($popup);}else{element.after($popup);}
scope.$on('$destroy',function(){if(scope.isOpen===true){if(!$rootScope.$$phase){scope.$apply(function(){scope.isOpen=false;});}}
$popup.remove();element.unbind('keydown',inputKeydownBind);$document.unbind('click',documentClickBind);});};scope.getText=function(key){return scope[key+'Text']||datepickerPopupConfig[key+'Text'];};scope.isDisabled=function(date){if(date==='today'){date=new Date();}
return scope.watchData.minDate&&scope.compare(date,cache.minDate)<0||scope.watchData.maxDate&&scope.compare(date,cache.maxDate)>0;};scope.compare=function(date1,date2){return new Date(date1.getFullYear(),date1.getMonth(),date1.getDate())-new Date(date2.getFullYear(),date2.getMonth(),date2.getDate());};scope.dateSelection=function(dt){if(angular.isDefined(dt)){scope.date=dt;}
var date=scope.date?dateFilter(scope.date,dateFormat):null;element.val(date);ngModel.$setViewValue(date);if(closeOnDateSelection){scope.isOpen=false;element[0].focus();}};scope.keydown=function(evt){if(evt.which===27){evt.stopPropagation();scope.isOpen=false;element[0].focus();}};scope.select=function(date){if(date==='today'){var today=new Date();if(angular.isDate(scope.date)){date=new Date(scope.date);date.setFullYear(today.getFullYear(),today.getMonth(),today.getDate());}else{date=new Date(today.setHours(0,0,0,0));}}
scope.dateSelection(date);};scope.close=function(){scope.isOpen=false;element[0].focus();};scope.disabled=angular.isDefined(attrs.disabled)||false;if(attrs.ngDisabled){scope.$parent.$watch($parse(attrs.ngDisabled),function(disabled){scope.disabled=disabled;});}
scope.$watch('isOpen',function(value){if(value){if(!scope.disabled){scope.position=appendToBody?$position.offset(element):$position.position(element);scope.position.top=scope.position.top+element.prop('offsetHeight');$timeout(function(){if(onOpenFocus){scope.$broadcast('uib:datepicker.focus');}
$document.bind('click',documentClickBind);},0,false);}else{scope.isOpen=false;}}else{$document.unbind('click',documentClickBind);}});function cameltoDash(string){return string.replace(/([A-Z])/g,function($1){return'-'+$1.toLowerCase();});}
function parseDateString(viewValue){var date=dateParser.parse(viewValue,dateFormat,scope.date);if(isNaN(date)){for(var i=0;i<altInputFormats.length;i++){date=dateParser.parse(viewValue,altInputFormats[i],scope.date);if(!isNaN(date)){return date;}}}
return date;}
function parseDate(viewValue){if(angular.isNumber(viewValue)){viewValue=new Date(viewValue);}
if(!viewValue){return null;}
if(angular.isDate(viewValue)&&!isNaN(viewValue)){return viewValue;}
if(angular.isString(viewValue)){var date=parseDateString(viewValue);if(!isNaN(date)){return dateParser.toTimezone(date,ngModelOptions.timezone);}}
return ngModel.$options&&ngModel.$options.allowInvalid?viewValue:undefined;}
function validator(modelValue,viewValue){var value=modelValue||viewValue;if(!attrs.ngRequired&&!value){return true;}
if(angular.isNumber(value)){value=new Date(value);}
if(!value){return true;}
if(angular.isDate(value)&&!isNaN(value)){return true;}
if(angular.isString(value)){return!isNaN(parseDateString(viewValue));}
return false;}
function documentClickBind(event){if(!scope.isOpen&&scope.disabled){return;}
var popup=$popup[0];var dpContainsTarget=element[0].contains(event.target);var popupContainsTarget=popup.contains!==undefined&&popup.contains(event.target);if(scope.isOpen&&!(dpContainsTarget||popupContainsTarget)){scope.$apply(function(){scope.isOpen=false;});}}
function inputKeydownBind(evt){if(evt.which===27&&scope.isOpen){evt.preventDefault();evt.stopPropagation();scope.$apply(function(){scope.isOpen=false;});element[0].focus();}else if(evt.which===40&&!scope.isOpen){evt.preventDefault();evt.stopPropagation();scope.$apply(function(){scope.isOpen=true;});}}}]).directive('uibDatepickerPopup',function(){return{require:['ngModel','uibDatepickerPopup'],controller:'UibDatepickerPopupController',scope:{isOpen:'=?',currentText:'@',clearText:'@',closeText:'@',dateDisabled:'&',customClass:'&'},link:function(scope,element,attrs,ctrls){var ngModel=ctrls[0],ctrl=ctrls[1];ctrl.init(ngModel);}};}).directive('uibDatepickerPopupWrap',function(){return{replace:true,transclude:true,templateUrl:function(element,attrs){return attrs.templateUrl||'uib/template/datepicker/popup.html';}};});angular.module('ui.bootstrap.debounce',[]).factory('$$debounce',['$timeout',function($timeout){return function(callback,debounceTime){var timeoutPromise;return function(){var self=this;var args=Array.prototype.slice.call(arguments);if(timeoutPromise){$timeout.cancel(timeoutPromise);}
timeoutPromise=$timeout(function(){callback.apply(self,args);},debounceTime);};};}]);angular.module('ui.bootstrap.dropdown',['ui.bootstrap.position']).constant('uibDropdownConfig',{appendToOpenClass:'uib-dropdown-open',openClass:'open'}).service('uibDropdownService',['$document','$rootScope',function($document,$rootScope){var openScope=null;this.open=function(dropdownScope){if(!openScope){$document.on('click',closeDropdown);$document.on('keydown',keybindFilter);}
if(openScope&&openScope!==dropdownScope){openScope.isOpen=false;}
openScope=dropdownScope;};this.close=function(dropdownScope){if(openScope===dropdownScope){openScope=null;$document.off('click',closeDropdown);$document.off('keydown',keybindFilter);}};var closeDropdown=function(evt){if(!openScope){return;}
if(evt&&openScope.getAutoClose()==='disabled'){return;}
if(evt&&evt.which===3){return;}
var toggleElement=openScope.getToggleElement();if(evt&&toggleElement&&toggleElement[0].contains(evt.target)){return;}
var dropdownElement=openScope.getDropdownElement();if(evt&&openScope.getAutoClose()==='outsideClick'&&dropdownElement&&dropdownElement[0].contains(evt.target)){return;}
openScope.isOpen=false;if(!$rootScope.$$phase){openScope.$apply();}};var keybindFilter=function(evt){if(evt.which===27){openScope.focusToggleElement();closeDropdown();}else if(openScope.isKeynavEnabled()&&[38,40].indexOf(evt.which)!==-1&&openScope.isOpen){evt.preventDefault();evt.stopPropagation();openScope.focusDropdownEntry(evt.which);}};}]).controller('UibDropdownController',['$scope','$element','$attrs','$parse','uibDropdownConfig','uibDropdownService','$animate','$uibPosition','$document','$compile','$templateRequest',function($scope,$element,$attrs,$parse,dropdownConfig,uibDropdownService,$animate,$position,$document,$compile,$templateRequest){var self=this,scope=$scope.$new(),templateScope,appendToOpenClass=dropdownConfig.appendToOpenClass,openClass=dropdownConfig.openClass,getIsOpen,setIsOpen=angular.noop,toggleInvoker=$attrs.onToggle?$parse($attrs.onToggle):angular.noop,appendToBody=false,appendTo=null,keynavEnabled=false,selectedOption=null,body=$document.find('body');$element.addClass('dropdown');this.init=function(){if($attrs.isOpen){getIsOpen=$parse($attrs.isOpen);setIsOpen=getIsOpen.assign;$scope.$watch(getIsOpen,function(value){scope.isOpen=!!value;});}
if(angular.isDefined($attrs.dropdownAppendTo)){var appendToEl=$parse($attrs.dropdownAppendTo)(scope);if(appendToEl){appendTo=angular.element(appendToEl);}}
appendToBody=angular.isDefined($attrs.dropdownAppendToBody);keynavEnabled=angular.isDefined($attrs.keyboardNav);if(appendToBody&&!appendTo){appendTo=body;}
if(appendTo&&self.dropdownMenu){appendTo.append(self.dropdownMenu);$element.on('$destroy',function handleDestroyEvent(){self.dropdownMenu.remove();});}};this.toggle=function(open){return scope.isOpen=arguments.length?!!open:!scope.isOpen;};this.isOpen=function(){return scope.isOpen;};scope.getToggleElement=function(){return self.toggleElement;};scope.getAutoClose=function(){return $attrs.autoClose||'always';};scope.getElement=function(){return $element;};scope.isKeynavEnabled=function(){return keynavEnabled;};scope.focusDropdownEntry=function(keyCode){var elems=self.dropdownMenu?angular.element(self.dropdownMenu).find('a'):$element.find('ul').eq(0).find('a');switch(keyCode){case 40:{if(!angular.isNumber(self.selectedOption)){self.selectedOption=0;}else{self.selectedOption=self.selectedOption===elems.length-1?self.selectedOption:self.selectedOption+1;}
break;}
case 38:{if(!angular.isNumber(self.selectedOption)){self.selectedOption=elems.length-1;}else{self.selectedOption=self.selectedOption===0?0:self.selectedOption-1;}
break;}}
elems[self.selectedOption].focus();};scope.getDropdownElement=function(){return self.dropdownMenu;};scope.focusToggleElement=function(){if(self.toggleElement){self.toggleElement[0].focus();}};scope.$watch('isOpen',function(isOpen,wasOpen){if(appendTo&&self.dropdownMenu){var pos=$position.positionElements($element,self.dropdownMenu,'bottom-left',true),css,rightalign;css={top:pos.top+'px',display:isOpen?'block':'none'};rightalign=self.dropdownMenu.hasClass('dropdown-menu-right');if(!rightalign){css.left=pos.left+'px';css.right='auto';}else{css.left='auto';css.right=window.innerWidth-
(pos.left+$element.prop('offsetWidth'))+'px';}
if(!appendToBody){var appendOffset=$position.offset(appendTo);css.top=pos.top-appendOffset.top+'px';if(!rightalign){css.left=pos.left-appendOffset.left+'px';}else{css.right=window.innerWidth-
(pos.left-appendOffset.left+$element.prop('offsetWidth'))+'px';}}
self.dropdownMenu.css(css);}
var openContainer=appendTo?appendTo:$element;$animate[isOpen?'addClass':'removeClass'](openContainer,appendTo?appendToOpenClass:openClass).then(function(){if(angular.isDefined(isOpen)&&isOpen!==wasOpen){toggleInvoker($scope,{open:!!isOpen});}});if(isOpen){if(self.dropdownMenuTemplateUrl){$templateRequest(self.dropdownMenuTemplateUrl).then(function(tplContent){templateScope=scope.$new();$compile(tplContent.trim())(templateScope,function(dropdownElement){var newEl=dropdownElement;self.dropdownMenu.replaceWith(newEl);self.dropdownMenu=newEl;});});}
scope.focusToggleElement();uibDropdownService.open(scope);}else{if(self.dropdownMenuTemplateUrl){if(templateScope){templateScope.$destroy();}
var newEl=angular.element('<ul class="dropdown-menu"></ul>');self.dropdownMenu.replaceWith(newEl);self.dropdownMenu=newEl;}
uibDropdownService.close(scope);self.selectedOption=null;}
if(angular.isFunction(setIsOpen)){setIsOpen($scope,isOpen);}});$scope.$on('$locationChangeSuccess',function(){if(scope.getAutoClose()!=='disabled'){scope.isOpen=false;}});}]).directive('uibDropdown',function(){return{controller:'UibDropdownController',link:function(scope,element,attrs,dropdownCtrl){dropdownCtrl.init();}};}).directive('uibDropdownMenu',function(){return{restrict:'A',require:'?^uibDropdown',link:function(scope,element,attrs,dropdownCtrl){if(!dropdownCtrl||angular.isDefined(attrs.dropdownNested)){return;}
element.addClass('dropdown-menu');var tplUrl=attrs.templateUrl;if(tplUrl){dropdownCtrl.dropdownMenuTemplateUrl=tplUrl;}
if(!dropdownCtrl.dropdownMenu){dropdownCtrl.dropdownMenu=element;}}};}).directive('uibDropdownToggle',function(){return{require:'?^uibDropdown',link:function(scope,element,attrs,dropdownCtrl){if(!dropdownCtrl){return;}
element.addClass('dropdown-toggle');dropdownCtrl.toggleElement=element;var toggleDropdown=function(event){event.preventDefault();if(!element.hasClass('disabled')&&!attrs.disabled){scope.$apply(function(){dropdownCtrl.toggle();});}};element.bind('click',toggleDropdown);element.attr({'aria-haspopup':true,'aria-expanded':false});scope.$watch(dropdownCtrl.isOpen,function(isOpen){element.attr('aria-expanded',!!isOpen);});scope.$on('$destroy',function(){element.unbind('click',toggleDropdown);});}};});angular.module('ui.bootstrap.stackedMap',[]).factory('$$stackedMap',function(){return{createNew:function(){var stack=[];return{add:function(key,value){stack.push({key:key,value:value});},get:function(key){for(var i=0;i<stack.length;i++){if(key===stack[i].key){return stack[i];}}},keys:function(){var keys=[];for(var i=0;i<stack.length;i++){keys.push(stack[i].key);}
return keys;},top:function(){return stack[stack.length-1];},remove:function(key){var idx=-1;for(var i=0;i<stack.length;i++){if(key===stack[i].key){idx=i;break;}}
return stack.splice(idx,1)[0];},removeTop:function(){return stack.splice(stack.length-1,1)[0];},length:function(){return stack.length;}};}};});angular.module('ui.bootstrap.modal',['ui.bootstrap.stackedMap']).factory('$$multiMap',function(){return{createNew:function(){var map={};return{entries:function(){return Object.keys(map).map(function(key){return{key:key,value:map[key]};});},get:function(key){return map[key];},hasKey:function(key){return!!map[key];},keys:function(){return Object.keys(map);},put:function(key,value){if(!map[key]){map[key]=[];}
map[key].push(value);},remove:function(key,value){var values=map[key];if(!values){return;}
var idx=values.indexOf(value);if(idx!==-1){values.splice(idx,1);}
if(!values.length){delete map[key];}}};}};}).provider('$uibResolve',function(){var resolve=this;this.resolver=null;this.setResolver=function(resolver){this.resolver=resolver;};this.$get=['$injector','$q',function($injector,$q){var resolver=resolve.resolver?$injector.get(resolve.resolver):null;return{resolve:function(invocables,locals,parent,self){if(resolver){return resolver.resolve(invocables,locals,parent,self);}
var promises=[];angular.forEach(invocables,function(value){if(angular.isFunction(value)||angular.isArray(value)){promises.push($q.resolve($injector.invoke(value)));}else if(angular.isString(value)){promises.push($q.resolve($injector.get(value)));}else{promises.push($q.resolve(value));}});return $q.all(promises).then(function(resolves){var resolveObj={};var resolveIter=0;angular.forEach(invocables,function(value,key){resolveObj[key]=resolves[resolveIter++];});return resolveObj;});}};}];}).directive('uibModalBackdrop',['$animateCss','$injector','$uibModalStack',function($animateCss,$injector,$modalStack){return{replace:true,templateUrl:'uib/template/modal/backdrop.html',compile:function(tElement,tAttrs){tElement.addClass(tAttrs.backdropClass);return linkFn;}};function linkFn(scope,element,attrs){if(attrs.modalInClass){$animateCss(element,{addClass:attrs.modalInClass}).start();scope.$on($modalStack.NOW_CLOSING_EVENT,function(e,setIsAsync){var done=setIsAsync();if(scope.modalOptions.animation){$animateCss(element,{removeClass:attrs.modalInClass}).start().then(done);}else{done();}});}}}]).directive('uibModalWindow',['$uibModalStack','$q','$animate','$animateCss','$document',function($modalStack,$q,$animate,$animateCss,$document){return{scope:{index:'@'},replace:true,transclude:true,templateUrl:function(tElement,tAttrs){return tAttrs.templateUrl||'uib/template/modal/window.html';},link:function(scope,element,attrs){element.addClass(attrs.windowClass||'');element.addClass(attrs.windowTopClass||'');scope.size=attrs.size;scope.close=function(evt){var modal=$modalStack.getTop();if(modal&&modal.value.backdrop&&modal.value.backdrop!=='static'&&evt.target===evt.currentTarget){evt.preventDefault();evt.stopPropagation();$modalStack.dismiss(modal.key,'backdrop click');}};element.on('click',scope.close);scope.$isRendered=true;var modalRenderDeferObj=$q.defer();attrs.$observe('modalRender',function(value){if(value==='true'){modalRenderDeferObj.resolve();}});modalRenderDeferObj.promise.then(function(){var animationPromise=null;if(attrs.modalInClass){animationPromise=$animateCss(element,{addClass:attrs.modalInClass}).start();scope.$on($modalStack.NOW_CLOSING_EVENT,function(e,setIsAsync){var done=setIsAsync();if($animateCss){$animateCss(element,{removeClass:attrs.modalInClass}).start().then(done);}else{$animate.removeClass(element,attrs.modalInClass).then(done);}});}
$q.when(animationPromise).then(function(){if(!($document[0].activeElement&&element[0].contains($document[0].activeElement))){var inputWithAutofocus=element[0].querySelector('[autofocus]');if(inputWithAutofocus){inputWithAutofocus.focus();}else{element[0].focus();}}});var modal=$modalStack.getTop();if(modal){$modalStack.modalRendered(modal.key);}});}};}]).directive('uibModalAnimationClass',function(){return{compile:function(tElement,tAttrs){if(tAttrs.modalAnimation){tElement.addClass(tAttrs.uibModalAnimationClass);}}};}).directive('uibModalTransclude',function(){return{link:function(scope,element,attrs,controller,transclude){transclude(scope.$parent,function(clone){element.empty();element.append(clone);});}};}).factory('$uibModalStack',['$animate','$animateCss','$document','$compile','$rootScope','$q','$$multiMap','$$stackedMap',function($animate,$animateCss,$document,$compile,$rootScope,$q,$$multiMap,$$stackedMap){var OPENED_MODAL_CLASS='modal-open';var backdropDomEl,backdropScope;var openedWindows=$$stackedMap.createNew();var openedClasses=$$multiMap.createNew();var $modalStack={NOW_CLOSING_EVENT:'modal.stack.now-closing'};var focusableElementList;var focusIndex=0;var tababbleSelector='a[href], area[href], input:not([disabled]), '+'button:not([disabled]),select:not([disabled]), textarea:not([disabled]), '+'iframe, object, embed, *[tabindex], *[contenteditable=true]';function backdropIndex(){var topBackdropIndex=-1;var opened=openedWindows.keys();for(var i=0;i<opened.length;i++){if(openedWindows.get(opened[i]).value.backdrop){topBackdropIndex=i;}}
return topBackdropIndex;}
$rootScope.$watch(backdropIndex,function(newBackdropIndex){if(backdropScope){backdropScope.index=newBackdropIndex;}});function removeModalWindow(modalInstance,elementToReceiveFocus){var modalWindow=openedWindows.get(modalInstance).value;var appendToElement=modalWindow.appendTo;openedWindows.remove(modalInstance);removeAfterAnimate(modalWindow.modalDomEl,modalWindow.modalScope,function(){var modalBodyClass=modalWindow.openedClass||OPENED_MODAL_CLASS;openedClasses.remove(modalBodyClass,modalInstance);appendToElement.toggleClass(modalBodyClass,openedClasses.hasKey(modalBodyClass));toggleTopWindowClass(true);});checkRemoveBackdrop();if(elementToReceiveFocus&&elementToReceiveFocus.focus){elementToReceiveFocus.focus();}else if(appendToElement.focus){appendToElement.focus();}}
function toggleTopWindowClass(toggleSwitch){var modalWindow;if(openedWindows.length()>0){modalWindow=openedWindows.top().value;modalWindow.modalDomEl.toggleClass(modalWindow.windowTopClass||'',toggleSwitch);}}
function checkRemoveBackdrop(){if(backdropDomEl&&backdropIndex()===-1){var backdropScopeRef=backdropScope;removeAfterAnimate(backdropDomEl,backdropScope,function(){backdropScopeRef=null;});backdropDomEl=undefined;backdropScope=undefined;}}
function removeAfterAnimate(domEl,scope,done,closedDeferred){var asyncDeferred;var asyncPromise=null;var setIsAsync=function(){if(!asyncDeferred){asyncDeferred=$q.defer();asyncPromise=asyncDeferred.promise;}
return function asyncDone(){asyncDeferred.resolve();};};scope.$broadcast($modalStack.NOW_CLOSING_EVENT,setIsAsync);return $q.when(asyncPromise).then(afterAnimating);function afterAnimating(){if(afterAnimating.done){return;}
afterAnimating.done=true;$animateCss(domEl,{event:'leave'}).start().then(function(){domEl.remove();if(closedDeferred){closedDeferred.resolve();}});scope.$destroy();if(done){done();}}}
$document.on('keydown',keydownListener);$rootScope.$on('$destroy',function(){$document.off('keydown',keydownListener);});function keydownListener(evt){if(evt.isDefaultPrevented()){return evt;}
var modal=openedWindows.top();if(modal){switch(evt.which){case 27:{if(modal.value.keyboard){evt.preventDefault();$rootScope.$apply(function(){$modalStack.dismiss(modal.key,'escape key press');});}
break;}
case 9:{$modalStack.loadFocusElementList(modal);var focusChanged=false;if(evt.shiftKey){if($modalStack.isFocusInFirstItem(evt)){focusChanged=$modalStack.focusLastFocusableElement();}}else{if($modalStack.isFocusInLastItem(evt)){focusChanged=$modalStack.focusFirstFocusableElement();}}
if(focusChanged){evt.preventDefault();evt.stopPropagation();}
break;}}}}
$modalStack.open=function(modalInstance,modal){var modalOpener=$document[0].activeElement,modalBodyClass=modal.openedClass||OPENED_MODAL_CLASS;toggleTopWindowClass(false);openedWindows.add(modalInstance,{deferred:modal.deferred,renderDeferred:modal.renderDeferred,closedDeferred:modal.closedDeferred,modalScope:modal.scope,backdrop:modal.backdrop,keyboard:modal.keyboard,openedClass:modal.openedClass,windowTopClass:modal.windowTopClass,animation:modal.animation,appendTo:modal.appendTo});openedClasses.put(modalBodyClass,modalInstance);var appendToElement=modal.appendTo,currBackdropIndex=backdropIndex();if(!appendToElement.length){throw new Error('appendTo element not found. Make sure that the element passed is in DOM.');}
if(currBackdropIndex>=0&&!backdropDomEl){backdropScope=$rootScope.$new(true);backdropScope.modalOptions=modal;backdropScope.index=currBackdropIndex;backdropDomEl=angular.element('<div uib-modal-backdrop="modal-backdrop"></div>');backdropDomEl.attr('backdrop-class',modal.backdropClass);if(modal.animation){backdropDomEl.attr('modal-animation','true');}
$compile(backdropDomEl)(backdropScope);$animate.enter(backdropDomEl,appendToElement);}
var angularDomEl=angular.element('<div uib-modal-window="modal-window"></div>');angularDomEl.attr({'template-url':modal.windowTemplateUrl,'window-class':modal.windowClass,'window-top-class':modal.windowTopClass,'size':modal.size,'index':openedWindows.length()-1,'animate':'animate'}).html(modal.content);if(modal.animation){angularDomEl.attr('modal-animation','true');}
$animate.enter(angularDomEl,appendToElement).then(function(){$compile(angularDomEl)(modal.scope);$animate.addClass(appendToElement,modalBodyClass);});openedWindows.top().value.modalDomEl=angularDomEl;openedWindows.top().value.modalOpener=modalOpener;$modalStack.clearFocusListCache();};function broadcastClosing(modalWindow,resultOrReason,closing){return!modalWindow.value.modalScope.$broadcast('modal.closing',resultOrReason,closing).defaultPrevented;}
$modalStack.close=function(modalInstance,result){var modalWindow=openedWindows.get(modalInstance);if(modalWindow&&broadcastClosing(modalWindow,result,true)){modalWindow.value.modalScope.$$uibDestructionScheduled=true;modalWindow.value.deferred.resolve(result);removeModalWindow(modalInstance,modalWindow.value.modalOpener);return true;}
return!modalWindow;};$modalStack.dismiss=function(modalInstance,reason){var modalWindow=openedWindows.get(modalInstance);if(modalWindow&&broadcastClosing(modalWindow,reason,false)){modalWindow.value.modalScope.$$uibDestructionScheduled=true;modalWindow.value.deferred.reject(reason);removeModalWindow(modalInstance,modalWindow.value.modalOpener);return true;}
return!modalWindow;};$modalStack.dismissAll=function(reason){var topModal=this.getTop();while(topModal&&this.dismiss(topModal.key,reason)){topModal=this.getTop();}};$modalStack.getTop=function(){return openedWindows.top();};$modalStack.modalRendered=function(modalInstance){var modalWindow=openedWindows.get(modalInstance);if(modalWindow){modalWindow.value.renderDeferred.resolve();}};$modalStack.focusFirstFocusableElement=function(){if(focusableElementList.length>0){focusableElementList[0].focus();return true;}
return false;};$modalStack.focusLastFocusableElement=function(){if(focusableElementList.length>0){focusableElementList[focusableElementList.length-1].focus();return true;}
return false;};$modalStack.isFocusInFirstItem=function(evt){if(focusableElementList.length>0){return(evt.target||evt.srcElement)===focusableElementList[0];}
return false;};$modalStack.isFocusInLastItem=function(evt){if(focusableElementList.length>0){return(evt.target||evt.srcElement)===focusableElementList[focusableElementList.length-1];}
return false;};$modalStack.clearFocusListCache=function(){focusableElementList=[];focusIndex=0;};$modalStack.loadFocusElementList=function(modalWindow){if(focusableElementList===undefined||!focusableElementList.length){if(modalWindow){var modalDomE1=modalWindow.value.modalDomEl;if(modalDomE1&&modalDomE1.length){focusableElementList=modalDomE1[0].querySelectorAll(tababbleSelector);}}}};return $modalStack;}]).provider('$uibModal',function(){var $modalProvider={options:{animation:true,backdrop:true,keyboard:true},$get:['$rootScope','$q','$document','$templateRequest','$controller','$uibResolve','$uibModalStack',function($rootScope,$q,$document,$templateRequest,$controller,$uibResolve,$modalStack){var $modal={};function getTemplatePromise(options){return options.template?$q.when(options.template):$templateRequest(angular.isFunction(options.templateUrl)?options.templateUrl():options.templateUrl);}
var promiseChain=null;$modal.getPromiseChain=function(){return promiseChain;};$modal.open=function(modalOptions){var modalResultDeferred=$q.defer();var modalOpenedDeferred=$q.defer();var modalClosedDeferred=$q.defer();var modalRenderDeferred=$q.defer();var modalInstance={result:modalResultDeferred.promise,opened:modalOpenedDeferred.promise,closed:modalClosedDeferred.promise,rendered:modalRenderDeferred.promise,close:function(result){return $modalStack.close(modalInstance,result);},dismiss:function(reason){return $modalStack.dismiss(modalInstance,reason);}};modalOptions=angular.extend({},$modalProvider.options,modalOptions);modalOptions.resolve=modalOptions.resolve||{};modalOptions.appendTo=modalOptions.appendTo||$document.find('body').eq(0);if(!modalOptions.template&&!modalOptions.templateUrl){throw new Error('One of template or templateUrl options is required.');}
var templateAndResolvePromise=$q.all([getTemplatePromise(modalOptions),$uibResolve.resolve(modalOptions.resolve,{},null,null)]);function resolveWithTemplate(){return templateAndResolvePromise;}
var samePromise;samePromise=promiseChain=$q.all([promiseChain]).then(resolveWithTemplate,resolveWithTemplate).then(function resolveSuccess(tplAndVars){var providedScope=modalOptions.scope||$rootScope;var modalScope=providedScope.$new();modalScope.$close=modalInstance.close;modalScope.$dismiss=modalInstance.dismiss;modalScope.$on('$destroy',function(){if(!modalScope.$$uibDestructionScheduled){modalScope.$dismiss('$uibUnscheduledDestruction');}});var ctrlInstance,ctrlLocals={};if(modalOptions.controller){ctrlLocals.$scope=modalScope;ctrlLocals.$uibModalInstance=modalInstance;angular.forEach(tplAndVars[1],function(value,key){ctrlLocals[key]=value;});ctrlInstance=$controller(modalOptions.controller,ctrlLocals);if(modalOptions.controllerAs){if(modalOptions.bindToController){ctrlInstance.$close=modalScope.$close;ctrlInstance.$dismiss=modalScope.$dismiss;angular.extend(ctrlInstance,providedScope);}
modalScope[modalOptions.controllerAs]=ctrlInstance;}}
$modalStack.open(modalInstance,{scope:modalScope,deferred:modalResultDeferred,renderDeferred:modalRenderDeferred,closedDeferred:modalClosedDeferred,content:tplAndVars[0],animation:modalOptions.animation,backdrop:modalOptions.backdrop,keyboard:modalOptions.keyboard,backdropClass:modalOptions.backdropClass,windowTopClass:modalOptions.windowTopClass,windowClass:modalOptions.windowClass,windowTemplateUrl:modalOptions.windowTemplateUrl,size:modalOptions.size,openedClass:modalOptions.openedClass,appendTo:modalOptions.appendTo});modalOpenedDeferred.resolve(true);},function resolveError(reason){modalOpenedDeferred.reject(reason);modalResultDeferred.reject(reason);})['finally'](function(){if(promiseChain===samePromise){promiseChain=null;}});return modalInstance;};return $modal;}]};return $modalProvider;});angular.module('ui.bootstrap.paging',[]).factory('uibPaging',['$parse',function($parse){return{create:function(ctrl,$scope,$attrs){ctrl.setNumPages=$attrs.numPages?$parse($attrs.numPages).assign:angular.noop;ctrl.ngModelCtrl={$setViewValue:angular.noop};ctrl.init=function(ngModelCtrl,config){ctrl.ngModelCtrl=ngModelCtrl;ctrl.config=config;ngModelCtrl.$render=function(){ctrl.render();};if($attrs.itemsPerPage){$scope.$parent.$watch($parse($attrs.itemsPerPage),function(value){ctrl.itemsPerPage=parseInt(value,10);$scope.totalPages=ctrl.calculateTotalPages();ctrl.updatePage();});}else{ctrl.itemsPerPage=config.itemsPerPage;}
$scope.$watch('totalItems',function(newTotal,oldTotal){if(angular.isDefined(newTotal)||newTotal!==oldTotal){$scope.totalPages=ctrl.calculateTotalPages();ctrl.updatePage();}});};ctrl.calculateTotalPages=function(){var totalPages=ctrl.itemsPerPage<1?1:Math.ceil($scope.totalItems/ctrl.itemsPerPage);return Math.max(totalPages||0,1);};ctrl.render=function(){$scope.page=parseInt(ctrl.ngModelCtrl.$viewValue,10)||1;};$scope.selectPage=function(page,evt){if(evt){evt.preventDefault();}
var clickAllowed=!$scope.ngDisabled||!evt;if(clickAllowed&&$scope.page!==page&&page>0&&page<=$scope.totalPages){if(evt&&evt.target){evt.target.blur();}
ctrl.ngModelCtrl.$setViewValue(page);ctrl.ngModelCtrl.$render();}};$scope.getText=function(key){return $scope[key+'Text']||ctrl.config[key+'Text'];};$scope.noPrevious=function(){return $scope.page===1;};$scope.noNext=function(){return $scope.page===$scope.totalPages;};ctrl.updatePage=function(){ctrl.setNumPages($scope.$parent,$scope.totalPages);if($scope.page>$scope.totalPages){$scope.selectPage($scope.totalPages);}else{ctrl.ngModelCtrl.$render();}};}};}]);angular.module('ui.bootstrap.pager',['ui.bootstrap.paging']).controller('UibPagerController',['$scope','$attrs','uibPaging','uibPagerConfig',function($scope,$attrs,uibPaging,uibPagerConfig){$scope.align=angular.isDefined($attrs.align)?$scope.$parent.$eval($attrs.align):uibPagerConfig.align;uibPaging.create(this,$scope,$attrs);}]).constant('uibPagerConfig',{itemsPerPage:10,previousText:' Previous',nextText:'Next ',align:true}).directive('uibPager',['uibPagerConfig',function(uibPagerConfig){return{scope:{totalItems:'=',previousText:'@',nextText:'@',ngDisabled:'='},require:['uibPager','?ngModel'],controller:'UibPagerController',controllerAs:'pager',templateUrl:function(element,attrs){return attrs.templateUrl||'uib/template/pager/pager.html';},replace:true,link:function(scope,element,attrs,ctrls){var paginationCtrl=ctrls[0],ngModelCtrl=ctrls[1];if(!ngModelCtrl){return;}
paginationCtrl.init(ngModelCtrl,uibPagerConfig);}};}]);angular.module('ui.bootstrap.pagination',['ui.bootstrap.paging']).controller('UibPaginationController',['$scope','$attrs','$parse','uibPaging','uibPaginationConfig',function($scope,$attrs,$parse,uibPaging,uibPaginationConfig){var ctrl=this;var maxSize=angular.isDefined($attrs.maxSize)?$scope.$parent.$eval($attrs.maxSize):uibPaginationConfig.maxSize,rotate=angular.isDefined($attrs.rotate)?$scope.$parent.$eval($attrs.rotate):uibPaginationConfig.rotate,forceEllipses=angular.isDefined($attrs.forceEllipses)?$scope.$parent.$eval($attrs.forceEllipses):uibPaginationConfig.forceEllipses,boundaryLinkNumbers=angular.isDefined($attrs.boundaryLinkNumbers)?$scope.$parent.$eval($attrs.boundaryLinkNumbers):uibPaginationConfig.boundaryLinkNumbers;$scope.boundaryLinks=angular.isDefined($attrs.boundaryLinks)?$scope.$parent.$eval($attrs.boundaryLinks):uibPaginationConfig.boundaryLinks;$scope.directionLinks=angular.isDefined($attrs.directionLinks)?$scope.$parent.$eval($attrs.directionLinks):uibPaginationConfig.directionLinks;uibPaging.create(this,$scope,$attrs);if($attrs.maxSize){$scope.$parent.$watch($parse($attrs.maxSize),function(value){maxSize=parseInt(value,10);ctrl.render();});}
function makePage(number,text,isActive){return{number:number,text:text,active:isActive};}
function getPages(currentPage,totalPages){var pages=[];var startPage=1,endPage=totalPages;var isMaxSized=angular.isDefined(maxSize)&&maxSize<totalPages;if(isMaxSized){if(rotate){startPage=Math.max(currentPage-Math.floor(maxSize/2),1);endPage=startPage+maxSize-1;if(endPage>totalPages){endPage=totalPages;startPage=endPage-maxSize+1;}}else{startPage=(Math.ceil(currentPage/maxSize)-1)*maxSize+1;endPage=Math.min(startPage+maxSize-1,totalPages);}}
for(var number=startPage;number<=endPage;number++){var page=makePage(number,number,number===currentPage);pages.push(page);}
if(isMaxSized&&maxSize>0&&(!rotate||forceEllipses||boundaryLinkNumbers)){if(startPage>1){if(!boundaryLinkNumbers||startPage>3){var previousPageSet=makePage(startPage-1,'...',false);pages.unshift(previousPageSet);}
if(boundaryLinkNumbers){if(startPage===3){var secondPageLink=makePage(2,'2',false);pages.unshift(secondPageLink);}
var firstPageLink=makePage(1,'1',false);pages.unshift(firstPageLink);}}
if(endPage<totalPages){if(!boundaryLinkNumbers||endPage<totalPages-2){var nextPageSet=makePage(endPage+1,'...',false);pages.push(nextPageSet);}
if(boundaryLinkNumbers){if(endPage===totalPages-2){var secondToLastPageLink=makePage(totalPages-1,totalPages-1,false);pages.push(secondToLastPageLink);}
var lastPageLink=makePage(totalPages,totalPages,false);pages.push(lastPageLink);}}}
return pages;}
var originalRender=this.render;this.render=function(){originalRender();if($scope.page>0&&$scope.page<=$scope.totalPages){$scope.pages=getPages($scope.page,$scope.totalPages);}};}]).constant('uibPaginationConfig',{itemsPerPage:10,boundaryLinks:false,boundaryLinkNumbers:false,directionLinks:true,firstText:'First',previousText:'Previous',nextText:'Next',lastText:'Last',rotate:true,forceEllipses:false}).directive('uibPagination',['$parse','uibPaginationConfig',function($parse,uibPaginationConfig){return{scope:{totalItems:'=',firstText:'@',previousText:'@',nextText:'@',lastText:'@',ngDisabled:'='},require:['uibPagination','?ngModel'],controller:'UibPaginationController',controllerAs:'pagination',templateUrl:function(element,attrs){return attrs.templateUrl||'uib/template/pagination/pagination.html';},replace:true,link:function(scope,element,attrs,ctrls){var paginationCtrl=ctrls[0],ngModelCtrl=ctrls[1];if(!ngModelCtrl){return;}
paginationCtrl.init(ngModelCtrl,uibPaginationConfig);}};}]);angular.module('ui.bootstrap.tooltip',['ui.bootstrap.position','ui.bootstrap.stackedMap']).provider('$uibTooltip',function(){var defaultOptions={placement:'top',placementClassPrefix:'',animation:true,popupDelay:0,popupCloseDelay:0,useContentExp:false};var triggerMap={'mouseenter':'mouseleave','click':'click','outsideClick':'outsideClick','focus':'blur','none':''};var globalOptions={};this.options=function(value){angular.extend(globalOptions,value);};this.setTriggers=function setTriggers(triggers){angular.extend(triggerMap,triggers);};function snake_case(name){var regexp=/[A-Z]/g;var separator='-';return name.replace(regexp,function(letter,pos){return(pos?separator:'')+letter.toLowerCase();});}
this.$get=['$window','$compile','$timeout','$document','$uibPosition','$interpolate','$rootScope','$parse','$$stackedMap',function($window,$compile,$timeout,$document,$position,$interpolate,$rootScope,$parse,$$stackedMap){var openedTooltips=$$stackedMap.createNew();$document.on('keypress',keypressListener);$rootScope.$on('$destroy',function(){$document.off('keypress',keypressListener);});function keypressListener(e){if(e.which===27){var last=openedTooltips.top();if(last){last.value.close();openedTooltips.removeTop();last=null;}}}
return function $tooltip(ttType,prefix,defaultTriggerShow,options){options=angular.extend({},defaultOptions,globalOptions,options);function getTriggers(trigger){var show=(trigger||options.trigger||defaultTriggerShow).split(' ');var hide=show.map(function(trigger){return triggerMap[trigger]||trigger;});return{show:show,hide:hide};}
var directiveName=snake_case(ttType);var startSym=$interpolate.startSymbol();var endSym=$interpolate.endSymbol();var template='<div '+directiveName+'-popup '+'title="'+startSym+'title'+endSym+'" '+
(options.useContentExp?'content-exp="contentExp()" ':'content="'+startSym+'content'+endSym+'" ')+'placement="'+startSym+'placement'+endSym+'" '+'popup-class="'+startSym+'popupClass'+endSym+'" '+'animation="animation" '+'is-open="isOpen"'+'origin-scope="origScope" '+'style="visibility: hidden; display: block; top: -9999px; left: -9999px;"'+'>'+'</div>';return{compile:function(tElem,tAttrs){var tooltipLinker=$compile(template);return function link(scope,element,attrs,tooltipCtrl){var tooltip;var tooltipLinkedScope;var transitionTimeout;var showTimeout;var hideTimeout;var positionTimeout;var appendToBody=angular.isDefined(options.appendToBody)?options.appendToBody:false;var triggers=getTriggers(undefined);var hasEnableExp=angular.isDefined(attrs[prefix+'Enable']);var ttScope=scope.$new(true);var repositionScheduled=false;var isOpenParse=angular.isDefined(attrs[prefix+'IsOpen'])?$parse(attrs[prefix+'IsOpen']):false;var contentParse=options.useContentExp?$parse(attrs[ttType]):false;var observers=[];var positionTooltip=function(){if(!tooltip||!tooltip.html()){return;}
if(!positionTimeout){positionTimeout=$timeout(function(){tooltip.css({top:0,left:0});var ttPosition=$position.positionElements(element,tooltip,ttScope.placement,appendToBody);tooltip.css({top:ttPosition.top+'px',left:ttPosition.left+'px',visibility:'visible'});if(options.placementClassPrefix){tooltip.removeClass('top bottom left right');}
tooltip.removeClass(options.placementClassPrefix+'top '+
options.placementClassPrefix+'top-left '+
options.placementClassPrefix+'top-right '+
options.placementClassPrefix+'bottom '+
options.placementClassPrefix+'bottom-left '+
options.placementClassPrefix+'bottom-right '+
options.placementClassPrefix+'left '+
options.placementClassPrefix+'left-top '+
options.placementClassPrefix+'left-bottom '+
options.placementClassPrefix+'right '+
options.placementClassPrefix+'right-top '+
options.placementClassPrefix+'right-bottom');var placement=ttPosition.placement.split('-');tooltip.addClass(placement[0],options.placementClassPrefix+ttPosition.placement);$position.positionArrow(tooltip,ttPosition.placement);positionTimeout=null;},0,false);}};ttScope.origScope=scope;ttScope.isOpen=false;openedTooltips.add(ttScope,{close:hide});function toggleTooltipBind(){if(!ttScope.isOpen){showTooltipBind();}else{hideTooltipBind();}}
function showTooltipBind(){if(hasEnableExp&&!scope.$eval(attrs[prefix+'Enable'])){return;}
cancelHide();prepareTooltip();if(ttScope.popupDelay){if(!showTimeout){showTimeout=$timeout(show,ttScope.popupDelay,false);}}else{show();}}
function hideTooltipBind(){cancelShow();if(ttScope.popupCloseDelay){if(!hideTimeout){hideTimeout=$timeout(hide,ttScope.popupCloseDelay,false);}}else{hide();}}
function show(){cancelShow();cancelHide();if(!ttScope.content){return angular.noop;}
createTooltip();ttScope.$evalAsync(function(){ttScope.isOpen=true;assignIsOpen(true);positionTooltip();});}
function cancelShow(){if(showTimeout){$timeout.cancel(showTimeout);showTimeout=null;}
if(positionTimeout){$timeout.cancel(positionTimeout);positionTimeout=null;}}
function hide(){if(!ttScope){return;}
ttScope.$evalAsync(function(){ttScope.isOpen=false;assignIsOpen(false);if(ttScope.animation){if(!transitionTimeout){transitionTimeout=$timeout(removeTooltip,150,false);}}else{removeTooltip();}});}
function cancelHide(){if(hideTimeout){$timeout.cancel(hideTimeout);hideTimeout=null;}
if(transitionTimeout){$timeout.cancel(transitionTimeout);transitionTimeout=null;}}
function createTooltip(){if(tooltip){return;}
tooltipLinkedScope=ttScope.$new();tooltip=tooltipLinker(tooltipLinkedScope,function(tooltip){if(appendToBody){$document.find('body').append(tooltip);}else{element.after(tooltip);}});prepObservers();}
function removeTooltip(){cancelShow();cancelHide();unregisterObservers();if(tooltip){tooltip.remove();tooltip=null;}
if(tooltipLinkedScope){tooltipLinkedScope.$destroy();tooltipLinkedScope=null;}}
function prepareTooltip(){ttScope.title=attrs[prefix+'Title'];if(contentParse){ttScope.content=contentParse(scope);}else{ttScope.content=attrs[ttType];}
ttScope.popupClass=attrs[prefix+'Class'];ttScope.placement=angular.isDefined(attrs[prefix+'Placement'])?attrs[prefix+'Placement']:options.placement;var delay=parseInt(attrs[prefix+'PopupDelay'],10);var closeDelay=parseInt(attrs[prefix+'PopupCloseDelay'],10);ttScope.popupDelay=!isNaN(delay)?delay:options.popupDelay;ttScope.popupCloseDelay=!isNaN(closeDelay)?closeDelay:options.popupCloseDelay;}
function assignIsOpen(isOpen){if(isOpenParse&&angular.isFunction(isOpenParse.assign)){isOpenParse.assign(scope,isOpen);}}
ttScope.contentExp=function(){return ttScope.content;};attrs.$observe('disabled',function(val){if(val){cancelShow();}
if(val&&ttScope.isOpen){hide();}});if(isOpenParse){scope.$watch(isOpenParse,function(val){if(ttScope&&!val===ttScope.isOpen){toggleTooltipBind();}});}
function prepObservers(){observers.length=0;if(contentParse){observers.push(scope.$watch(contentParse,function(val){ttScope.content=val;if(!val&&ttScope.isOpen){hide();}}));observers.push(tooltipLinkedScope.$watch(function(){if(!repositionScheduled){repositionScheduled=true;tooltipLinkedScope.$$postDigest(function(){repositionScheduled=false;if(ttScope&&ttScope.isOpen){positionTooltip();}});}}));}else{observers.push(attrs.$observe(ttType,function(val){ttScope.content=val;if(!val&&ttScope.isOpen){hide();}else{positionTooltip();}}));}
observers.push(attrs.$observe(prefix+'Title',function(val){ttScope.title=val;if(ttScope.isOpen){positionTooltip();}}));observers.push(attrs.$observe(prefix+'Placement',function(val){ttScope.placement=val?val:options.placement;if(ttScope.isOpen){positionTooltip();}}));}
function unregisterObservers(){if(observers.length){angular.forEach(observers,function(observer){observer();});observers.length=0;}}
function bodyHideTooltipBind(e){if(!ttScope||!ttScope.isOpen||!tooltip){return;}
if(!element[0].contains(e.target)&&!tooltip[0].contains(e.target)){hideTooltipBind();}}
var unregisterTriggers=function(){triggers.show.forEach(function(trigger){if(trigger==='outsideClick'){element.off('click',toggleTooltipBind);}else{element.off(trigger,showTooltipBind);element.off(trigger,toggleTooltipBind);}});triggers.hide.forEach(function(trigger){if(trigger==='outsideClick'){$document.off('click',bodyHideTooltipBind);}else{element.off(trigger,hideTooltipBind);}});};function prepTriggers(){var val=attrs[prefix+'Trigger'];unregisterTriggers();triggers=getTriggers(val);if(triggers.show!=='none'){triggers.show.forEach(function(trigger,idx){if(trigger==='outsideClick'){element.on('click',toggleTooltipBind);$document.on('click',bodyHideTooltipBind);}else if(trigger===triggers.hide[idx]){element.on(trigger,toggleTooltipBind);}else if(trigger){element.on(trigger,showTooltipBind);element.on(triggers.hide[idx],hideTooltipBind);}
element.on('keypress',function(e){if(e.which===27){hideTooltipBind();}});});}}
prepTriggers();var animation=scope.$eval(attrs[prefix+'Animation']);ttScope.animation=angular.isDefined(animation)?!!animation:options.animation;var appendToBodyVal;var appendKey=prefix+'AppendToBody';if(appendKey in attrs&&attrs[appendKey]===undefined){appendToBodyVal=true;}else{appendToBodyVal=scope.$eval(attrs[appendKey]);}
appendToBody=angular.isDefined(appendToBodyVal)?appendToBodyVal:appendToBody;if(appendToBody){scope.$on('$locationChangeSuccess',function closeTooltipOnLocationChangeSuccess(){if(ttScope.isOpen){hide();}});}
scope.$on('$destroy',function onDestroyTooltip(){unregisterTriggers();removeTooltip();openedTooltips.remove(ttScope);ttScope=null;});};}};};}];}).directive('uibTooltipTemplateTransclude',['$animate','$sce','$compile','$templateRequest',function($animate,$sce,$compile,$templateRequest){return{link:function(scope,elem,attrs){var origScope=scope.$eval(attrs.tooltipTemplateTranscludeScope);var changeCounter=0,currentScope,previousElement,currentElement;var cleanupLastIncludeContent=function(){if(previousElement){previousElement.remove();previousElement=null;}
if(currentScope){currentScope.$destroy();currentScope=null;}
if(currentElement){$animate.leave(currentElement).then(function(){previousElement=null;});previousElement=currentElement;currentElement=null;}};scope.$watch($sce.parseAsResourceUrl(attrs.uibTooltipTemplateTransclude),function(src){var thisChangeId=++changeCounter;if(src){$templateRequest(src,true).then(function(response){if(thisChangeId!==changeCounter){return;}
var newScope=origScope.$new();var template=response;var clone=$compile(template)(newScope,function(clone){cleanupLastIncludeContent();$animate.enter(clone,elem);});currentScope=newScope;currentElement=clone;currentScope.$emit('$includeContentLoaded',src);},function(){if(thisChangeId===changeCounter){cleanupLastIncludeContent();scope.$emit('$includeContentError',src);}});scope.$emit('$includeContentRequested',src);}else{cleanupLastIncludeContent();}});scope.$on('$destroy',cleanupLastIncludeContent);}};}]).directive('uibTooltipClasses',['$uibPosition',function($uibPosition){return{restrict:'A',link:function(scope,element,attrs){if(scope.placement){var position=$uibPosition.parsePlacement(scope.placement);element.addClass(position[0]);}else{element.addClass('top');}
if(scope.popupClass){element.addClass(scope.popupClass);}
if(scope.animation()){element.addClass(attrs.tooltipAnimationClass);}}};}]).directive('uibTooltipPopup',function(){return{replace:true,scope:{content:'@',placement:'@',popupClass:'@',animation:'&',isOpen:'&'},templateUrl:'uib/template/tooltip/tooltip-popup.html'};}).directive('uibTooltip',['$uibTooltip',function($uibTooltip){return $uibTooltip('uibTooltip','tooltip','mouseenter');}]).directive('uibTooltipTemplatePopup',function(){return{replace:true,scope:{contentExp:'&',placement:'@',popupClass:'@',animation:'&',isOpen:'&',originScope:'&'},templateUrl:'uib/template/tooltip/tooltip-template-popup.html'};}).directive('uibTooltipTemplate',['$uibTooltip',function($uibTooltip){return $uibTooltip('uibTooltipTemplate','tooltip','mouseenter',{useContentExp:true});}]).directive('uibTooltipHtmlPopup',function(){return{replace:true,scope:{contentExp:'&',placement:'@',popupClass:'@',animation:'&',isOpen:'&'},templateUrl:'uib/template/tooltip/tooltip-html-popup.html'};}).directive('uibTooltipHtml',['$uibTooltip',function($uibTooltip){return $uibTooltip('uibTooltipHtml','tooltip','mouseenter',{useContentExp:true});}]);angular.module('ui.bootstrap.popover',['ui.bootstrap.tooltip']).directive('uibPopoverTemplatePopup',function(){return{replace:true,scope:{title:'@',contentExp:'&',placement:'@',popupClass:'@',animation:'&',isOpen:'&',originScope:'&'},templateUrl:'uib/template/popover/popover-template.html'};}).directive('uibPopoverTemplate',['$uibTooltip',function($uibTooltip){return $uibTooltip('uibPopoverTemplate','popover','click',{useContentExp:true});}]).directive('uibPopoverHtmlPopup',function(){return{replace:true,scope:{contentExp:'&',title:'@',placement:'@',popupClass:'@',animation:'&',isOpen:'&'},templateUrl:'uib/template/popover/popover-html.html'};}).directive('uibPopoverHtml',['$uibTooltip',function($uibTooltip){return $uibTooltip('uibPopoverHtml','popover','click',{useContentExp:true});}]).directive('uibPopoverPopup',function(){return{replace:true,scope:{title:'@',content:'@',placement:'@',popupClass:'@',animation:'&',isOpen:'&'},templateUrl:'uib/template/popover/popover.html'};}).directive('uibPopover',['$uibTooltip',function($uibTooltip){return $uibTooltip('uibPopover','popover','click');}]);angular.module('ui.bootstrap.progressbar',[]).constant('uibProgressConfig',{animate:true,max:100}).controller('UibProgressController',['$scope','$attrs','uibProgressConfig',function($scope,$attrs,progressConfig){var self=this,animate=angular.isDefined($attrs.animate)?$scope.$parent.$eval($attrs.animate):progressConfig.animate;this.bars=[];$scope.max=angular.isDefined($scope.max)?$scope.max:progressConfig.max;this.addBar=function(bar,element,attrs){if(!animate){element.css({'transition':'none'});}
this.bars.push(bar);bar.max=$scope.max;bar.title=attrs&&angular.isDefined(attrs.title)?attrs.title:'progressbar';bar.$watch('value',function(value){bar.recalculatePercentage();});bar.recalculatePercentage=function(){var totalPercentage=self.bars.reduce(function(total,bar){bar.percent=+(100*bar.value/bar.max).toFixed(2);return total+bar.percent;},0);if(totalPercentage>100){bar.percent-=totalPercentage-100;}};bar.$on('$destroy',function(){element=null;self.removeBar(bar);});};this.removeBar=function(bar){this.bars.splice(this.bars.indexOf(bar),1);this.bars.forEach(function(bar){bar.recalculatePercentage();});};$scope.$watch('max',function(max){self.bars.forEach(function(bar){bar.max=$scope.max;bar.recalculatePercentage();});});}]).directive('uibProgress',function(){return{replace:true,transclude:true,controller:'UibProgressController',require:'uibProgress',scope:{max:'=?'},templateUrl:'uib/template/progressbar/progress.html'};}).directive('uibBar',function(){return{replace:true,transclude:true,require:'^uibProgress',scope:{value:'=',type:'@'},templateUrl:'uib/template/progressbar/bar.html',link:function(scope,element,attrs,progressCtrl){progressCtrl.addBar(scope,element,attrs);}};}).directive('uibProgressbar',function(){return{replace:true,transclude:true,controller:'UibProgressController',scope:{value:'=',max:'=?',type:'@'},templateUrl:'uib/template/progressbar/progressbar.html',link:function(scope,element,attrs,progressCtrl){progressCtrl.addBar(scope,angular.element(element.children()[0]),{title:attrs.title});}};});angular.module('ui.bootstrap.rating',[]).constant('uibRatingConfig',{max:5,stateOn:null,stateOff:null,titles:['one','two','three','four','five']}).controller('UibRatingController',['$scope','$attrs','uibRatingConfig',function($scope,$attrs,ratingConfig){var ngModelCtrl={$setViewValue:angular.noop};this.init=function(ngModelCtrl_){ngModelCtrl=ngModelCtrl_;ngModelCtrl.$render=this.render;ngModelCtrl.$formatters.push(function(value){if(angular.isNumber(value)&&value<<0!==value){value=Math.round(value);}
return value;});this.stateOn=angular.isDefined($attrs.stateOn)?$scope.$parent.$eval($attrs.stateOn):ratingConfig.stateOn;this.stateOff=angular.isDefined($attrs.stateOff)?$scope.$parent.$eval($attrs.stateOff):ratingConfig.stateOff;var tmpTitles=angular.isDefined($attrs.titles)?$scope.$parent.$eval($attrs.titles):ratingConfig.titles;this.titles=angular.isArray(tmpTitles)&&tmpTitles.length>0?tmpTitles:ratingConfig.titles;var ratingStates=angular.isDefined($attrs.ratingStates)?$scope.$parent.$eval($attrs.ratingStates):new Array(angular.isDefined($attrs.max)?$scope.$parent.$eval($attrs.max):ratingConfig.max);$scope.range=this.buildTemplateObjects(ratingStates);};this.buildTemplateObjects=function(states){for(var i=0,n=states.length;i<n;i++){states[i]=angular.extend({index:i},{stateOn:this.stateOn,stateOff:this.stateOff,title:this.getTitle(i)},states[i]);}
return states;};this.getTitle=function(index){if(index>=this.titles.length){return index+1;}
return this.titles[index];};$scope.rate=function(value){if(!$scope.readonly&&value>=0&&value<=$scope.range.length){ngModelCtrl.$setViewValue(ngModelCtrl.$viewValue===value?0:value);ngModelCtrl.$render();}};$scope.enter=function(value){if(!$scope.readonly){$scope.value=value;}
$scope.onHover({value:value});};$scope.reset=function(){$scope.value=ngModelCtrl.$viewValue;$scope.onLeave();};$scope.onKeydown=function(evt){if(/(37|38|39|40)/.test(evt.which)){evt.preventDefault();evt.stopPropagation();$scope.rate($scope.value+(evt.which===38||evt.which===39?1:-1));}};this.render=function(){$scope.value=ngModelCtrl.$viewValue;};}]).directive('uibRating',function(){return{require:['uibRating','ngModel'],scope:{readonly:'=?',onHover:'&',onLeave:'&'},controller:'UibRatingController',templateUrl:'uib/template/rating/rating.html',replace:true,link:function(scope,element,attrs,ctrls){var ratingCtrl=ctrls[0],ngModelCtrl=ctrls[1];ratingCtrl.init(ngModelCtrl);}};});angular.module('ui.bootstrap.tabs',[]).controller('UibTabsetController',['$scope',function($scope){var ctrl=this,tabs=ctrl.tabs=$scope.tabs=[];ctrl.select=function(selectedTab){angular.forEach(tabs,function(tab){if(tab.active&&tab!==selectedTab){tab.active=false;tab.onDeselect();selectedTab.selectCalled=false;}});selectedTab.active=true;if(!selectedTab.selectCalled){selectedTab.onSelect();selectedTab.selectCalled=true;}};ctrl.addTab=function addTab(tab){tabs.push(tab);if(tabs.length===1&&tab.active!==false){tab.active=true;}else if(tab.active){ctrl.select(tab);}else{tab.active=false;}};ctrl.removeTab=function removeTab(tab){var index=tabs.indexOf(tab);if(tab.active&&tabs.length>1&&!destroyed){var newActiveIndex=index===tabs.length-1?index-1:index+1;ctrl.select(tabs[newActiveIndex]);}
tabs.splice(index,1);};var destroyed;$scope.$on('$destroy',function(){destroyed=true;});}]).directive('uibTabset',function(){return{transclude:true,replace:true,scope:{type:'@'},controller:'UibTabsetController',templateUrl:'uib/template/tabs/tabset.html',link:function(scope,element,attrs){scope.vertical=angular.isDefined(attrs.vertical)?scope.$parent.$eval(attrs.vertical):false;scope.justified=angular.isDefined(attrs.justified)?scope.$parent.$eval(attrs.justified):false;}};}).directive('uibTab',['$parse',function($parse){return{require:'^uibTabset',replace:true,templateUrl:'uib/template/tabs/tab.html',transclude:true,scope:{active:'=?',heading:'@',onSelect:'&select',onDeselect:'&deselect'},controller:function(){},controllerAs:'tab',link:function(scope,elm,attrs,tabsetCtrl,transclude){scope.$watch('active',function(active){if(active){tabsetCtrl.select(scope);}});scope.disabled=false;if(attrs.disable){scope.$parent.$watch($parse(attrs.disable),function(value){scope.disabled=!!value;});}
scope.select=function(){if(!scope.disabled){scope.active=true;}};tabsetCtrl.addTab(scope);scope.$on('$destroy',function(){tabsetCtrl.removeTab(scope);});scope.$transcludeFn=transclude;}};}]).directive('uibTabHeadingTransclude',function(){return{restrict:'A',require:'^uibTab',link:function(scope,elm){scope.$watch('headingElement',function updateHeadingElement(heading){if(heading){elm.html('');elm.append(heading);}});}};}).directive('uibTabContentTransclude',function(){return{restrict:'A',require:'^uibTabset',link:function(scope,elm,attrs){var tab=scope.$eval(attrs.uibTabContentTransclude);tab.$transcludeFn(tab.$parent,function(contents){angular.forEach(contents,function(node){if(isTabHeading(node)){tab.headingElement=node;}else{elm.append(node);}});});}};function isTabHeading(node){return node.tagName&&(node.hasAttribute('uib-tab-heading')||node.hasAttribute('data-uib-tab-heading')||node.hasAttribute('x-uib-tab-heading')||node.tagName.toLowerCase()==='uib-tab-heading'||node.tagName.toLowerCase()==='data-uib-tab-heading'||node.tagName.toLowerCase()==='x-uib-tab-heading');}});angular.module('ui.bootstrap.timepicker',[]).constant('uibTimepickerConfig',{hourStep:1,minuteStep:1,secondStep:1,showMeridian:true,showSeconds:false,meridians:null,readonlyInput:false,mousewheel:true,arrowkeys:true,showSpinners:true,templateUrl:'uib/template/timepicker/timepicker.html'}).controller('UibTimepickerController',['$scope','$element','$attrs','$parse','$log','$locale','uibTimepickerConfig',function($scope,$element,$attrs,$parse,$log,$locale,timepickerConfig){var selected=new Date(),ngModelCtrl={$setViewValue:angular.noop},meridians=angular.isDefined($attrs.meridians)?$scope.$parent.$eval($attrs.meridians):timepickerConfig.meridians||$locale.DATETIME_FORMATS.AMPMS;$scope.tabindex=angular.isDefined($attrs.tabindex)?$attrs.tabindex:0;$element.removeAttr('tabindex');this.init=function(ngModelCtrl_,inputs){ngModelCtrl=ngModelCtrl_;ngModelCtrl.$render=this.render;ngModelCtrl.$formatters.unshift(function(modelValue){return modelValue?new Date(modelValue):null;});var hoursInputEl=inputs.eq(0),minutesInputEl=inputs.eq(1),secondsInputEl=inputs.eq(2);var mousewheel=angular.isDefined($attrs.mousewheel)?$scope.$parent.$eval($attrs.mousewheel):timepickerConfig.mousewheel;if(mousewheel){this.setupMousewheelEvents(hoursInputEl,minutesInputEl,secondsInputEl);}
var arrowkeys=angular.isDefined($attrs.arrowkeys)?$scope.$parent.$eval($attrs.arrowkeys):timepickerConfig.arrowkeys;if(arrowkeys){this.setupArrowkeyEvents(hoursInputEl,minutesInputEl,secondsInputEl);}
$scope.readonlyInput=angular.isDefined($attrs.readonlyInput)?$scope.$parent.$eval($attrs.readonlyInput):timepickerConfig.readonlyInput;this.setupInputEvents(hoursInputEl,minutesInputEl,secondsInputEl);};var hourStep=timepickerConfig.hourStep;if($attrs.hourStep){$scope.$parent.$watch($parse($attrs.hourStep),function(value){hourStep=+value;});}
var minuteStep=timepickerConfig.minuteStep;if($attrs.minuteStep){$scope.$parent.$watch($parse($attrs.minuteStep),function(value){minuteStep=+value;});}
var min;$scope.$parent.$watch($parse($attrs.min),function(value){var dt=new Date(value);min=isNaN(dt)?undefined:dt;});var max;$scope.$parent.$watch($parse($attrs.max),function(value){var dt=new Date(value);max=isNaN(dt)?undefined:dt;});var disabled=false;if($attrs.ngDisabled){$scope.$parent.$watch($parse($attrs.ngDisabled),function(value){disabled=value;});}
$scope.noIncrementHours=function(){var incrementedSelected=addMinutes(selected,hourStep*60);return disabled||incrementedSelected>max||incrementedSelected<selected&&incrementedSelected<min;};$scope.noDecrementHours=function(){var decrementedSelected=addMinutes(selected,-hourStep*60);return disabled||decrementedSelected<min||decrementedSelected>selected&&decrementedSelected>max;};$scope.noIncrementMinutes=function(){var incrementedSelected=addMinutes(selected,minuteStep);return disabled||incrementedSelected>max||incrementedSelected<selected&&incrementedSelected<min;};$scope.noDecrementMinutes=function(){var decrementedSelected=addMinutes(selected,-minuteStep);return disabled||decrementedSelected<min||decrementedSelected>selected&&decrementedSelected>max;};$scope.noIncrementSeconds=function(){var incrementedSelected=addSeconds(selected,secondStep);return disabled||incrementedSelected>max||incrementedSelected<selected&&incrementedSelected<min;};$scope.noDecrementSeconds=function(){var decrementedSelected=addSeconds(selected,-secondStep);return disabled||decrementedSelected<min||decrementedSelected>selected&&decrementedSelected>max;};$scope.noToggleMeridian=function(){if(selected.getHours()<12){return disabled||addMinutes(selected,12*60)>max;}
return disabled||addMinutes(selected,-12*60)<min;};var secondStep=timepickerConfig.secondStep;if($attrs.secondStep){$scope.$parent.$watch($parse($attrs.secondStep),function(value){secondStep=+value;});}
$scope.showSeconds=timepickerConfig.showSeconds;if($attrs.showSeconds){$scope.$parent.$watch($parse($attrs.showSeconds),function(value){$scope.showSeconds=!!value;});}
$scope.showMeridian=timepickerConfig.showMeridian;if($attrs.showMeridian){$scope.$parent.$watch($parse($attrs.showMeridian),function(value){$scope.showMeridian=!!value;if(ngModelCtrl.$error.time){var hours=getHoursFromTemplate(),minutes=getMinutesFromTemplate();if(angular.isDefined(hours)&&angular.isDefined(minutes)){selected.setHours(hours);refresh();}}else{updateTemplate();}});}
function getHoursFromTemplate(){var hours=+$scope.hours;var valid=$scope.showMeridian?hours>0&&hours<13:hours>=0&&hours<24;if(!valid){return undefined;}
if($scope.showMeridian){if(hours===12){hours=0;}
if($scope.meridian===meridians[1]){hours=hours+12;}}
return hours;}
function getMinutesFromTemplate(){var minutes=+$scope.minutes;return minutes>=0&&minutes<60?minutes:undefined;}
function getSecondsFromTemplate(){var seconds=+$scope.seconds;return seconds>=0&&seconds<60?seconds:undefined;}
function pad(value){if(value===null){return'';}
return angular.isDefined(value)&&value.toString().length<2?'0'+value:value.toString();}
this.setupMousewheelEvents=function(hoursInputEl,minutesInputEl,secondsInputEl){var isScrollingUp=function(e){if(e.originalEvent){e=e.originalEvent;}
var delta=e.wheelDelta?e.wheelDelta:-e.deltaY;return e.detail||delta>0;};hoursInputEl.bind('mousewheel wheel',function(e){if(!disabled){$scope.$apply(isScrollingUp(e)?$scope.incrementHours():$scope.decrementHours());}
e.preventDefault();});minutesInputEl.bind('mousewheel wheel',function(e){if(!disabled){$scope.$apply(isScrollingUp(e)?$scope.incrementMinutes():$scope.decrementMinutes());}
e.preventDefault();});secondsInputEl.bind('mousewheel wheel',function(e){if(!disabled){$scope.$apply(isScrollingUp(e)?$scope.incrementSeconds():$scope.decrementSeconds());}
e.preventDefault();});};this.setupArrowkeyEvents=function(hoursInputEl,minutesInputEl,secondsInputEl){hoursInputEl.bind('keydown',function(e){if(!disabled){if(e.which===38){e.preventDefault();$scope.incrementHours();$scope.$apply();}else if(e.which===40){e.preventDefault();$scope.decrementHours();$scope.$apply();}}});minutesInputEl.bind('keydown',function(e){if(!disabled){if(e.which===38){e.preventDefault();$scope.incrementMinutes();$scope.$apply();}else if(e.which===40){e.preventDefault();$scope.decrementMinutes();$scope.$apply();}}});secondsInputEl.bind('keydown',function(e){if(!disabled){if(e.which===38){e.preventDefault();$scope.incrementSeconds();$scope.$apply();}else if(e.which===40){e.preventDefault();$scope.decrementSeconds();$scope.$apply();}}});};this.setupInputEvents=function(hoursInputEl,minutesInputEl,secondsInputEl){if($scope.readonlyInput){$scope.updateHours=angular.noop;$scope.updateMinutes=angular.noop;$scope.updateSeconds=angular.noop;return;}
var invalidate=function(invalidHours,invalidMinutes,invalidSeconds){ngModelCtrl.$setViewValue(null);ngModelCtrl.$setValidity('time',false);if(angular.isDefined(invalidHours)){$scope.invalidHours=invalidHours;}
if(angular.isDefined(invalidMinutes)){$scope.invalidMinutes=invalidMinutes;}
if(angular.isDefined(invalidSeconds)){$scope.invalidSeconds=invalidSeconds;}};$scope.updateHours=function(){var hours=getHoursFromTemplate(),minutes=getMinutesFromTemplate();ngModelCtrl.$setDirty();if(angular.isDefined(hours)&&angular.isDefined(minutes)){selected.setHours(hours);selected.setMinutes(minutes);if(selected<min||selected>max){invalidate(true);}else{refresh('h');}}else{invalidate(true);}};hoursInputEl.bind('blur',function(e){ngModelCtrl.$setTouched();if($scope.hours===null||$scope.hours===''){invalidate(true);}else if(!$scope.invalidHours&&$scope.hours<10){$scope.$apply(function(){$scope.hours=pad($scope.hours);});}});$scope.updateMinutes=function(){var minutes=getMinutesFromTemplate(),hours=getHoursFromTemplate();ngModelCtrl.$setDirty();if(angular.isDefined(minutes)&&angular.isDefined(hours)){selected.setHours(hours);selected.setMinutes(minutes);if(selected<min||selected>max){invalidate(undefined,true);}else{refresh('m');}}else{invalidate(undefined,true);}};minutesInputEl.bind('blur',function(e){ngModelCtrl.$setTouched();if($scope.minutes===null){invalidate(undefined,true);}else if(!$scope.invalidMinutes&&$scope.minutes<10){$scope.$apply(function(){$scope.minutes=pad($scope.minutes);});}});$scope.updateSeconds=function(){var seconds=getSecondsFromTemplate();ngModelCtrl.$setDirty();if(angular.isDefined(seconds)){selected.setSeconds(seconds);refresh('s');}else{invalidate(undefined,undefined,true);}};secondsInputEl.bind('blur',function(e){if(!$scope.invalidSeconds&&$scope.seconds<10){$scope.$apply(function(){$scope.seconds=pad($scope.seconds);});}});};this.render=function(){var date=ngModelCtrl.$viewValue;if(isNaN(date)){ngModelCtrl.$setValidity('time',false);$log.error('Timepicker directive: "ng-model" value must be a Date object, a number of milliseconds since 01.01.1970 or a string representing an RFC2822 or ISO 8601 date.');}else{if(date){selected=date;}
if(selected<min||selected>max){ngModelCtrl.$setValidity('time',false);$scope.invalidHours=true;$scope.invalidMinutes=true;}else{makeValid();}
updateTemplate();}};function refresh(keyboardChange){makeValid();ngModelCtrl.$setViewValue(new Date(selected));updateTemplate(keyboardChange);}
function makeValid(){ngModelCtrl.$setValidity('time',true);$scope.invalidHours=false;$scope.invalidMinutes=false;$scope.invalidSeconds=false;}
function updateTemplate(keyboardChange){if(!ngModelCtrl.$modelValue){$scope.hours=null;$scope.minutes=null;$scope.seconds=null;$scope.meridian=meridians[0];}else{var hours=selected.getHours(),minutes=selected.getMinutes(),seconds=selected.getSeconds();if($scope.showMeridian){hours=hours===0||hours===12?12:hours%12;}
$scope.hours=keyboardChange==='h'?hours:pad(hours);if(keyboardChange!=='m'){$scope.minutes=pad(minutes);}
$scope.meridian=selected.getHours()<12?meridians[0]:meridians[1];if(keyboardChange!=='s'){$scope.seconds=pad(seconds);}
$scope.meridian=selected.getHours()<12?meridians[0]:meridians[1];}}
function addSecondsToSelected(seconds){selected=addSeconds(selected,seconds);refresh();}
function addMinutes(selected,minutes){return addSeconds(selected,minutes*60);}
function addSeconds(date,seconds){var dt=new Date(date.getTime()+seconds*1000);var newDate=new Date(date);newDate.setHours(dt.getHours(),dt.getMinutes(),dt.getSeconds());return newDate;}
$scope.showSpinners=angular.isDefined($attrs.showSpinners)?$scope.$parent.$eval($attrs.showSpinners):timepickerConfig.showSpinners;$scope.incrementHours=function(){if(!$scope.noIncrementHours()){addSecondsToSelected(hourStep*60*60);}};$scope.decrementHours=function(){if(!$scope.noDecrementHours()){addSecondsToSelected(-hourStep*60*60);}};$scope.incrementMinutes=function(){if(!$scope.noIncrementMinutes()){addSecondsToSelected(minuteStep*60);}};$scope.decrementMinutes=function(){if(!$scope.noDecrementMinutes()){addSecondsToSelected(-minuteStep*60);}};$scope.incrementSeconds=function(){if(!$scope.noIncrementSeconds()){addSecondsToSelected(secondStep);}};$scope.decrementSeconds=function(){if(!$scope.noDecrementSeconds()){addSecondsToSelected(-secondStep);}};$scope.toggleMeridian=function(){var minutes=getMinutesFromTemplate(),hours=getHoursFromTemplate();if(!$scope.noToggleMeridian()){if(angular.isDefined(minutes)&&angular.isDefined(hours)){addSecondsToSelected(12*60*(selected.getHours()<12?60:-60));}else{$scope.meridian=$scope.meridian===meridians[0]?meridians[1]:meridians[0];}}};$scope.blur=function(){ngModelCtrl.$setTouched();};}]).directive('uibTimepicker',['uibTimepickerConfig',function(uibTimepickerConfig){return{require:['uibTimepicker','?^ngModel'],controller:'UibTimepickerController',controllerAs:'timepicker',replace:true,scope:{},templateUrl:function(element,attrs){return attrs.templateUrl||uibTimepickerConfig.templateUrl;},link:function(scope,element,attrs,ctrls){var timepickerCtrl=ctrls[0],ngModelCtrl=ctrls[1];if(ngModelCtrl){timepickerCtrl.init(ngModelCtrl,element.find('input'));}}};}]);angular.module('ui.bootstrap.typeahead',['ui.bootstrap.debounce','ui.bootstrap.position']).factory('uibTypeaheadParser',['$parse',function($parse){var TYPEAHEAD_REGEXP=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w\d]*))\s+in\s+([\s\S]+?)$/;return{parse:function(input){var match=input.match(TYPEAHEAD_REGEXP);if(!match){throw new Error('Expected typeahead specification in form of "_modelValue_ (as _label_)? for _item_ in _collection_"'+' but got "'+input+'".');}
return{itemName:match[3],source:$parse(match[4]),viewMapper:$parse(match[2]||match[1]),modelMapper:$parse(match[1])};}};}]).controller('UibTypeaheadController',['$scope','$element','$attrs','$compile','$parse','$q','$timeout','$document','$window','$rootScope','$$debounce','$uibPosition','uibTypeaheadParser',function(originalScope,element,attrs,$compile,$parse,$q,$timeout,$document,$window,$rootScope,$$debounce,$position,typeaheadParser){var HOT_KEYS=[9,13,27,38,40];var eventDebounceTime=200;var modelCtrl,ngModelOptions;var minLength=originalScope.$eval(attrs.typeaheadMinLength);if(!minLength&&minLength!==0){minLength=1;}
var waitTime=originalScope.$eval(attrs.typeaheadWaitMs)||0;var isEditable=originalScope.$eval(attrs.typeaheadEditable)!==false;originalScope.$watch(attrs.typeaheadEditable,function(newVal){isEditable=newVal!==false;});var isLoadingSetter=$parse(attrs.typeaheadLoading).assign||angular.noop;var onSelectCallback=$parse(attrs.typeaheadOnSelect);var isSelectOnBlur=angular.isDefined(attrs.typeaheadSelectOnBlur)?originalScope.$eval(attrs.typeaheadSelectOnBlur):false;var isNoResultsSetter=$parse(attrs.typeaheadNoResults).assign||angular.noop;var inputFormatter=attrs.typeaheadInputFormatter?$parse(attrs.typeaheadInputFormatter):undefined;var appendToBody=attrs.typeaheadAppendToBody?originalScope.$eval(attrs.typeaheadAppendToBody):false;var appendTo=attrs.typeaheadAppendTo?originalScope.$eval(attrs.typeaheadAppendTo):null;var focusFirst=originalScope.$eval(attrs.typeaheadFocusFirst)!==false;var selectOnExact=attrs.typeaheadSelectOnExact?originalScope.$eval(attrs.typeaheadSelectOnExact):false;var isOpenSetter=$parse(attrs.typeaheadIsOpen).assign||angular.noop;var showHint=originalScope.$eval(attrs.typeaheadShowHint)||false;var parsedModel=$parse(attrs.ngModel);var invokeModelSetter=$parse(attrs.ngModel+'($$$p)');var $setModelValue=function(scope,newValue){if(angular.isFunction(parsedModel(originalScope))&&ngModelOptions&&ngModelOptions.$options&&ngModelOptions.$options.getterSetter){return invokeModelSetter(scope,{$$$p:newValue});}
return parsedModel.assign(scope,newValue);};var parserResult=typeaheadParser.parse(attrs.uibTypeahead);var hasFocus;var selected;var scope=originalScope.$new();var offDestroy=originalScope.$on('$destroy',function(){scope.$destroy();});scope.$on('$destroy',offDestroy);var popupId='typeahead-'+scope.$id+'-'+Math.floor(Math.random()*10000);element.attr({'aria-autocomplete':'list','aria-expanded':false,'aria-owns':popupId});var inputsContainer,hintInputElem;if(showHint){inputsContainer=angular.element('<div></div>');inputsContainer.css('position','relative');element.after(inputsContainer);hintInputElem=element.clone();hintInputElem.attr('placeholder','');hintInputElem.val('');hintInputElem.css({'position':'absolute','top':'0px','left':'0px','border-color':'transparent','box-shadow':'none','opacity':1,'background':'none 0% 0% / auto repeat scroll padding-box border-box rgb(255, 255, 255)','color':'#999'});element.css({'position':'relative','vertical-align':'top','background-color':'transparent'});inputsContainer.append(hintInputElem);hintInputElem.after(element);}
var popUpEl=angular.element('<div uib-typeahead-popup></div>');popUpEl.attr({id:popupId,matches:'matches',active:'activeIdx',select:'select(activeIdx, evt)','move-in-progress':'moveInProgress',query:'query',position:'position','assign-is-open':'assignIsOpen(isOpen)',debounce:'debounceUpdate'});if(angular.isDefined(attrs.typeaheadTemplateUrl)){popUpEl.attr('template-url',attrs.typeaheadTemplateUrl);}
if(angular.isDefined(attrs.typeaheadPopupTemplateUrl)){popUpEl.attr('popup-template-url',attrs.typeaheadPopupTemplateUrl);}
var resetHint=function(){if(showHint){hintInputElem.val('');}};var resetMatches=function(){scope.matches=[];scope.activeIdx=-1;element.attr('aria-expanded',false);resetHint();};var getMatchId=function(index){return popupId+'-option-'+index;};scope.$watch('activeIdx',function(index){if(index<0){element.removeAttr('aria-activedescendant');}else{element.attr('aria-activedescendant',getMatchId(index));}});var inputIsExactMatch=function(inputValue,index){if(scope.matches.length>index&&inputValue){return inputValue.toUpperCase()===scope.matches[index].label.toUpperCase();}
return false;};var getMatchesAsync=function(inputValue,evt){var locals={$viewValue:inputValue};isLoadingSetter(originalScope,true);isNoResultsSetter(originalScope,false);$q.when(parserResult.source(originalScope,locals)).then(function(matches){var onCurrentRequest=inputValue===modelCtrl.$viewValue;if(onCurrentRequest&&hasFocus){if(matches&&matches.length>0){scope.activeIdx=focusFirst?0:-1;isNoResultsSetter(originalScope,false);scope.matches.length=0;for(var i=0;i<matches.length;i++){locals[parserResult.itemName]=matches[i];scope.matches.push({id:getMatchId(i),label:parserResult.viewMapper(scope,locals),model:matches[i]});}
scope.query=inputValue;recalculatePosition();element.attr('aria-expanded',true);if(selectOnExact&&scope.matches.length===1&&inputIsExactMatch(inputValue,0)){if(angular.isNumber(scope.debounceUpdate)||angular.isObject(scope.debounceUpdate)){$$debounce(function(){scope.select(0,evt);},angular.isNumber(scope.debounceUpdate)?scope.debounceUpdate:scope.debounceUpdate['default']);}else{scope.select(0,evt);}}
if(showHint){var firstLabel=scope.matches[0].label;if(inputValue.length>0&&firstLabel.slice(0,inputValue.length).toUpperCase()===inputValue.toUpperCase()){hintInputElem.val(inputValue+firstLabel.slice(inputValue.length));}
else{hintInputElem.val('');}}}else{resetMatches();isNoResultsSetter(originalScope,true);}}
if(onCurrentRequest){isLoadingSetter(originalScope,false);}},function(){resetMatches();isLoadingSetter(originalScope,false);isNoResultsSetter(originalScope,true);});};if(appendToBody){angular.element($window).on('resize',fireRecalculating);$document.find('body').on('scroll',fireRecalculating);}
var debouncedRecalculate=$$debounce(function(){if(scope.matches.length){recalculatePosition();}
scope.moveInProgress=false;},eventDebounceTime);scope.moveInProgress=false;function fireRecalculating(){if(!scope.moveInProgress){scope.moveInProgress=true;scope.$digest();}
debouncedRecalculate();}
function recalculatePosition(){scope.position=appendToBody?$position.offset(element):$position.position(element);scope.position.top+=element.prop('offsetHeight');}
scope.query=undefined;var timeoutPromise;var scheduleSearchWithTimeout=function(inputValue){timeoutPromise=$timeout(function(){getMatchesAsync(inputValue);},waitTime);};var cancelPreviousTimeout=function(){if(timeoutPromise){$timeout.cancel(timeoutPromise);}};resetMatches();scope.assignIsOpen=function(isOpen){isOpenSetter(originalScope,isOpen);};scope.select=function(activeIdx,evt){var locals={};var model,item;selected=true;locals[parserResult.itemName]=item=scope.matches[activeIdx].model;model=parserResult.modelMapper(originalScope,locals);$setModelValue(originalScope,model);modelCtrl.$setValidity('editable',true);modelCtrl.$setValidity('parse',true);onSelectCallback(originalScope,{$item:item,$model:model,$label:parserResult.viewMapper(originalScope,locals),$event:evt});resetMatches();if(scope.$eval(attrs.typeaheadFocusOnSelect)!==false){$timeout(function(){element[0].focus();},0,false);}};element.on('keydown',function(evt){if(scope.matches.length===0||HOT_KEYS.indexOf(evt.which)===-1){return;}
if(scope.activeIdx===-1&&(evt.which===9||evt.which===13)){resetMatches();scope.$digest();return;}
evt.preventDefault();var target;switch(evt.which){case 9:case 13:scope.$apply(function(){if(angular.isNumber(scope.debounceUpdate)||angular.isObject(scope.debounceUpdate)){$$debounce(function(){scope.select(scope.activeIdx,evt);},angular.isNumber(scope.debounceUpdate)?scope.debounceUpdate:scope.debounceUpdate['default']);}else{scope.select(scope.activeIdx,evt);}});break;case 27:evt.stopPropagation();resetMatches();scope.$digest();break;case 38:scope.activeIdx=(scope.activeIdx>0?scope.activeIdx:scope.matches.length)-1;scope.$digest();target=popUpEl.find('li')[scope.activeIdx];target.parentNode.scrollTop=target.offsetTop;break;case 40:scope.activeIdx=(scope.activeIdx+1)%scope.matches.length;scope.$digest();target=popUpEl.find('li')[scope.activeIdx];target.parentNode.scrollTop=target.offsetTop;break;}});element.bind('focus',function(evt){hasFocus=true;if(minLength===0&&!modelCtrl.$viewValue){$timeout(function(){getMatchesAsync(modelCtrl.$viewValue,evt);},0);}});element.bind('blur',function(evt){if(isSelectOnBlur&&scope.matches.length&&scope.activeIdx!==-1&&!selected){selected=true;scope.$apply(function(){if(angular.isObject(scope.debounceUpdate)&&angular.isNumber(scope.debounceUpdate.blur)){$$debounce(function(){scope.select(scope.activeIdx,evt);},scope.debounceUpdate.blur);}else{scope.select(scope.activeIdx,evt);}});}
if(!isEditable&&modelCtrl.$error.editable){modelCtrl.$viewValue='';element.val('');}
hasFocus=false;selected=false;});var dismissClickHandler=function(evt){if(element[0]!==evt.target&&evt.which!==3&&scope.matches.length!==0){resetMatches();if(!$rootScope.$$phase){scope.$digest();}}};$document.on('click',dismissClickHandler);originalScope.$on('$destroy',function(){$document.off('click',dismissClickHandler);if(appendToBody||appendTo){$popup.remove();}
if(appendToBody){angular.element($window).off('resize',fireRecalculating);$document.find('body').off('scroll',fireRecalculating);}
popUpEl.remove();if(showHint){inputsContainer.remove();}});var $popup=$compile(popUpEl)(scope);if(appendToBody){$document.find('body').append($popup);}else if(appendTo){angular.element(appendTo).eq(0).append($popup);}else{element.after($popup);}
this.init=function(_modelCtrl,_ngModelOptions){modelCtrl=_modelCtrl;ngModelOptions=_ngModelOptions;scope.debounceUpdate=modelCtrl.$options&&$parse(modelCtrl.$options.debounce)(originalScope);modelCtrl.$parsers.unshift(function(inputValue){hasFocus=true;if(minLength===0||inputValue&&inputValue.length>=minLength){if(waitTime>0){cancelPreviousTimeout();scheduleSearchWithTimeout(inputValue);}else{getMatchesAsync(inputValue);}}else{isLoadingSetter(originalScope,false);cancelPreviousTimeout();resetMatches();}
if(isEditable){return inputValue;}
if(!inputValue){modelCtrl.$setValidity('editable',true);return null;}
modelCtrl.$setValidity('editable',false);return undefined;});modelCtrl.$formatters.push(function(modelValue){var candidateViewValue,emptyViewValue;var locals={};if(!isEditable){modelCtrl.$setValidity('editable',true);}
if(inputFormatter){locals.$model=modelValue;return inputFormatter(originalScope,locals);}
locals[parserResult.itemName]=modelValue;candidateViewValue=parserResult.viewMapper(originalScope,locals);locals[parserResult.itemName]=undefined;emptyViewValue=parserResult.viewMapper(originalScope,locals);return candidateViewValue!==emptyViewValue?candidateViewValue:modelValue;});};}]).directive('uibTypeahead',function(){return{controller:'UibTypeaheadController',require:['ngModel','^?ngModelOptions','uibTypeahead'],link:function(originalScope,element,attrs,ctrls){ctrls[2].init(ctrls[0],ctrls[1]);}};}).directive('uibTypeaheadPopup',['$$debounce',function($$debounce){return{scope:{matches:'=',query:'=',active:'=',position:'&',moveInProgress:'=',select:'&',assignIsOpen:'&',debounce:'&'},replace:true,templateUrl:function(element,attrs){return attrs.popupTemplateUrl||'uib/template/typeahead/typeahead-popup.html';},link:function(scope,element,attrs){scope.templateUrl=attrs.templateUrl;scope.isOpen=function(){var isDropdownOpen=scope.matches.length>0;scope.assignIsOpen({isOpen:isDropdownOpen});return isDropdownOpen;};scope.isActive=function(matchIdx){return scope.active===matchIdx;};scope.selectActive=function(matchIdx){scope.active=matchIdx;};scope.selectMatch=function(activeIdx,evt){var debounce=scope.debounce();if(angular.isNumber(debounce)||angular.isObject(debounce)){$$debounce(function(){scope.select({activeIdx:activeIdx,evt:evt});},angular.isNumber(debounce)?debounce:debounce['default']);}else{scope.select({activeIdx:activeIdx,evt:evt});}};}};}]).directive('uibTypeaheadMatch',['$templateRequest','$compile','$parse',function($templateRequest,$compile,$parse){return{scope:{index:'=',match:'=',query:'='},link:function(scope,element,attrs){var tplUrl=$parse(attrs.templateUrl)(scope.$parent)||'uib/template/typeahead/typeahead-match.html';$templateRequest(tplUrl).then(function(tplContent){var tplEl=angular.element(tplContent.trim());element.replaceWith(tplEl);$compile(tplEl)(scope);});}};}]).filter('uibTypeaheadHighlight',['$sce','$injector','$log',function($sce,$injector,$log){var isSanitizePresent;isSanitizePresent=$injector.has('$sanitize');function escapeRegexp(queryToEscape){return queryToEscape.replace(/([.?*+^$[\]\\(){}|-])/g,'\\$1');}
function containsHtml(matchItem){return/<.*>/g.test(matchItem);}
return function(matchItem,query){if(!isSanitizePresent&&containsHtml(matchItem)){$log.warn('Unsafe use of typeahead please use ngSanitize');}
matchItem=query?(''+matchItem).replace(new RegExp(escapeRegexp(query),'gi'),'<strong>$&</strong>'):matchItem;if(!isSanitizePresent){matchItem=$sce.trustAsHtml(matchItem);}
return matchItem;};}]);angular.module("uib/template/accordion/accordion-group.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("uib/template/accordion/accordion-group.html","<div class=\"panel\" ng-class=\"panelClass || 'panel-default'\">\n"+"  <div class=\"panel-heading\" ng-keypress=\"toggleOpen($event)\">\n"+"    <h4 class=\"panel-title\">\n"+"      <div tabindex=\"0\" class=\"accordion-toggle\" ng-click=\"toggleOpen()\" uib-accordion-transclude=\"heading\"><span ng-class=\"{'text-muted': isDisabled}\">{{heading}}</span></div>\n"+"    </h4>\n"+"  </div>\n"+"  <div class=\"panel-collapse collapse\" uib-collapse=\"!isOpen\">\n"+"   <div class=\"panel-body\" ng-transclude></div>\n"+"  </div>\n"+"</div>\n"+"");}]);angular.module("uib/template/accordion/accordion.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("uib/template/accordion/accordion.html","<div class=\"panel-group\" ng-transclude></div>");}]);angular.module("uib/template/alert/alert.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("uib/template/alert/alert.html","<div class=\"alert\" ng-class=\"['alert-' + (type || 'warning'), closeable ? 'alert-dismissible' : null]\" role=\"alert\">\n"+"    <button ng-show=\"closeable\" type=\"button\" class=\"close\" ng-click=\"close({$event: $event})\">\n"+"        <span aria-hidden=\"true\">&times;</span>\n"+"        <span class=\"sr-only\">Close</span>\n"+"    </button>\n"+"    <div ng-transclude></div>\n"+"</div>\n"+"");}]);angular.module("uib/template/carousel/carousel.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("uib/template/carousel/carousel.html","<div ng-mouseenter=\"pause()\" ng-mouseleave=\"play()\" class=\"carousel\" ng-swipe-right=\"prev()\" ng-swipe-left=\"next()\">\n"+"  <div class=\"carousel-inner\" ng-transclude></div>\n"+"  <a role=\"button\" href class=\"left carousel-control\" ng-click=\"prev()\" ng-show=\"slides.length > 1\">\n"+"    <span aria-hidden=\"true\" class=\"glyphicon glyphicon-chevron-left\"></span>\n"+"    <span class=\"sr-only\">previous</span>\n"+"  </a>\n"+"  <a role=\"button\" href class=\"right carousel-control\" ng-click=\"next()\" ng-show=\"slides.length > 1\">\n"+"    <span aria-hidden=\"true\" class=\"glyphicon glyphicon-chevron-right\"></span>\n"+"    <span class=\"sr-only\">next</span>\n"+"  </a>\n"+"  <ol class=\"carousel-indicators\" ng-show=\"slides.length > 1\">\n"+"    <li ng-repeat=\"slide in slides | orderBy:indexOfSlide track by $index\" ng-class=\"{ active: isActive(slide) }\" ng-click=\"select(slide)\">\n"+"      <span class=\"sr-only\">slide {{ $index + 1 }} of {{ slides.length }}<span ng-if=\"isActive(slide)\">, currently active</span></span>\n"+"    </li>\n"+"  </ol>\n"+"</div>");}]);angular.module("uib/template/carousel/slide.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("uib/template/carousel/slide.html","<div ng-class=\"{\n"+"    'active': active\n"+"  }\" class=\"item text-center\" ng-transclude></div>\n"+"");}]);angular.module("uib/template/datepicker/datepicker.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("uib/template/datepicker/datepicker.html","<div class=\"uib-datepicker\" ng-switch=\"datepickerMode\" role=\"application\" ng-keydown=\"keydown($event)\">\n"+"  <uib-daypicker ng-switch-when=\"day\" tabindex=\"0\"></uib-daypicker>\n"+"  <uib-monthpicker ng-switch-when=\"month\" tabindex=\"0\"></uib-monthpicker>\n"+"  <uib-yearpicker ng-switch-when=\"year\" tabindex=\"0\"></uib-yearpicker>\n"+"</div>");}]);angular.module("uib/template/datepicker/day.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("uib/template/datepicker/day.html","<table class=\"uib-daypicker\" role=\"grid\" aria-labelledby=\"{{::uniqueId}}-title\" aria-activedescendant=\"{{activeDateId}}\">\n"+"  <thead>\n"+"    <tr>\n"+"      <th><button type=\"button\" class=\"btn btn-default btn-sm pull-left uib-left\" ng-click=\"move(-1)\" tabindex=\"-1\"><i class=\"glyphicon glyphicon-chevron-left\"></i></button></th>\n"+"      <th colspan=\"{{::5 + showWeeks}}\"><button id=\"{{::uniqueId}}-title\" role=\"heading\" aria-live=\"assertive\" aria-atomic=\"true\" type=\"button\" class=\"btn btn-default btn-sm uib-title\" ng-click=\"toggleMode()\" ng-disabled=\"datepickerMode === maxMode\" tabindex=\"-1\" style=\"width:100%;\"><strong>{{title}}</strong></button></th>\n"+"      <th><button type=\"button\" class=\"btn btn-default btn-sm pull-right uib-right\" ng-click=\"move(1)\" tabindex=\"-1\"><i class=\"glyphicon glyphicon-chevron-right\"></i></button></th>\n"+"    </tr>\n"+"    <tr>\n"+"      <th ng-if=\"showWeeks\" class=\"text-center\"></th>\n"+"      <th ng-repeat=\"label in ::labels track by $index\" class=\"text-center\"><small aria-label=\"{{::label.full}}\">{{::label.abbr}}</small></th>\n"+"    </tr>\n"+"  </thead>\n"+"  <tbody>\n"+"    <tr class=\"uib-weeks\" ng-repeat=\"row in rows track by $index\">\n"+"      <td ng-if=\"showWeeks\" class=\"text-center h6\"><em>{{ weekNumbers[$index] }}</em></td>\n"+"      <td ng-repeat=\"dt in row\" class=\"uib-day text-center\" role=\"gridcell\"\n"+"        id=\"{{::dt.uid}}\"\n"+"        ng-class=\"::dt.customClass\">\n"+"        <button type=\"button\" style=\"min-width:100%;\" class=\"btn btn-default btn-sm\"\n"+"          uib-is-class=\"\n"+"            'btn-info' for selectedDt,\n"+"            'active' for activeDt\n"+"            on dt\"\n"+"          ng-click=\"select(dt.date)\"\n"+"          ng-disabled=\"::dt.disabled\"\n"+"          tabindex=\"-1\"><span ng-class=\"::{'text-muted': dt.secondary, 'text-info': dt.current}\">{{::dt.label}}</span></button>\n"+"      </td>\n"+"    </tr>\n"+"  </tbody>\n"+"</table>\n"+"");}]);angular.module("uib/template/datepicker/month.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("uib/template/datepicker/month.html","<table class=\"uib-monthpicker\" role=\"grid\" aria-labelledby=\"{{::uniqueId}}-title\" aria-activedescendant=\"{{activeDateId}}\">\n"+"  <thead>\n"+"    <tr>\n"+"      <th><button type=\"button\" class=\"btn btn-default btn-sm pull-left uib-left\" ng-click=\"move(-1)\" tabindex=\"-1\"><i class=\"glyphicon glyphicon-chevron-left\"></i></button></th>\n"+"      <th><button id=\"{{::uniqueId}}-title\" role=\"heading\" aria-live=\"assertive\" aria-atomic=\"true\" type=\"button\" class=\"btn btn-default btn-sm uib-title\" ng-click=\"toggleMode()\" ng-disabled=\"datepickerMode === maxMode\" tabindex=\"-1\" style=\"width:100%;\"><strong>{{title}}</strong></button></th>\n"+"      <th><button type=\"button\" class=\"btn btn-default btn-sm pull-right uib-right\" ng-click=\"move(1)\" tabindex=\"-1\"><i class=\"glyphicon glyphicon-chevron-right\"></i></button></th>\n"+"    </tr>\n"+"  </thead>\n"+"  <tbody>\n"+"    <tr class=\"uib-months\" ng-repeat=\"row in rows track by $index\">\n"+"      <td ng-repeat=\"dt in row\" class=\"uib-month text-center\" role=\"gridcell\"\n"+"        id=\"{{::dt.uid}}\"\n"+"        ng-class=\"::dt.customClass\">\n"+"        <button type=\"button\" style=\"min-width:100%;\" class=\"btn btn-default\"\n"+"          uib-is-class=\"\n"+"            'btn-info' for selectedDt,\n"+"            'active' for activeDt\n"+"            on dt\"\n"+"          ng-click=\"select(dt.date)\"\n"+"          ng-disabled=\"::dt.disabled\"\n"+"          tabindex=\"-1\"><span ng-class=\"::{'text-info': dt.current}\">{{::dt.label}}</span></button>\n"+"      </td>\n"+"    </tr>\n"+"  </tbody>\n"+"</table>\n"+"");}]);angular.module("uib/template/datepicker/popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("uib/template/datepicker/popup.html","<ul class=\"uib-datepicker-popup dropdown-menu\" dropdown-nested ng-if=\"isOpen\" style=\"display: block\" ng-style=\"{top: position.top+'px', left: position.left+'px'}\" ng-keydown=\"keydown($event)\" ng-click=\"$event.stopPropagation()\">\n"+" <li ng-transclude></li>\n"+" <li ng-if=\"showButtonBar\" style=\"padding:10px 9px 2px\" class=\"uib-button-bar\">\n"+"  <span class=\"btn-group pull-left\">\n"+"   <button type=\"button\" class=\"btn btn-sm btn-info uib-datepicker-current\" ng-click=\"select('today')\" ng-disabled=\"isDisabled('today')\">{{ getText('current') }}</button>\n"+"   <button type=\"button\" class=\"btn btn-sm btn-danger uib-clear\" ng-click=\"select(null)\">{{ getText('clear') }}</button>\n"+"  </span>\n"+"  <button type=\"button\" class=\"btn btn-sm btn-success pull-right uib-close\" ng-click=\"close()\">{{ getText('close') }}</button>\n"+" </li>\n"+"</ul>\n"+"");}]);angular.module("uib/template/datepicker/year.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("uib/template/datepicker/year.html","<table class=\"uib-yearpicker\" role=\"grid\" aria-labelledby=\"{{::uniqueId}}-title\" aria-activedescendant=\"{{activeDateId}}\">\n"+"  <thead>\n"+"    <tr>\n"+"      <th><button type=\"button\" class=\"btn btn-default btn-sm pull-left uib-left\" ng-click=\"move(-1)\" tabindex=\"-1\"><i class=\"glyphicon glyphicon-chevron-left\"></i></button></th>\n"+"      <th colspan=\"{{::columns - 2}}\"><button id=\"{{::uniqueId}}-title\" role=\"heading\" aria-live=\"assertive\" aria-atomic=\"true\" type=\"button\" class=\"btn btn-default btn-sm uib-title\" ng-click=\"toggleMode()\" ng-disabled=\"datepickerMode === maxMode\" tabindex=\"-1\" style=\"width:100%;\"><strong>{{title}}</strong></button></th>\n"+"      <th><button type=\"button\" class=\"btn btn-default btn-sm pull-right uib-right\" ng-click=\"move(1)\" tabindex=\"-1\"><i class=\"glyphicon glyphicon-chevron-right\"></i></button></th>\n"+"    </tr>\n"+"  </thead>\n"+"  <tbody>\n"+"    <tr class=\"uib-years\" ng-repeat=\"row in rows track by $index\">\n"+"      <td ng-repeat=\"dt in row\" class=\"uib-year text-center\" role=\"gridcell\"\n"+"        id=\"{{::dt.uid}}\"\n"+"        ng-class=\"::dt.customClass\">\n"+"        <button type=\"button\" style=\"min-width:100%;\" class=\"btn btn-default\"\n"+"          uib-is-class=\"\n"+"            'btn-info' for selectedDt,\n"+"            'active' for activeDt\n"+"            on dt\"\n"+"          ng-click=\"select(dt.date)\"\n"+"          ng-disabled=\"::dt.disabled\"\n"+"          tabindex=\"-1\"><span ng-class=\"::{'text-info': dt.current}\">{{::dt.label}}</span></button>\n"+"      </td>\n"+"    </tr>\n"+"  </tbody>\n"+"</table>\n"+"");}]);angular.module("uib/template/modal/backdrop.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("uib/template/modal/backdrop.html","<div class=\"modal-backdrop\"\n"+"     uib-modal-animation-class=\"fade\"\n"+"     modal-in-class=\"in\"\n"+"     ng-style=\"{'z-index': 1040 + (index && 1 || 0) + index*10}\"\n"+"></div>\n"+"");}]);angular.module("uib/template/modal/window.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("uib/template/modal/window.html","<div modal-render=\"{{$isRendered}}\" tabindex=\"-1\" role=\"dialog\" class=\"modal\"\n"+"    uib-modal-animation-class=\"fade\"\n"+"    modal-in-class=\"in\"\n"+"    ng-style=\"{'z-index': 1050 + index*10, display: 'block'}\">\n"+"    <div class=\"modal-dialog\" ng-class=\"size ? 'modal-' + size : ''\"><div class=\"modal-content\" uib-modal-transclude></div></div>\n"+"</div>\n"+"");}]);angular.module("uib/template/pager/pager.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("uib/template/pager/pager.html","<ul class=\"pager\">\n"+"  <li ng-class=\"{disabled: noPrevious()||ngDisabled, previous: align}\"><a href ng-click=\"selectPage(page - 1, $event)\">{{::getText('previous')}}</a></li>\n"+"  <li ng-class=\"{disabled: noNext()||ngDisabled, next: align}\"><a href ng-click=\"selectPage(page + 1, $event)\">{{::getText('next')}}</a></li>\n"+"</ul>\n"+"");}]);angular.module("uib/template/pagination/pagination.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("uib/template/pagination/pagination.html","<ul class=\"pagination\">\n"+"  <li ng-if=\"::boundaryLinks\" ng-class=\"{disabled: noPrevious()||ngDisabled}\" class=\"pagination-first\"><a href ng-click=\"selectPage(1, $event)\">{{::getText('first')}}</a></li>\n"+"  <li ng-if=\"::directionLinks\" ng-class=\"{disabled: noPrevious()||ngDisabled}\" class=\"pagination-prev\"><a href ng-click=\"selectPage(page - 1, $event)\">{{::getText('previous')}}</a></li>\n"+"  <li ng-repeat=\"page in pages track by $index\" ng-class=\"{active: page.active,disabled: ngDisabled&&!page.active}\" class=\"pagination-page\"><a href ng-click=\"selectPage(page.number, $event)\">{{page.text}}</a></li>\n"+"  <li ng-if=\"::directionLinks\" ng-class=\"{disabled: noNext()||ngDisabled}\" class=\"pagination-next\"><a href ng-click=\"selectPage(page + 1, $event)\">{{::getText('next')}}</a></li>\n"+"  <li ng-if=\"::boundaryLinks\" ng-class=\"{disabled: noNext()||ngDisabled}\" class=\"pagination-last\"><a href ng-click=\"selectPage(totalPages, $event)\">{{::getText('last')}}</a></li>\n"+"</ul>\n"+"");}]);angular.module("uib/template/tooltip/tooltip-html-popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("uib/template/tooltip/tooltip-html-popup.html","<div class=\"tooltip\"\n"+"  tooltip-animation-class=\"fade\"\n"+"  uib-tooltip-classes\n"+"  ng-class=\"{ in: isOpen() }\">\n"+"  <div class=\"tooltip-arrow\"></div>\n"+"  <div class=\"tooltip-inner\" ng-bind-html=\"contentExp()\"></div>\n"+"</div>\n"+"");}]);angular.module("template/tooltip/tooltip-html-unsafe-popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tooltip/tooltip-html-unsafe-popup.html","<div class=\"tooltip\"\n"+"  tooltip-animation-class=\"fade\"\n"+"  tooltip-classes\n"+"  ng-class=\"{ in: isOpen() }\">\n"+"  <div class=\"tooltip-arrow\"></div>\n"+"  <div class=\"tooltip-inner\" bind-html-unsafe=\"content\"></div>\n"+"</div>\n"+"");}]);angular.module("uib/template/tooltip/tooltip-popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("uib/template/tooltip/tooltip-popup.html","<div class=\"tooltip\"\n"+"  tooltip-animation-class=\"fade\"\n"+"  uib-tooltip-classes\n"+"  ng-class=\"{ in: isOpen() }\">\n"+"  <div class=\"tooltip-arrow\"></div>\n"+"  <div class=\"tooltip-inner\" ng-bind=\"content\"></div>\n"+"</div>\n"+"");}]);angular.module("uib/template/tooltip/tooltip-template-popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("uib/template/tooltip/tooltip-template-popup.html","<div class=\"tooltip\"\n"+"  tooltip-animation-class=\"fade\"\n"+"  uib-tooltip-classes\n"+"  ng-class=\"{ in: isOpen() }\">\n"+"  <div class=\"tooltip-arrow\"></div>\n"+"  <div class=\"tooltip-inner\"\n"+"    uib-tooltip-template-transclude=\"contentExp()\"\n"+"    tooltip-template-transclude-scope=\"originScope()\"></div>\n"+"</div>\n"+"");}]);angular.module("uib/template/popover/popover-html.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("uib/template/popover/popover-html.html","<div class=\"popover\"\n"+"  tooltip-animation-class=\"fade\"\n"+"  uib-tooltip-classes\n"+"  ng-class=\"{ in: isOpen() }\">\n"+"  <div class=\"arrow\"></div>\n"+"\n"+"  <div class=\"popover-inner\">\n"+"      <h3 class=\"popover-title\" ng-bind=\"title\" ng-if=\"title\"></h3>\n"+"      <div class=\"popover-content\" ng-bind-html=\"contentExp()\"></div>\n"+"  </div>\n"+"</div>\n"+"");}]);angular.module("uib/template/popover/popover-template.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("uib/template/popover/popover-template.html","<div class=\"popover\"\n"+"  tooltip-animation-class=\"fade\"\n"+"  uib-tooltip-classes\n"+"  ng-class=\"{ in: isOpen() }\">\n"+"  <div class=\"arrow\"></div>\n"+"\n"+"  <div class=\"popover-inner\">\n"+"      <h3 class=\"popover-title\" ng-bind=\"title\" ng-if=\"title\"></h3>\n"+"      <div class=\"popover-content\"\n"+"        uib-tooltip-template-transclude=\"contentExp()\"\n"+"        tooltip-template-transclude-scope=\"originScope()\"></div>\n"+"  </div>\n"+"</div>\n"+"");}]);angular.module("uib/template/popover/popover.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("uib/template/popover/popover.html","<div class=\"popover\"\n"+"  tooltip-animation-class=\"fade\"\n"+"  uib-tooltip-classes\n"+"  ng-class=\"{ in: isOpen() }\">\n"+"  <div class=\"arrow\"></div>\n"+"\n"+"  <div class=\"popover-inner\">\n"+"      <h3 class=\"popover-title\" ng-bind=\"title\" ng-if=\"title\"></h3>\n"+"      <div class=\"popover-content\" ng-bind=\"content\"></div>\n"+"  </div>\n"+"</div>\n"+"");}]);angular.module("uib/template/progressbar/bar.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("uib/template/progressbar/bar.html","<div class=\"progress-bar\" ng-class=\"type && 'progress-bar-' + type\" role=\"progressbar\" aria-valuenow=\"{{value}}\" aria-valuemin=\"0\" aria-valuemax=\"{{max}}\" ng-style=\"{width: (percent < 100 ? percent : 100) + '%'}\" aria-valuetext=\"{{percent | number:0}}%\" aria-labelledby=\"{{::title}}\" ng-transclude></div>\n"+"");}]);angular.module("uib/template/progressbar/progress.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("uib/template/progressbar/progress.html","<div class=\"progress\" ng-transclude aria-labelledby=\"{{::title}}\"></div>");}]);angular.module("uib/template/progressbar/progressbar.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("uib/template/progressbar/progressbar.html","<div class=\"progress\">\n"+"  <div class=\"progress-bar\" ng-class=\"type && 'progress-bar-' + type\" role=\"progressbar\" aria-valuenow=\"{{value}}\" aria-valuemin=\"0\" aria-valuemax=\"{{max}}\" ng-style=\"{width: (percent < 100 ? percent : 100) + '%'}\" aria-valuetext=\"{{percent | number:0}}%\" aria-labelledby=\"{{::title}}\" ng-transclude></div>\n"+"</div>\n"+"");}]);angular.module("uib/template/rating/rating.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("uib/template/rating/rating.html","<span ng-mouseleave=\"reset()\" ng-keydown=\"onKeydown($event)\" tabindex=\"0\" role=\"slider\" aria-valuemin=\"0\" aria-valuemax=\"{{range.length}}\" aria-valuenow=\"{{value}}\">\n"+"    <span ng-repeat-start=\"r in range track by $index\" class=\"sr-only\">({{ $index < value ? '*' : ' ' }})</span>\n"+"    <i ng-repeat-end ng-mouseenter=\"enter($index + 1)\" ng-click=\"rate($index + 1)\" class=\"glyphicon\" ng-class=\"$index < value && (r.stateOn || 'glyphicon-star') || (r.stateOff || 'glyphicon-star-empty')\" ng-attr-title=\"{{r.title}}\" aria-valuetext=\"{{r.title}}\"></i>\n"+"</span>\n"+"");}]);angular.module("uib/template/tabs/tab.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("uib/template/tabs/tab.html","<li ng-class=\"{active: active, disabled: disabled}\" class=\"uib-tab\">\n"+"  <div ng-click=\"select()\" uib-tab-heading-transclude>{{heading}}</div>\n"+"</li>\n"+"");}]);angular.module("uib/template/tabs/tabset.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("uib/template/tabs/tabset.html","<div>\n"+"  <ul class=\"nav nav-{{type || 'tabs'}}\" ng-class=\"{'nav-stacked': vertical, 'nav-justified': justified}\" ng-transclude></ul>\n"+"  <div class=\"tab-content\">\n"+"    <div class=\"tab-pane\" \n"+"         ng-repeat=\"tab in tabs\" \n"+"         ng-class=\"{active: tab.active}\"\n"+"         uib-tab-content-transclude=\"tab\">\n"+"    </div>\n"+"  </div>\n"+"</div>\n"+"");}]);angular.module("uib/template/timepicker/timepicker.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("uib/template/timepicker/timepicker.html","<table class=\"uib-timepicker\">\n"+"  <tbody>\n"+"    <tr class=\"text-center\" ng-show=\"::showSpinners\">\n"+"      <td class=\"uib-increment hours\"><a ng-click=\"incrementHours()\" ng-class=\"{disabled: noIncrementHours()}\" class=\"btn btn-link\" ng-disabled=\"noIncrementHours()\" tabindex=\"{{::tabindex}}\"><span class=\"glyphicon glyphicon-chevron-up\"></span></a></td>\n"+"      <td>&nbsp;</td>\n"+"      <td class=\"uib-increment minutes\"><a ng-click=\"incrementMinutes()\" ng-class=\"{disabled: noIncrementMinutes()}\" class=\"btn btn-link\" ng-disabled=\"noIncrementMinutes()\" tabindex=\"{{::tabindex}}\"><span class=\"glyphicon glyphicon-chevron-up\"></span></a></td>\n"+"      <td ng-show=\"showSeconds\">&nbsp;</td>\n"+"      <td ng-show=\"showSeconds\" class=\"uib-increment seconds\"><a ng-click=\"incrementSeconds()\" ng-class=\"{disabled: noIncrementSeconds()}\" class=\"btn btn-link\" ng-disabled=\"noIncrementSeconds()\" tabindex=\"{{::tabindex}}\"><span class=\"glyphicon glyphicon-chevron-up\"></span></a></td>\n"+"      <td ng-show=\"showMeridian\"></td>\n"+"    </tr>\n"+"    <tr>\n"+"      <td class=\"form-group uib-time hours\" ng-class=\"{'has-error': invalidHours}\">\n"+"        <input style=\"width:50px;\" type=\"text\" placeholder=\"HH\" ng-model=\"hours\" ng-change=\"updateHours()\" class=\"form-control text-center\" ng-readonly=\"::readonlyInput\" maxlength=\"2\" tabindex=\"{{::tabindex}}\" ng-disabled=\"noIncrementHours()\" ng-blur=\"blur()\">\n"+"      </td>\n"+"      <td class=\"uib-separator\">:</td>\n"+"      <td class=\"form-group uib-time minutes\" ng-class=\"{'has-error': invalidMinutes}\">\n"+"        <input style=\"width:50px;\" type=\"text\" placeholder=\"MM\" ng-model=\"minutes\" ng-change=\"updateMinutes()\" class=\"form-control text-center\" ng-readonly=\"::readonlyInput\" maxlength=\"2\" tabindex=\"{{::tabindex}}\" ng-disabled=\"noIncrementMinutes()\" ng-blur=\"blur()\">\n"+"      </td>\n"+"      <td ng-show=\"showSeconds\" class=\"uib-separator\">:</td>\n"+"      <td class=\"form-group uib-time seconds\" ng-class=\"{'has-error': invalidSeconds}\" ng-show=\"showSeconds\">\n"+"        <input style=\"width:50px;\" type=\"text\" ng-model=\"seconds\" ng-change=\"updateSeconds()\" class=\"form-control text-center\" ng-readonly=\"readonlyInput\" maxlength=\"2\" tabindex=\"{{::tabindex}}\" ng-disabled=\"noIncrementSeconds()\" ng-blur=\"blur()\">\n"+"      </td>\n"+"      <td ng-show=\"showMeridian\" class=\"uib-time am-pm\"><button type=\"button\" ng-class=\"{disabled: noToggleMeridian()}\" class=\"btn btn-default text-center\" ng-click=\"toggleMeridian()\" ng-disabled=\"noToggleMeridian()\" tabindex=\"{{::tabindex}}\">{{meridian}}</button></td>\n"+"    </tr>\n"+"    <tr class=\"text-center\" ng-show=\"::showSpinners\">\n"+"      <td class=\"uib-decrement hours\"><a ng-click=\"decrementHours()\" ng-class=\"{disabled: noDecrementHours()}\" class=\"btn btn-link\" ng-disabled=\"noDecrementHours()\" tabindex=\"{{::tabindex}}\"><span class=\"glyphicon glyphicon-chevron-down\"></span></a></td>\n"+"      <td>&nbsp;</td>\n"+"      <td class=\"uib-decrement minutes\"><a ng-click=\"decrementMinutes()\" ng-class=\"{disabled: noDecrementMinutes()}\" class=\"btn btn-link\" ng-disabled=\"noDecrementMinutes()\" tabindex=\"{{::tabindex}}\"><span class=\"glyphicon glyphicon-chevron-down\"></span></a></td>\n"+"      <td ng-show=\"showSeconds\">&nbsp;</td>\n"+"      <td ng-show=\"showSeconds\" class=\"uib-decrement seconds\"><a ng-click=\"decrementSeconds()\" ng-class=\"{disabled: noDecrementSeconds()}\" class=\"btn btn-link\" ng-disabled=\"noDecrementSeconds()\" tabindex=\"{{::tabindex}}\"><span class=\"glyphicon glyphicon-chevron-down\"></span></a></td>\n"+"      <td ng-show=\"showMeridian\"></td>\n"+"    </tr>\n"+"  </tbody>\n"+"</table>\n"+"");}]);angular.module("uib/template/typeahead/typeahead-match.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("uib/template/typeahead/typeahead-match.html","<a href tabindex=\"-1\" ng-bind-html=\"match.label | uibTypeaheadHighlight:query\"></a>\n"+"");}]);angular.module("uib/template/typeahead/typeahead-popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("uib/template/typeahead/typeahead-popup.html","<ul class=\"dropdown-menu\" ng-show=\"isOpen() && !moveInProgress\" ng-style=\"{top: position().top+'px', left: position().left+'px'}\" style=\"display: block;\" role=\"listbox\" aria-hidden=\"{{!isOpen()}}\">\n"+"    <li ng-repeat=\"match in matches track by $index\" ng-class=\"{active: isActive($index) }\" ng-mouseenter=\"selectActive($index)\" ng-click=\"selectMatch($index, $event)\" role=\"option\" id=\"{{::match.id}}\">\n"+"        <div uib-typeahead-match index=\"$index\" match=\"match\" query=\"query\" template-url=\"templateUrl\"></div>\n"+"    </li>\n"+"</ul>\n"+"");}]);angular.module('ui.bootstrap.carousel').run(function(){!angular.$$csp().noInlineStyle&&angular.element(document).find('head').prepend('<style type="text/css">.ng-animate.item:not(.left):not(.right){-webkit-transition:0s ease-in-out left;transition:0s ease-in-out left}</style>');});angular.module('ui.bootstrap.tabs').run(function(){!angular.$$csp().noInlineStyle&&angular.element(document).find('head').prepend('<style type="text/css">.uib-tab > div{position:relative;display:block;padding:10px 15px;outline:0;color:#337ab7;}.uib-tab > div:focus,.uib-tab > div:hover{background-color:#eee;color:#23527c;}.uib-tab.disabled > div{color:#777;}.uib-tab.disabled > div:focus,.uib-tab.disabled > div:hover{color:#777;cursor:not-allowed;background-color:transparent;}.nav-tabs > .uib-tab > div{margin-right:2px;line-height:1.42857143;border:1px solid transparent;border-radius:4px 4px 0 0;}.nav-tabs > .uib-tab > div:hover{border-color:#eee #eee #ddd;}.nav-tabs > .uib-tab.active > div,.nav-tabs > .uib-tab.active > div:focus,.nav-tabs > .uib-tab.active > div:hover{color:#555;cursor:default;background-color:#fff;border-color:#ddd #ddd transparent #ddd;}.nav-pills > .uib-tab > div{border-radius:4px;}.nav-pills > .uib-tab.active > div,.nav-pills > .uib-tab.active > div:focus,.nav-pills > .uib-tab.active > div:hover{color:#fff;background-color:#337ab7;}</style>');});
;(function(angular){'use strict';angular.module('li.services.media.image-manager',['li.services.rest.rest-manager','li.services.community.context-manager','li.services.utils.lodash-utils','li.services.rest.liql','li.services.utils.url-manager','ngFileUpload','ui.bootstrap']).constant('$liImageManagerConfig',{settings:{maxFileSizeKey:'imageupload.max_file_size',allowedfileExtKey:'imageupload.legal_file_extensions',maxNumOfUploadAtATimeKey:'imageupload.max_uploaded_images_per_upload'},policies:{processAndRemoveExif:'image-upload.process-and-remove-exif-metadata'}}).factory('$liImageManager',['$liRestManager','$log','$liContextManager','$liImageManagerConfig','$interval','$liLodashUtils','$liql','Upload','$rootScope','$uibModal','$location','$liUrlManager','$document','$q',function($liRestManager,$log,$liContextManager,$liImageManagerConfig,$interval,$liLodashUtils,$liql,Upload,$rootScope,$uibModal,$location,$liUrlManager,$document,$q){var lightboxOpened=false;function startFakeProgress(image){var fakeProgressInterval=$interval(function(){if(image.progressStarted){$interval.cancel(fakeProgressInterval);}else if(image.progress<65){image.progress++;}},200);}
return{getImage:function getImage(fields,id){return $liql().select(fields).from('images').where('id').eq(id).exec().first();},getImagesForMessage:function getImagesForMessage(messageId,fields,associationType,limit,offset){return $liql().select(fields&&fields.length>0?fields:'*').from('images').where('messages.id').eq(messageId+'').and('association_type').eq(associationType).limit(limit).offset(offset).exec().unwrap();},getImageByDisplayId:function getImageByDisplayId(imgId,fields){return $liql().select(fields&&fields.length>0?fields:'*').from('images').where('id').eq(imgId+'').exec().first();},getImagesByUser:function getImagesByUser(userId,privacyLevel,visibility,fields,limit,offset){return $liql().select(fields&&fields.length>0?fields:'*').from('images').where('owner.id').eq(userId+'').and('album.privacy_level').eq(privacyLevel).and('visibility').eq(visibility).orderBy('upload_time').desc().limit(limit).offset(offset).exec().unwrap();},editImage:function editImage(image,editOptions){if(!image.id||!editOptions){throw'image with an id and editOptions must be specified.';}
var path='/images/'+image.id;editOptions.type='image';var payload={data:editOptions};return $liRestManager.request(path,null,payload,'put');},getImageUploadMaxFileSize:function getImageUploadMaxFileSize(){return $liContextManager.currentUserSettings()[$liImageManagerConfig.settings.maxFileSizeKey];},getAllowedImageUploadFileExts:function getAllowedImageUploadFileExts(){return $liContextManager.currentUserSettings()[$liImageManagerConfig.settings.allowedfileExtKey];},getMaxNumOfImageUploadAllowedAtATime:function getMaxNumOfImageUploadAllowedAtATime(){return $liContextManager.currentUserSettings()[$liImageManagerConfig.settings.maxNumOfUploadAtATimeKey];},isImageExtensionAllowed:function isImageExtensionAllowed(extension){var acceptExts=$liContextManager.currentUserSettings()[$liImageManagerConfig.settings.allowedfileExtKey];var allowedTypes=acceptExts.replace(/\.|\*/g,'').split(';');return allowedTypes.indexOf(extension)>-1;},isImageUploadExifAllowed:function isImageUploadExifAllowed(){return $liContextManager.currentUserPolicies()[$liImageManagerConfig.policies.processAndRemoveExif];},deleteImage:function deleteImage(image){if(!image){$log.error('An Image object is required');}else{return $liRestManager.request('/images/:id',{id:image.id},null,'delete',null);}},deleteDrafts:function deleteDrafts(images){if(!images||images.length<1){$log.error('An array of Image objects is required');}else{var ids=$liLodashUtils.map(images,function(image){return image.id;}).join(',');return $liRestManager.request('/images/drafts',{ids:ids},null,'delete',null);}},uploadImageFromUrl:function uploadImageFromUrl(imageOptions,image){var payload={data:imageOptions};payload.data.type='image';startFakeProgress(image);return $liRestManager.request('/images',null,payload,'post',null,false).then(function(response){image.isUploadComplete=true;return angular.extend(image,response.data);}).finally(function(){image.progress=100;});},uploadImageFromFile:function uploadImageFromFile(image,albumId,visibility,images){var params={request:{data:{type:'image',title:image.file.name,field:'image.content',visibility:visibility,description:'',album:{id:albumId}}}};return Upload.upload({url:$liRestManager.getFullyQualifiedUrl('/images'),data:{'image.content':image.file,'api.request':angular.toJson(params)},headers:{name:'image.content'}}).then(function(response){image.isUploadComplete=true;return angular.extend(image,response.data.data);},function(response){$log.error('uploading image failed for following reason: '+response.data.message);return $q.reject(response.data.message);},function(evt){var currentImgIdx=images.indexOf(image);var updatedProgress=parseInt(100.0*evt.loaded/evt.total);if(currentImgIdx!==-1){images[currentImgIdx].progress=updatedProgress;}else{image.progress=updatedProgress;images.push(image);}}).finally(function(){image.progress=100;});},lightbox:function lightbox(images,loadImages,limit,metaName,openContext,eventContext){function encodeContext(id){return id+=scope.openContext?':'+scope.openContext:'';}
function decodeContext(){var val=$location.search()['lightbox-'+metaName];if(val!==undefined){var parts=val.split(':');if(parts.length===2){options({openContext:parts[1]});}
return parts[0];}}
function open(image){scope.image=image;initialState=$location.state();lightboxOpened=true;closeHandled=false;modal=$uibModal.open({template:'<li:media-image-lightbox li-image="image" li-images="images" li-open-context="openContext"'+'li-load-images="loadImages(limit, offset, context)" li-limit="limit" li-close="close()" '+'li-event-context="eventContext">'+'</li:media-image-lightbox>',scope:scope,controller:function controller($scope){$scope.$watch('image',function(newImage){if(metaName){$location.search('lightbox-'+metaName,encodeContext(newImage.id));}});$scope.$watch(function(){return $location.search()['lightbox-'+metaName];},function(){$scope.$broadcast('liLightboxImageChange',decodeContext());});$scope.$on('modal.closing',function($event){if($body.hasClass('lia-fullscreen')){$event.preventDefault();}else{if(!closeHandled){closeHandled=true;clearState();}}});},size:'imagelightbox'});return scope.liModal;}
function close(){closeHandled=true;lightboxOpened=false;if(modal){clearState();modal.close();}}
function clearState(){if(metaName){try{$location.state(initialState);}catch(e){}
if($location.search()['lightbox-'+metaName]){$location.search('lightbox-'+metaName,null);}}}
function options(opts){if(opts){angular.extend(scope,opts);}
return scope;}
var modal;var initialState;var closeHandled=false;var $body=angular.element($document[0].body);var scope=$rootScope.$new();scope.images=images;scope.loadImages=loadImages;scope.limit=limit;scope.close=close;scope.openContext=openContext;scope.eventContext=eventContext;if(metaName&&!lightboxOpened){var imageDisplayId=decodeContext();if(imageDisplayId){open({id:imageDisplayId});}}
return{open:open,close:close,options:options};},getCropUrl:function getCropUrl(url,visibility){var adjustedUrl=$liUrlManager.adjustUrl(url);if(visibility!=='rejected'){adjustedUrl.addPathParam('crop-image','true');}
return adjustedUrl.build();},getImagesInfoFromMarkup:function getImagesInfoFromMarkup(markup){var imgs=[];var imgElms=angular.element('<div>').append(markup).find('li-image');angular.forEach(imgElms,function(img){var $img=angular.element(img);var id=$img.attr('id');var size=$img.attr('size');imgs.push({id:id,size:size});});return imgs;},getLiImagesMarkup:function getLiImagesMarkup(images){var wrapper=angular.element('<div>');angular.forEach(images,function(image){var size=image.size||'large';var liElm=angular.element('<li-image>');liElm.attr({id:image.id,size:size,width:image.width});wrapper.append(liElm);});return wrapper.html();}};}]);})(window.LITHIUM&&LITHIUM.angular||angular);
;(function(angular){'use strict';angular.module('li.services.messages.message-manager',['li.services.rest.rest-manager','li.services.rest.liql']).factory('$liMessageManager',['$liRestManager','$q','$liql',function($liRestManager,$q,$liql){function getMessagesForImage(imageId,fields,limit){return $liql().select(fields).from('messages').where('images.id').eq(imageId).limit(limit).exec().unwrap();}
function getMessageById(messageId){return $liRestManager.request('/messages/:messageId',{messageId:messageId}).then(function(response){return response.data;});}
function getFloatedMessages(fields,boardId,floatScope,limit,expands){return $liql().select(fields).from('floated_messages').expand(expands).where('message.board.id').eq(boardId).and('scope').eq(floatScope).limit(limit).exec().unwrap();}
return{getMessagesForImage:getMessagesForImage,getMessageById:getMessageById,getFloatedMessages:getFloatedMessages};}]);})(window.LITHIUM&&LITHIUM.angular||angular);
;(function(angular){'use strict';angular.module('li.services.events.event-manager',['li.services.rest.rest-manager']).factory('$liEventManager',['$liRestManager','$document',function($liRestManager,$document){function stop($event){$event.preventDefault();$event.stopPropagation();}
var eventMap={'media-view':{payload:{mediaId:'id',mediaName:'title',mediaType:'type'},context:{messageId:'id'}}};var document=$document[0];function createEventPayload(eventType,eventPayload,eventContext){var eventObj=Object.create(eventMap[eventType].payload||{});for(var eventProp in eventObj){eventObj[eventProp]=eventPayload[eventObj[eventProp]];}
if(eventContext!==undefined&&eventContext!==null){var eventObjContext=Object.create(eventMap[eventType].context||{});for(var eventContextProp in eventObjContext){eventObjContext[eventContextProp]=eventContext[eventObjContext[eventContextProp]];}
angular.extend(eventObj,eventObjContext);}
return eventObj;}
function emitNativeEvent(eventName,context,element){var event=document.createEvent('CustomEvent');var triggerElement=element?element:document;event.initCustomEvent(eventName,true,true,context);triggerElement.dispatchEvent(event);}
return{sendEvent:function sendEvent(type,data,context){var lsiEvent={analytics_event:{type:type,id:-1,data:createEventPayload(type,data,context),version:'3.0'}};return $liRestManager.request('/internal/analytics',{},lsiEvent,'post',false);},emitNativeEvent:emitNativeEvent,KeyCodes:{TAB:9,ENTER:13,LEFT:37,UP:38,RIGHT:39,DOWN:40,ESC:27,f:102},stop:stop};}]);})(window.LITHIUM&&LITHIUM.angular||angular);
;(function(angular){'use strict';angular.module('li.services.utils.param-utils',['li.services.utils.lodash-utils']).factory('$liParamUtils',['$liLodashUtils','$log',function($liLodashUtils,$log){function validateParams(directiveName,scope,params){var allValid=true;angular.forEach(params,function(param){var paramObj;var method;var reason;var value;paramObj={allowNull:true,allowUndefined:false,allowEmpty:true};if(angular.isObject(param)){paramObj=angular.extend({},paramObj,param);}else{paramObj.paramName=param;}
value=scope[paramObj.paramName];if(!paramObj.allowNull&&value===null){reason=' cannot be null.';}
if(paramObj.allowUndefined&&angular.isUndefined(value)&&paramObj.hasOwnProperty('defaultValue')){scope[paramObj.paramName]=paramObj.defaultValue;$log.debug('Param ['+paramObj.paramName+'], was set to the default value '+'['+paramObj.defaultValue+'] for directive '+'['+directiveName+'].');value=scope[paramObj.paramName];}
if(!paramObj.allowUndefined&&angular.isUndefined(value)){reason=' cannot be undefined.';}
if(!paramObj.allowEmpty&&$liLodashUtils.isEmpty(value)){reason=' cannot be empty.';}
if(angular.isFunction(paramObj.validate)&&!paramObj.validate(value)){reason=' is not an allowed value.';}
if(!reason){method='debug';reason=' is valid.';}else{method='error';allValid=false;}
$log[method]('Required param ['+paramObj.paramName+'], with value '+'['+angular.toJson(value)+'], for directive '+'['+directiveName+']'+reason);});return allValid;}
function initTypeTemplate($scope,path,type,defaultType){$scope.templateUrl=function(){var templateType=type?type:defaultType;return path+(templateType?'.'+templateType:'')+'.tpl.html';};}
return{validateParams:validateParams,typeTemplate:'<ng-include src="templateUrl()"></ng-include>',initTypeTemplate:initTypeTemplate};}]);})(window.LITHIUM&&LITHIUM.angular||angular);
;(function(angular){'use strict';angular.module('li.services.media.matchmedia-utils',[]).constant('$liMatchmediaUtilsConfig',{screenSizes:{xs:'(max-width: 480px)',sm:'(min-width: 481px) and (max-width: 768px)',md:'(min-width: 769px) and (max-width: 992px)',lg:'(min-width: 993px) and (max-width: 1500px)',xl:'(min-width: 1501px)'}}).factory('$liMatchmediaUtils',['$window','$rootScope','$liMatchmediaUtilsConfig',function($window,$rootScope,$liMatchmediaUtilsConfig){var lastMediaQueryString;var currentSize;var currentMediaQuery;var listenersForSize={xs:[],sm:[],md:[],lg:[],xl:[]};var currentBodyClass='';function addListener(mediaQueryString,listener){var mediaQuery=$window.matchMedia(mediaQueryString);mediaQuery.addListener(function(){if(mediaQueryString!==lastMediaQueryString){lastMediaQueryString=mediaQueryString;listener.apply($window,arguments);$rootScope.$apply();}});listener(mediaQuery);}
function addListenerForSizes(screenSizes,ifListener,elseListener){var inIf=[];screenSizes=angular.isArray(screenSizes)?screenSizes:[screenSizes];angular.forEach(screenSizes,function(screenSize){listenersForSize[screenSize].push(ifListener);inIf.push(screenSize);if(currentSize===screenSize){ifListener(currentMediaQuery);}});if(angular.isFunction(elseListener)){angular.forEach($liMatchmediaUtilsConfig.screenSizes,function(mq,screenSize){if(inIf.indexOf(screenSize)===-1){listenersForSize[screenSize].push(elseListener);if(currentSize===screenSize){elseListener(currentMediaQuery);}}});}}
angular.forEach($liMatchmediaUtilsConfig.screenSizes,function(mediaQueryString,screenSize){addListener(mediaQueryString,function(mediaQuery){if(mediaQuery.matches){var bodyClass='lia-media-size-'+screenSize;angular.element(document.body).removeClass(currentBodyClass).addClass(bodyClass);currentBodyClass=bodyClass;currentSize=screenSize;currentMediaQuery=mediaQuery;angular.forEach(listenersForSize[screenSize],function(listener){listener(mediaQuery);});}});});return{addListener:addListener,addListenerForSizes:addListenerForSizes,matchMedia:function matchMedia(mediaString){return $window.matchMedia(mediaString);}};}]);})(window.LITHIUM&&LITHIUM.angular||angular);
;(function(angular){'use strict';angular.module('li.services.utils.image-utils',[]).constant('liMediaImageUtilsConfig',{acceptedSizes:{small:'small',medium:'medium',large:'large'}}).factory('$liImageUtils',['liMediaImageUtilsConfig','$q','$window','$document','$interval',function(liMediaImageUtilsConfig,$q,$window,$document,$interval){function base64ToArrayBuffer(dataUrl){var isCapable=$window.atob&&$window.ArrayBuffer&&$window.FileReader;if(!isCapable){return null;}
var base64=dataUrl.replace(/^data\:([^\;]+)\;base64,/gmi,'');var binary=$window.atob(base64);var len=binary.length;var bytes=new Uint8Array(len);for(var i=0;i<len;i++){bytes[i]=binary.charCodeAt(i);}
return bytes.buffer;}
function isLoaded(img){if(angular.isString(img)){if(loadedImgs[img]){img=loadedImgs[img];}else{return false;}}
return(img.complete||img.readyState===4||inCache(angular.element(img).attr('src')))&&img.naturalHeight!==undefined&&img.naturalHeight!==0;}
function inCache(src){return loadedImgs.hasOwnProperty(src);}
var loadedImgs={};return{getScaledDimensions:function getScaledDimensions(originalDim,desiredDim){var widthFactor;var heightFactor;var scaleFactor;var scaledWidth;var scaledHeight;if(originalDim.width===0&&originalDim.height===0){return desiredDim;}
widthFactor=desiredDim.width/originalDim.width;heightFactor=desiredDim.height/originalDim.height;scaleFactor=Math.min(widthFactor,heightFactor);if(scaleFactor>=1.0){return originalDim;}else{scaledWidth=Math.round(scaleFactor*originalDim.width);scaledHeight=Math.round(scaleFactor*originalDim.height);return{width:scaledWidth,height:scaledHeight};}},getImageOrientation:function getImageOrientation(dataUrl){var buffer=base64ToArrayBuffer(dataUrl);return buffer!==null&&$window.EXIF?$window.EXIF.readFromBinaryFile(buffer).Orientation:null;},readFile:function readFile(file){var deferred=$q.defer();if($window.FileReader){var fileReader=new $window.FileReader();fileReader.readAsDataURL(file);fileReader.onload=function(e){deferred.resolve(e.target.result);};}else{deferred.reject();}
return deferred.promise;},forceLoad:function forceLoad(src){var deferred=$q.defer();var interval;var count;var threshold=100;if(!inCache(src)){var dummyImg=$document[0].createElement('img');dummyImg.onload=function(event){if(isLoaded(dummyImg)){loadedImgs[src]=dummyImg;deferred.resolve(event,dummyImg);}else{interval=$interval(function(){if(isLoaded(dummyImg)){$interval.cancel(interval);loadedImgs[src]=dummyImg;deferred.resolve(event,dummyImg);}else if(count++>threshold){$interval.cancel(interval);}},100);}};dummyImg.src=src;}else{return $q.when(null,loadedImgs[src]);}
return deferred.promise;},isLoaded:isLoaded,inCache:inCache};}]);})(window.LITHIUM&&LITHIUM.angular||angular);
;(function(angular){'use strict';angular.module('li.directives.common.img-load',['li.services.utils.image-utils']).directive('liCommonImgLoad',['$interval','$document','$liImageUtils',function($interval,$document,$liImageUtils){return{restrict:'A',scope:{onLoad:'&liCommonImgLoad'},link:function link($scope,$element){$scope.$watch(function(){return $element.attr('src');},function(src){$liImageUtils.forceLoad(src).then($scope.onLoad);});}};}]);})(window.LITHIUM&&LITHIUM.angular||angular);
;(function(angular){'use strict';function localStorageCacheFactory($cacheFactory){function isQuotaExceeded(e){if(e&&(e.code===22||e.code===1014&&e.name==='NS_ERROR_DOM_QUOTA_REACHED')){return true;}
return false;}
function safeLocalStorageSet(key,value){try{localStorage.setItem(key,value);}catch(e){if(isQuotaExceeded(e)){localStorage.clear();localStorage.setItem(key,value);}}}
function cacheFactory(cacheId,options){function put(key,value){if(angular.isUndefined(value)){return;}
var storedValue=cache.put(key,value);setLocalCacheItem(key,value);cleanupLocalCache();return storedValue;}
function cleanupLocalCache(checkAll){var cacheKeys=getLocalCacheKeys();if(options&&cacheKeys.length>=options.capacity){for(var i=0;i<cacheKeys.length;i++){var cacheKey=cacheKeys[i];if(cache.get(cacheKey)===undefined){removeLocalCacheItem(cacheKey);if(!checkAll){break;}}}}}
function remove(key){removeLocalCacheItem(key);cache.remove(key);}
function removeAll(){removeAllLocalCacheItem();cache.removeAll();}
function info(){var i=cache.info();i.keys=getLocalCacheKeys();return i;}
function getLocalCacheKeys(){var keys=localStorage.getItem(cacheId+'::keys');return keys===null?[]:keys.split(',');}
function setLocalCacheKeys(keys){var localKey=cacheId+'::keys';if(keys.length===0){localStorage.removeItem(localKey);}else{safeLocalStorageSet(localKey,keys.join(','));}}
function addLocalCacheKey(key){var keys=getLocalCacheKeys();var index=keys.indexOf(key);if(index===-1){keys.push(key);setLocalCacheKeys(keys);}}
function removeLocalCacheKey(key){var keys=getLocalCacheKeys();var index=keys.indexOf(key);if(index>-1){keys.splice(index,1);setLocalCacheKeys(keys);}}
function getLocalCacheItem(key){var storedVal=localStorage.getItem(cacheId+'::key::'+key);var item=angular.fromJson(storedVal);return item&&item.value;}
function setLocalCacheItem(key,value){if(!angular.isUndefined(key)){var localKey=cacheId+'::key::'+key;if(value===null){removeLocalCacheItem(key);}else{var storedVal={value:value};safeLocalStorageSet(localKey,angular.toJson(storedVal));addLocalCacheKey(key);}}}
function removeLocalCacheItem(key){removeLocalCacheKey(key);localStorage.removeItem(cacheId+'::key::'+key);}
function removeAllLocalCacheItem(){var keys=getLocalCacheKeys();angular.forEach(keys,function(key){localStorage.removeItem(cacheId+'::key::'+key);});localStorage.removeItem(cacheId+'::keys');}
var cache=$cacheFactory(cacheId,options);if(!supportsLocalStorage()){return cache;}
var localCacheKeys=getLocalCacheKeys();angular.forEach(localCacheKeys,function(key){cache.put(key,getLocalCacheItem(key));});cleanupLocalCache(true);return{put:put,get:cache.get,remove:remove,removeAll:removeAll,destroy:cache.destroy,info:info};}
return cacheFactory;}
localStorageCacheFactory.$inject=['$cacheFactory'];function supportsLocalStorage(){try{localStorage.setItem('a','a');localStorage.removeItem('a');return true;}catch(e){return false;}}
function decorateCacheFactory($provide){$provide.decorator('$cacheFactory',['$delegate',function($delegate){var cacheFactory=function cacheFactory(cacheId,options){if(options&&options.storageMode==='localStorage'&&supportsLocalStorage()){return localStorageCacheFactory($delegate)(cacheId,options);}else{return $delegate(cacheId,options);}};cacheFactory.get=$delegate.get;cacheFactory.info=$delegate.info;return cacheFactory;}]);}
decorateCacheFactory.$inject=['$provide'];angular.module('li.services.cache.localstorage-cache-manager',[]).factory('$liLocalstorageCacheManager',localStorageCacheFactory).config(decorateCacheFactory);})(window.LITHIUM&&LITHIUM.angular||angular);

angular.module('pascalprecht.translate',['ng']).run(['$translate',function($translate){var key=$translate.storageKey(),storage=$translate.storage();var fallbackFromIncorrectStorageValue=function(){var preferred=$translate.preferredLanguage();if(angular.isString(preferred)){$translate.use(preferred);}else{storage.put(key,$translate.use());}};if(storage){if(!storage.get(key)){fallbackFromIncorrectStorageValue();}else{$translate.use(storage.get(key))['catch'](fallbackFromIncorrectStorageValue);}}else if(angular.isString($translate.preferredLanguage())){$translate.use($translate.preferredLanguage());}}]);angular.module('pascalprecht.translate').provider('$translate',['$STORAGE_KEY','$windowProvider',function($STORAGE_KEY,$windowProvider){var $translationTable={},$preferredLanguage,$availableLanguageKeys=[],$languageKeyAliases,$fallbackLanguage,$fallbackWasString,$uses,$nextLang,$storageFactory,$storageKey=$STORAGE_KEY,$storagePrefix,$missingTranslationHandlerFactory,$interpolationFactory,$interpolatorFactories=[],$interpolationSanitizationStrategy=false,$loaderFactory,$cloakClassName='translate-cloak',$loaderOptions,$notFoundIndicatorLeft,$notFoundIndicatorRight,$postCompilingEnabled=false,NESTED_OBJECT_DELIMITER='.',loaderCache,directivePriority=0;var version='2.6.1';var getFirstBrowserLanguage=function(){var nav=$windowProvider.$get().navigator,browserLanguagePropertyKeys=['language','browserLanguage','systemLanguage','userLanguage'],i,language;if(angular.isArray(nav.languages)){for(i=0;i<nav.languages.length;i++){language=nav.languages[i];if(language&&language.length){return language;}}}
for(i=0;i<browserLanguagePropertyKeys.length;i++){language=nav[browserLanguagePropertyKeys[i]];if(language&&language.length){return language;}}
return null;};getFirstBrowserLanguage.displayName='angular-translate/service: getFirstBrowserLanguage';var getLocale=function(){return(getFirstBrowserLanguage()||'').split('-').join('_');};getLocale.displayName='angular-translate/service: getLocale';var indexOf=function(array,searchElement){for(var i=0,len=array.length;i<len;i++){if(array[i]===searchElement){return i;}}
return-1;};var trim=function(){return this.replace(/^\s+|\s+$/g,'');};var negotiateLocale=function(preferred){var avail=[],locale=angular.lowercase(preferred),i=0,n=$availableLanguageKeys.length;for(;i<n;i++){avail.push(angular.lowercase($availableLanguageKeys[i]));}
if(indexOf(avail,locale)>-1){return preferred;}
if($languageKeyAliases){var alias;for(var langKeyAlias in $languageKeyAliases){var hasWildcardKey=false;var hasExactKey=Object.prototype.hasOwnProperty.call($languageKeyAliases,langKeyAlias)&&angular.lowercase(langKeyAlias)===angular.lowercase(preferred);if(langKeyAlias.slice(-1)==='*'){hasWildcardKey=langKeyAlias.slice(0,-1)===preferred.slice(0,langKeyAlias.length-1);}
if(hasExactKey||hasWildcardKey){alias=$languageKeyAliases[langKeyAlias];if(indexOf(avail,angular.lowercase(alias))>-1){return alias;}}}}
var parts=preferred.split('_');if(parts.length>1&&indexOf(avail,angular.lowercase(parts[0]))>-1){return parts[0];}
return preferred;};var translations=function(langKey,translationTable){if(!langKey&&!translationTable){return $translationTable;}
if(langKey&&!translationTable){if(angular.isString(langKey)){return $translationTable[langKey];}}else{if(!angular.isObject($translationTable[langKey])){$translationTable[langKey]={};}
angular.extend($translationTable[langKey],flatObject(translationTable));}
return this;};this.translations=translations;this.cloakClassName=function(name){if(!name){return $cloakClassName;}
$cloakClassName=name;return this;};var flatObject=function(data,path,result,prevKey){var key,keyWithPath,keyWithShortPath,val;if(!path){path=[];}
if(!result){result={};}
for(key in data){if(!Object.prototype.hasOwnProperty.call(data,key)){continue;}
val=data[key];if(angular.isObject(val)){flatObject(val,path.concat(key),result,key);}else{keyWithPath=path.length?(''+path.join(NESTED_OBJECT_DELIMITER)+NESTED_OBJECT_DELIMITER+key):key;if(path.length&&key===prevKey){keyWithShortPath=''+path.join(NESTED_OBJECT_DELIMITER);result[keyWithShortPath]='@:'+keyWithPath;}
result[keyWithPath]=val;}}
return result;};this.addInterpolation=function(factory){$interpolatorFactories.push(factory);return this;};this.useMessageFormatInterpolation=function(){return this.useInterpolation('$translateMessageFormatInterpolation');};this.useInterpolation=function(factory){$interpolationFactory=factory;return this;};this.useSanitizeValueStrategy=function(value){$interpolationSanitizationStrategy=value;return this;};this.preferredLanguage=function(langKey){setupPreferredLanguage(langKey);return this;};var setupPreferredLanguage=function(langKey){if(langKey){$preferredLanguage=langKey;}
return $preferredLanguage;};this.translationNotFoundIndicator=function(indicator){this.translationNotFoundIndicatorLeft(indicator);this.translationNotFoundIndicatorRight(indicator);return this;};this.translationNotFoundIndicatorLeft=function(indicator){if(!indicator){return $notFoundIndicatorLeft;}
$notFoundIndicatorLeft=indicator;return this;};this.translationNotFoundIndicatorRight=function(indicator){if(!indicator){return $notFoundIndicatorRight;}
$notFoundIndicatorRight=indicator;return this;};this.fallbackLanguage=function(langKey){fallbackStack(langKey);return this;};var fallbackStack=function(langKey){if(langKey){if(angular.isString(langKey)){$fallbackWasString=true;$fallbackLanguage=[langKey];}else if(angular.isArray(langKey)){$fallbackWasString=false;$fallbackLanguage=langKey;}
if(angular.isString($preferredLanguage)&&indexOf($fallbackLanguage,$preferredLanguage)<0){$fallbackLanguage.push($preferredLanguage);}
return this;}else{if($fallbackWasString){return $fallbackLanguage[0];}else{return $fallbackLanguage;}}};this.use=function(langKey){if(langKey){if(!$translationTable[langKey]&&(!$loaderFactory)){throw new Error("$translateProvider couldn't find translationTable for langKey: '"+langKey+"'");}
$uses=langKey;return this;}
return $uses;};var storageKey=function(key){if(!key){if($storagePrefix){return $storagePrefix+$storageKey;}
return $storageKey;}
$storageKey=key;};this.storageKey=storageKey;this.useUrlLoader=function(url,options){return this.useLoader('$translateUrlLoader',angular.extend({url:url},options));};this.useStaticFilesLoader=function(options){return this.useLoader('$translateStaticFilesLoader',options);};this.useLoader=function(loaderFactory,options){$loaderFactory=loaderFactory;$loaderOptions=options||{};return this;};this.useLocalStorage=function(){return this.useStorage('$translateLocalStorage');};this.useCookieStorage=function(){return this.useStorage('$translateCookieStorage');};this.useStorage=function(storageFactory){$storageFactory=storageFactory;return this;};this.storagePrefix=function(prefix){if(!prefix){return prefix;}
$storagePrefix=prefix;return this;};this.useMissingTranslationHandlerLog=function(){return this.useMissingTranslationHandler('$translateMissingTranslationHandlerLog');};this.useMissingTranslationHandler=function(factory){$missingTranslationHandlerFactory=factory;return this;};this.usePostCompiling=function(value){$postCompilingEnabled=!(!value);return this;};this.determinePreferredLanguage=function(fn){var locale=(fn&&angular.isFunction(fn))?fn():getLocale();if(!$availableLanguageKeys.length){$preferredLanguage=locale;}else{$preferredLanguage=negotiateLocale(locale);}
return this;};this.registerAvailableLanguageKeys=function(languageKeys,aliases){if(languageKeys){$availableLanguageKeys=languageKeys;if(aliases){$languageKeyAliases=aliases;}
return this;}
return $availableLanguageKeys;};this.useLoaderCache=function(cache){if(cache===false){loaderCache=undefined;}else if(cache===true){loaderCache=true;}else if(typeof(cache)==='undefined'){loaderCache='$translationCache';}else if(cache){loaderCache=cache;}
return this;};this.directivePriority=function(priority){if(priority===undefined){return directivePriority;}else{directivePriority=priority;return this;}};this.$get=['$log','$injector','$rootScope','$q',function($log,$injector,$rootScope,$q){var Storage,defaultInterpolator=$injector.get($interpolationFactory||'$translateDefaultInterpolation'),pendingLoader=false,interpolatorHashMap={},langPromises={},fallbackIndex,startFallbackIteration;var $translate=function(translationId,interpolateParams,interpolationId,defaultTranslationText){if(angular.isArray(translationId)){var translateAll=function(translationIds){var results={};var promises=[];var translate=function(translationId){var deferred=$q.defer();var regardless=function(value){results[translationId]=value;deferred.resolve([translationId,value]);};$translate(translationId,interpolateParams,interpolationId,defaultTranslationText).then(regardless,regardless);return deferred.promise;};for(var i=0,c=translationIds.length;i<c;i++){promises.push(translate(translationIds[i]));}
return $q.all(promises).then(function(){return results;});};return translateAll(translationId);}
var deferred=$q.defer();if(translationId){translationId=trim.apply(translationId);}
var promiseToWaitFor=(function(){var promise=$preferredLanguage?langPromises[$preferredLanguage]:langPromises[$uses];fallbackIndex=0;if($storageFactory&&!promise){var langKey=Storage.get($storageKey);promise=langPromises[langKey];if($fallbackLanguage&&$fallbackLanguage.length){var index=indexOf($fallbackLanguage,langKey);fallbackIndex=(index===0)?1:0;if(indexOf($fallbackLanguage,$preferredLanguage)<0){$fallbackLanguage.push($preferredLanguage);}}}
return promise;}());if(!promiseToWaitFor){determineTranslation(translationId,interpolateParams,interpolationId,defaultTranslationText).then(deferred.resolve,deferred.reject);}else{promiseToWaitFor.then(function(){determineTranslation(translationId,interpolateParams,interpolationId,defaultTranslationText).then(deferred.resolve,deferred.reject);},deferred.reject);}
return deferred.promise;};var applyNotFoundIndicators=function(translationId){if($notFoundIndicatorLeft){translationId=[$notFoundIndicatorLeft,translationId].join(' ');}
if($notFoundIndicatorRight){translationId=[translationId,$notFoundIndicatorRight].join(' ');}
return translationId;};var useLanguage=function(key){$uses=key;$rootScope.$emit('$translateChangeSuccess',{language:key});if($storageFactory){Storage.put($translate.storageKey(),$uses);}
defaultInterpolator.setLocale($uses);angular.forEach(interpolatorHashMap,function(interpolator,id){interpolatorHashMap[id].setLocale($uses);});$rootScope.$emit('$translateChangeEnd',{language:key});};var loadAsync=function(key){if(!key){throw'No language key specified for loading.';}
var deferred=$q.defer();$rootScope.$emit('$translateLoadingStart',{language:key});pendingLoader=true;var cache=loaderCache;if(typeof(cache)==='string'){cache=$injector.get(cache);}
var loaderOptions=angular.extend({},$loaderOptions,{key:key,$http:angular.extend({},{cache:cache},$loaderOptions.$http)});$injector.get($loaderFactory)(loaderOptions).then(function(data){var translationTable={};$rootScope.$emit('$translateLoadingSuccess',{language:key});if(angular.isArray(data)){angular.forEach(data,function(table){angular.extend(translationTable,flatObject(table));});}else{angular.extend(translationTable,flatObject(data));}
pendingLoader=false;deferred.resolve({key:key,table:translationTable});$rootScope.$emit('$translateLoadingEnd',{language:key});},function(key){$rootScope.$emit('$translateLoadingError',{language:key});deferred.reject(key);$rootScope.$emit('$translateLoadingEnd',{language:key});});return deferred.promise;};if($storageFactory){Storage=$injector.get($storageFactory);if(!Storage.get||!Storage.put){throw new Error('Couldn\'t use storage \''+$storageFactory+'\', missing get() or put() method!');}}
if(angular.isFunction(defaultInterpolator.useSanitizeValueStrategy)){defaultInterpolator.useSanitizeValueStrategy($interpolationSanitizationStrategy);}
if($interpolatorFactories.length){angular.forEach($interpolatorFactories,function(interpolatorFactory){var interpolator=$injector.get(interpolatorFactory);interpolator.setLocale($preferredLanguage||$uses);if(angular.isFunction(interpolator.useSanitizeValueStrategy)){interpolator.useSanitizeValueStrategy($interpolationSanitizationStrategy);}
interpolatorHashMap[interpolator.getInterpolationIdentifier()]=interpolator;});}
var getTranslationTable=function(langKey){var deferred=$q.defer();if(Object.prototype.hasOwnProperty.call($translationTable,langKey)){deferred.resolve($translationTable[langKey]);}else if(langPromises[langKey]){langPromises[langKey].then(function(data){translations(data.key,data.table);deferred.resolve(data.table);},deferred.reject);}else{deferred.reject();}
return deferred.promise;};var getFallbackTranslation=function(langKey,translationId,interpolateParams,Interpolator){var deferred=$q.defer();getTranslationTable(langKey).then(function(translationTable){if(Object.prototype.hasOwnProperty.call(translationTable,translationId)){Interpolator.setLocale(langKey);var translation=translationTable[translationId];if(translation.substr(0,2)==='@:'){getFallbackTranslation(langKey,translation.substr(2),interpolateParams,Interpolator).then(deferred.resolve,deferred.reject);}else{deferred.resolve(Interpolator.interpolate(translationTable[translationId],interpolateParams));}
Interpolator.setLocale($uses);}else{deferred.reject();}},deferred.reject);return deferred.promise;};var getFallbackTranslationInstant=function(langKey,translationId,interpolateParams,Interpolator){var result,translationTable=$translationTable[langKey];if(translationTable&&Object.prototype.hasOwnProperty.call(translationTable,translationId)){Interpolator.setLocale(langKey);result=Interpolator.interpolate(translationTable[translationId],interpolateParams);if(result.substr(0,2)==='@:'){return getFallbackTranslationInstant(langKey,result.substr(2),interpolateParams,Interpolator);}
Interpolator.setLocale($uses);}
return result;};var translateByHandler=function(translationId){if($missingTranslationHandlerFactory){var resultString=$injector.get($missingTranslationHandlerFactory)(translationId,$uses);if(resultString!==undefined){return resultString;}else{return translationId;}}else{return translationId;}};var resolveForFallbackLanguage=function(fallbackLanguageIndex,translationId,interpolateParams,Interpolator,defaultTranslationText){var deferred=$q.defer();if(fallbackLanguageIndex<$fallbackLanguage.length){var langKey=$fallbackLanguage[fallbackLanguageIndex];getFallbackTranslation(langKey,translationId,interpolateParams,Interpolator).then(deferred.resolve,function(){resolveForFallbackLanguage(fallbackLanguageIndex+1,translationId,interpolateParams,Interpolator,defaultTranslationText).then(deferred.resolve);});}else{if(defaultTranslationText){deferred.resolve(defaultTranslationText);}else{deferred.resolve(translateByHandler(translationId));}}
return deferred.promise;};var resolveForFallbackLanguageInstant=function(fallbackLanguageIndex,translationId,interpolateParams,Interpolator){var result;if(fallbackLanguageIndex<$fallbackLanguage.length){var langKey=$fallbackLanguage[fallbackLanguageIndex];result=getFallbackTranslationInstant(langKey,translationId,interpolateParams,Interpolator);if(!result){result=resolveForFallbackLanguageInstant(fallbackLanguageIndex+1,translationId,interpolateParams,Interpolator);}}
return result;};var fallbackTranslation=function(translationId,interpolateParams,Interpolator,defaultTranslationText){return resolveForFallbackLanguage((startFallbackIteration>0?startFallbackIteration:fallbackIndex),translationId,interpolateParams,Interpolator,defaultTranslationText);};var fallbackTranslationInstant=function(translationId,interpolateParams,Interpolator){return resolveForFallbackLanguageInstant((startFallbackIteration>0?startFallbackIteration:fallbackIndex),translationId,interpolateParams,Interpolator);};var determineTranslation=function(translationId,interpolateParams,interpolationId,defaultTranslationText){var deferred=$q.defer();var table=$uses?$translationTable[$uses]:$translationTable,Interpolator=(interpolationId)?interpolatorHashMap[interpolationId]:defaultInterpolator;if(table&&Object.prototype.hasOwnProperty.call(table,translationId)){var translation=table[translationId];if(translation.substr(0,2)==='@:'){$translate(translation.substr(2),interpolateParams,interpolationId,defaultTranslationText).then(deferred.resolve,deferred.reject);}else{deferred.resolve(Interpolator.interpolate(translation,interpolateParams));}}else{var missingTranslationHandlerTranslation;if($missingTranslationHandlerFactory&&!pendingLoader){missingTranslationHandlerTranslation=translateByHandler(translationId);}
if($uses&&$fallbackLanguage&&$fallbackLanguage.length){fallbackTranslation(translationId,interpolateParams,Interpolator,defaultTranslationText).then(function(translation){deferred.resolve(translation);},function(_translationId){deferred.reject(applyNotFoundIndicators(_translationId));});}else if($missingTranslationHandlerFactory&&!pendingLoader&&missingTranslationHandlerTranslation){if(defaultTranslationText){deferred.resolve(defaultTranslationText);}else{deferred.resolve(missingTranslationHandlerTranslation);}}else{if(defaultTranslationText){deferred.resolve(defaultTranslationText);}else{deferred.reject(applyNotFoundIndicators(translationId));}}}
return deferred.promise;};var determineTranslationInstant=function(translationId,interpolateParams,interpolationId){var result,table=$uses?$translationTable[$uses]:$translationTable,Interpolator=defaultInterpolator;if(interpolatorHashMap&&Object.prototype.hasOwnProperty.call(interpolatorHashMap,interpolationId)){Interpolator=interpolatorHashMap[interpolationId];}
if(table&&Object.prototype.hasOwnProperty.call(table,translationId)){var translation=table[translationId];if(translation.substr(0,2)==='@:'){result=determineTranslationInstant(translation.substr(2),interpolateParams,interpolationId);}else{result=Interpolator.interpolate(translation,interpolateParams);}}else{var missingTranslationHandlerTranslation;if($missingTranslationHandlerFactory&&!pendingLoader){missingTranslationHandlerTranslation=translateByHandler(translationId);}
if($uses&&$fallbackLanguage&&$fallbackLanguage.length){fallbackIndex=0;result=fallbackTranslationInstant(translationId,interpolateParams,Interpolator);}else if($missingTranslationHandlerFactory&&!pendingLoader&&missingTranslationHandlerTranslation){result=missingTranslationHandlerTranslation;}else{result=applyNotFoundIndicators(translationId);}}
return result;};$translate.preferredLanguage=function(langKey){if(langKey){setupPreferredLanguage(langKey);}
return $preferredLanguage;};$translate.cloakClassName=function(){return $cloakClassName;};$translate.fallbackLanguage=function(langKey){if(langKey!==undefined&&langKey!==null){fallbackStack(langKey);if($loaderFactory){if($fallbackLanguage&&$fallbackLanguage.length){for(var i=0,len=$fallbackLanguage.length;i<len;i++){if(!langPromises[$fallbackLanguage[i]]){langPromises[$fallbackLanguage[i]]=loadAsync($fallbackLanguage[i]);}}}}
$translate.use($translate.use());}
if($fallbackWasString){return $fallbackLanguage[0];}else{return $fallbackLanguage;}};$translate.useFallbackLanguage=function(langKey){if(langKey!==undefined&&langKey!==null){if(!langKey){startFallbackIteration=0;}else{var langKeyPosition=indexOf($fallbackLanguage,langKey);if(langKeyPosition>-1){startFallbackIteration=langKeyPosition;}}}};$translate.proposedLanguage=function(){return $nextLang;};$translate.storage=function(){return Storage;};$translate.use=function(key){if(!key){return $uses;}
var deferred=$q.defer();$rootScope.$emit('$translateChangeStart',{language:key});var aliasedKey=negotiateLocale(key);if(aliasedKey){key=aliasedKey;}
if(!$translationTable[key]&&$loaderFactory&&!langPromises[key]){$nextLang=key;langPromises[key]=loadAsync(key).then(function(translation){translations(translation.key,translation.table);deferred.resolve(translation.key);useLanguage(translation.key);if($nextLang===key){$nextLang=undefined;}
return translation;},function(key){if($nextLang===key){$nextLang=undefined;}
$rootScope.$emit('$translateChangeError',{language:key});deferred.reject(key);$rootScope.$emit('$translateChangeEnd',{language:key});});}else{deferred.resolve(key);useLanguage(key);}
return deferred.promise;};$translate.storageKey=function(){return storageKey();};$translate.isPostCompilingEnabled=function(){return $postCompilingEnabled;};$translate.refresh=function(langKey){if(!$loaderFactory){throw new Error('Couldn\'t refresh translation table, no loader registered!');}
var deferred=$q.defer();function resolve(){deferred.resolve();$rootScope.$emit('$translateRefreshEnd',{language:langKey});}
function reject(){deferred.reject();$rootScope.$emit('$translateRefreshEnd',{language:langKey});}
$rootScope.$emit('$translateRefreshStart',{language:langKey});if(!langKey){var tables=[],loadingKeys={};if($fallbackLanguage&&$fallbackLanguage.length){for(var i=0,len=$fallbackLanguage.length;i<len;i++){tables.push(loadAsync($fallbackLanguage[i]));loadingKeys[$fallbackLanguage[i]]=true;}}
if($uses&&!loadingKeys[$uses]){tables.push(loadAsync($uses));}
$q.all(tables).then(function(tableData){angular.forEach(tableData,function(data){if($translationTable[data.key]){delete $translationTable[data.key];}
translations(data.key,data.table);});if($uses){useLanguage($uses);}
resolve();});}else if($translationTable[langKey]){loadAsync(langKey).then(function(data){translations(data.key,data.table);if(langKey===$uses){useLanguage($uses);}
resolve();},reject);}else{reject();}
return deferred.promise;};$translate.instant=function(translationId,interpolateParams,interpolationId){if(translationId===null||angular.isUndefined(translationId)){return translationId;}
if(angular.isArray(translationId)){var results={};for(var i=0,c=translationId.length;i<c;i++){results[translationId[i]]=$translate.instant(translationId[i],interpolateParams,interpolationId);}
return results;}
if(angular.isString(translationId)&&translationId.length<1){return translationId;}
if(translationId){translationId=trim.apply(translationId);}
var result,possibleLangKeys=[];if($preferredLanguage){possibleLangKeys.push($preferredLanguage);}
if($uses){possibleLangKeys.push($uses);}
if($fallbackLanguage&&$fallbackLanguage.length){possibleLangKeys=possibleLangKeys.concat($fallbackLanguage);}
for(var j=0,d=possibleLangKeys.length;j<d;j++){var possibleLangKey=possibleLangKeys[j];if($translationTable[possibleLangKey]){if(typeof $translationTable[possibleLangKey][translationId]!=='undefined'){result=determineTranslationInstant(translationId,interpolateParams,interpolationId);}else if($notFoundIndicatorLeft||$notFoundIndicatorRight){result=applyNotFoundIndicators(translationId);}}
if(typeof result!=='undefined'){break;}}
if(!result&&result!==''){result=defaultInterpolator.interpolate(translationId,interpolateParams);if($missingTranslationHandlerFactory&&!pendingLoader){result=translateByHandler(translationId);}}
return result;};$translate.versionInfo=function(){return version;};$translate.loaderCache=function(){return loaderCache;};$translate.directivePriority=function(){return directivePriority;};if($loaderFactory){if(angular.equals($translationTable,{})){$translate.use($translate.use());}
if($fallbackLanguage&&$fallbackLanguage.length){var processAsyncResult=function(translation){translations(translation.key,translation.table);$rootScope.$emit('$translateChangeEnd',{language:translation.key});return translation;};for(var i=0,len=$fallbackLanguage.length;i<len;i++){langPromises[$fallbackLanguage[i]]=loadAsync($fallbackLanguage[i]).then(processAsyncResult);}}}
return $translate;}];}]);angular.module('pascalprecht.translate').factory('$translateDefaultInterpolation',['$interpolate',function($interpolate){var $translateInterpolator={},$locale,$identifier='default',$sanitizeValueStrategy=null,sanitizeValueStrategies={escaped:function(params){var result={};for(var key in params){if(Object.prototype.hasOwnProperty.call(params,key)){if(angular.isNumber(params[key])){result[key]=params[key];}else{result[key]=angular.element('<div></div>').text(params[key]).html();}}}
return result;}};var sanitizeParams=function(params){var result;if(angular.isFunction(sanitizeValueStrategies[$sanitizeValueStrategy])){result=sanitizeValueStrategies[$sanitizeValueStrategy](params);}else{result=params;}
return result;};$translateInterpolator.setLocale=function(locale){$locale=locale;};$translateInterpolator.getInterpolationIdentifier=function(){return $identifier;};$translateInterpolator.useSanitizeValueStrategy=function(value){$sanitizeValueStrategy=value;return this;};$translateInterpolator.interpolate=function(string,interpolateParams){if($sanitizeValueStrategy){interpolateParams=sanitizeParams(interpolateParams);}
return $interpolate(string)(interpolateParams||{});};return $translateInterpolator;}]);angular.module('pascalprecht.translate').constant('$STORAGE_KEY','NG_TRANSLATE_LANG_KEY');angular.module('pascalprecht.translate').directive('translate',['$translate','$q','$interpolate','$compile','$parse','$rootScope',function($translate,$q,$interpolate,$compile,$parse,$rootScope){var trim=function(){return this.replace(/^\s+|\s+$/g,'');};return{restrict:'AE',scope:true,priority:$translate.directivePriority(),compile:function(tElement,tAttr){var translateValuesExist=(tAttr.translateValues)?tAttr.translateValues:undefined;var translateInterpolation=(tAttr.translateInterpolation)?tAttr.translateInterpolation:undefined;var translateValueExist=tElement[0].outerHTML.match(/translate-value-+/i);var interpolateRegExp='^(.*)('+$interpolate.startSymbol()+'.*'+$interpolate.endSymbol()+')(.*)',watcherRegExp='^(.*)'+$interpolate.startSymbol()+'(.*)'+$interpolate.endSymbol()+'(.*)';return function linkFn(scope,iElement,iAttr){scope.interpolateParams={};scope.preText='';scope.postText='';var translationIds={};var observeElementTranslation=function(translationId){if(angular.isFunction(observeElementTranslation._unwatchOld)){observeElementTranslation._unwatchOld();observeElementTranslation._unwatchOld=undefined;}
if(angular.equals(translationId,'')||!angular.isDefined(translationId)){var interpolateMatches=trim.apply(iElement.text()).match(interpolateRegExp);if(angular.isArray(interpolateMatches)){scope.preText=interpolateMatches[1];scope.postText=interpolateMatches[3];translationIds.translate=$interpolate(interpolateMatches[2])(scope.$parent);var watcherMatches=iElement.text().match(watcherRegExp);if(angular.isArray(watcherMatches)&&watcherMatches[2]&&watcherMatches[2].length){observeElementTranslation._unwatchOld=scope.$watch(watcherMatches[2],function(newValue){translationIds.translate=newValue;updateTranslations();});}}else{translationIds.translate=iElement.text().replace(/^\s+|\s+$/g,'');}}else{translationIds.translate=translationId;}
updateTranslations();};var observeAttributeTranslation=function(translateAttr){iAttr.$observe(translateAttr,function(translationId){translationIds[translateAttr]=translationId;updateTranslations();});};var firstAttributeChangedEvent=true;iAttr.$observe('translate',function(translationId){if(typeof translationId==='undefined'){observeElementTranslation('');}else{if(translationId!==''||!firstAttributeChangedEvent){translationIds.translate=translationId;updateTranslations();}}
firstAttributeChangedEvent=false;});for(var translateAttr in iAttr){if(iAttr.hasOwnProperty(translateAttr)&&translateAttr.substr(0,13)==='translateAttr'){observeAttributeTranslation(translateAttr);}}
iAttr.$observe('translateDefault',function(value){scope.defaultText=value;});if(translateValuesExist){iAttr.$observe('translateValues',function(interpolateParams){if(interpolateParams){scope.$parent.$watch(function(){angular.extend(scope.interpolateParams,$parse(interpolateParams)(scope.$parent));});}});}
if(translateValueExist){var observeValueAttribute=function(attrName){iAttr.$observe(attrName,function(value){var attributeName=angular.lowercase(attrName.substr(14,1))+attrName.substr(15);scope.interpolateParams[attributeName]=value;});};for(var attr in iAttr){if(Object.prototype.hasOwnProperty.call(iAttr,attr)&&attr.substr(0,14)==='translateValue'&&attr!=='translateValues'){observeValueAttribute(attr);}}}
var updateTranslations=function(){for(var key in translationIds){if(translationIds.hasOwnProperty(key)){updateTranslation(key,translationIds[key],scope,scope.interpolateParams,scope.defaultText);}}};var updateTranslation=function(translateAttr,translationId,scope,interpolateParams,defaultTranslationText){if(translationId){$translate(translationId,interpolateParams,translateInterpolation,defaultTranslationText).then(function(translation){applyTranslation(translation,scope,true,translateAttr);},function(translationId){applyTranslation(translationId,scope,false,translateAttr);});}else{applyTranslation(translationId,scope,false,translateAttr);}};var applyTranslation=function(value,scope,successful,translateAttr){if(translateAttr==='translate'){if(!successful&&typeof scope.defaultText!=='undefined'){value=scope.defaultText;}
iElement.html(scope.preText+value+scope.postText);var globallyEnabled=$translate.isPostCompilingEnabled();var locallyDefined=typeof tAttr.translateCompile!=='undefined';var locallyEnabled=locallyDefined&&tAttr.translateCompile!=='false';if((globallyEnabled&&!locallyDefined)||locallyEnabled){$compile(iElement.contents())(scope);}}else{if(!successful&&typeof scope.defaultText!=='undefined'){value=scope.defaultText;}
var attributeName=iAttr.$attr[translateAttr].substr(15);iElement.attr(attributeName,value);}};scope.$watch('interpolateParams',updateTranslations,true);var unbind=$rootScope.$on('$translateChangeSuccess',updateTranslations);if(iElement.text().length){observeElementTranslation('');}
updateTranslations();scope.$on('$destroy',unbind);};}};}]);angular.module('pascalprecht.translate').directive('translateCloak',['$rootScope','$translate',function($rootScope,$translate){return{compile:function(tElement){var applyCloak=function(){tElement.addClass($translate.cloakClassName());},removeCloak=function(){tElement.removeClass($translate.cloakClassName());},removeListener=$rootScope.$on('$translateChangeEnd',function(){removeCloak();removeListener();removeListener=null;});applyCloak();return function linkFn(scope,iElement,iAttr){if(iAttr.translateCloak&&iAttr.translateCloak.length){iAttr.$observe('translateCloak',function(translationId){$translate(translationId).then(removeCloak,applyCloak);});}};}};}]);angular.module('pascalprecht.translate').filter('translate',['$parse','$translate',function($parse,$translate){var translateFilter=function(translationId,interpolateParams,interpolation){if(!angular.isObject(interpolateParams)){interpolateParams=$parse(interpolateParams)(this);}
return $translate.instant(translationId,interpolateParams,interpolation);};translateFilter.$stateful=true;return translateFilter;}]);

(function(root){function MessageFormat(locale,pluralFunc,globalName){var lc=locale||'en',lcFile;if(pluralFunc){MessageFormat.locale[lc]=pluralFunc;}else{while(lc&&!MessageFormat.locale.hasOwnProperty(lc)){lc=lc.replace(/[-_]?[^-_]*$/,'');}
if(!lc){lc=locale.replace(/[-_].*$/,'');MessageFormat.loadLocale(lc);}}
this.lc=lc;this.globalName=globalName||'i18n';}
if(!('locale'in MessageFormat))MessageFormat.locale={};MessageFormat.loadLocale=function(lc){try{var lcFile=require('path').join(__dirname,'locale',lc+'.js'),lcStr=(''+require('fs').readFileSync(lcFile)).match(/{[^]*}/);if(!lcStr)throw"no function found in file '"+lcFile+"'";MessageFormat.locale[lc]='function(n)'+lcStr;}catch(ex){if(lc=='en'){MessageFormat.locale[lc]='function(n){return n===1?"one":"other"}';}else{ex.message='Locale '+lc+' could not be loaded: '+ex.message;throw ex;}}};MessageFormat.prototype.functions=function(){var l=[];for(var lc in MessageFormat.locale){if(MessageFormat.locale.hasOwnProperty(lc)){l.push(JSON.stringify(lc)+':'+MessageFormat.locale[lc].toString().trim());}}
return'{lc:{'+l.join(',')+'},\n'
+'c:function(d,k){if(!d)throw new Error("MessageFormat: Data required for \'"+k+"\'.")},\n'
+'n:function(d,k,o){if(isNaN(d[k]))throw new Error("MessageFormat: \'"+k+"\' isn\'t a number.");return d[k]-(o||0)},\n'
+'v:function(d,k){'+this.globalName+'.c(d,k);return d[k]},\n'
+'p:function(d,k,o,l,p){'+this.globalName+'.c(d,k);return d[k] in p?p[d[k]]:(k='+this.globalName+'.lc[l](d[k]-o),k in p?p[k]:p.other)},\n'
+'s:function(d,k,p){'+this.globalName+'.c(d,k);return d[k] in p?p[d[k]]:p.other}}';};var mparser=(function(){function peg$subclass(child,parent){function ctor(){this.constructor=child;}
ctor.prototype=parent.prototype;child.prototype=new ctor();}
function SyntaxError(message,expected,found,offset,line,column){this.message=message;this.expected=expected;this.found=found;this.offset=offset;this.line=line;this.column=column;this.name="SyntaxError";}
peg$subclass(SyntaxError,Error);function parse(input){var options=arguments.length>1?arguments[1]:{},peg$FAILED={},peg$startRuleFunctions={start:peg$parsestart},peg$startRuleFunction=peg$parsestart,peg$c0=function(messageFormatPattern){return{type:"program",program:messageFormatPattern};},peg$c1=peg$FAILED,peg$c2=[],peg$c3=function(s1,inner){var st=[];if(s1&&s1.val){st.push(s1);}
for(var i in inner){if(inner.hasOwnProperty(i)){st.push(inner[i]);}}
return{type:'messageFormatPattern',statements:st};},peg$c4="{",peg$c5={type:"literal",value:"{",description:"\"{\""},peg$c6="}",peg$c7={type:"literal",value:"}",description:"\"}\""},peg$c8=function(mfe,s1){var res=[];if(mfe){res.push(mfe);}
if(s1&&s1.val){res.push(s1);}
return{type:"messageFormatPatternRight",statements:res};},peg$c9=null,peg$c10=",",peg$c11={type:"literal",value:",",description:"\",\""},peg$c12=function(argIdx,efmt){var res={type:"messageFormatElement",argumentIndex:argIdx};if(efmt&&efmt.length){res.elementFormat=efmt[1];}
else{res.output=true;}
return res;},peg$c13="plural",peg$c14={type:"literal",value:"plural",description:"\"plural\""},peg$c15=function(t,s){return{type:"elementFormat",key:t,val:s.val};},peg$c16="select",peg$c17={type:"literal",value:"select",description:"\"select\""},peg$c18=function(pfp){return{type:"pluralStyle",val:pfp};},peg$c19=function(sfp){return{type:"selectStyle",val:sfp};},peg$c20=function(op,pf){var res={type:"pluralFormatPattern",pluralForms:pf};if(op){res.offset=op;}
else{res.offset=0;}
return res;},peg$c21="offset",peg$c22={type:"literal",value:"offset",description:"\"offset\""},peg$c23=":",peg$c24={type:"literal",value:":",description:"\":\""},peg$c25=function(d){return d;},peg$c26=function(pf){return{type:"selectFormatPattern",pluralForms:pf};},peg$c27=function(k,mfp){return{type:"pluralForms",key:k,val:mfp};},peg$c28=function(i){return i;},peg$c29="=",peg$c30={type:"literal",value:"=",description:"\"=\""},peg$c31=function(ws,s){var tmp=[];for(var i=0;i<s.length;++i){for(var j=0;j<s[i].length;++j){tmp.push(s[i][j]);}}
return{type:"string",val:ws+tmp.join('')};},peg$c32=/^[0-9a-zA-Z$_]/,peg$c33={type:"class",value:"[0-9a-zA-Z$_]",description:"[0-9a-zA-Z$_]"},peg$c34=/^[^ \t\n\r,.+={}]/,peg$c35={type:"class",value:"[^ \\t\\n\\r,.+={}]",description:"[^ \\t\\n\\r,.+={}]"},peg$c36=function(s1,s2){return s1+(s2?s2.join(''):'');},peg$c37=function(chars){return chars.join('');},peg$c38=/^[^{}\\\0-\x1F \t\n\r]/,peg$c39={type:"class",value:"[^{}\\\\\\0-\\x1F \\t\\n\\r]",description:"[^{}\\\\\\0-\\x1F \\t\\n\\r]"},peg$c40=function(x){return x;},peg$c41="\\#",peg$c42={type:"literal",value:"\\#",description:"\"\\\\#\""},peg$c43=function(){return"\\#";},peg$c44="\\{",peg$c45={type:"literal",value:"\\{",description:"\"\\\\{\""},peg$c46=function(){return"\u007B";},peg$c47="\\}",peg$c48={type:"literal",value:"\\}",description:"\"\\\\}\""},peg$c49=function(){return"\u007D";},peg$c50="\\u",peg$c51={type:"literal",value:"\\u",description:"\"\\\\u\""},peg$c52=function(h1,h2,h3,h4){return String.fromCharCode(parseInt("0x"+h1+h2+h3+h4));},peg$c53=/^[0-9]/,peg$c54={type:"class",value:"[0-9]",description:"[0-9]"},peg$c55=function(ds){return parseInt((ds.join('')),10);},peg$c56=/^[0-9a-fA-F]/,peg$c57={type:"class",value:"[0-9a-fA-F]",description:"[0-9a-fA-F]"},peg$c58={type:"other",description:"whitespace"},peg$c59=function(w){return w.join('');},peg$c60=/^[ \t\n\r]/,peg$c61={type:"class",value:"[ \\t\\n\\r]",description:"[ \\t\\n\\r]"},peg$currPos=0,peg$reportedPos=0,peg$cachedPos=0,peg$cachedPosDetails={line:1,column:1,seenCR:false},peg$maxFailPos=0,peg$maxFailExpected=[],peg$silentFails=0,peg$result;if("startRule"in options){if(!(options.startRule in peg$startRuleFunctions)){throw new Error("Can't start parsing from rule \""+options.startRule+"\".");}
peg$startRuleFunction=peg$startRuleFunctions[options.startRule];}
function text(){return input.substring(peg$reportedPos,peg$currPos);}
function offset(){return peg$reportedPos;}
function line(){return peg$computePosDetails(peg$reportedPos).line;}
function column(){return peg$computePosDetails(peg$reportedPos).column;}
function expected(description){throw peg$buildException(null,[{type:"other",description:description}],peg$reportedPos);}
function error(message){throw peg$buildException(message,null,peg$reportedPos);}
function peg$computePosDetails(pos){function advance(details,startPos,endPos){var p,ch;for(p=startPos;p<endPos;p++){ch=input.charAt(p);if(ch==="\n"){if(!details.seenCR){details.line++;}
details.column=1;details.seenCR=false;}else if(ch==="\r"||ch==="\u2028"||ch==="\u2029"){details.line++;details.column=1;details.seenCR=true;}else{details.column++;details.seenCR=false;}}}
if(peg$cachedPos!==pos){if(peg$cachedPos>pos){peg$cachedPos=0;peg$cachedPosDetails={line:1,column:1,seenCR:false};}
advance(peg$cachedPosDetails,peg$cachedPos,pos);peg$cachedPos=pos;}
return peg$cachedPosDetails;}
function peg$fail(expected){if(peg$currPos<peg$maxFailPos){return;}
if(peg$currPos>peg$maxFailPos){peg$maxFailPos=peg$currPos;peg$maxFailExpected=[];}
peg$maxFailExpected.push(expected);}
function peg$buildException(message,expected,pos){function cleanupExpected(expected){var i=1;expected.sort(function(a,b){if(a.description<b.description){return-1;}else if(a.description>b.description){return 1;}else{return 0;}});while(i<expected.length){if(expected[i-1]===expected[i]){expected.splice(i,1);}else{i++;}}}
function buildMessage(expected,found){function stringEscape(s){function hex(ch){return ch.charCodeAt(0).toString(16).toUpperCase();}
return s.replace(/\\/g,'\\\\').replace(/"/g,'\\"').replace(/\x08/g,'\\b').replace(/\t/g,'\\t').replace(/\n/g,'\\n').replace(/\f/g,'\\f').replace(/\r/g,'\\r').replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(ch){return'\\x0'+hex(ch);}).replace(/[\x10-\x1F\x80-\xFF]/g,function(ch){return'\\x'+hex(ch);}).replace(/[\u0180-\u0FFF]/g,function(ch){return'\\u0'+hex(ch);}).replace(/[\u1080-\uFFFF]/g,function(ch){return'\\u'+hex(ch);});}
var expectedDescs=new Array(expected.length),expectedDesc,foundDesc,i;for(i=0;i<expected.length;i++){expectedDescs[i]=expected[i].description;}
expectedDesc=expected.length>1?expectedDescs.slice(0,-1).join(", ")
+" or "
+expectedDescs[expected.length-1]:expectedDescs[0];foundDesc=found?"\""+stringEscape(found)+"\"":"end of input";return"Expected "+expectedDesc+" but "+foundDesc+" found.";}
var posDetails=peg$computePosDetails(pos),found=pos<input.length?input.charAt(pos):null;if(expected!==null){cleanupExpected(expected);}
return new SyntaxError(message!==null?message:buildMessage(expected,found),expected,found,pos,posDetails.line,posDetails.column);}
function peg$parsestart(){var s0,s1;s0=peg$currPos;s1=peg$parsemessageFormatPattern();if(s1!==peg$FAILED){peg$reportedPos=s0;s1=peg$c0(s1);}
s0=s1;return s0;}
function peg$parsemessageFormatPattern(){var s0,s1,s2,s3;s0=peg$currPos;s1=peg$parsestring();if(s1!==peg$FAILED){s2=[];s3=peg$parsemessageFormatPatternRight();while(s3!==peg$FAILED){s2.push(s3);s3=peg$parsemessageFormatPatternRight();}
if(s2!==peg$FAILED){peg$reportedPos=s0;s1=peg$c3(s1,s2);s0=s1;}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}
return s0;}
function peg$parsemessageFormatPatternRight(){var s0,s1,s2,s3,s4,s5,s6;s0=peg$currPos;if(input.charCodeAt(peg$currPos)===123){s1=peg$c4;peg$currPos++;}else{s1=peg$FAILED;if(peg$silentFails===0){peg$fail(peg$c5);}}
if(s1!==peg$FAILED){s2=peg$parse_();if(s2!==peg$FAILED){s3=peg$parsemessageFormatElement();if(s3!==peg$FAILED){s4=peg$parse_();if(s4!==peg$FAILED){if(input.charCodeAt(peg$currPos)===125){s5=peg$c6;peg$currPos++;}else{s5=peg$FAILED;if(peg$silentFails===0){peg$fail(peg$c7);}}
if(s5!==peg$FAILED){s6=peg$parsestring();if(s6!==peg$FAILED){peg$reportedPos=s0;s1=peg$c8(s3,s6);s0=s1;}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}
return s0;}
function peg$parsemessageFormatElement(){var s0,s1,s2,s3,s4;s0=peg$currPos;s1=peg$parseid();if(s1!==peg$FAILED){s2=peg$currPos;if(input.charCodeAt(peg$currPos)===44){s3=peg$c10;peg$currPos++;}else{s3=peg$FAILED;if(peg$silentFails===0){peg$fail(peg$c11);}}
if(s3!==peg$FAILED){s4=peg$parseelementFormat();if(s4!==peg$FAILED){s3=[s3,s4];s2=s3;}else{peg$currPos=s2;s2=peg$c1;}}else{peg$currPos=s2;s2=peg$c1;}
if(s2===peg$FAILED){s2=peg$c9;}
if(s2!==peg$FAILED){peg$reportedPos=s0;s1=peg$c12(s1,s2);s0=s1;}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}
return s0;}
function peg$parseelementFormat(){var s0,s1,s2,s3,s4,s5,s6,s7;s0=peg$currPos;s1=peg$parse_();if(s1!==peg$FAILED){if(input.substr(peg$currPos,6)===peg$c13){s2=peg$c13;peg$currPos+=6;}else{s2=peg$FAILED;if(peg$silentFails===0){peg$fail(peg$c14);}}
if(s2!==peg$FAILED){s3=peg$parse_();if(s3!==peg$FAILED){if(input.charCodeAt(peg$currPos)===44){s4=peg$c10;peg$currPos++;}else{s4=peg$FAILED;if(peg$silentFails===0){peg$fail(peg$c11);}}
if(s4!==peg$FAILED){s5=peg$parse_();if(s5!==peg$FAILED){s6=peg$parsepluralStyle();if(s6!==peg$FAILED){s7=peg$parse_();if(s7!==peg$FAILED){peg$reportedPos=s0;s1=peg$c15(s2,s6);s0=s1;}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}
if(s0===peg$FAILED){s0=peg$currPos;s1=peg$parse_();if(s1!==peg$FAILED){if(input.substr(peg$currPos,6)===peg$c16){s2=peg$c16;peg$currPos+=6;}else{s2=peg$FAILED;if(peg$silentFails===0){peg$fail(peg$c17);}}
if(s2!==peg$FAILED){s3=peg$parse_();if(s3!==peg$FAILED){if(input.charCodeAt(peg$currPos)===44){s4=peg$c10;peg$currPos++;}else{s4=peg$FAILED;if(peg$silentFails===0){peg$fail(peg$c11);}}
if(s4!==peg$FAILED){s5=peg$parse_();if(s5!==peg$FAILED){s6=peg$parseselectStyle();if(s6!==peg$FAILED){s7=peg$parse_();if(s7!==peg$FAILED){peg$reportedPos=s0;s1=peg$c15(s2,s6);s0=s1;}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}}
return s0;}
function peg$parsepluralStyle(){var s0,s1;s0=peg$currPos;s1=peg$parsepluralFormatPattern();if(s1!==peg$FAILED){peg$reportedPos=s0;s1=peg$c18(s1);}
s0=s1;return s0;}
function peg$parseselectStyle(){var s0,s1;s0=peg$currPos;s1=peg$parseselectFormatPattern();if(s1!==peg$FAILED){peg$reportedPos=s0;s1=peg$c19(s1);}
s0=s1;return s0;}
function peg$parsepluralFormatPattern(){var s0,s1,s2,s3;s0=peg$currPos;s1=peg$parseoffsetPattern();if(s1===peg$FAILED){s1=peg$c9;}
if(s1!==peg$FAILED){s2=[];s3=peg$parsepluralForms();while(s3!==peg$FAILED){s2.push(s3);s3=peg$parsepluralForms();}
if(s2!==peg$FAILED){peg$reportedPos=s0;s1=peg$c20(s1,s2);s0=s1;}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}
return s0;}
function peg$parseoffsetPattern(){var s0,s1,s2,s3,s4,s5,s6,s7;s0=peg$currPos;s1=peg$parse_();if(s1!==peg$FAILED){if(input.substr(peg$currPos,6)===peg$c21){s2=peg$c21;peg$currPos+=6;}else{s2=peg$FAILED;if(peg$silentFails===0){peg$fail(peg$c22);}}
if(s2!==peg$FAILED){s3=peg$parse_();if(s3!==peg$FAILED){if(input.charCodeAt(peg$currPos)===58){s4=peg$c23;peg$currPos++;}else{s4=peg$FAILED;if(peg$silentFails===0){peg$fail(peg$c24);}}
if(s4!==peg$FAILED){s5=peg$parse_();if(s5!==peg$FAILED){s6=peg$parsedigits();if(s6!==peg$FAILED){s7=peg$parse_();if(s7!==peg$FAILED){peg$reportedPos=s0;s1=peg$c25(s6);s0=s1;}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}
return s0;}
function peg$parseselectFormatPattern(){var s0,s1,s2;s0=peg$currPos;s1=[];s2=peg$parsepluralForms();while(s2!==peg$FAILED){s1.push(s2);s2=peg$parsepluralForms();}
if(s1!==peg$FAILED){peg$reportedPos=s0;s1=peg$c26(s1);}
s0=s1;return s0;}
function peg$parsepluralForms(){var s0,s1,s2,s3,s4,s5,s6,s7,s8;s0=peg$currPos;s1=peg$parse_();if(s1!==peg$FAILED){s2=peg$parsestringKey();if(s2!==peg$FAILED){s3=peg$parse_();if(s3!==peg$FAILED){if(input.charCodeAt(peg$currPos)===123){s4=peg$c4;peg$currPos++;}else{s4=peg$FAILED;if(peg$silentFails===0){peg$fail(peg$c5);}}
if(s4!==peg$FAILED){s5=peg$parse_();if(s5!==peg$FAILED){s6=peg$parsemessageFormatPattern();if(s6!==peg$FAILED){s7=peg$parse_();if(s7!==peg$FAILED){if(input.charCodeAt(peg$currPos)===125){s8=peg$c6;peg$currPos++;}else{s8=peg$FAILED;if(peg$silentFails===0){peg$fail(peg$c7);}}
if(s8!==peg$FAILED){peg$reportedPos=s0;s1=peg$c27(s2,s6);s0=s1;}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}
return s0;}
function peg$parsestringKey(){var s0,s1,s2;s0=peg$currPos;s1=peg$parseid();if(s1!==peg$FAILED){peg$reportedPos=s0;s1=peg$c28(s1);}
s0=s1;if(s0===peg$FAILED){s0=peg$currPos;if(input.charCodeAt(peg$currPos)===61){s1=peg$c29;peg$currPos++;}else{s1=peg$FAILED;if(peg$silentFails===0){peg$fail(peg$c30);}}
if(s1!==peg$FAILED){s2=peg$parsedigits();if(s2!==peg$FAILED){peg$reportedPos=s0;s1=peg$c25(s2);s0=s1;}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}}
return s0;}
function peg$parsestring(){var s0,s1,s2,s3,s4,s5,s6;s0=peg$currPos;s1=peg$parse_();if(s1!==peg$FAILED){s2=[];s3=peg$currPos;s4=peg$parse_();if(s4!==peg$FAILED){s5=peg$parsechars();if(s5!==peg$FAILED){s6=peg$parse_();if(s6!==peg$FAILED){s4=[s4,s5,s6];s3=s4;}else{peg$currPos=s3;s3=peg$c1;}}else{peg$currPos=s3;s3=peg$c1;}}else{peg$currPos=s3;s3=peg$c1;}
while(s3!==peg$FAILED){s2.push(s3);s3=peg$currPos;s4=peg$parse_();if(s4!==peg$FAILED){s5=peg$parsechars();if(s5!==peg$FAILED){s6=peg$parse_();if(s6!==peg$FAILED){s4=[s4,s5,s6];s3=s4;}else{peg$currPos=s3;s3=peg$c1;}}else{peg$currPos=s3;s3=peg$c1;}}else{peg$currPos=s3;s3=peg$c1;}}
if(s2!==peg$FAILED){peg$reportedPos=s0;s1=peg$c31(s1,s2);s0=s1;}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}
return s0;}
function peg$parseid(){var s0,s1,s2,s3,s4;s0=peg$currPos;s1=peg$parse_();if(s1!==peg$FAILED){if(peg$c32.test(input.charAt(peg$currPos))){s2=input.charAt(peg$currPos);peg$currPos++;}else{s2=peg$FAILED;if(peg$silentFails===0){peg$fail(peg$c33);}}
if(s2!==peg$FAILED){s3=[];if(peg$c34.test(input.charAt(peg$currPos))){s4=input.charAt(peg$currPos);peg$currPos++;}else{s4=peg$FAILED;if(peg$silentFails===0){peg$fail(peg$c35);}}
while(s4!==peg$FAILED){s3.push(s4);if(peg$c34.test(input.charAt(peg$currPos))){s4=input.charAt(peg$currPos);peg$currPos++;}else{s4=peg$FAILED;if(peg$silentFails===0){peg$fail(peg$c35);}}}
if(s3!==peg$FAILED){s4=peg$parse_();if(s4!==peg$FAILED){peg$reportedPos=s0;s1=peg$c36(s2,s3);s0=s1;}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}
return s0;}
function peg$parsechars(){var s0,s1,s2;s0=peg$currPos;s1=[];s2=peg$parsechar();if(s2!==peg$FAILED){while(s2!==peg$FAILED){s1.push(s2);s2=peg$parsechar();}}else{s1=peg$c1;}
if(s1!==peg$FAILED){peg$reportedPos=s0;s1=peg$c37(s1);}
s0=s1;return s0;}
function peg$parsechar(){var s0,s1,s2,s3,s4,s5;s0=peg$currPos;if(peg$c38.test(input.charAt(peg$currPos))){s1=input.charAt(peg$currPos);peg$currPos++;}else{s1=peg$FAILED;if(peg$silentFails===0){peg$fail(peg$c39);}}
if(s1!==peg$FAILED){peg$reportedPos=s0;s1=peg$c40(s1);}
s0=s1;if(s0===peg$FAILED){s0=peg$currPos;if(input.substr(peg$currPos,2)===peg$c41){s1=peg$c41;peg$currPos+=2;}else{s1=peg$FAILED;if(peg$silentFails===0){peg$fail(peg$c42);}}
if(s1!==peg$FAILED){peg$reportedPos=s0;s1=peg$c43();}
s0=s1;if(s0===peg$FAILED){s0=peg$currPos;if(input.substr(peg$currPos,2)===peg$c44){s1=peg$c44;peg$currPos+=2;}else{s1=peg$FAILED;if(peg$silentFails===0){peg$fail(peg$c45);}}
if(s1!==peg$FAILED){peg$reportedPos=s0;s1=peg$c46();}
s0=s1;if(s0===peg$FAILED){s0=peg$currPos;if(input.substr(peg$currPos,2)===peg$c47){s1=peg$c47;peg$currPos+=2;}else{s1=peg$FAILED;if(peg$silentFails===0){peg$fail(peg$c48);}}
if(s1!==peg$FAILED){peg$reportedPos=s0;s1=peg$c49();}
s0=s1;if(s0===peg$FAILED){s0=peg$currPos;if(input.substr(peg$currPos,2)===peg$c50){s1=peg$c50;peg$currPos+=2;}else{s1=peg$FAILED;if(peg$silentFails===0){peg$fail(peg$c51);}}
if(s1!==peg$FAILED){s2=peg$parsehexDigit();if(s2!==peg$FAILED){s3=peg$parsehexDigit();if(s3!==peg$FAILED){s4=peg$parsehexDigit();if(s4!==peg$FAILED){s5=peg$parsehexDigit();if(s5!==peg$FAILED){peg$reportedPos=s0;s1=peg$c52(s2,s3,s4,s5);s0=s1;}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}}else{peg$currPos=s0;s0=peg$c1;}}}}}
return s0;}
function peg$parsedigits(){var s0,s1,s2;s0=peg$currPos;s1=[];if(peg$c53.test(input.charAt(peg$currPos))){s2=input.charAt(peg$currPos);peg$currPos++;}else{s2=peg$FAILED;if(peg$silentFails===0){peg$fail(peg$c54);}}
if(s2!==peg$FAILED){while(s2!==peg$FAILED){s1.push(s2);if(peg$c53.test(input.charAt(peg$currPos))){s2=input.charAt(peg$currPos);peg$currPos++;}else{s2=peg$FAILED;if(peg$silentFails===0){peg$fail(peg$c54);}}}}else{s1=peg$c1;}
if(s1!==peg$FAILED){peg$reportedPos=s0;s1=peg$c55(s1);}
s0=s1;return s0;}
function peg$parsehexDigit(){var s0;if(peg$c56.test(input.charAt(peg$currPos))){s0=input.charAt(peg$currPos);peg$currPos++;}else{s0=peg$FAILED;if(peg$silentFails===0){peg$fail(peg$c57);}}
return s0;}
function peg$parse_(){var s0,s1,s2;peg$silentFails++;s0=peg$currPos;s1=[];s2=peg$parsewhitespace();while(s2!==peg$FAILED){s1.push(s2);s2=peg$parsewhitespace();}
if(s1!==peg$FAILED){peg$reportedPos=s0;s1=peg$c59(s1);}
s0=s1;peg$silentFails--;if(s0===peg$FAILED){s1=peg$FAILED;if(peg$silentFails===0){peg$fail(peg$c58);}}
return s0;}
function peg$parsewhitespace(){var s0;if(peg$c60.test(input.charAt(peg$currPos))){s0=input.charAt(peg$currPos);peg$currPos++;}else{s0=peg$FAILED;if(peg$silentFails===0){peg$fail(peg$c61);}}
return s0;}
peg$result=peg$startRuleFunction();if(peg$result!==peg$FAILED&&peg$currPos===input.length){return peg$result;}else{if(peg$result!==peg$FAILED&&peg$currPos<input.length){peg$fail({type:"end",description:"end of input"});}
throw peg$buildException(null,peg$maxFailExpected,peg$maxFailPos);}}
return{SyntaxError:SyntaxError,parse:parse};})();MessageFormat.prototype.parse=function(){return mparser.parse.apply(mparser,arguments);};MessageFormat.prototype.precompile=function(ast){var self=this,needOther=false;function _next(data){var res=JSON.parse(JSON.stringify(data));res.pf_count++;return res;}
function interpMFP(ast,data){data=data||{keys:{},offset:{}};var r=[],i,tmp;switch(ast.type){case'program':return interpMFP(ast.program);case'messageFormatPattern':for(i=0;i<ast.statements.length;++i){r.push(interpMFP(ast.statements[i],data));}
tmp=r.join('+')||'""';return data.pf_count?tmp:'function(d){return '+tmp+'}';case'messageFormatPatternRight':for(i=0;i<ast.statements.length;++i){r.push(interpMFP(ast.statements[i],data));}
return r.join('+');case'messageFormatElement':data.pf_count=data.pf_count||0;if(ast.output){return self.globalName+'.v(d,"'+ast.argumentIndex+'")';}
else{data.keys[data.pf_count]='"'+ast.argumentIndex+'"';return interpMFP(ast.elementFormat,data);}
return'';case'elementFormat':if(ast.key==='select'){return self.globalName+'.s(d,'+data.keys[data.pf_count]+','+interpMFP(ast.val,data)+')';}
else if(ast.key==='plural'){data.offset[data.pf_count||0]=ast.val.offset||0;return self.globalName+'.p(d,'+data.keys[data.pf_count]+','+(data.offset[data.pf_count]||0)
+',"'+self.lc+'",'+interpMFP(ast.val,data)+')';}
return'';case'pluralFormatPattern':data.pf_count=data.pf_count||0;needOther=true;for(i=0;i<ast.pluralForms.length;++i){if(ast.pluralForms[i].key==='other'){needOther=false;}
r.push('"'+ast.pluralForms[i].key+'":'+interpMFP(ast.pluralForms[i].val,_next(data)));}
if(needOther){throw new Error("No 'other' form found in pluralFormatPattern "+data.pf_count);}
return'{'+r.join(',')+'}';case'selectFormatPattern':data.pf_count=data.pf_count||0;data.offset[data.pf_count]=0;needOther=true;for(i=0;i<ast.pluralForms.length;++i){if(ast.pluralForms[i].key==='other'){needOther=false;}
r.push('"'+ast.pluralForms[i].key+'":'+interpMFP(ast.pluralForms[i].val,_next(data)));}
if(needOther){throw new Error("No 'other' form found in selectFormatPattern "+data.pf_count);}
return'{'+r.join(',')+'}';case'string':tmp='"'+(ast.val||"").replace(/\n/g,'\\n').replace(/"/g,'\\"')+'"';if(data.pf_count){var o=data.offset[data.pf_count-1];tmp=tmp.replace(/(^|[^\\])#/g,'$1"+'+self.globalName+'.n(d,'+data.keys[data.pf_count-1]+(o?','+o:'')+')+"');tmp=tmp.replace(/^""\+/,'').replace(/\+""$/,'');}
return tmp;default:throw new Error('Bad AST type: '+ast.type);}}
return interpMFP(ast);};MessageFormat.prototype.compile=function(message){return(new Function('this[\''+this.globalName+'\']='+this.functions()+';'+'return '+this.precompile(this.parse(message))))();};MessageFormat.prototype.precompileObject=function(messages){var tmp=[];for(var key in messages){tmp.push(JSON.stringify(key)+':'+this.precompile(this.parse(messages[key])));}
return'{\n'+tmp.join(',\n')+'}';};if(typeof exports!=='undefined'){if(typeof module!=='undefined'&&module.exports){exports=module.exports=MessageFormat;}
exports.MessageFormat=MessageFormat;}
else if(typeof define==='function'&&define.amd){define(function(){return MessageFormat;});}
else{root['MessageFormat']=MessageFormat;}})(this);

MessageFormat.locale.en=function(n){return n===1?"one":"other"}

angular.module('pascalprecht.translate').constant('TRANSLATE_MF_INTERPOLATION_CACHE','$translateMessageFormatInterpolation').factory('$translateMessageFormatInterpolation',['$cacheFactory','TRANSLATE_MF_INTERPOLATION_CACHE',function($cacheFactory,TRANSLATE_MF_INTERPOLATION_CACHE){var $translateInterpolator={},$cache=$cacheFactory.get(TRANSLATE_MF_INTERPOLATION_CACHE),$mf=new MessageFormat('en'),$identifier='messageformat',$sanitizeValueStrategy=null,sanitizeValueStrategies={escaped:function(params){var result={};for(var key in params){if(Object.prototype.hasOwnProperty.call(params,key)){result[key]=angular.element('<div></div>').text(params[key]).html();}}
return result;}};var sanitizeParams=function(params){var result;if(angular.isFunction(sanitizeValueStrategies[$sanitizeValueStrategy])){result=sanitizeValueStrategies[$sanitizeValueStrategy](params);}else{result=params;}
return result;};if(!$cache){$cache=$cacheFactory(TRANSLATE_MF_INTERPOLATION_CACHE);}
$cache.put('en',$mf);$translateInterpolator.setLocale=function(locale){$mf=$cache.get(locale);if(!$mf){$mf=new MessageFormat(locale);$cache.put(locale,$mf);}};$translateInterpolator.getInterpolationIdentifier=function(){return $identifier;};$translateInterpolator.useSanitizeValueStrategy=function(value){$sanitizeValueStrategy=value;return this;};$translateInterpolator.interpolate=function(string,interpolateParams){interpolateParams=interpolateParams||{};if($sanitizeValueStrategy){interpolateParams=sanitizeParams(interpolateParams);}
var interpolatedText=$cache.get(string+angular.toJson(interpolateParams));if(!interpolatedText){interpolatedText=$mf.compile(string)(interpolateParams);$cache.put(string+angular.toJson(interpolateParams),interpolatedText);}
return interpolatedText;};return $translateInterpolator;}]);
;(function(angular){'use strict';angular.module('li.services.plugins.localization-manager',['li.services.rest.rest-manager','li.services.community.context-manager','li.services.cache.localstorage-cache-manager','pascalprecht.translate']).config(['$translateProvider',function($translateProvider){$translateProvider.useLoader('$liLocalizationManager',{});$translateProvider.preferredLanguage('en');$translateProvider.addInterpolation('$translateMessageFormatInterpolation');}]).factory('$liLocalizationManager',['$liRestManager','$log','$q','$rootScope','$liContextManager','$timeout','$translate','$liLocalstorageCacheManager',function($liRestManager,$log,$q,$rootScope,$liContextManager,$timeout,$translate,$liLocalstorageCacheManager){var textdata={li:{}};var groups={};var nodeId=$liContextManager.coreNode().id;var nodeType=$liContextManager.coreNode().type;var promises=[];var groupsLoaded=[];var groupLoadedCbs={};var cache=false;if($liContextManager.config().phase==='prod'){var cachekey='$liLocalizationManager'+'::revision::'+$liContextManager.config()['app.revision']+'::lang::'+$liContextManager.currentUserSettings()['profile.language'];cache=$liLocalstorageCacheManager(cachekey,{capacity:30});}
function getGroup(group){if(!textdata.li.hasOwnProperty(group)){textdata.li[group]={};var params={group:'ng-'+group};if(nodeId&&nodeType&&nodeType!=='community'){params[nodeType+'.id']=nodeId;}
return $liRestManager.request('/ui/lang/:group',params,{},'GET',cache).then(function(response){if(response.data&&response.data.li){angular.extend(textdata.li[group],response.data.li[group]);groupsLoaded.push(group);if(groupLoadedCbs[group]){angular.forEach(groupLoadedCbs[group],function(cb){cb();});}}else{$log.error('Error loading text keys data for group: ['+group+']',response);}}).catch(function(){$log.error('Error while getting text keys data for group: '+group);});}else{return $q.when();}}
function service(){angular.forEach(groups,function(val,group){if(!groups[group]){groups[group]=getGroup(group);}
promises.push(groups[group]);});if(promises.length>0){return $q.all(promises).then(function(){return textdata;});}else{return $q.when(textdata);}}
function addPart(group){if(!groups.hasOwnProperty(group)){groups[group]=false;$translate.refresh();}}
function loaded(checkGroups){var isLoaded=true;angular.forEach(checkGroups,function(checkGroup){if(groupsLoaded.indexOf(checkGroup)===-1){isLoaded=false;}});return isLoaded;}
function onLoad(loadGroups,cb){loadGroups=angular.isArray(loadGroups)?loadGroups:[loadGroups];angular.forEach(loadGroups,function(loadGroup){if(groupsLoaded.indexOf(loadGroup)===-1){groupLoadedCbs[loadGroup]=groupLoadedCbs[loadGroup]||[];groupLoadedCbs[loadGroup].push(cb);}else{cb();}});}
function loadGroupFromKey(key){var group;if(key&&key.length>0){var parts=key.split('.');if(parts.length>1&&parts[0]==='li'){group=parts[1];addPart(group);}}
return group;}
function translate(translationId,interpolateParams,interpolation){var defer=$q.defer();onLoad(loadGroupFromKey(translationId),function(){$timeout(function(){$translate(translationId,interpolateParams,interpolation).then(defer.resolve);});});return defer.promise;}
service.addPart=addPart;service.loaded=loaded;service.onLoad=onLoad;service.loadGroupFromKey=loadGroupFromKey;service.translate=translate;return service;}]).filter('translate',['$parse','$translate','$liLocalizationManager','$liContextManager',function($parse,$translate,$liLocalizationManager,$liContextManager){function translateFilter(translationId,interpolateParams,interpolation){var showTextKeys=$liContextManager.server().show_text_keys;$liLocalizationManager.loadGroupFromKey(translationId);if(!angular.isObject(interpolateParams)){interpolateParams=$parse(interpolateParams)();}
return showTextKeys===true?translationId:$translate.instant(translationId,interpolateParams,interpolation);}
translateFilter.$stateful=true;return translateFilter;}]);})(window.LITHIUM&&LITHIUM.angular||angular);
;(function(angular){'use strict';angular.module('li.filters.formatting.date',['li.services.community.context-manager']).filter('liDate',['$filter','$liContextManager',function($filter,$liContextManager){var currentUserSettings=$liContextManager.currentUserSettings();var friendlyDatesEnabled=currentUserSettings['layout.friendly_dates_enabled'];var datePattern=currentUserSettings['layout.format_pattern_date'];var timePattern='h:mm a';return function(date,friendlyDate,dateOnly,timeOnly){if(friendlyDate!==undefined&&friendlyDate!==null&&friendlyDatesEnabled){return friendlyDate;}
if(dateOnly){return $filter('date')(date,datePattern);}
if(timeOnly){return $filter('date')(date,timePattern);}
return $filter('date')(date,datePattern+' '+timePattern);};}]);})(window.LITHIUM&&LITHIUM.angular||angular);
;(function(angular){'use strict';angular.module('li.filters.formatting.unsafe',[]).filter('liUnsafe',['$sce',function($sce){return function(val){return $sce.trustAsHtml(val);};}]);})(window.LITHIUM&&LITHIUM.angular||angular);
;(function(angular){'use strict';angular.module('li.directives.common.text-ready',['li.services.plugins.localization-manager']).directive('liCommonTextReady',['$liLocalizationManager','$timeout',function($liLocalizationManager,$timeout){return{restrict:'A',link:function link($scope,$element,$attrs){var checkGroups=$scope.$eval($attrs.liCommonTextReady);checkGroups=angular.isArray(checkGroups)?checkGroups:[checkGroups];$element.addClass('lia-not-ready');$liLocalizationManager.onLoad(checkGroups,function check(){$element.toggleClass('lia-not-ready',!$liLocalizationManager.loaded(checkGroups));});$timeout(function(){angular.forEach(checkGroups,function(group){$liLocalizationManager.addPart(group);});});}};}]);})(window.LITHIUM&&LITHIUM.angular||angular);
;(function(angular){'use strict';angular.module('li.directives.media.publishing-history',['li.services.messages.message-manager','li.services.utils.param-utils','li.services.plugins.localization-manager','li.filters.formatting.date','li.filters.formatting.unsafe','li.directives.common.text-ready']).directive('liMediaPublishingHistory',['$liMessageManager','$liParamUtils','$filter',function($liMessageManager,$liParamUtils,$filter){return{scope:{imageId:'=liImageId'},restrict:'AE',templateUrl:'media/publishing-history/publishing-history.tpl.html',link:function link($scope){$scope.showPublishingHistory=false;if(!$liParamUtils.validateParams('liMediaPublishingHistory',$scope,['imageId'])){return;}
function loadMessages(){$liMessageManager.getMessagesForImage($scope.imageId,['id','subject','view_href','post_time','post_time_friendly','board.title','board.view_href','replies.count(*)'],100).then(function(messages){$scope.messages=messages;});}
loadMessages();$scope.getPostDate=function(msg){return $filter('liDate')(msg.post_time,msg.post_time_friendly);};$scope.$watch('imageId',loadMessages);}};}]);})(window.LITHIUM&&LITHIUM.angular||angular);

angular.module('li.directives.media.publishing-history').run(['$templateCache',function($templateCache){$templateCache.put('media/publishing-history/publishing-history.tpl.html','<div class="lia-media-publishing-history" ng-show="messages.length > 0" li-common-text-ready="\'media\'">\n'+'  <span class="lia-publishing-history-title">{{\'li.media.publishing-history.title\'|translate}}</span>\n'+'    <ul class="lia-publishing-history-items">\n'+'      <li class="lia-publishing-history-item" ng-repeat="message in messages track by $index">\n'+'          <div class="lia-publishing-history-item-header lia-publishing-history-row"\n'+'               ng-bind-html="\'li.media.publishing-history.date-and-board\'|translate:{date:getPostDate(message),\n'+'               boardLink: message.board.view_href, boardTitle:message.board.title}:\'messageformat\'|liUnsafe">\n'+'          </div>\n'+'          <a class="lia-publishing-history-item-subject lia-publishing-history-row" ng-href="{{message.view_href}}">{{message.subject}}</a>\n'+'          {{\'li.media.publishing-history.reply-count\'|translate:{count:message.replies.count}:\'messageformat\'}}\n'+'      </li>\n'+'    </ul>\n'+'</div>\n'+'');}]);
;(function(angular){'use strict';angular.module('li.directives.users.user-login',[]).directive('liUsersUserLogin',function(){return{templateUrl:'users/user-login/user-login.tpl.html',restrict:'EA',replace:true,scope:{user:'='}};});})(window.LITHIUM&&LITHIUM.angular||angular);

angular.module('li.directives.users.user-login').run(['$templateCache',function($templateCache){$templateCache.put('users/user-login/user-login.tpl.html','<span class="lia-users-user-login UserName lia-user-name" ng-class="{\'lia-anonymous-user\': !user.view_href}">\n'+'  <img ng-src="{{user.rank.icon_left}}" ng-if="user.rank.icon_left" class="lia-user-rank-icon lia-user-rank-icon-left" />\n'+'  <a class="lia-user-login lia-user-name-link lia-link-navigation"\n'+'     ng-class="{\'login-bold\': user.rank.bold}"\n'+'     ng-style="user.rank.color && {\'color\': \'#\' + user.rank.color }"\n'+'     ng-href="{{user.view_href}}"\n'+'     target="_self"\n'+'     ng-if="user.view_href">{{user.login}}</a>\n'+'  <span class="lia-user-login lia-user-name-link lia-link-disabled"\n'+'        ng-class="{\'login-bold\': user.rank.bold}"\n'+'        ng-style="user.rank.color && {\'color\': \'#\' + user.rank.color }"\n'+'        ng-if="!user.view_href">{{user.login}}</span>\n'+'  <img ng-src="{{user.rank.icon_right}}" ng-if="user.rank.icon_right" class="lia-user-rank-icon lia-user-rank-icon-right" />\n'+'</span>\n'+'');}]);
;(function(angular){'use strict';angular.module('li.services.auth.authentication-manager',['li.services.rest.rest-manager','li.services.utils.url-manager','li.services.community.context-manager']).factory('$liAuthenticationManager',['$liContextManager','$liUrlManager','$location','$window',function($liContextManager,$liUrlManager,$location,$window){var page=$liContextManager.page();var loginUrls={default:page.auth_urls.login_url,notRegistered:page.auth_urls.login_url_not_registered_dest_tpl};function deleteStaleUserAction(pageName){var pageNames=['UserLoginPage','UserRegistrationPage','ForgotPasswordPage','UserResetPasswordPage','MobileUserLoginPage','MobileUserRegistrationPage','MobileForgotPasswordPage','MobileUserResetPasswordPage','MobileVerifyUserEmailPage'];for(var i in pageNames){if(pageNames[i]===pageName){return;}}
var isActionRecent=localStorage.getItem('li:is-action-recent');if(isActionRecent!==null){if(isActionRecent==='true'){localStorage.setItem('li:is-action-recent','false');}else{var savedAction=localStorage.getItem('li:action');if(savedAction!==null){localStorage.removeItem(savedAction);}
localStorage.removeItem('li:is-action-recent');localStorage.removeItem('li:action');}}}
deleteStaleUserAction($liContextManager.page().name);return{getCurrentUser:function getCurrentUser(){return $liContextManager.currentUser();},login:function login(reason){reason=reason||'default';var bldr=$liUrlManager.adjustUrl(loginUrls[reason]);bldr.compileQueryParams({destUrl:$location.absUrl()});$window.location.href=bldr.build();},saveUserActionAndLogin:function saveUserActionAndLogin(action,params){localStorage.setItem('li:is-action-recent','true');localStorage.setItem('li:action',action);localStorage.setItem(action,JSON.stringify(params));this.login('notRegistered');},retrieveUserAction:function retrieveUserAction(action){var paramString=localStorage.getItem(action);if(paramString!==null){localStorage.removeItem('li:is-action-recent');localStorage.removeItem('li:action');localStorage.removeItem(action);return JSON.parse(paramString);}else{return null;}}};}]);})(window.LITHIUM&&LITHIUM.angular||angular);
;(function(angular){'use strict';angular.module('li.services.kudos.kudos-manager',['li.services.rest.rest-manager','li.services.auth.authentication-manager','li.services.rest.liql','li.services.utils.lodash-utils','li.services.community.context-manager','li.services.utils.url-manager']).constant('$liKudosManagerConfig',{stateMap:{100:'actionable',101:'denied',103:'feature_disabled',104:'disabled',105:'frozen',self:'self',actioned:'actioned'}}).factory('$liKudosManager',['$liql','$liRestManager','$liKudosManagerConfig','$liContextManager','$liLodashUtils','$liAuthenticationManager','$q','$document',function($liql,$liRestManager,$liKudosManagerConfig,$liContextManager,$liLodashUtils,$liAuthenticationManager,$q,$document){var cache={};var user=$liContextManager.currentUser();var isContest=$liContextManager.coreNode().conversation_style==='contest';var isOneKudoPerContest=$liContextManager.currentUserSettings()['contest.one_kudo_per_contest'];var limitToSingleKudoPerNode=isContest&&isOneKudoPerContest;var $body=angular.element($document[0].body);if(limitToSingleKudoPerNode){$body.addClass('lia-kudo-single-vote');}
function isOwner(entity){return $liLodashUtils.get(entity,'owner.id',-1)===user.id;}
function hasGivenKudos(entity){var cacheVal=getFromCache(entity);if($liLodashUtils.has(cacheVal,'hasGiven')){return $q.when(cacheVal.hasGiven);}
return $liql().select('*').from('kudos').where(entity.type+'.id').eq(entity.id).and('user.id').eq(user.id+'').exec().unwrap().then(function(item){var hasGiven=item.length>0;updateCache(entity,{hasGiven:hasGiven});return hasGiven;});}
function getKudosWeight(entity){var cacheVal=getFromCache(entity);if($liLodashUtils.has(cacheVal,'weight')){return cacheVal.weight;}else if($liLodashUtils.has(entity,'kudos.sum.weight')){updateCache(entity,{weight:entity.kudos.sum.weight});return entity.kudos.sum.weight;}
return $liql().select('kudos.sum(weight)').from(entity.type+'s').where('id').eq(entity.id).exec().first().then(function(obj){$liLodashUtils.set(entity,'kudos.sum.weight',obj.kudos.sum.weight);updateCache(entity,{weight:obj.kudos.sum.weight});return obj.kudos.sum.weight;});}
function getKudosAllowed(entity,force){var cacheVal=getFromCache(entity);if($liLodashUtils.has(cacheVal,'allowed')&&!force){return $q.when(cacheVal.allowed);}
return $liRestManager.request('/allowed',{method:'post',path:'/'+entity.type+'s/'+entity.id+'/kudos'},'get').then(function(response){var reason=$liKudosManagerConfig.stateMap[response.data.reason_code];if(reason==='feature_disabled'||reason==='disabled'){return reason;}else if(user.is_anonymous){return'anon';}else if(isOwner(entity)){return'self';}else{return hasGivenKudos(entity).then(function(given){if(given){return'actioned';}else{return reason;}});}}).then(function(allowed){updateCache(entity,{allowed:allowed});return allowed;});}
function giveOrRevokeKudos(entity){if(user.is_anonymous){$liAuthenticationManager.saveUserActionAndLogin(buildLoginActionId(entity),{});return $q.defer().promise;}else{return hasGivenKudos(entity).then(function(hasGiven){var method=hasGiven?'delete':'post';return $liRestManager.request('/'+entity.type+'s/:id/kudos',{id:entity.id},{data:{type:'kudo'}},method).then(function(response){var allowed=hasGiven?'actionable':'actioned';if($liLodashUtils.has(entity,'kudos.sum.weight')){var modifier=hasGiven?-response.data.weight:response.data.weight;entity.kudos.sum.weight+=modifier;updateCache(entity,{hasGiven:!hasGiven,allowed:allowed,weight:entity.kudos.sum.weight});}
if(limitToSingleKudoPerNode){angular.forEach(Object.keys(cache),function(key){var item=cache[key];if(item.entity.id!==entity.id){var newState;if(!hasGiven){newState='denied';updateCache(item.entity,{previousAllowed:item.allowed,allowed:newState});if(item.refreshCallback){item.refreshCallback(newState);}}else{if(item.previousAllowed){newState=item.previousAllowed;updateCache(item.entity,{allowed:newState});if(item.refreshCallback){item.refreshCallback(newState);}}else{getKudosAllowed(item.entity,true).then(function(newState){if(item.refreshCallback){item.refreshCallback(newState);}});}}}});$body.toggleClass('lia-kudo-single-vote-given',!hasGiven);}
response.data.state=allowed;return response;}).catch(function(){});});}}
function handleSavedKudosAction(entity){if(!user.is_anonymous){var action=$liAuthenticationManager.retrieveUserAction(buildLoginActionId(entity));if(action){return hasGivenKudos(entity).then(function(hasGiven){if(!hasGiven){return giveOrRevokeKudos(entity);}});}}
return $q.when();}
function updateCache(entity,context){var key=entity.type+entity.id;var item;if(cache[key]){item=cache[key];item.entity=entity;}else{item={entity:entity};}
cache[key]=angular.extend(item,context);}
function getFromCache(entity){return cache[entity.type+entity.id]||null;}
function buildLoginActionId(entity){return'li:kudos-'+entity.type+'-'+entity.id;}
function onRefreshState(entity,fn){updateCache(entity,{refreshCallback:fn});}
return{getKudosWeight:getKudosWeight,getKudosAllowed:getKudosAllowed,giveOrRevokeKudos:giveOrRevokeKudos,hasGivenKudos:hasGivenKudos,handleSavedKudosAction:handleSavedKudosAction,onRefreshState:onRefreshState};}]);})(window.LITHIUM&&LITHIUM.angular||angular);
;(function(angular){'use strict';angular.module('li.directives.kudos.kudo',['li.services.kudos.kudos-manager','li.services.plugins.localization-manager','li.services.utils.lodash-utils','li.services.media.image-manager','li.services.utils.url-manager','li.directives.common.text-ready','li.filters.formatting.unsafe','li.services.utils.param-utils']).directive('liKudosKudo',['$liLodashUtils','$liKudosManager','$liUrlManager','$q','$liParamUtils',function($liLodashUtils,$liKudosManager,$liUrlManager,$q,$liParamUtils){return{restrict:'AE',template:$liParamUtils.typeTemplate,scope:{entity:'=liEntity',liType:'@'},link:function link($scope){var currentEntityId;var processing=false;function updateAfterAction(response){var state=$liLodashUtils.get(response,'data.state',null);if(state!==null){$scope.state=response.data.state;}}
$liParamUtils.initTypeTemplate($scope,'kudos/kudo/kudo',$scope.liType);$scope.canKudo=function(){return $scope.state==='actionable'||$scope.state==='actioned'||$scope.state==='anon';};$scope.whoKudoedUrl=function(){var context={tab:'all-users'};if($scope.entity.type==='image'){context['image-id']=$scope.entity.id;}else if($scope.entity.type==='message'){context['message-uid']=$scope.entity.id;}
return $liUrlManager.buildUrl('KudosMessagePage',context);};$scope.$watch('entity',function(newEntity){if(newEntity&&newEntity.type&&currentEntityId!==newEntity.id){currentEntityId=newEntity.id;$liKudosManager.getKudosAllowed($scope.entity).then(function(state){$scope.state=state;});$liKudosManager.onRefreshState($scope.entity,function(state){$scope.state=state;});$q.all([$liKudosManager.getKudosWeight($scope.entity),$liKudosManager.handleSavedKudosAction($scope.entity)]).then(function(responses){if(responses[0]!==undefined){$liLodashUtils.set($scope.entity,'kudos.sum.weight',responses[0]);}
updateAfterAction(responses[1]);});}});$scope.giveOrRevokeKudos=function($event){$event.stopPropagation();$event.preventDefault();if($scope.canKudo()&&processing===false){processing=true;$liKudosManager.giveOrRevokeKudos($scope.entity).then(updateAfterAction).finally(function(){processing=false;});}};$scope.gotoWhoKudoed=function(){if($liLodashUtils.get($scope.entity,'kudos.sum.weight',-1)>0){$liUrlManager.goto($scope.whoKudoedUrl());}};$scope.cssClasses=function(){var cssClasses=[];if(!$scope.canKudo()){cssClasses.push('lia-kudos-button-disabled');}
if($scope.state){cssClasses.push('lia-kudos-'+$scope.state);}
if($scope.entity&&$scope.entity.type){cssClasses.push('lia-kudos-'+$scope.entity.type+'-kudos');}
return cssClasses;};}};}]);})(window.LITHIUM&&LITHIUM.angular||angular);

angular.module('li.directives.kudos.kudo').run(['$templateCache',function($templateCache){$templateCache.put('kudos/kudo/kudo.reverse.tpl.html','<div class="lia-kudos-kudo lia-kudos-kudo-reversed"\n'+'     li-common-text-ready="\'kudos\'"\n'+'     ng-show="state !== \'feature_disabled\' && state !== \'disabled\'"\n'+'     ng-class="cssClasses()"\n'+'     ng-attr-title="{{\'li.kudos.kudo.\' + state|translate}}">\n'+'  <span class="lia-button-wrapper lia-button-wrapper-primary lia-kudos-give-wrapper" ng-click="giveOrRevokeKudos($event)">\n'+'    <button class="lia-button lia-button-primary lia-button-icon lia-kudos-button">\n'+'      <i class="lia-fa lia-fa-thumbs-up lia-kudos-kudo-icon" ng-class="{ \'lia-kudos-{{entity.type}}-kudos-icon\': entity.type }"></i>\n'+'      {{\'li.kudos.kudo.button.\' + state|translate}}\n'+'    </button>\n'+'  </span>\n'+'  <span class="lia-kudos-count-wrapper lia-button-wrapper" ng-click="gotoWhoKudoed()">\n'+'    <span class="lia-kudos-count lia-button lia-button-primary lia-button-icon lia-button-inversed">\n'+'      <span class="lia-kudos-count-link lia-link-disabled" ng-if="entity.kudos.sum.weight === 0" ng-bind-html="\'li.kudos.kudo.kudos\'|translate:{\'count\':entity.kudos.sum.weight}:\'messageformat\'|liUnsafe"></span>\n'+'      <a class="lia-kudos-count-link lia-link-navigation" ng-if="entity.kudos.sum.weight > 0" ng-href="{{whoKudoedUrl()}}" ng-bind-html="\'li.kudos.kudo.kudos\'|translate:{\'count\':entity.kudos.sum.weight}:\'messageformat\'|liUnsafe"></a>\n'+'    </span>\n'+'  </span>\n'+'</div>\n'+'');}]);

angular.module('li.directives.kudos.kudo').run(['$templateCache',function($templateCache){$templateCache.put('kudos/kudo/kudo.tpl.html','<div class="lia-kudos-kudo"\n'+'     li-common-text-ready="\'kudos\'"\n'+'     ng-show="entity.kudos.sum.weight !== undefined && state !== undefined && state !== \'feature_disabled\' && state !== \'disabled\'"\n'+'     ng-class="cssClasses()"\n'+'     ng-attr-title="{{\'li.kudos.kudo.\' + state|translate}}">\n'+'  <span class="lia-kudos-count-wrapper lia-button-wrapper" ng-click="gotoWhoKudoed()">\n'+'    <span class="lia-kudos-count lia-button lia-button-primary lia-button-icon lia-button-inversed">\n'+'      <span class="lia-kudos-count-link lia-link-disabled" ng-if="entity.kudos.sum.weight === 0" ng-bind-html="\'li.kudos.kudo.kudos\'|translate:{\'count\':entity.kudos.sum.weight}:\'messageformat\'|liUnsafe"></span>\n'+'      <a class="lia-kudos-count-link lia-link-navigation" ng-if="entity.kudos.sum.weight > 0" ng-href="{{whoKudoedUrl()}}" ng-bind-html="\'li.kudos.kudo.kudos\'|translate:{\'count\':entity.kudos.sum.weight}:\'messageformat\'|liUnsafe"></a>\n'+'    </span>\n'+'  </span>\n'+'  <span class="lia-button-wrapper lia-button-wrapper-primary lia-kudos-give-wrapper" ng-click="giveOrRevokeKudos($event)">\n'+'    <button class="lia-button lia-button-primary lia-button-icon lia-kudos-button">\n'+'      <i class="lia-fa lia-fa-thumbs-up lia-kudos-kudo-icon" ng-class="{ \'lia-kudos-{{entity.type}}-kudos-icon\': entity.type }"></i>\n'+'    </button>\n'+'  </span>\n'+'</div>\n'+'');}]);
;(function(angular){'use strict';angular.module('li.directives.common.element-hook',[]).directive('liCommonElementHook',function(){return{restrict:'A',scope:{liCommonElementHook:'='},link:function link($scope,$element){$scope.liCommonElementHook=$element;}};});})(window.LITHIUM&&LITHIUM.angular||angular);
;(function(angular){'use strict';angular.module('li.directives.media.download-media',['li.directives.common.element-hook','li.services.plugins.localization-manager']).directive('liMediaDownloadMedia',['$timeout',function($timeout){return{restrict:'AE',templateUrl:'media/download-media/download-media.tpl.html',scope:{liMediaUrl:'=',liType:'='},link:function link($scope){$scope.download=function($event){$event.stopPropagation();if(angular.element($event.target).hasClass('lia-media-download-icon')&&$scope.downloadElement){$timeout(function(){$scope.downloadElement[0].click();});}};}};}]);})(window.LITHIUM&&LITHIUM.angular||angular);

angular.module('li.directives.media.download-media').run(['$templateCache',function($templateCache){$templateCache.put('media/download-media/download-media.tpl.html','<span class="lia-media-download-icon lia-button-wrapper lia-button-wrapper-primary"\n'+'      ng-click="download($event)"\n'+'      ng-attr-title="{{\'li.media.download-media.\' + liType|translate}}">\n'+'  <a download\n'+'     class="lia-image-download-link lia-button lia-button-primary lia-button-inversed lia-button-icon"\n'+'     ng-href="{{liMediaUrl}}"\n'+'     li-common-element-hook="downloadElement">\n'+'      <i class="lia-fa lia-fa-download lia-image-download-link-icon"></i>\n'+'  </a>\n'+'</span>\n'+'');}]);
;(function(angular){'use strict';angular.module('li.services.moderation.abuse-manager',['li.services.rest.rest-manager','li.services.auth.authentication-manager','li.services.community.context-manager','li.services.utils.lodash-utils']).constant('$liAbuseManagerConfig',{type:{message:'messages',image:'images'},stateMap:{100:'actionable',101:'denied',102:'actioned',anon:'anon',actioned:'actioned'}}).factory('$liAbuseManager',['$liRestManager','$q','$log','$cacheFactory','$liAbuseManagerConfig','$liAuthenticationManager','$liContextManager','$liLodashUtils',function($liRestManager,$q,$log,$cacheFactory,$liAbuseManagerConfig,$liAuthenticationManager,$liContextManager,$liLodashUtils){var user=$liContextManager.currentUser();var flagsGiven={};var jsonPayload={request:{data:{}}};function createActionId(entity){return'li:flag-'+entity.type+'-'+entity.id;}
function flag(entity,message){if(message){jsonPayload.request.data.body=message;}
var resource=entity.type+'s';if(user.is_anonymous){$liAuthenticationManager.saveUserActionAndLogin(createActionId(entity),{type:entity.type,id:entity.id});return $q.defer().promise;}
var requestUrl='/'+resource+'/'+entity.id+'/abuse_reports';return $liRestManager.request(requestUrl,{},jsonPayload,'post').then(function(response){addToCache(entity,true);response.data.state='actioned';return response;});}
function getFlagAllowed(entity){var requestedPath=[entity.type+'s',entity.id,'abuse_reports'].join('/');var qParams={method:'post',path:requestedPath};var requestUrl='/allowed';var state=$liLodashUtils.get(flagsGiven,entity.type+'.'+entity.id,null);if(state!==null){return $q.when('actioned');}
return $liRestManager.request(requestUrl,qParams,{},'get',true).then(function(response){var state=$liAbuseManagerConfig.stateMap[response.data.reason_code];if(state!=='actioned'&&user.is_anonymous){return'anon';}else{return state;}});}
function addToCache(entity,state){if(!flagsGiven[entity.type]){flagsGiven[entity.type]={};}
flagsGiven[entity.type][entity.id]=state;}
function handleSavedFlagAction(entity){var retrievedAction=$liAuthenticationManager.retrieveUserAction(createActionId(entity));if(retrievedAction&&!user.is_anonymous){return flag({type:retrievedAction.type,id:retrievedAction.id},'Flagged');}
return $q.when();}
return{flag:flag,getFlagAllowed:getFlagAllowed,handleSavedFlagAction:handleSavedFlagAction};}]);})(window.LITHIUM&&LITHIUM.angular||angular);
;(function(angular){'use strict';angular.module('li.directives.moderation.flag-entity',['li.services.moderation.abuse-manager','li.services.plugins.localization-manager','li.services.auth.authentication-manager','li.services.plugins.localization-manager','li.directives.common.text-ready']).directive('liModerationFlagEntity',['$filter','$log','$liAbuseManager','$liLodashUtils',function($filter,$log,$liAbuseManager,$liLodashUtils){function link($scope){function updateAfterAction(response){var state=$liLodashUtils.get(response,'data.state',null);if(state){$scope.state=response.data.state;}}
$scope.canFlag=function(){return $scope.state==='actionable'||$scope.state==='anon';};$scope.flag=function($event){$event.stopPropagation();$event.preventDefault();if($scope.canFlag()){$liAbuseManager.flag($scope.entity,'Flagged').then(updateAfterAction);}};$scope.$watch('entity',function(){if($scope.entity&&$scope.entity.type&&$scope.entity.id){$liAbuseManager.getFlagAllowed($scope.entity).then(function(state){$scope.state=state;});$liAbuseManager.handleSavedFlagAction($scope.entity).then(updateAfterAction);}});}
return{templateUrl:'moderation/flag-entity/flag-entity.tpl.html',restrict:'EA',replace:false,scope:{entity:'=liEntity'},link:link};}]);})(window.LITHIUM&&LITHIUM.angular||angular);

angular.module('li.directives.moderation.flag-entity').run(['$templateCache',function($templateCache){$templateCache.put('moderation/flag-entity/flag-entity.tpl.html','<span class="lia-moderation-flag-entity lia-button-wrapper lia-button-wrapper-primary lia-entity-flag-{{state}}"\n'+'      ng-class="{ \'lia-link-disabled\': !canFlag() }"\n'+'      li-common-text-ready="\'moderation\'"\n'+'      ng-attr-title="{{ \'li.moderation.flag-entity.\' + state | translate }}"\n'+'      ng-click="flag($event)">\n'+'  <button class="lia-button lia-button-primary lia-button-inversed lia-button-icon lia-flag-button">\n'+'    <i class="lia-fa lia-fa-flag lia-flagged-icon"></i>\n'+'  </button>\n'+'</span>\n'+'');}]);

(function(window,angular,undefined){'use strict';var ngTouch=angular.module('ngTouch',[]);function nodeName_(element){return angular.lowercase(element.nodeName||(element[0]&&element[0].nodeName));}
ngTouch.factory('$swipe',[function(){var MOVE_BUFFER_RADIUS=10;var POINTER_EVENTS={'mouse':{start:'mousedown',move:'mousemove',end:'mouseup'},'touch':{start:'touchstart',move:'touchmove',end:'touchend',cancel:'touchcancel'}};function getCoordinates(event){var originalEvent=event.originalEvent||event;var touches=originalEvent.touches&&originalEvent.touches.length?originalEvent.touches:[originalEvent];var e=(originalEvent.changedTouches&&originalEvent.changedTouches[0])||touches[0];return{x:e.clientX,y:e.clientY};}
function getEvents(pointerTypes,eventType){var res=[];angular.forEach(pointerTypes,function(pointerType){var eventName=POINTER_EVENTS[pointerType][eventType];if(eventName){res.push(eventName);}});return res.join(' ');}
return{bind:function(element,eventHandlers,pointerTypes){var totalX,totalY;var startCoords;var lastPos;var active=false;pointerTypes=pointerTypes||['mouse','touch'];element.on(getEvents(pointerTypes,'start'),function(event){startCoords=getCoordinates(event);active=true;totalX=0;totalY=0;lastPos=startCoords;eventHandlers['start']&&eventHandlers['start'](startCoords,event);});var events=getEvents(pointerTypes,'cancel');if(events){element.on(events,function(event){active=false;eventHandlers['cancel']&&eventHandlers['cancel'](event);});}
element.on(getEvents(pointerTypes,'move'),function(event){if(!active)return;if(!startCoords)return;var coords=getCoordinates(event);totalX+=Math.abs(coords.x-lastPos.x);totalY+=Math.abs(coords.y-lastPos.y);lastPos=coords;if(totalX<MOVE_BUFFER_RADIUS&&totalY<MOVE_BUFFER_RADIUS){return;}
if(totalY>totalX){active=false;eventHandlers['cancel']&&eventHandlers['cancel'](event);return;}else{event.preventDefault();eventHandlers['move']&&eventHandlers['move'](coords,event);}});element.on(getEvents(pointerTypes,'end'),function(event){if(!active)return;active=false;eventHandlers['end']&&eventHandlers['end'](getCoordinates(event),event);});}};}]);ngTouch.config(['$provide',function($provide){$provide.decorator('ngClickDirective',['$delegate',function($delegate){$delegate.shift();return $delegate;}]);}]);ngTouch.directive('ngClick',['$parse','$timeout','$rootElement',function($parse,$timeout,$rootElement){var TAP_DURATION=750;var MOVE_TOLERANCE=12;var PREVENT_DURATION=2500;var CLICKBUSTER_THRESHOLD=25;var ACTIVE_CLASS_NAME='ng-click-active';var lastPreventedTime;var touchCoordinates;var lastLabelClickCoordinates;function hit(x1,y1,x2,y2){return Math.abs(x1-x2)<CLICKBUSTER_THRESHOLD&&Math.abs(y1-y2)<CLICKBUSTER_THRESHOLD;}
function checkAllowableRegions(touchCoordinates,x,y){for(var i=0;i<touchCoordinates.length;i+=2){if(hit(touchCoordinates[i],touchCoordinates[i+1],x,y)){touchCoordinates.splice(i,i+2);return true;}}
return false;}
function onClick(event){if(Date.now()-lastPreventedTime>PREVENT_DURATION){return;}
var touches=event.touches&&event.touches.length?event.touches:[event];var x=touches[0].clientX;var y=touches[0].clientY;if(x<1&&y<1){return;}
if(lastLabelClickCoordinates&&lastLabelClickCoordinates[0]===x&&lastLabelClickCoordinates[1]===y){return;}
if(lastLabelClickCoordinates){lastLabelClickCoordinates=null;}
if(nodeName_(event.target)==='label'){lastLabelClickCoordinates=[x,y];}
if(checkAllowableRegions(touchCoordinates,x,y)){return;}
event.stopPropagation();event.preventDefault();event.target&&event.target.blur&&event.target.blur();}
function onTouchStart(event){var touches=event.touches&&event.touches.length?event.touches:[event];var x=touches[0].clientX;var y=touches[0].clientY;touchCoordinates.push(x,y);$timeout(function(){for(var i=0;i<touchCoordinates.length;i+=2){if(touchCoordinates[i]==x&&touchCoordinates[i+1]==y){touchCoordinates.splice(i,i+2);return;}}},PREVENT_DURATION,false);}
function preventGhostClick(x,y){if(!touchCoordinates){$rootElement[0].addEventListener('click',onClick,true);$rootElement[0].addEventListener('touchstart',onTouchStart,true);touchCoordinates=[];}
lastPreventedTime=Date.now();checkAllowableRegions(touchCoordinates,x,y);}
return function(scope,element,attr){var clickHandler=$parse(attr.ngClick),tapping=false,tapElement,startTime,touchStartX,touchStartY;function resetState(){tapping=false;element.removeClass(ACTIVE_CLASS_NAME);}
element.on('touchstart',function(event){tapping=true;tapElement=event.target?event.target:event.srcElement;if(tapElement.nodeType==3){tapElement=tapElement.parentNode;}
element.addClass(ACTIVE_CLASS_NAME);startTime=Date.now();var originalEvent=event.originalEvent||event;var touches=originalEvent.touches&&originalEvent.touches.length?originalEvent.touches:[originalEvent];var e=touches[0];touchStartX=e.clientX;touchStartY=e.clientY;});element.on('touchcancel',function(event){resetState();});element.on('touchend',function(event){var diff=Date.now()-startTime;var originalEvent=event.originalEvent||event;var touches=(originalEvent.changedTouches&&originalEvent.changedTouches.length)?originalEvent.changedTouches:((originalEvent.touches&&originalEvent.touches.length)?originalEvent.touches:[originalEvent]);var e=touches[0];var x=e.clientX;var y=e.clientY;var dist=Math.sqrt(Math.pow(x-touchStartX,2)+Math.pow(y-touchStartY,2));if(tapping&&diff<TAP_DURATION&&dist<MOVE_TOLERANCE){preventGhostClick(x,y);if(tapElement){tapElement.blur();}
if(!angular.isDefined(attr.disabled)||attr.disabled===false){element.triggerHandler('click',[event]);}}
resetState();});element.onclick=function(event){};element.on('click',function(event,touchend){scope.$apply(function(){clickHandler(scope,{$event:(touchend||event)});});});element.on('mousedown',function(event){element.addClass(ACTIVE_CLASS_NAME);});element.on('mousemove mouseup',function(event){element.removeClass(ACTIVE_CLASS_NAME);});};}]);function makeSwipeDirective(directiveName,direction,eventName){ngTouch.directive(directiveName,['$parse','$swipe',function($parse,$swipe){var MAX_VERTICAL_DISTANCE=75;var MAX_VERTICAL_RATIO=0.3;var MIN_HORIZONTAL_DISTANCE=30;return function(scope,element,attr){var swipeHandler=$parse(attr[directiveName]);var startCoords,valid;function validSwipe(coords){if(!startCoords)return false;var deltaY=Math.abs(coords.y-startCoords.y);var deltaX=(coords.x-startCoords.x)*direction;return valid&&deltaY<MAX_VERTICAL_DISTANCE&&deltaX>0&&deltaX>MIN_HORIZONTAL_DISTANCE&&deltaY/deltaX<MAX_VERTICAL_RATIO;}
var pointerTypes=['touch'];if(!angular.isDefined(attr['ngSwipeDisableMouse'])){pointerTypes.push('mouse');}
$swipe.bind(element,{'start':function(coords,event){startCoords=coords;valid=true;},'cancel':function(event){valid=false;},'end':function(coords,event){if(validSwipe(coords)){scope.$apply(function(){element.triggerHandler(eventName);swipeHandler(scope,{$event:event});});}}},pointerTypes);};}]);}
makeSwipeDirective('ngSwipeLeft',-1,'swipeleft');makeSwipeDirective('ngSwipeRight',1,'swiperight');})(window,window.angular);
;(function(angular){'use strict';angular.module('li.directives.media.image-lightbox',['li.services.media.matchmedia-utils','li.services.utils.url-manager','li.directives.common.img-load','li.directives.media.publishing-history','li.directives.users.user-login','li.directives.kudos.kudo','li.directives.media.download-media','li.directives.moderation.flag-entity','li.services.events.event-manager','li.services.utils.lodash-utils','li.services.utils.image-utils','li.services.media.image-manager','li.filters.formatting.date','li.services.community.context-manager','ngTouch']).constant('liMediaImageLightboxConfig',{imageSizes:{1000:'xs',1500:'sm',1700:'md',2000:'lg',2500:'xl'},filmstripSizes:{0:'xs',5:'sm',7:'md',11:'lg',13:'xl'},events:{changeImage:'LITHIUM:liMediaImageLightbox:changeImage'}}).directive('liMediaImageLightbox',['$window','liMediaImageLightboxConfig','$liMatchmediaUtils','$liUrlManager','$liEventManager','$liLodashUtils','$liImageUtils','$timeout','$rootScope','$liImageManager','$liContextManager','$document',function($window,liMediaImageLightboxConfig,$liMatchmediaUtils,$liUrlManager,$liEventManager,$liLodashUtils,$liImageUtils,$timeout,$rootScope,$liImageManager,$liContextManager,$document){return{restrict:'AE',templateUrl:'media/image-lightbox/image-lightbox.tpl.html',scope:{image:'=?liImage',images:'=?liImages',loadImages:'&liLoadImages',limit:'=?liLimit',close:'&liClose',openContext:'=?liOpenContext',eventContext:'=?liEventContext'},link:function link($scope,$element){function _loadImages(limit){return $scope.loadImages({limit:limit,offset:page++*limit,context:$scope.openContext}).then(function(response){$scope.images=$scope.images.concat(response);hasMore=response.length===limit;});}
function getImage(){if($scope.index!==undefined){$scope.image=$scope.images[$scope.index];}else{setImage($scope.image.id);}
return $scope.image;}
function setImage(imageId){for(var i=0;i<$scope.images.length;i++){if($scope.images[i].id===imageId){$scope.index=i;$scope.image=$scope.images[i];}}}
function handleKey($event){var keyCode=$event.keyCode||$event.which;if(keyCode===$liEventManager.KeyCodes.LEFT){$scope.prev($event);$scope.$apply();}else if(keyCode===$liEventManager.KeyCodes.RIGHT){$scope.next($event);$scope.$apply();}}
function redrawIcons(){$icons=$icons?$icons:getImageContainer().find('i');$icons.addClass('lia-hidden');$timeout(function(){$icons.removeClass('lia-hidden');});}
function getImageContainer(){$imgContainer=$imgContainer?$imgContainer:angular.element($element[0].querySelector('.lia-lightbox-main-image'));return $imgContainer;}
function resizeContainer(){var img=getImage();if(isMobile||$window.screenfull.enabled&&$window.screenfull.isFullscreen){getImageContainer().css({height:null,'min-height':null});minHeight=450;if(isMobile){viewport.content='width=device-width, minimum-scale=1.0, maximum-scale=1.0, initial-scale=1.0';}
redrawIcons();}else if(img.height>minHeight){var newMinHeight=Math.min(img.height,$window.innerHeight-gutterHeight());if(newMinHeight>minHeight){minHeight=newMinHeight;getImageContainer().css({height:minHeight+'px','min-height':minHeight+'px'});redrawIcons();}}}
function buildHref(img){if(img.original_href){var href=$liUrlManager.adjustUrl(img.original_href).removePathParam('image-size');if($liLodashUtils.get(img,'visibility')!=='rejected'){href.addPathParam('image-dimensions',currentImageRes||2000);}
return href.build();}
return null;}
function getImageHref(){return buildHref(getImage());}
function preLoad(start,end){var imgs=$scope.images.slice(start,end+1);angular.forEach(imgs,function(img){preLoaded.push(img.id);$liImageUtils.forceLoad(buildHref(img));});}
function checkLoadMore(){if(hasMore&&($scope.images.length-$scope.index<=loadMoreThreshold||filmstripEnd!==null&&$scope.images.length-filmstripEnd<=loadMoreThreshold)){_loadImages($scope.limit).then(function(){if(preLoaded.length-$scope.index<preLoadThreshold){preLoad(preLoaded.length+1,preLoaded.length+1+preLoadCount);}});}}
function gutterHeight(){var infoRowHeight=80;var filmStripRowHeight=110;var gutter=infoRowHeight;if($scope.images.length>1){gutter+=filmStripRowHeight;}
return gutter;}
function setOrientationStyle(){isLandscape=$window.orientation===-90||$window.orientation===90;$body.toggleClass('lia-orientation-landscape',isLandscape);}
function orientationChangeHandler($event){setOrientationStyle();minHeight=450;handleResizeThrottle($event);}
function toggleFullscreenHandler($event){var keyCode=$event.keyCode||$event.which;if(keyCode===$liEventManager.KeyCodes.f){$scope.fullscreen();}}
function fullscreenChangeHandler($event){$body.toggleClass('lia-fullscreen',$window.screenfull.isFullscreen);redrawIcons();$liEventManager.stop($event);}
var currentImageRes;var currentImageId;var minHeight=450;var $imgContainer;var $icons;var hasMore;var loadMoreThreshold;var preLoaded=[];var preLoadThreshold=3;var preLoadCount=5;var handleResizeThrottle=$liLodashUtils.debounce(function(){$timeout(resizeContainer);},250);var page=0;var imageIndex=0;var filmstripStart=null;var filmstripEnd=null;var isMobile=$liContextManager.server().device_mode==='MOBILE';var viewport=$document[0].querySelector('meta[name="viewport"]');var originalViewportContent=viewport?viewport.content:null;var $$window=angular.element($window);var $body=angular.element($document[0].body);var isLandscape;$scope.showAvatar=$liContextManager.currentUserSettings()['config.enable_avatar'];$scope.images=$scope.images!==undefined?$scope.images:[];$scope.limit=$scope.limit!==undefined?$scope.limit:100;$scope.loader=!$liImageUtils.inCache(getImageHref());$scope.getImageHref=getImageHref;$scope.isForceShow=false;$scope.allowFullscreen=$window.screenfull.enabled;$scope.isFullscreen=function(){return $window.screenfull.isFullscreen;};hasMore=$scope.images.length<=$scope.limit;loadMoreThreshold=Math.round($scope.limit/2);$scope.closeModal=function(){if(isMobile&&originalViewportContent){viewport.content=originalViewportContent;}
$body.removeClass('lia-orientation-landscape');$body.removeClass('lia-fullscreen');$scope.close();$$window.off('keyup',handleKey).off('resize',handleResizeThrottle).off('orientationchange',orientationChangeHandler).off('keypress',toggleFullscreenHandler);if($window.screenfull.enabled){$$window.off($window.screenfull.raw.fullscreenchange,fullscreenChangeHandler);}};$scope.prev=function($event){$scope.moveTo($event,$scope.index-1);};$scope.next=function($event){$scope.moveTo($event,$scope.index+1);};$scope.prevPage=function($event){$liEventManager.stop($event);var currentRange=$scope.filmstripRange();filmstripStart=Math.max(0,currentRange.start-$scope.filmstripSize);filmstripEnd=filmstripStart+$scope.filmstripSize;};$scope.nextPage=function($event){$liEventManager.stop($event);var currentRange=$scope.filmstripRange();if(currentRange.end<$scope.images.length){filmstripEnd=Math.min($scope.images.length,currentRange.end+$scope.filmstripSize);filmstripStart=filmstripEnd-$scope.filmstripSize;checkLoadMore();}};$scope.moveTo=function($event,index){$liEventManager.stop($event);if(index>=0&&index<$scope.images.length){$scope.index=index;$scope.loader=!$liImageUtils.inCache(getImageHref());filmstripStart=filmstripEnd=null;checkLoadMore();}};$scope.filmstripRange=function(){var start;var end;if(filmstripStart!==null&&filmstripEnd!==null){start=filmstripStart;end=filmstripEnd;}else if($scope.filmstripSize>$scope.images.length){start=0;end=$scope.filmstripSize;}else if($scope.index<$scope.filmstripSize/2){start=0;end=$scope.filmstripSize;}else if($scope.index>$scope.images.length-$scope.filmstripSize){start=$scope.images.length-$scope.filmstripSize;end=$scope.images.length;}else{var delta=Math.floor($scope.filmstripSize/2);start=$scope.index-delta;end=$scope.index+$scope.filmstripSize-delta;}
return{start:start,end:end};};$scope.forceShow=function($event){var filmstripSizeName=liMediaImageLightboxConfig.filmstripSizes[$scope.filmstripSize];if(filmstripSizeName==='xs'||filmstripSizeName==='sm'&&isLandscape){$liEventManager.stop($event);$scope.isForceShow=!$scope.isForceShow;return $scope.isForceShow;}};$scope.$watch('images',function(images){angular.forEach(images,function(image){if(!image.hasOwnProperty('imageIndex')){image.imageIndex=imageIndex++;}});});$scope.hideLoader=function(){$scope.loader=false;resizeContainer();};$scope.fullscreen=function(){if($window.screenfull.enabled){$window.screenfull.toggle(getImageContainer()[0]);}};$scope.$on('liLightboxImageChange',function($event,newImageId){if(newImageId!==undefined){if(newImageId!==$scope.image.id){setImage(newImageId);}}else{$scope.closeModal();}});$scope.$watch('image',function(image){if(currentImageId!==image.id&&image.type){currentImageId=image.id;$rootScope.$broadcast(liMediaImageLightboxConfig.events.changeImage,image);$liEventManager.sendEvent('media-view',image,$scope.eventContext);resizeContainer();}});$scope.downloadUrl=function(image){return image.original_href&&$liUrlManager.adjustUrl(image.original_href).addPathParam('download','true').build();};angular.forEach(liMediaImageLightboxConfig.imageSizes,function(screenSize,imageSize){$liMatchmediaUtils.addListenerForSizes(screenSize,function(){currentImageRes=imageSize;});});angular.forEach(liMediaImageLightboxConfig.filmstripSizes,function(screenSize,filmstripSize){$liMatchmediaUtils.addListenerForSizes(screenSize,function(){$scope.filmstripSize=parseInt(filmstripSize,10);});});$$window.on('keyup',handleKey).on('resize',handleResizeThrottle).on('orientationchange',orientationChangeHandler).on('keypress',toggleFullscreenHandler);if($window.screenfull.enabled){$$window.on($window.screenfull.raw.fullscreenchange,fullscreenChangeHandler);}
setOrientationStyle();$scope.getCropUrl=$liImageManager.getCropUrl;if($scope.images.length===0){_loadImages($scope.limit).then(function(){preLoad(1,preLoadCount);});}else{page++;preLoad(1,preLoadCount);checkLoadMore();}}};}]);})(window.LITHIUM&&LITHIUM.angular||angular);

(function(){'use strict';var isCommonjs=typeof module!=='undefined'&&module.exports;var keyboardAllowed=typeof Element!=='undefined'&&'ALLOW_KEYBOARD_INPUT'in Element;var fn=(function(){var val;var valLength;var fnMap=[['requestFullscreen','exitFullscreen','fullscreenElement','fullscreenEnabled','fullscreenchange','fullscreenerror'],['webkitRequestFullscreen','webkitExitFullscreen','webkitFullscreenElement','webkitFullscreenEnabled','webkitfullscreenchange','webkitfullscreenerror'],['webkitRequestFullScreen','webkitCancelFullScreen','webkitCurrentFullScreenElement','webkitCancelFullScreen','webkitfullscreenchange','webkitfullscreenerror'],['mozRequestFullScreen','mozCancelFullScreen','mozFullScreenElement','mozFullScreenEnabled','mozfullscreenchange','mozfullscreenerror'],['msRequestFullscreen','msExitFullscreen','msFullscreenElement','msFullscreenEnabled','MSFullscreenChange','MSFullscreenError']];var i=0;var l=fnMap.length;var ret={};for(;i<l;i++){val=fnMap[i];if(val&&val[1]in document){for(i=0,valLength=val.length;i<valLength;i++){ret[fnMap[0][i]]=val[i];}
return ret;}}
return false;})();var screenfull={request:function(elem){var request=fn.requestFullscreen;elem=elem||document.documentElement;if(/5\.1[\.\d]* Safari/.test(navigator.userAgent)){elem[request]();}else{elem[request](keyboardAllowed&&Element.ALLOW_KEYBOARD_INPUT);}},exit:function(){document[fn.exitFullscreen]();},toggle:function(elem){if(this.isFullscreen){this.exit();}else{this.request(elem);}},raw:fn};if(!fn){if(isCommonjs){module.exports=false;}else{window.screenfull=false;}
return;}
Object.defineProperties(screenfull,{isFullscreen:{get:function(){return!!document[fn.fullscreenElement];}},element:{enumerable:true,get:function(){return document[fn.fullscreenElement];}},enabled:{enumerable:true,get:function(){return!!document[fn.fullscreenEnabled];}}});if(isCommonjs){module.exports=screenfull;}else{window.screenfull=screenfull;}})();

angular.module('li.directives.media.image-lightbox').run(['$templateCache',function($templateCache){$templateCache.put('media/image-lightbox/image-lightbox.tpl.html','<div class="lia-media-image-lightbox lia-content"\n'+'     ng-class="{\'lia-show-controls\': isForceShow}"\n'+'     ng-click="forceShow($event)">\n'+'  <div class="lia-lightbox-main-image"\n'+'       ng-swipe-left="next($event)"\n'+'       ng-swipe-right="prev($event)">\n'+'    <img class="lia-image lia-no-select" ng-src="{{getImageHref()}}"\n'+'        li-common-img-load="hideLoader()" ng-show="!loader">\n'+'    <i class="lia-fa lia-fa-spinner lia-fa-spin lia-lightbox-image-loader" ng-show="loader"></i>\n'+'    <div class="lia-lightbox-actions-container lia-no-select lia-button-container">\n'+'      <i class="lia-fa lia-lightbox-button lia-lightbox-fullscreen-button"\n'+'         ng-click="fullscreen()"\n'+'         ng-if="allowFullscreen"\n'+'         ng-class="\'lia-fa-\' + (isFullscreen() ? \'compress\' : \'expand\')"></i>\n'+'      <i class="lia-fa lia-fa-times lia-lightbox-button lia-lightbox-close-button" ng-click="closeModal()"></i>\n'+'    </div>\n'+'    <div class="lia-lightbox-prev-container lia-no-select lia-button-container"\n'+'         ng-click="prev($event)"\n'+'         ng-class="{\'lia-button-disabled\': index === 0 }">\n'+'      <i class="lia-fa lia-fa-chevron-left lia-lightbox-button"></i>\n'+'    </div>\n'+'    <div class="lia-lightbox-next-container lia-no-select lia-button-container"\n'+'         ng-click="next($event)"\n'+'         ng-class="{\'lia-button-disabled\': index === images.length - 1 }">\n'+'      <i class="lia-fa lia-fa-chevron-right lia-lightbox-button"></i>\n'+'    </div>\n'+'    <figcaption class="lia-lightbox-image-caption" ng-if="image.description.length > 0" ng-bind="image.description"></figcaption>\n'+'  </div>\n'+'\n'+'  <div class="lia-lightbox-info-wrapper" ng-click="$event.stopPropagation()">\n'+'    <figcaption class="lia-lightbox-image-caption" ng-if="image.description.length > 0" ng-bind="image.description"></figcaption>\n'+'    <div class="lia-lightbox-info clearfix">\n'+'      <div class="lia-lightbox-context">\n'+'        <img ng-src="{{image.owner.avatar.message}}" class="lia-user-avatar" ng-if="showAvatar"/>\n'+'        <li:users-user-login user="image.owner"></li:users-user-login>\n'+'        <span class="lia-bull-spacer">&bull;</span>\n'+'        <span class="lia-image-upload-time">{{image.upload_time|liDate:image.upload_time_friendly}}</span>\n'+'        <a ng-href="{{image.album.view_href}}" class="lia-lightbox-image-album">{{image.album.title}}</a>\n'+'      </div>\n'+'      <div class="lia-lightbox-actions lia-button-group lia-button-group-left">\n'+'        <li:kudos-kudo li-entity="image"></li:kudos-kudo>\n'+'        <li:moderation-flag-entity li-entity="image"></li:moderation-flag-entity>\n'+'        <li:media-download-media li-media-url="downloadUrl(image)" li-type="\'image\'"></li:media-download-media>\n'+'      </div>\n'+'    </div>\n'+'  </div>\n'+'\n'+'  <div class="lia-filmstrip" ng-if="images.length > 1 && filmstripSize > 0" ng-swipe-left="nextPage($event)" ng-swipe-right="prevPage($event)">\n'+'\n'+'    <div class="lia-filmstrip-prev-container lia-no-select lia-button-container"\n'+'         ng-click="prevPage($event)"\n'+'         ng-class="{\'lia-button-disabled\': filmstripRange().start === 0 }">\n'+'      <i class="lia-fa lia-fa-chevron-left lia-lightbox-button lia-lightbox-button-inverted"></i>\n'+'    </div>\n'+'    <ul class="lia-list-tile">\n'+'      <li class="lia-media-image-item lia-no-select"\n'+'          ng-repeat="image in images.slice(filmstripRange().start, filmstripRange().end) track by image.imageIndex"\n'+'          ng-class="{\'lia-image-selected\': index === image.imageIndex}"\n'+'          li-common-append-space>\n'+'        <div class="lia-media-image-frame" ng-click="moveTo($event, image.imageIndex)">\n'+'          <img class="lia-media-image" ng-src="{{getCropUrl(image.thumb_href, image.visibility)}}"\n'+'               title="{{image.title}}" />\n'+'        </div>\n'+'      </li>\n'+'    </ul>\n'+'\n'+'    <div class="lia-filmstrip-next-container lia-no-select lia-button-container"\n'+'         ng-click="nextPage($event)"\n'+'         ng-class="{\'lia-button-disabled\': filmstripRange().end >= images.length }">\n'+'      <i class="lia-fa lia-fa-chevron-right lia-lightbox-button lia-lightbox-button-inverted"></i>\n'+'    </div>\n'+'  </div>\n'+'\n'+'  <li:media-publishing-history li-image-id="image.id" ng-if="image.id && !loader"></li:media-publishing-history>\n'+'\n'+'</div>\n'+'');}]);
;(function(angular){'use strict';angular.module('li.directives.messages.message-image',['li.services.utils.url-manager','li.services.media.image-manager','li.services.messages.message-manager','li.services.events.event-manager','li.services.utils.param-utils','li.directives.media.image-lightbox','ui.bootstrap']).directive('liMessagesMessageImage',['$liUrlManager','$timeout','$document','$templateCache','$compile','$liMessageManager','$liImageManager','$liEventManager','$liParamUtils',function($liUrlManager,$timeout,$document,$templateCache,$compile,$liMessageManager,$liImageManager,$liEventManager,$liParamUtils){return{restrict:'A',scope:{messageUid:'=liMessageUid',imageDisplayId:'=liImageDisplayId',imageUrl:'@liImageUrl'},replace:true,link:function link($scope,$element){function getAncestorByType(element,type){while(element.parentNode){element=element.parentNode;if(element!==null&&element.nodeName.toLowerCase()===type){return element;}}}
function hideActions(){$wrapper.addClass('lia-message-image-actions-hidden');$timeout(function(){$document.one('mouseover',function(){$wrapper.removeClass('lia-message-image-actions-hidden');});},100);}
function doActionsFit(){var imageWidth=$element[0].width||$element[0].clientWidth;return $mediaActions[0].clientWidth<imageWidth-25&&imageWidth>110+($anchor?50:0);}
function addIconSizeClasses(){if(!doActionsFit()){$wrapper.addClass('lia-message-image-actions-narrow');if(!doActionsFit()){$wrapper.addClass('lia-message-image-actions-below');}}}
function getImagesForMessage(limit,offset){var fields=['id','original_href','thumb_href','upload_time','upload_time_friendly','title','description','owner.login','owner.rank.name','owner.avatar.message','owner.view_href','owner.rank.icon_left','owner.rank.icon_right','owner.rank.bold','owner.rank.color','height','width','album.view_href','album.title'];return $liImageManager.getImagesForMessage($scope.messageUid,fields,null,limit,offset);}
function goToLinkHandler($event){$liEventManager.stop($event);$anchor[0].click();hideActions();}
function openLightboxHandler($event){$liEventManager.stop($event);$event.target.blur();lightbox.open({id:$scope.imageDisplayId,original_href:$scope.imageUrl});}
if(!$liParamUtils.validateParams('liMessageImage',$scope,['imageDisplayId','messageUid'])){return;}
var template=$templateCache.get('messages/message-image/message-image.tpl.html');var $mediaActions=$compile(template)($scope);var $anchor=angular.element(getAncestorByType($element[0],'a'));var $wrapper=$element.wrap('<span class="lia-message-image-wrapper">').parent();var lightbox=$liImageManager.lightbox([],getImagesForMessage,100,'message-images-'+$scope.messageUid,null,{id:$scope.messageUid});$element.after($mediaActions);$element.on('mouseover',addIconSizeClasses);$element.on('click',openLightboxHandler);$wrapper.parent().on('click',$liEventManager.stop);$scope.open=openLightboxHandler;$scope.goToLink=goToLinkHandler;if($anchor.length>0){$scope.link=$anchor.attr('href');$scope.hostName=$liUrlManager.getHostName($scope.link);}}};}]);})(window.LITHIUM&&LITHIUM.angular||angular);

angular.module('li.directives.messages.message-image').run(['$templateCache',function($templateCache){$templateCache.put('messages/message-image/message-image.tpl.html','<span class="lia-messages-message-image">\n'+'  <span ng-if="link" ng-click="goToLink($event)" class="lia-message-image-link-wrapper">\n'+'    <i class="lia-fa lia-fa-external-link"></i>\n'+'    <span class="lia-media-link-text">{{hostName}}</span>\n'+'  </span><i class="lia-fa lia-fa-search-plus lia-media-lightbox-trigger" ng-click="open($event)"></i>\n'+'</span>\n'+'');}]);
;(function(angular){'use strict';angular.module('li.services.media.document-manager',['li.services.rest.rest-manager']).factory('$liDocumentManager',['$q','$rootScope','$liRestManager',function($q,$rootScope,$liRestManager){return{getViewUrl:function getViewUrl(mediaId){var deferred=$q.defer();$liRestManager.request('/document/:mediaId',{mediaId:mediaId}).then(function(response){if(response.status==='success'){deferred.resolve(response.data.viewUrl);}},function(){deferred.resolve(null);});return deferred.promise;},uploadAttachment:function uploadAttachment(messageId,attachmentId){var deferred=$q.defer();var jsonPayload={};jsonPayload.messageId=messageId;jsonPayload.attachmentId=attachmentId;$liRestManager.request('/document/upload',{},jsonPayload,'post').then(function(response){if(response.status==='success'){deferred.resolve(response.data.mediaId);}},function(){deferred.resolve(null);});return deferred.promise;}};}]);})(window.LITHIUM&&LITHIUM.angular||angular);

(function(){var module=angular.module('multi-transclude',[]);var Ctrl=['$scope','$element','$transclude',function($scope,$element,$transclude){if(!$transclude){throw new Error('Illegal use of ngMultiTransclude controller. No directive '+'that requires a transclusion found.');}
this.$element=$element;this.isChildOf=function(otherCtrl){return otherCtrl.$element[0].contains(this.$element[0]);};var toTransclude;$scope.$on('$destroy',function(){if(toTransclude){toTransclude.remove();toTransclude=null;}});var transcludeContainer=angular.element('<div style="display:none;"></div>');this.transclude=function(name,element){for(var i=0;i<toTransclude.length;++i){var el=angular.element(toTransclude[i]);if(el.attr('name')===name){element.empty();element.append(el);return;}}};this.transcluded=function(){if(transcludeContainer){transcludeContainer.remove();transcludeContainer=null;}};$transclude(function(clone){toTransclude=clone;transcludeContainer.append(clone);$element.append(transcludeContainer);});}];module.directive('ngMultiTemplate',function(){return{transclude:true,templateUrl:function(element,attrs){return attrs.ngMultiTemplate;},controller:Ctrl,link:function(scope,element,attrs,ctrl){ctrl.transcluded();}};});module.directive('ngMultiTranscludeController',function(){return{controller:Ctrl,link:function(scope,element,attrs,ctrl){ctrl.transcluded();}};});module.directive('ngMultiTransclude',function(){return{require:['?^ngMultiTranscludeController','?^ngMultiTemplate'],link:function(scope,element,attrs,ctrls){var ctrl1=ctrls[0];var ctrl2=ctrls[1];var ctrl;if(ctrl1&&ctrl2){ctrl=ctrl1.isChildOf(ctrl2)?ctrl1:ctrl2;}
else{ctrl=ctrl1||ctrl2;}
if(!ctrl){throw new Error('Illegal use of ngMultiTransclude. No wrapping controller.')}
ctrl.transclude(attrs.ngMultiTransclude,element);}};});})();
;(function(angular){'use strict';angular.module('li.directives.media.lightbox',['multi-transclude']).controller('LiMediaLightboxController',['$rootScope','$scope','$document','$timeout','$window',function($rootScope,$scope,$document,$timeout,$window){var scrollX=$window.pageXOffset;var scrollY=$window.pageYOffset;$scope.$on('$destroy',function(){$window.scrollTo(scrollX,scrollY);$scope.hideLightbox();});var wait=false;$scope.handleEvent=function($event){if(!wait){wait=true;$timeout(function(){wait=false;},250);}else{return;}
switch($event.type){case'keydown':switch($event.keyCode){case 27:$scope.hideLightbox();break;case 39:$scope.next();break;case 37:case 32:$scope.previous();break;default:break;}}};}]).directive('liMediaLightbox',function(){return{restrict:'AE',templateUrl:'media/lightbox/lightbox.tpl.html',transclude:true,controller:'LiMediaLightboxController'};});})(window.LITHIUM&&LITHIUM.angular||angular);

angular.module('li.directives.media.lightbox').run(['$templateCache',function($templateCache){$templateCache.put('media/lightbox/lightbox.tpl.html','<div class="lia-media-lightbox" ng-keydown="handleEvent($event)" tabindex="0" ng-multi-transclude-controller>\n'+'  <div class="lia-lightbox-overlay" ng-click="hideLightbox()"></div>\n'+'  <div class="lia-lightbox-dialog" ng-style="dialogStyle">\n'+'    <div class="lia-close-button" ng-click=\'hideLightbox()\'>\n'+'      <span class="lia-icon-wrapper lia-lightbox-close-icon">\n'+'        <i class="lia-fa lia-fa-times lia-close-button-icon"></i>\n'+'      </span>\n'+'    </div>\n'+'    <div class="lia-lightbox-header-wrapper" ng-multi-transclude="lightbox-header"></div>\n'+'    <div class="lia-lightbox-main-content-wrapper" ng-multi-transclude="lightbox-content"></div>\n'+'    <div class="lia-lightbox-footer-wrapper" ng-multi-transclude="lightbox-footer"></div>\n'+'  </div>\n'+'</div>');}]);

(function(window,angular,undefined){'use strict';var $sanitizeMinErr=angular.$$minErr('$sanitize');function $SanitizeProvider(){this.$get=['$$sanitizeUri',function($$sanitizeUri){return function(html){var buf=[];htmlParser(html,htmlSanitizeWriter(buf,function(uri,isImage){return!/^unsafe/.test($$sanitizeUri(uri,isImage));}));return buf.join('');};}];}
function sanitizeText(chars){var buf=[];var writer=htmlSanitizeWriter(buf,angular.noop);writer.chars(chars);return buf.join('');}
var START_TAG_REGEXP=/^<((?:[a-zA-Z])[\w:-]*)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*(>?)/,END_TAG_REGEXP=/^<\/\s*([\w:-]+)[^>]*>/,ATTR_REGEXP=/([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,BEGIN_TAG_REGEXP=/^</,BEGING_END_TAGE_REGEXP=/^<\//,COMMENT_REGEXP=/<!--(.*?)-->/g,DOCTYPE_REGEXP=/<!DOCTYPE([^>]*?)>/i,CDATA_REGEXP=/<!\[CDATA\[(.*?)]]>/g,SURROGATE_PAIR_REGEXP=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,NON_ALPHANUMERIC_REGEXP=/([^\#-~| |!])/g;var voidElements=makeMap("area,br,col,hr,img,wbr");var optionalEndTagBlockElements=makeMap("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),optionalEndTagInlineElements=makeMap("rp,rt"),optionalEndTagElements=angular.extend({},optionalEndTagInlineElements,optionalEndTagBlockElements);var blockElements=angular.extend({},optionalEndTagBlockElements,makeMap("address,article,"+"aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,"+"h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,script,section,table,ul"));var inlineElements=angular.extend({},optionalEndTagInlineElements,makeMap("a,abbr,acronym,b,"+"bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,"+"samp,small,span,strike,strong,sub,sup,time,tt,u,var"));var svgElements=makeMap("circle,defs,desc,ellipse,font-face,font-face-name,font-face-src,g,glyph,"+"hkern,image,linearGradient,line,marker,metadata,missing-glyph,mpath,path,polygon,polyline,"+"radialGradient,rect,stop,svg,switch,text,title,tspan,use");var specialElements=makeMap("script,style");var validElements=angular.extend({},voidElements,blockElements,inlineElements,optionalEndTagElements,svgElements);var uriAttrs=makeMap("background,cite,href,longdesc,src,usemap,xlink:href");var htmlAttrs=makeMap('abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,'+'color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,'+'ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,'+'scope,scrolling,shape,size,span,start,summary,tabindex,target,title,type,'+'valign,value,vspace,width');var svgAttrs=makeMap('accent-height,accumulate,additive,alphabetic,arabic-form,ascent,'+'baseProfile,bbox,begin,by,calcMode,cap-height,class,color,color-rendering,content,'+'cx,cy,d,dx,dy,descent,display,dur,end,fill,fill-rule,font-family,font-size,font-stretch,'+'font-style,font-variant,font-weight,from,fx,fy,g1,g2,glyph-name,gradientUnits,hanging,'+'height,horiz-adv-x,horiz-origin-x,ideographic,k,keyPoints,keySplines,keyTimes,lang,'+'marker-end,marker-mid,marker-start,markerHeight,markerUnits,markerWidth,mathematical,'+'max,min,offset,opacity,orient,origin,overline-position,overline-thickness,panose-1,'+'path,pathLength,points,preserveAspectRatio,r,refX,refY,repeatCount,repeatDur,'+'requiredExtensions,requiredFeatures,restart,rotate,rx,ry,slope,stemh,stemv,stop-color,'+'stop-opacity,strikethrough-position,strikethrough-thickness,stroke,stroke-dasharray,'+'stroke-dashoffset,stroke-linecap,stroke-linejoin,stroke-miterlimit,stroke-opacity,'+'stroke-width,systemLanguage,target,text-anchor,to,transform,type,u1,u2,underline-position,'+'underline-thickness,unicode,unicode-range,units-per-em,values,version,viewBox,visibility,'+'width,widths,x,x-height,x1,x2,xlink:actuate,xlink:arcrole,xlink:role,xlink:show,xlink:title,'+'xlink:type,xml:base,xml:lang,xml:space,xmlns,xmlns:xlink,y,y1,y2,zoomAndPan',true);var validAttrs=angular.extend({},uriAttrs,svgAttrs,htmlAttrs);function makeMap(str,lowercaseKeys){var obj={},items=str.split(','),i;for(i=0;i<items.length;i++){obj[lowercaseKeys?angular.lowercase(items[i]):items[i]]=true;}
return obj;}
function htmlParser(html,handler){if(typeof html!=='string'){if(html===null||typeof html==='undefined'){html='';}else{html=''+html;}}
var index,chars,match,stack=[],last=html,text;stack.last=function(){return stack[stack.length-1];};while(html){text='';chars=true;if(!stack.last()||!specialElements[stack.last()]){if(html.indexOf("<!--")===0){index=html.indexOf("--",4);if(index>=0&&html.lastIndexOf("-->",index)===index){if(handler.comment)handler.comment(html.substring(4,index));html=html.substring(index+3);chars=false;}}else if(DOCTYPE_REGEXP.test(html)){match=html.match(DOCTYPE_REGEXP);if(match){html=html.replace(match[0],'');chars=false;}}else if(BEGING_END_TAGE_REGEXP.test(html)){match=html.match(END_TAG_REGEXP);if(match){html=html.substring(match[0].length);match[0].replace(END_TAG_REGEXP,parseEndTag);chars=false;}}else if(BEGIN_TAG_REGEXP.test(html)){match=html.match(START_TAG_REGEXP);if(match){if(match[4]){html=html.substring(match[0].length);match[0].replace(START_TAG_REGEXP,parseStartTag);}
chars=false;}else{text+='<';html=html.substring(1);}}
if(chars){index=html.indexOf("<");text+=index<0?html:html.substring(0,index);html=index<0?"":html.substring(index);if(handler.chars)handler.chars(decodeEntities(text));}}else{html=html.replace(new RegExp("([\\W\\w]*)<\\s*\\/\\s*"+stack.last()+"[^>]*>",'i'),function(all,text){text=text.replace(COMMENT_REGEXP,"$1").replace(CDATA_REGEXP,"$1");if(handler.chars)handler.chars(decodeEntities(text));return"";});parseEndTag("",stack.last());}
if(html==last){throw $sanitizeMinErr('badparse',"The sanitizer was unable to parse the following block "+"of html: {0}",html);}
last=html;}
parseEndTag();function parseStartTag(tag,tagName,rest,unary){tagName=angular.lowercase(tagName);if(blockElements[tagName]){while(stack.last()&&inlineElements[stack.last()]){parseEndTag("",stack.last());}}
if(optionalEndTagElements[tagName]&&stack.last()==tagName){parseEndTag("",tagName);}
unary=voidElements[tagName]||!!unary;if(!unary){stack.push(tagName);}
var attrs={};rest.replace(ATTR_REGEXP,function(match,name,doubleQuotedValue,singleQuotedValue,unquotedValue){var value=doubleQuotedValue||singleQuotedValue||unquotedValue||'';attrs[name]=decodeEntities(value);});if(handler.start)handler.start(tagName,attrs,unary);}
function parseEndTag(tag,tagName){var pos=0,i;tagName=angular.lowercase(tagName);if(tagName){for(pos=stack.length-1;pos>=0;pos--){if(stack[pos]==tagName)break;}}
if(pos>=0){for(i=stack.length-1;i>=pos;i--)
if(handler.end)handler.end(stack[i]);stack.length=pos;}}}
var hiddenPre=document.createElement("pre");function decodeEntities(value){if(!value){return'';}
hiddenPre.innerHTML=value.replace(/</g,"&lt;");return hiddenPre.textContent;}
function encodeEntities(value){return value.replace(/&/g,'&amp;').replace(SURROGATE_PAIR_REGEXP,function(value){var hi=value.charCodeAt(0);var low=value.charCodeAt(1);return'&#'+(((hi-0xD800)*0x400)+(low-0xDC00)+0x10000)+';';}).replace(NON_ALPHANUMERIC_REGEXP,function(value){return'&#'+value.charCodeAt(0)+';';}).replace(/</g,'&lt;').replace(/>/g,'&gt;');}
function htmlSanitizeWriter(buf,uriValidator){var ignore=false;var out=angular.bind(buf,buf.push);return{start:function(tag,attrs,unary){tag=angular.lowercase(tag);if(!ignore&&specialElements[tag]){ignore=tag;}
if(!ignore&&validElements[tag]===true){out('<');out(tag);angular.forEach(attrs,function(value,key){var lkey=angular.lowercase(key);var isImage=(tag==='img'&&lkey==='src')||(lkey==='background');if(validAttrs[lkey]===true&&(uriAttrs[lkey]!==true||uriValidator(value,isImage))){out(' ');out(key);out('="');out(encodeEntities(value));out('"');}});out(unary?'/>':'>');}},end:function(tag){tag=angular.lowercase(tag);if(!ignore&&validElements[tag]===true){out('</');out(tag);out('>');}
if(tag==ignore){ignore=false;}},chars:function(chars){if(!ignore){out(encodeEntities(chars));}}};}
angular.module('ngSanitize',[]).provider('$sanitize',$SanitizeProvider);angular.module('ngSanitize').filter('linky',['$sanitize',function($sanitize){var LINKY_URL_REGEXP=/((ftp|https?):\/\/|(www\.)|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>"\u201d\u2019]/i,MAILTO_REGEXP=/^mailto:/i;return function(text,target){if(!text)return text;var match;var raw=text;var html=[];var url;var i;while((match=raw.match(LINKY_URL_REGEXP))){url=match[0];if(!match[2]&&!match[4]){url=(match[3]?'http://':'mailto:')+url;}
i=match.index;addText(raw.substr(0,i));addLink(url,match[0].replace(MAILTO_REGEXP,''));raw=raw.substring(i+match[0].length);}
addText(raw);return $sanitize(html.join(''));function addText(text){if(!text){return;}
html.push(sanitizeText(text));}
function addLink(url,text){html.push('<a ');if(angular.isDefined(target)){html.push('target="',target,'" ');}
html.push('href="',url.replace(/"/g,'&quot;'),'">');addText(text);html.push('</a>');}};}]);})(window,window.angular);
;(function(angular){'use strict';angular.module('li.directives.media.document-lightbox',['li.services.plugins.localization-manager','li.directives.common.text-ready','li.directives.media.lightbox','li.directives.media.download-media','li.directives.users.user-login','ngSanitize','ngTouch']).directive('liMediaDocumentLightbox',['$sce',function($sce){return{restrict:'AE',templateUrl:'media/document-lightbox/document-lightbox.tpl.html',link:function link($scope){$scope.trustSrc=function(src){return $sce.trustAsResourceUrl(src);};}};}]);})(window.LITHIUM&&LITHIUM.angular||angular);

angular.module('li.directives.media.document-lightbox').run(['$templateCache',function($templateCache){$templateCache.put('media/document-lightbox/document-lightbox.tpl.html','<li:media-lightbox li-common-text-ready="\'media\'">\n'+'  <div name="lightbox-header">\n'+'    <div class="lia-lightbox-header-context-section lia-document-title-location">\n'+'      <span ng-bind-html="titleKey|translate:titleParams:\'messageformat\'"></span>\n'+'    </div>\n'+'  </div>\n'+'  <div name="lightbox-content" class="lia-document-body-content">\n'+'    <div class="lia-document-box-content" ng-if="viewUrl">\n'+'      <iframe ng-src="{{trustSrc(viewUrl)}}" frameborder="0"\n'+'        marginwidth="0" marginheight="0" scrolling="auto" onload=""\n'+'        allowtransparency="false" allowfullscreen=""></iframe>\n'+'    </div>\n'+'    <div class="lia-document-error" ng-if="errorMessage">\n'+'      <div class="lia-document-body-section">\n'+'        <span ng-bind-html="errorMessage |translate:linkParams"></span>\n'+'      </div>\n'+'    </div>\n'+'  </div>\n'+'  <div name="lightbox-footer" class="lia-lightbox-footer">\n'+'    <div class="lia-lightbox-dialog-content-wrapper">\n'+'      <div class="lia-lightbox-dialog-content">\n'+'       <div class="lia-lightbox-context">\n'+'         <li:users-user-login user="author" mode="mode"></li:users-user-login>\n'+'         <span class="post-date">{{postTimeFriendly}}</span>\n'+'       </div>\n'+'       <div class="lia-lightbox-actions">\n'+'         <li:media-download-media li-media-url="downloadUrl" li-type="\'document\'"></li:media-download-media>\n'+'       </div>\n'+'     </div>\n'+'    </div>\n'+'  </div>\n'+'</li:media-lightbox>\n'+'');}]);
;(function(angular){'use strict';angular.module('li.directives.media.document-lightbox-trigger',['li.services.media.document-manager','li.services.messages.message-manager','li.directives.media.document-lightbox','ui.bootstrap']).directive('liMediaDocumentLightboxTrigger',['$liDocumentManager','$liMessageManager','$uibModal','$log','$location',function($liDocumentManager,$liMessageManager,$uibModal,$log,$location){return{restrict:'A',scope:{liMsgId:'@',liMediaId:'@',liDownloadUrl:'@',liAttachmentName:'@',liAttachmentId:'@'},link:function link($scope,$element){var modalOpened=false;var modal;function setDocumentLightboxErrorMessage(){$scope.errorMessage='li.media.document-lightbox.error.message';}
function prepareDocumentLightbox(mediaId){$liDocumentManager.getViewUrl(mediaId).then(function(viewUrl){if(viewUrl){$scope.viewUrl=viewUrl;}else{setDocumentLightboxErrorMessage();}});}
$scope.openDocumentLightbox=function(){$scope.downloadUrl=$scope.liDownloadUrl;$scope.viewUrl=null;if(!$scope.liMediaId){$log.debug('need to upload first');$liDocumentManager.uploadAttachment($scope.liMsgId,$scope.liAttachmentId).then(function(mediaId){if(mediaId){prepareDocumentLightbox(mediaId);}else{setDocumentLightboxErrorMessage();}});}else{prepareDocumentLightbox($scope.liMediaId);}
$scope.titleKey='li.media.document-lightbox.title';$scope.titleParams={};$scope.titleParams.attachmentName=$scope.liAttachmentName;$liMessageManager.getMessageById($scope.liMsgId).then(function(message){if(message){$scope.postTimeFriendly=message.post_time_friendly;$scope.author=message.author;}}).finally(function(){if(!modalOpened){modal=$uibModal.open({template:'<li:media-document-lightbox></li:media-document-lightbox>',scope:$scope,windowTopClass:'lia-document-lightbox'});modalOpened=true;}
$scope.hideLightbox=function(){$location.search('attachment-id',null);modal.close();modalOpened=false;};});};var attachmentId=$location.search()['attachment-id'];if(attachmentId!==undefined&&attachmentId===$scope.liAttachmentId){$scope.openDocumentLightbox();}
$element.on('click',function($event){$event.preventDefault();$location.search('attachment-id',$scope.liAttachmentId);$scope.openDocumentLightbox();});}};}]);})(window.LITHIUM&&LITHIUM.angular||angular);
;(function(angular){'use strict';angular.module('li.directives.common.non-bindable',[]).directive('liCommonNonBindable',['$document','$compile','$rootScope',function($document,$compile,$rootScope){return{restrict:'A',compile:function compile($element){var allowedElements=$element[0].querySelectorAll('[li-bindable]');angular.forEach(allowedElements,function(elm){$compile(angular.element(elm))($rootScope);});},terminal:true,priority:1000};}]);})(window.LITHIUM&&LITHIUM.angular||angular);
